HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page   1
BASIC   Z80

    1                   ; -----------------------------------------------------
    2                   ;	Originalquelltext des KC-BASIC-ROM BM 600
    3                   ;	- angepasst zu Erzeugung mit CAOS-Vorblock
    4                   ;	- modifiziert zur Assemblierung mit SLRZ80
    5                   ;		SLRZ80 BASIC/F
    6                   ;		REN BASIC.COM BASIC.KCC
    7                   ;	- verschiedene Kommentare ergaenzt durch
    8                   ;	  Mario Leubner und Frank Ludwig
    9                   ;
   10                   ; 24.01.2021: LIST gepatcht, sodass bei Anzeige keine
   11                   ; undefinierten Erweiterungstoken mit beruecksichtigt
   12                   ; werden (bei MC in BASIC-Zeile)
   13                   ;
   14                   ; 29.05.2021: Notizspeicher-Erstbelegung korrigiert auf
   15                   ; Adresse 0300H. Der Sprung zu BASIC-Warmstart fuehrte
   16                   ; 3 Byte vor das eigentliche Ziel aus nicht erklaertem
   17                   ; Grund.
   18                   ;
   19                   ; Mario Leubner			26.07.2013 - 16.02.2022
   20                   ; -----------------------------------------------------
   21                   .xcref
   22                   .z80
   24                   	aseg
   25                   
   26                   ;************************************************ 
   27         C000      ROMBEG	EQU	0C000H	; INTERPRETERANFANGSADR.
   28         0300      RAMBEG	EQU	300H	; RAMANFANGSADR.
   29         0300      WSP	EQU	RAMBEG
   30         0401      PRAM	EQU	WSP+257	; PROGRAMMSPEICHERANFADR.
   31         0000      ZFT	EQU	0	; WSP<PRAM
   32         0001      BIN0IO	EQU	1	; BINAERE NULLEN SIND
   33                   			; ALS I/O-DATEN MOEGLICH
   34         E003      EXTGO1	EQU	0E003H	; BASIC-Erweiterung 1
   35         E006      EXTGO2	EQU	0E006H	; BASIC-Erweiterung 2
   36         E009      EXTGO3	EQU	0E009H	; BASIC-Erweiterung 3
   37         E00C      EXTTAB	EQU	0E00CH	; Token-Tabelle der Erweiterungen
   38         E00E      VERT	EQU	0E00EH	; BASIC Programmverteiler
   39                   ;------------------------------------------------
   40                   ; CAOS-Vorblock:
   41 0100  42 41 53 49 	DB	'BASIC   KCC'	; Dateiname
   42 010B  00 00 00 00 	DS	5,0
   43 0110  02          	DB	2		; 2 Argumente
   44 0111  C000        	DW	ROMBEG		; Anfangsadresse
   45 0113  E000        	DW	ROMEND		; Endadresse
   46 0115  0000        	DW	0
   47 0117  00 00 00 00 	DS	95,0
   48                   ;	DB	'07.01.1987'	; Datum
   49 0176  32 39 2E 30 	DB	'29.05.2021'	; Datum
   50                   ;---------------
   51                   	.PHASE	ROMBEG
   52                   
  117                   .LIST
  118                   ; NOTIZSPEICHERVEREINBARUNG	Adresse	Beschreibung (teilweise nach Horst Voelz)
  119                   ;				-----	----------------------------------------
  120         0300      RSTLOC	EQU	WSP		;0300	Sprungbefehl Warmstart (REBASIC)
  121         0303      USRLOC	EQU	RSTLOC+3	;0303	Sprungbefehl in die USR(X)-Funktion
  122         0306      PORTAD	EQU	USRLOC+3	;0306	Portadresse Variable
  123         0307      IOCHNL	EQU	PORTAD+1	;0307	E/A-Flag
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page   2
BASIC   Z80

  124                   	; Bezeichnung der Bit-Nummern im E/A-Flag
  125         0000      IM_	EQU	0
  126         0001      OM_	EQU	1
  127         0002      IM?	EQU	2
  128         0003      OM?	EQU	3
  129         0004      IM??	EQU	4
  130         0005      OM??	EQU	5
  131         0006      CIM	EQU	6	; unbenutzt?
  132         0007      COM	EQU	7	; unbenutzt?
  133         0308      OUTIND	EQU	IOCHNL+1	;0308	OUT-Index
  134         0309      ININD	EQU	OUTIND+1	;0309	IN-Index
  135         030A      TRFLAG	EQU	ININD+1		;030A	TRACE-Flag
  136         030B      DIVVAR	EQU	TRFLAG+1	;030B	Schnelle SBC-Routine fuer Gleitkommadivision
  137         030C      DVAR1	EQU	DIVVAR+1	;030C	DIV-Variable 1
  138         0310      DVAR2	EQU	DIVVAR+5	;0310	DIV-Variable 2
  139         0314      DVAR3	EQU	DIVVAR+9	;0314	DIV-Variable 3
  140         0317      DVAR4	EQU	DIVVAR+12	;0317	DIV-Variable 4
  141         0319      RNDVR1	EQU	DVAR4+2		;0319	RND-Variable 1
  142         031A      RNDVR2	EQU	RNDVR1+1	;031A	RND-Variable 2
  143         031B      RNDVR3	EQU	RNDVR2+1	;031B	RND-Variable 3
  144         033C      RNDVR4	EQU	RNDVR3+33	;033C	RND-Variable 4
  145                   				;1 Byte fuer RNDVR3
  146                   				;32 Byte Array mit 8 Konstanten ohne Markennamen
  147         0340      DUMMY	EQU	RNDVR4+4	;0340	Anzahl Dummy-Zeichen (NULL X)
  148         0341      LINLEN	EQU	DUMMY+1		;0341	Ausgabezeilenlaenge
  149         0342      PRLISI	EQU	LINLEN+1	;0342	Anzahl darstellbarer Formate pro Zeile -1
  150                   				;	Formatlaenge (13)+1=27
  151         0343      OUTFLG	EQU	PRLISI+1	;0343	Ausgabeunterdrueckung wenn Zelle <> 0
  152         0344      LINFLG	EQU	OUTFLG+1	;0344	Zeilenanzahl fuer List (normal = 10)
  153         0346      LNFLGC	EQU	LINFLG+2	;0346	Kopie von 0344
  154         0348      CHSUML	EQU	LNFLGC+2	;0348	Pruefsumme fuer CLOAD* und CSAVE*
  155         034A      INPLOC	EQU	CHSUML+2	;034A	Eingeberoutine fuer Daten
  156         034D      AUTOFG	EQU	INPLOC+3	;034D	AUTO-Flag
  157         034E      ANF	EQU	AUTOFG+1	;034E	aktuelle Zeilennummer
  158         0350      ENDE	EQU	ANF+2		;0350	Zeilennummer-Abstand
  159         0352      NANF	EQU	ENDE+2		;0352
  160         0354      DISTAN	EQU	NANF+2		;0354
  161         0356      STDPTR	EQU	DISTAN+2	;0356	RAM-Mindestgroesse
  162         0358      CULINO	EQU	STDPTR+2	;0358	aktuelle Zeilennummer
  163         035A      WINJP	EQU	CULINO+2	;035A
  164         035D      DATBYT	EQU	WINJP+3		;035D	1=geschuetzte Datei erzeugen (Kopierschutz)
  165         035E      DATFLG	EQU	DATBYT+1	;035E	1=LIST/EDIT/BYE-Schutz
  166         035F      PSTBEG	EQU	DATFLG+1	;035F	PROGRAMMSTART-ADRESSE
  167         0361      INPBUF	EQU	PSTBEG+2	;0361	EINGABEPUFFERANFANG
  168         03AB      EOINPB	EQU	INPBUF+74	;03AB	EINGABEPUFFERENDE
  169         03AC      CURPOS	EQU	EOINPB+1	;03AC	CURSORPOSITION
  170         03AD      LOCCRE	EQU	CURPOS+1	;03AD	SUCHE VARIABLE (0) ODER FUEGE SIE EIN (1)
  171         03AE      DATYPE	EQU	LOCCRE+1	;03AE	DATENTYP
  172         03AF      DSTMNT	EQU	DATYPE+1	;03AF	DATA-STATEMENS-FLAG
  173         03B0      MEMSIZ	EQU	DSTMNT+1	;03B0	MEMORY SIZE (Speicherende, Anfang Stringraum)
  174         03B2      SPTPTR	EQU	MEMSIZ+2	;03B2	ADRESSE DER NAECHSTEN FREIEN STELLE IN LSPT
  175         03B4      LSPTBG	EQU	SPTPTR+2	;03B4	SRING-ADRESSTABELLE
  176         03BF      EOLSPT	EQU	LSPTBG+11	;03BF	ENDE DER TABELLE
  177         03C0      STRDAT	EQU	EOLSPT+1	;03C0	LAENGE UND ADRESSE DES AKTUELLEN STRINGS
  178         03C4      SWAPTR	EQU	STRDAT+4	;03C4	ZEIGER FUER STRINGBER.
  179         03C6      LBYTEX	EQU	SWAPTR+2	;03C6	INDEX DES ZULETZT ABGEARBEITETEN BYTES
  180         03C8      CSTFOR	EQU	LBYTEX+2	;03C8	ADRESSE DES PROGRAMMZEIGERS WAEHREND DER
  181                   				;	SUCHE NACH EINER VORHERIGEN FOR-ANWEISUNG
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page   3
BASIC   Z80

  182         03CA      DATPTR	EQU	CSTFOR+2	;03CA	ZEILENNUMMER DES ZULETZT GELESENEN DATASTATEMENTS
  183         03CC      FORFLG	EQU	DATPTR+2	;03CC	FOR-FLAG
  184         03CD      IPHFLG	EQU	FORFLG+1	;03CD	INPUT-PHASE-FLAG
  185         03CE      RDFLAG	EQU	IPHFLG+1	;03CE	RD/WR-FLAG
  186         03CF      CUSTMT	EQU	RDFLAG+1	;03CF	ZEILENNUMMER/ADRESSE DES AKTUELLEN STATEMENTS
  187         03D1      NTOKPT	EQU	CUSTMT+2	;03D1	ADRESSE DES NAECHSTEN ELEMENTS 
  188         03D3      LLNOEX	EQU	NTOKPT+2	;03D3	LETZTE ZEILENNUMMER BEI END/STOP
  189         03D5      LBYTER	EQU	LLNOEX+2	;03D5	ADRESSE DES LETZTEN BYTES BEI ERROR
  190         03D7      SVARPT	EQU	LBYTER+2	;03D7	ADRESSE DER LISTE DER EINFACHEN- UND STRINGVAR. (Programm-Ende+1)
  191         03D9      DVARPT	EQU	SVARPT+2	;03D9	ADRESSE DER LISTE DER FELDVARIABLEN
  192         03DB      FSLPTR	EQU	DVARPT+2	;03DB	ERSTE FREIE ADRESSE HINTER DEN Variablen-LISTEN
  193         03DD      RDPTR	EQU	FSLPTR+2	;03DD	AKT. ADRESSE IM DATA-STATEMENT WAEHREND READ
  194         03DF      FNPTR	EQU	RDPTR+2		;03DF	ADRESSE DES FN-Statements
  195         03E1      WRA0	EQU	FNPTR+2		;03E1	ARITHMETIKREGISTER 0
  196         03E5      WRA1	EQU	WRA0+4		;03E5	ARITHMETIKREGISTER 1
  197         03E9      SGNORS	EQU	WRA1+4		;03E9	VORZEICHEN DER OPERATION
  198         03EA      INTPRB	EQU	SGNORS+1	;03EA	PRINT-PUFFER
  199         03F7      WRA2	EQU	INTPRB+13	;03F7	ARITHMETIKREGISTER 2
  200         03FB      LSTFLG	EQU	WRA2+4		;03FB	Listen-Flag (Status) 0=Grundliste; 1=Erweiterung
  201         03FC      EXTFLG	EQU	LSTFLG+1	;03FC	Erweiterungsflag, 0 = Erweiterung nicht vorhanden
  202         03FD      PRTFLG	EQU	EXTFLG+1	;03FD	PRINT-Erweiterungsflag, 0 = ohne PRINT-Erweiterung
  203         03FE      COLRET	EQU	PRTFLG+1	;03FE	Farbbyte
  204                    
  205                   ;STEUERZEICHENVEREINBARUNG bzw. Tastencodes
  206         0007      ASCBEL	EQU	07H	;BEEP
  207         000D      ASCCR	EQU	0DH	;CR bzw. Enter-Taste
  208         0020      ASCSP	EQU	20H	;Leerzeichen
  209         0008      CURLFT	EQU	8	;Cursor nach links
  210         0009      CURRGT	EQU	9	;Cursor nach rechts
  211         001F      CURDEL	EQU	1FH	;DEL = Zeichen loeschen
  212         001A      CURSP	EQU	1AH	;INS = Zeichen einfuegen
  213         000A      CURDWN	EQU	0AH	;Cursor nach unten
  214         000B      CURHIG	EQU	0BH	;Cursor nach oben
  215         0018      CURRE	EQU	18H	;Shift+Cursor rechts
  216         0019      CURLI	EQU	19H	;Shift+Cursor links
  217         0002      CLLN	EQU	2	;Shift+DEL
  218         001C      LISTSW	EQU	1CH	;LIST-Taste
  219         001D      RUNSW	EQU	1DH	;RUN-Taste
  220         0013      PAUSSW	EQU	13H	;PAUSE-Taste
  221         0003      STOPSW	EQU	03H	;BRK-Taste
  222         001E      CONTSW	EQU	1EH	;CONTINUE-Taste
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page   4
BASIC   Z80

  224                   ;	ORG	ROMBEG
  225                    
  226 C000  18 0B       BA:	JR	PRIST1	;NEUSTART DES INTERPRETERS
  227 C002  C3 C08C     	JP	SECST	;RESTART  --"--
  228                   ;-------------------------------
  229 C005  7F7F        	DEFW	7F7FH
  230 C007  42 41 53 49 	DEFM	'BASIC'
  231 C00C  00          	DEFB	0
  232                   ;-------------------------------
  233 C00D              PRIST1:
  234                   ;LADE DIE ERSTEN 98 SPEICHERPLAETZE DES
  235                   ;NOTIZSPEICHERS MIT ERSTBELEGUNG
  236                   ;RESERVIERE EIN STACKNIVEAU
  237 C00D              LDWSP:	
  238 C00D  21 C0BD     	LD	HL,RAMST
  239 C010  11 0300     	LD	DE,WSP
  240 C013  01 0067     	LD	BC,PSTBEG-RSTLOC+8
  241 C016  ED B0       	LDIR
  242 C018  EB          	EX	DE,HL
  243 C019  F9          	LD	SP,HL
  244 C01A  CD C669     	CALL	INITR		; Stackpointer auf obere RAM-Grenze einstellen
  245 C01D  32 03AB     	LD	(EOINPB),A
  246 C020  32 0400     	LD	(PRAM-1),A
  247                   ;RESERVIERE ARBEITSRAMBEREICH
  248 C023  21 C092     RESSP:	LD	HL,MEMO		; HC-BASIC
  249 C026  CD D1C9     	CALL	TEXTO
  250 C029  21 C0AE     	LD	HL,MEMSZ	; MEMORY END ?
  251 C02C  CD D1C9     	CALL	TEXTO
  252 C02F  CD C5AE     	CALL	EING		; Eingabe Speicherende
  253 C032  21 0362     	LD	HL,INPBUF+1	; Eingabepuffer
  254 C035  CD C986     	CALL	DCHEX		; Erfassen der eingegebenen Dezimalzahl
  255 C038  7A          	LD	A,D
  256 C039  D6 06       	SUB	6		;H(RAMBEG)+3
  257 C03B  21 0300     	LD	HL,RAMBEG
  258 C03E  2B          	DEC	HL
  259 C03F  30 03       	JR	NC,RAMSH1
  260 C041  11 BFFF     RAMSCH:	LD	DE,ROMBEG-1
  261                   ;SELBSTTAETIGE RAM-SUCHE BIS MAX. <DE>
  262 C044  23          RAMSH1:	INC	HL
  263 C045  CD C689     	CALL	CPREG
  264 C048  28 09       	JR	Z,RAMTST
  265 C04A  7E          	LD	A,(HL)
  266 C04B  47          	LD	B,A
  267 C04C  2F          	CPL
  268 C04D  77          	LD	(HL),A
  269 C04E  BE          	CP	(HL)
  270 C04F  70          	LD	(HL),B
  271 C050  28 F2       	JR	Z,RAMSH1
  272 C052  2B          	DEC	HL
  273 C053  11 FF00     RAMTST:	LD	DE,-256
  274 C056  22 03B0     	LD	(MEMSIZ),HL
  275 C059  19          	ADD	HL,DE
  276 C05A  22 0356     	LD	(STDPTR),HL
  277 C05D  CD C641     	CALL	NEW1
  278 C060  2A 0356     	LD	HL,(STDPTR)
  279 C063  11 FBEF     	LD	DE,-PRAM-16
  280 C066  19          	ADD	HL,DE
  281                   ;QUITTIEREN DES ERFOLGREICHEN STARTS
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page   5
BASIC   Z80

  282 C067  CD D829     	CALL	NUMBO
  283 C06A  21 C0A0     	LD	HL,BYT
  284 C06D  CD D1C9     	CALL	TEXTO
  285                   ;
  286                   ; Test, ob Erweiterungen vorhanden sind. Dazu wird der Inhalt der
  287                   ; Speicherzelle gelesen, auf die E004H zeigt. Wenn BASIC-Erweiterungen
  288                   ; vorhanden sind, dann beginnen diese mit LD A,B = 78H
  289                   ;
  290 C070  2A E004     	LD	HL,(EXTGO1+1)
  291 C073  7E          	LD	A,(HL)
  292 C074  FE 78       	CP	78H		; Befehl LD A,B
  293 C076  20 01       	JR	NZ,RAMSH0
  294 C078  3E          	DEFB	3EH		; LD A,0AFH - Erweiterungen vorhanden
  295 C079  AF          RAMSH0:	XOR	A		; A=0	    - keine Erweiterungen
  296 C07A  32 03FC     	LD	(EXTFLG),A
  297 C07D  31 0367     	LD	SP,INPBUF+6
  298 C080  18 0A       	JR	SECST
  299                   ;WARMSTART DES INTERPRETERS
  300                   ;--------------------------------
  301 C082  7F7F        	DEFW	7F7FH
  302 C084  52 45 42 41 	DEFM	'REBASIC'
  303 C08B  00          	DEFB	0
  304                   ;--------------------------------
  305 C08C  CD C669     SECST:	CALL	INITR		; Stackpointer auf obere RAM-Grenze einstellen
  306 C08F  C3 C388     	JP	EDIT
  307                    
  308 C092  0C          MEMO:	DEFB	0CH		;CLS
  309 C093  0D0A        	DEFW	0D0AH
  310 C095  4B 43 2D 42 	DEFM	'KC-BASIC'	; Original: HC-BASIC
  311 C09D  0D0A        	DEFW	0D0AH
  312 C09F  00          	DEFB	0
  313 C0A0  20 42 59 54 BYT:	DEFM	' BYTES FREE'
  314 C0AB  0D0A        	DEFW	0D0AH
  315 C0AD  00          	DEFB	0
  316 C0AE  4D 45 4D 4F MEMSZ:	DEFM	'MEMORY END ? :'
  317 C0BC  00          	DEFB	0
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page   6
BASIC   Z80

  319                   ;NOTIZSPEICHER ERSTBELEGUNG
  320 C0BD              RAMST:	;JP	SECST-3	;RSTLOC
  321                   ;
  322                   ; 29.05.2021: Sprungziel BASIC-Warmstart von SECST-3 zu SECST geaendert.
  323                   ; Warum das urspruenglich drei Byte davor geht, ist nicht bekannt.
  324                   ; Macht keinen Sinn, jedoch auch keinen Schaden.
  325                   ;
  326 C0BD  C3 C08C     	JP	SECST	;RSTLOC
  327 C0C0  C3 C967     	JP	FCER	;USRLOC
  328 C0C3  00          	DEFB	0	;PORTAD	;TORADRESSE VARIABEL
  329 C0C4  00          	DEFB	0	;IOCHNL ;E/A-FLAG
  330 C0C5  00          	DEFB	0	;OUTIND	;OUTINDEX
  331 C0C6  00          	DEFB	0	;ININD	;ININDEX
  332 C0C7  00          	DEFB	0	;TRFLAG	;TRACE-FLAG
  333 C0C8  D6 00       	SUB	0	;DIVVAR	;SUB VAR.
  334                   			;FOR DIV;DVAR1
  335 C0CA  6F          	LD	L,A
  336 C0CB  7C          	LD	A,H
  337 C0CC  DE 00       	SBC	A,0	;DVAR2
  338 C0CE  67          	LD	H,A
  339 C0CF  78          	LD	A,B
  340 C0D0  DE 00       	SBC	A,0	;DVAR3
  341 C0D2  47          	LD	B,A
  342 C0D3  3E 00       	LD	A,0	;DVAR4
  343 C0D5  C9          	RET
  344                   
  345 C0D6  00          	DEFB	0	;RNDVR1		Zaehler 0..170
  346 C0D7  00          	DEFB	0	;RNDVR2		Index fuer 3 Konstanten im ROM (RNDL)
  347 C0D8  00          	DEFB	0	;RNDVR3		Index fuer 8 Konstanten im WSP (RNDVR3+1)
  348 C0D9  4A35        	DEFW	4A35H	;-2.65145*10E+7
  349 C0DB  99CA        	DEFW	99CAH
  350 C0DD  1C39        	DEFW	1C39H	; 1.61291*10E+7
  351 C0DF  9876        	DEFW	9876H
  352 C0E1  9522        	DEFW	9522H	;-1.17691*10E+7
  353 C0E3  98B3        	DEFW	98B3H
  354 C0E5  DD0A        	DEFW	0DD0AH	; 1.30983*10E+7
  355 C0E7  9847        	DEFW	9847H
  356 C0E9  D153        	DEFW	0D153H	;-2.01612*10E+7
  357 C0EB  9999        	DEFW	9999H
  358 C0ED  1A0A        	DEFW	1A0AH	;-1.04269*10E+7
  359 C0EF  989F        	DEFW	989FH
  360 C0F1  BC65        	DEFW	0BC65H	;-1.34831*10E+7
  361 C0F3  98CD        	DEFW	98CDH
  362 C0F5  77D6        	DEFW	77D6H	; 1.24825*10E+7
  363 C0F7  983E        	DEFW	983EH
  364 C0F9  C752        	DEFW	0C752H	;RNDVR4	;.811635	zuletzt mit RND erzeugte Zahl
  365 C0FB  804F        	DEFW	804FH
  366 C0FD  0B          	DEFB	11	;DUMMY	;ANZAHL DER DUMMY-ZEICHEN +1
  367 C0FE  FF          	DEFB	255	;LINLEN	;AUSGABEZEILENLAENGE
  368 C0FF  1B          	DEFB	27	;PRLISI	;(ANZAHL DER DARSTELLBAREN FORMATE PRO ZEILE -1)*
  369                   			;FORMATLAENGE (13) + 1
  370 C100  00          	DEFB	0	;OUTFLG	;AUSGABEUNTERDRUECKUNG WENN <> 0
  371 C101  000A        	DEFW	10	;LINFLG	;ZEILENANZAHL FUER LIST
  372 C103  000A        	DEFW	10	;LNFLGC	;COPY VON LINFLG
  373 C105  0000        	DEFW	0	;CHSUML	;PRUEFSUMME FUER CSAVE* UND CLOAD*
  374 C107  C3 C5AE     	JP	EING	;INPLOC	;EINGABEROUTINE FUER DATEN
  375 C10A  00          	DEFB	0	;AUTOFG	;AUTO-FLAG
  376 C10B  0000        	DEFW	0	;ANF	;AKT. ZEILENNUMMER
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page   7
BASIC   Z80

  377 C10D  0000        	DEFW	0	;ENDE	;ZEILENNR.-ABSTAND
  378 C10F  0000        	DEFW	0	;NANF
  379 C111  0000        	DEFW	0	;DISTAN
  380 C113  0465        	DEFW	PRAM+100;STDPTR	;RAM-MINDESTGROESSE
  381                   			;UNTERE STRINGBEREICHSADRESSE
  382 C115  FFFE        	DEFW	65534	;CULINO	;AKT. ZEILENNUMMER
  383 C117  0000        	DEFW	0	;WINJP
  384 C119  C9          	DEFB	0C9H
  385 C11A  0000        	DEFW	0	;DATBYT,DATFLG
  386 C11C  0401        	DEFW	PRAM	;PSTBEG	;PROGRAMMADRESSE
  387 C11E  0000        	DEFW	0	;INPBUF-INITIALISIERUNG
  388 C120  00          	DEFB	0
  389                   ;****************************
  390                   ;LISTE DER RESERVIERTEN WORTE, ABGESCHLOSSEN MIT 80H
  391 C121  C5          MNEMTB:	DEFB	'E'+80H		;80H
  392 C122  4E 44       	DEFM	'ND'
  393         0080      ENDTOK	EQU	80H
  394 C124  C6          	DEFB	'F'+80H		;81H
  395 C125  4F 52       	DEFM	'OR'
  396         0081      FORTOK	EQU	81H
  397 C127  CE          	DEFB	'N'+80H		;82H
  398 C128  45 58 54    	DEFM	'EXT'
  399         0082      NEXTOK	EQU	82H
  400 C12B  C4          	DEFB	'D'+80H		;83H
  401 C12C  41 54 41    	DEFM	'ATA'
  402         0083      DATTOK	EQU	83H
  403 C12F  C9          	DEFB	'I'+80H		;84H
  404 C130  4E 50 55 54 	DEFM	'NPUT'
  405         0084      INPTOK	EQU	84H
  406 C134  C4          	DEFB	'D'+80H		;85H
  407 C135  49 4D       	DEFM	'IM'
  408         0085      DIMTOK	EQU	85H
  409 C137  D2          	DEFB	'R'+80H		;86H
  410 C138  45 41 44    	DEFM	'EAD'
  411         0086      REATOK	EQU	86H
  412 C13B  CC          	DEFB	'L'+80H		;87H
  413 C13C  45 54       	DEFM	'ET'
  414         0087      LETTOK	EQU	87H
  415 C13E  C7          	DEFB	'G'+80H		;88H
  416 C13F  4F 54 4F    	DEFM	'OTO'
  417         0088      GTOTOK	EQU	88H
  418 C142  D2          	DEFB	'R'+80H		;89H
  419 C143  55 4E       	DEFM	'UN'
  420         0089      RUNTOK	EQU	89H
  421 C145  C9          	DEFB	'I'+80H		;8AH
  422 C146  46          	DEFM	'F'
  423         008A      IFTOK	EQU	8AH
  424 C147  D2          	DEFB	'R'+80H		;8BH
  425 C148  45 53 54 4F 	DEFM	'ESTORE'
  426         008B      RSTTOK	EQU	8BH
  427 C14E  C7          	DEFB	'G'+80H		;8CH
  428 C14F  4F 53 55 42 	DEFM	'OSUB'
  429         008C      GSBTOK	EQU	8CH
  430 C153  D2          	DEFB	'R'+80H		;8DH
  431 C154  45 54 55 52 	DEFM	'ETURN'
  432         008D      RETTOK	EQU	8DH
  433 C159  D2          	DEFB	'R'+80H		;8EH
  434 C15A  45 4D       	DEFM	'EM'
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page   8
BASIC   Z80

  435         008E      REMTOK	EQU	8EH
  436 C15C  D3          	DEFB	'S'+80H		;8FH
  437 C15D  54 4F 50    	DEFM	'TOP'
  438         008F      STOTOK	EQU	8FH
  439 C160  CF          	DEFB	'O'+80H		;90H
  440 C161  55 54       	DEFM	'UT'
  441         0090      OUTTOK	EQU	90H
  442 C163  CF          	DEFB	'O'+80H		;91H
  443 C164  4E          	DEFM	'N'
  444         0091      ONTOK	EQU	91H
  445 C165  CE          	DEFB	'N'+80H		;92H
  446 C166  55 4C 4C    	DEFM	'ULL'
  447         0092      NULTOK	EQU	92H
  448 C169  D7          	DEFB	'W'+80H		;93H
  449 C16A  41 49 54    	DEFM	'AIT'
  450         0093      WAITOK	EQU	93H
  451 C16D  C4          	DEFB	'D'+80H		;94H
  452 C16E  45 46       	DEFM	'EF'
  453         0094      DEFTOK	EQU	94H
  454 C170  D0          	DEFB	'P'+80H		;95H
  455 C171  4F 4B 45    	DEFM	'OKE'
  456         0095      POKTOK	EQU	95H
  457 C174  C4          	DEFB	'D'+80H		;96H
  458 C175  4F 4B 45    	DEFM	'OKE'
  459         0096      DOKTOK	EQU	96H
  460 C178  C1          	DEFB	'A'+80H		;97H
  461 C179  55 54 4F    	DEFM	'UTO'
  462         0097      AUTTOK	EQU	97H
  463 C17C  CC          	DEFB	'L'+80H		;98H
  464 C17D  49 4E 45 53 	DEFM	'INES'
  465         0098      LINTOK	EQU	98H
  466 C181  C3          	DEFB	'C'+80H		;99H
  467 C182  4C 53       	DEFM	'LS'
  468         0099      CLSTOK	EQU	99H
  469 C184  D7          	DEFB	'W'+80H		;9AH
  470 C185  49 44 54 48 	DEFM	'IDTH'
  471         009A      WIDTOK	EQU	9AH
  472 C189  C2          	DEFB	'B'+80H		;9BH
  473 C18A  59 45       	DEFM	'YE'
  474         009B      BYETOK	EQU	9BH
  475 C18C  A1          	DEFB	'!'+80H		;9CH
  476         009C      RMTOK	EQU	9CH
  477 C18D  C3          	DEFB	'C'+80H		;9DH
  478 C18E  41 4C 4C    	DEFM	'ALL'
  479         009D      CALTOK	EQU	9DH
  480 C191  D0          	DEFB	'P'+80H		;9EH
  481 C192  52 49 4E 54 	DEFM	'RINT'
  482         009E      PNTTOK	EQU	9EH
  483 C196  C3          	DEFB	'C'+80H		;9FH
  484 C197  4F 4E 54    	DEFM	'ONT'
  485         009F      CONTOK	EQU	9FH
  486 C19A  CC          	DEFB	'L'+80H		;A0H
  487 C19B  49 53 54    	DEFM	'IST'
  488         00A0      LISTOK	EQU	0A0H
  489 C19E  C3          	DEFB	'C'+80H		;A1H
  490 C19F  4C 45 41 52 	DEFM	'LEAR'
  491         00A1      CLETOK	EQU	0A1H
  492 C1A3  C3          	DEFB	'C'+80H		;A2H
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page   9
BASIC   Z80

  493 C1A4  4C 4F 41 44 	DEFM	'LOAD'
  494         00A2      CLOTOK	EQU	0A2H
  495 C1A8  C3          	DEFB	'C'+80H		;A3H
  496 C1A9  53 41 56 45 	DEFM	'SAVE'
  497         00A3      CSATOK	EQU	0A3H
  498 C1AD  CE          	DEFB	'N'+80H		;A4H
  499 C1AE  45 57       	DEFM	'EW'
  500         00A4      NEWTOK	EQU	0A4H
  501 C1B0  D4          	DEFB	'T'+80H		;A5H
  502 C1B1  41 42 28    	DEFM	'AB('
  503         00A5      TABTOK	EQU	0A5H
  504 C1B4  D4          	DEFB	'T'+80H		;A6H
  505 C1B5  4F          	DEFM	'O'
  506         00A6      TOTOK	EQU	0A6H
  507 C1B6  C6          	DEFB	'F'+80H		;A7H
  508 C1B7  4E          	DEFM	'N'
  509         00A7      FNTOK	EQU	0A7H
  510 C1B8  D3          	DEFB	'S'+80H		;A8H
  511 C1B9  50 43 28    	DEFM	'PC('
  512         00A8      SPCTOK	EQU	0A8H
  513 C1BC  D4          	DEFB	'T'+80H		;A9H
  514 C1BD  48 45 4E    	DEFM	'HEN'
  515         00A9      THNTOK	EQU	0A9H
  516 C1C0  CE          	DEFB	'N'+80H		;AAH
  517 C1C1  4F 54       	DEFM	'OT'
  518         00AA      NOTTOK	EQU	0AAH
  519 C1C3  D3          	DEFB	'S'+80H		;ABH
  520 C1C4  54 45 50    	DEFM	'TEP'
  521         00AB      STPTOK	EQU	0ABH
  522 C1C7  AB          	DEFB	'+'+80H		;ACH
  523         00AC      PLUTOK EQU	0ACH
  524 C1C8  AD          	DEFB	'-'+80H		;ADH
  525         00AD      MINTOK	EQU	0ADH
  526 C1C9  AA          	DEFB	'*'+80H		;AEH
  527         00AE      MULTOK	EQU	0AEH
  528 C1CA  AF          	DEFB	'/'+80H		;AFH
  529         00AF      DIVTOK	EQU	0AFH
  530 C1CB  DE          	DEFB	'^'+80H		;B0H
  531         00B0      RPOTOK	EQU	0B0H
  532 C1CC  C1          	DEFB	'A'+80H		;B1H
  533 C1CD  4E 44       	DEFM	'ND'
  534         00B1      ANDTOK	EQU	0B1H
  535 C1CF  CF          	DEFB	'O'+80H		;B2H
  536 C1D0  52          	DEFM	'R'
  537         00B2      ORTOK	EQU	0B2H
  538 C1D1  BE          	DEFB	'>'+80H		;B3H
  539         00B3      GRTTOK	EQU	0B3H
  540 C1D2  BD          	DEFB	'='+80H		;B4H
  541         00B4      EQUTOK	EQU	0B4H
  542 C1D3  BC          	DEFB	'<'+80H		;B5H
  543         00B5      LTHTOK	EQU	0B5H
  544 C1D4  D3          	DEFB	'S'+80H		;B6H
  545 C1D5  47 4E       	DEFM	'GN'
  546         00B6      SGNTOK	EQU	0B6H
  547 C1D7  C9          	DEFB	'I'+80H		;B7H
  548 C1D8  4E 54       	DEFM	'NT'
  549         00B7      INTTOK	EQU	0B7H
  550 C1DA  C1          	DEFB	'A'+80H		;B8H
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  10
BASIC   Z80

  551 C1DB  42 53       	DEFM	'BS'
  552         00B8      ABSTOK	EQU	0B8H
  553 C1DD  D5          	DEFB	'U'+80H		;B9H
  554 C1DE  53 52       	DEFM	'SR'
  555         00B9      USRTOK	EQU	0B9H
  556 C1E0  C6          	DEFB	'F'+80H		;BAH
  557 C1E1  52 45       	DEFM	'RE'
  558         00BA      FRETOK	EQU	0BAH
  559 C1E3  C9          	DEFB	'I'+80H		;BBH
  560 C1E4  4E 50       	DEFM	'NP'
  561         00BB      INTOK	EQU	0BBH
  562 C1E6  D0          	DEFB	'P'+80H		;BCH
  563 C1E7  4F 53       	DEFM	'OS'
  564         00BC      POSTOK	EQU	0BCH
  565 C1E9  D3          	DEFB	'S'+80H		;BDH
  566 C1EA  51 52       	DEFM	'QR'
  567         00BD      SQRTOK	EQU	0BDH
  568 C1EC  D2          	DEFB	'R'+80H		;BEH
  569 C1ED  4E 44       	DEFM	'ND'
  570         00BE      RNDTOK	EQU	0BEH
  571 C1EF  CC          	DEFB	'L'+80H		;BFH
  572 C1F0  4E          	DEFM	'N'
  573         00BF      LNTOK	EQU	0BFH
  574 C1F1  C5          	DEFB	'E'+80H		;C0H
  575 C1F2  58 50       	DEFM	'XP'
  576         00C0      EXPTOK	EQU	0C0H
  577 C1F4  C3          	DEFB	'C'+80H		;C1H
  578 C1F5  4F 53       	DEFM	'OS'
  579         00C1      COSTOK	EQU	0C1H
  580 C1F7  D3          	DEFB	'S'+80H		;C2H
  581 C1F8  49 4E       	DEFM	'IN'
  582         00C2      SINTOK	EQU	0C2H
  583 C1FA  D4          	DEFB	'T'+80H		;C3H
  584 C1FB  41 4E       	DEFM	'AN'
  585         00C3      TANTOK	EQU	0C3H
  586 C1FD  C1          	DEFB	'A'+80H		;C4H
  587 C1FE  54 4E       	DEFM	'TN'
  588         00C4      ATNTOK	EQU	0C4H
  589 C200  D0          	DEFB	'P'+80H		;C5H
  590 C201  45 45 4B    	DEFM	'EEK'
  591         00C5      PEKTOK	EQU	0C5H
  592 C204  C4          	DEFB	'D'+80H		;C6H
  593 C205  45 45 4B    	DEFM	'EEK'
  594         00C6      DEKTOK	EQU	0C6H
  595 C208  D0          	DEFB	'P'+80H		;C7H
  596 C209  49          	DEFM	'I'
  597         00C7      PITOK	EQU	0C7H
  598 C20A  CC          	DEFB	'L'+80H		;C8H
  599 C20B  45 4E       	DEFM	'EN'
  600         00C8      LENTOK	EQU	0C8H
  601 C20D  D3          	DEFB	'S'+80H		;C9H
  602 C20E  54 52 24    	DEFM	'TR$'
  603         00C9      STRTOK	EQU	0C9H
  604 C211  D6          	DEFB	'V'+80H		;CAH
  605 C212  41 4C       	DEFM	'AL'
  606         00CA      VALTOK	EQU	0CAH
  607 C214  C1          	DEFB	'A'+80H		;CBH
  608 C215  53 43       	DEFM	'SC'
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  11
BASIC   Z80

  609         00CB      ASCTOK	EQU	0CBH
  610 C217  C3          	DEFB	'C'+80H		;CCH
  611 C218  48 52 24    	DEFM	'HR$'
  612         00CC      CHRTOK	EQU	0CCH
  613 C21B  CC          	DEFB	'L'+80H		;CDH
  614 C21C  45 46 54 24 	DEFM	'EFT$'
  615         00CD      LFTTOK	EQU	0CDH
  616 C220  D2          	DEFB	'R'+80H		;CEH
  617 C221  49 47 48 54 	DEFM	'IGHT$'
  618         00CE      RGTTOK	EQU	0CEH
  619 C226  CD          	DEFB	'M'+80H		;CFH
  620 C227  49 44 24    	DEFM	'ID$'
  621         00CF      MIDTOK	EQU	0CFH
  622 C22A  CC          	DEFB	'L'+80H		;D0H
  623 C22B  4F 41 44    	DEFM	'OAD'
  624         00D0      LODTOK	EQU	0D0H
  625 C22E  D4          	DEFB	'T'+80H		;D1H
  626 C22F  52 4F 4E    	DEFM	'RON'
  627         00D1      TRNTOK	EQU	0D1H
  628 C232  D4          	DEFB	'T'+80H		;D2H
  629 C233  52 4F 46 46 	DEFM	'ROFF'
  630         00D2      TRFTOK	EQU	0D2H
  631 C237  C5          	DEFB	'E'+80H		;D3H
  632 C238  44 49 54    	DEFM	'DIT'
  633         00D3      EDITOK	EQU	0D3H
  634 C23B  C5          	DEFB	'E'+80H		;D4H
  635 C23C  4C 53 45    	DEFM	'LSE'
  636         00D4      ELSTOK	EQU	0D4H
  637 C23F  80          	DEFB	80H
  638         00D4      LAST	EQU	ELSTOK
  639                   ;
  640                   ;ADRESSLISTE DER UNTERPROGRAMME FUER KOMMANDOS
  641                   ;(DIRECT MODE MOEGLICH)
  642 C240  C91A        ADRTB1:	DEFW	END
  643 C242  C7DE        	DEFW	FOR
  644 C244  CCDC        	DEFW	NEXT
  645 C246  CA48        	DEFW	DATA
  646 C248  CBEC        	DEFW	INPUT
  647 C24A  CF01        	DEFW	DIM
  648 C24C  CC1F        	DEFW	READ
  649 C24E  CA5D        	DEFW	LET
  650 C250  CA07        	DEFW	GOTO
  651 C252  C9EB        	DEFW	RUN
  652 C254  CACF        	DEFW	IF
  653 C256  C8DF        	DEFW	RESTO
  654 C258  C9F6        	DEFW	GOSUB
  655 C25A  CA25        	DEFW	RETUR
  656 C25C  CA4A        	DEFW	REM
  657 C25E  C918        	DEFW	STOP
  658 C260  D3EC        	DEFW	OUT
  659 C262  CAB3        	DEFW	ON
  660 C264  CBC0        	DEFW	NULL
  661 C266  D3F7        	DEFW	WAIT
  662 C268  D0C4        	DEFW	DEF
  663 C26A  D437        	DEFW	POKE
  664 C26C  D44E        	DEFW	DOKE
  665 C26E  C5FA        	DEFW	AUTO
  666 C270  C6EA        	DEFW	LINES
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  12
BASIC   Z80

  667 C272  DDD0        	DEFW	CLS
  668 C274  CBB9        	DEFW	WIDTH
  669 C276  DFF4        	DEFW	MONI
  670 C278  CA4A        	DEFW	REM
  671 C27A  DB38        	DEFW	CALL
  672 C27C  CAFA        	DEFW	PRINT
  673 C27E  C948        	DEFW	CONT
  674 C280  C6F2        	DEFW	LIST
  675 C282  C9AA        	DEFW	CLEAR
  676 C284  DC43        	DEFW	CLOAD
  677 C286  DD41        	DEFW	CSAVE
  678 C288  C640        	DEFW	NEW
  679 C28A  C62D        	DEFW	LOAD
  680 C28C  C7B7        	DEFW	TRON
  681 C28E  C7B8        	DEFW	TROFF
  682 C290  C3E7        	DEFW	EDITOR
  683 C292  CA4A        	DEFW	ELSE
  684                    
  685                   ;ADRESSLISTE DER UNTERPROGRAMME FUER STANDARDFUNKTIONEN
  686 C294  D6A6        ADRTB2:	DEFW	SGN
  687 C296  D770        	DEFW	INT
  688 C298  D6BC        	DEFW	ABS
  689 C29A  0303        	DEFW	USRLOC
  690 C29C  D090        	DEFW	FRE
  691 C29E  D3E3        	DEFW	INP
  692 C2A0  D0BD        	DEFW	POS
  693 C2A2  D91F        	DEFW	SQR
  694 C2A4  D9FD        	DEFW	RND
  695 C2A6  D559        	DEFW	LOG
  696 C2A8  D96D        	DEFW	EXP
  697 C2AA  DA70        	DEFW	COS
  698 C2AC  DA76        	DEFW	SIN
  699 C2AE  DAD7        	DEFW	TAN
  700 C2B0  DAEC        	DEFW	ATN
  701 C2B2  D431        	DEFW	PEEK
  702 C2B4  D444        	DEFW	DEEK
  703 C2B6  D6D5        	DEFW	PI
  704 C2B8  D32C        	DEFW	LEN
  705 C2BA  D156        	DEFW	STR_
  706 C2BC  D3BF        	DEFW	VAL
  707 C2BE  D33B        	DEFW	ASC
  708 C2C0  D34B        	DEFW	CHR_
  709 C2C2  D35B        	DEFW	LEFT_
  710 C2C4  D389        	DEFW	RGHT_
  711 C2C6  D392        	DEFW	MID_
  712                    
  713                   ;LISTE DER ADRESSEN FUER DIE UNTERPROGRAMME
  714                   ;DER ARITHMETIK MIT WICHTUNGSKOEFFIZIENTEN
  715 C2C8  79          ADRTB3:	DEFB	79H
  716 C2C9  D811        	DEFW	PLUS
  717 C2CB  79          	DEFB	79H
  718 C2CC  D46A        	DEFW	MINUS
  719 C2CE  7C          	DEFB	7CH
  720 C2CF  D598        	DEFW	MUL
  721 C2D1  7C          	DEFB	7CH
  722 C2D2  D5F3        	DEFW	DIV
  723 C2D4  7F          	DEFB	7FH
  724 C2D5  D928        	DEFW	EXPO
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  13
BASIC   Z80

  725 C2D7  50          	DEFB	50H
  726 C2D8  CE5E        	DEFW	AND
  727 C2DA  46          	DEFB	46H
  728 C2DB  CE5D        	DEFW	OR
  729                   ;
  730                   ;FEHLERAUSGABE UND RAMTEST
  731 C2DD  4E 46 53 4E ERRTAB:	DEFM	'NFSNRGODFCOVOMULBSDD'
  732 C2F1  2F 30 49 44 	DEFM	'/0IDTMOSLSSTCNUFMO'
  733 C303  49 4F       	DEFM	'IO'
  734 C305  20 45 52 52 ERR:	DEFM	' ERROR'
  735 C30B  0007        	DEFW	ASCBEL
  736 C30D  20 49 4E 20 IN:	DEFM	' IN '
  737 C311  00          	DEFB	00H
  738 C312  46 49 4C 45 FILE:	DEFM	'FILE FOUND'
  739 C31C  0D          	DEFB	ASCCR
  740 C31D  4F 4B       OK:	DEFM	'OK'
  741 C31F  000D        	DEFW	ASCCR
  742 C321  42 52 45 41 BR:	DEFM	'BREAK'
  743 C326  00          	DEFB	0
  744                    
  745                   ;TEST, OB RAM FUER DIE NAECHSTEN OPERATIONEN AUSREICHT
  746 C327  E5          TMEMO:	PUSH	HL		;NEUER ZUSAETZLICHER
  747 C328  2A 03DB     	LD	HL,(FSLPTR)	;RAMBEDARF  2*(C)
  748 C32B  06 00       	LD	B,0
  749 C32D  09          	ADD	HL,BC
  750 C32E  09          	ADD	HL,BC
  751 C32F  3E          	DEFB	3EH
  752 C330  E5          TMEMO1:	PUSH	HL		;AKTIVIERTER RAM UND
  753 C331  3E D0       	LD	A,208		;AKTUELLER SP MUESSEN
  754 C333  95          	SUB	L		;MINDESTENS 49 BYTES
  755 C334  6F          	LD	L,A		;AUSEINANDER LIEGEN,
  756 C335  3E FF       	LD	A,-1		;SONST OM-ERROR
  757 C337  9C          	SBC	A,H
  758 C338  38 04       	JR	C,OMER		; -> OM ERROR
  759 C33A  67          	LD	H,A
  760 C33B  39          	ADD	HL,SP
  761 C33C  E1          	POP	HL
  762 C33D  D8          	RET	C
  763                   ;ORGANISATION DER FEHLERAUSGABE
  764                   ;FEHLERNUMMER IN REGISTER E
  765 C33E  1E 0C       OMER:	LD	E,12		; OM-ERROR
  766 C340  18 14       	JR	ERROO
  767                   	;
  768 C342  2A 03CA     SNER0:	LD	HL,(DATPTR)
  769 C345  22 0358     	LD	(CULINO),HL	; aktuelle Zeilennummer
  770 C348  1E 02       SNER:	LD	E,2		; SN-ERROR
  771 C34A  01          	DEFB	01H
  772 C34B  1E 14       DIVER:	LD	E,20		; /0-ERROR
  773 C34D  01          	DEFB	01H
  774 C34E  1E 00       NFER:	LD	E,0		; NF-ERROR
  775 C350  01          	DEFB	01H
  776 C351  1E 12       DDER:	LD	E,18		; DD-ERROR
  777 C353  01          	DEFB	01H
  778 C354  1E 22       UFER:	LD	E,34		; UF-ERROR
  779                    
  780                   ;AUSGABE DES FEHLERKODE
  781 C356  CD C669     ERROO:	CALL	INITR		; Stackpointer auf obere RAM-Grenze einstellen
  782 C359  32 0343     	LD	(OUTFLG),A	; OUTPUT ENABLE
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  14
BASIC   Z80

  783 C35C  CD CB55     	CALL	CRWDY		; neue Zeile
  784 C35F  21 C2DD     	LD	HL,ERRTAB
  785 C362  57          	LD	D,A
  786 C363  19          	ADD	HL,DE
  787 C364  44          	LD	B,H
  788 C365  4D          	LD	C,L
  789 C366  0B          	DEC	BC
  790 C367  3E 3F       	LD	A,'?'		; als Erstes ein Fragezeichen
  791 C369  1E 03       	LD	E,3		; insgesamt 3 Zeichen
  792 C36B  CD D1D6     	CALL	TEXTO3		; anzeigen
  793 C36E  21 C305     ERROO2:	LD	HL,ERR		; ERROR + Beep
  794 C371  CD D1C9     ERROO1:	CALL	TEXTO		; anzeigen
  795 C374  2A 0358     	LD	HL,(CULINO)	; aktuelle Zeilennummer
  796 C377  11 FFFE     	LD	DE,65534	; Startwert bei Initialisiereun
  797 C37A  CD C689     	CALL	CPREG
  798 C37D  CA C00D     	JP	Z,PRIST1	;SPRUNG, WENN FEHLER BEI DER EIONGABE
  799                   				;DES RAMBEREICHS BEIM KALTSTART
  800 C380  7C          	LD	A,H
  801 C381  A5          	AND	L		; HL=FFFFh im Direktmode
  802 C382  3C          	INC	A		; Direktmode?
  803 C383  C4 D821     	CALL	NZ,INOUT	; "IN Zeilennummer" anzeigen
  804 C386  3E          	DEFB	3EH
  805                   ;
  806                   ;EDITIERROUTINE/KOMMANDOEBENE
  807 C387  C1          EDIT0:	POP	BC
  808 C388  AF          EDIT:	XOR	A
  809 C389  32 0343     	LD	(OUTFLG),A	; Ausgabe nicht unterdruecken
  810 C38C  CD CB55     	CALL	CRWDY		; neue Zeile
  811 C38F  21 C31D     	LD	HL,OK
  812 C392  CD D1C9     	CALL	TEXTO		; OK-Meldung
  813 C395  37          	SCF			; alle Kanaele schliessen
  814                   ;ZEILENEINGABE
  815 C396  DC DDFD     LININP:	CALL	C,CLCHNL	; alle benutzten Kanaele schliessen, sowie
  816                   				; Tastatur/Bildschirm als E/A-Kanal einstellen
  817 C399  CD C6DF     	CALL	INPINI		; Eingabepuffer initialisieren
  818 C39C  2B          	DEC	HL		; -1
  819 C39D  22 0358     	LD	(CULINO),HL	; aktuelle Zeilennummer = Direktmode
  820 C3A0  21 03EA     	LD	HL,INTPRB
  821 C3A3  3A 034D     	LD	A,(AUTOFG)
  822 C3A6  B7          	OR	A		; Automatische Zeilennummerierung aktiv?
  823 C3A7  28 6B       	JR	Z,LIN4		; nein
  824 C3A9  ED 5B 034E  	LD	DE,(ANF)	; aktuelle Zeilennummer
  825 C3AD  F2 C3F0     	JP	P,EDITO1
  826 C3B0  D5          	PUSH	DE
  827 C3B1  CD D82A     	CALL	NUMBO1		; Nummer anzeigen
  828 C3B4  D1          	POP	DE
  829 C3B5  D5          	PUSH	DE
  830 C3B6  CD C4BB     	CALL	ZPOIT
  831 C3B9  3E 2A       	LD	A,'*'		; Zeile bereits vorhanden
  832 C3BB  38 02       	JR	C,LIN1
  833 C3BD  3E 20       	LD	A,' '		; Zeile noch nicht vorhanden
  834 C3BF  CD C6AE     LIN1:	CALL	CHARO
  835 C3C2  CD C5AE     	CALL	EING		; Zeileneingabe bei AUTO=aktiv
  836 C3C5  D1          	POP	DE
  837 C3C6  30 06       	JR	NC,LIN3		; nicht BRK sondern Enter
  838 C3C8  AF          LIN2:	XOR	A
  839 C3C9  32 034D     	LD	(AUTOFG),A	; AUTO deaktivieren
  840 C3CC  18 BA       	JR	EDIT
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  15
BASIC   Z80

  841                   	;
  842 C3CE  2A 0350     LIN3:	LD	HL,(ENDE)	; Zeilennummer Abstand
  843 C3D1  19          	ADD	HL,DE		; zu aktueller Zeilennummer addieren
  844 C3D2  38 F4       	JR	C,LIN2		; Ueberlauf
  845 C3D4  D5          	PUSH	DE
  846 C3D5  11 FFF9     	LD	DE,65529
  847 C3D8  CD C689     	CALL	CPREG
  848 C3DB  D1          	POP	DE
  849 C3DC  30 EA       	JR	NC,LIN2		; zu gross
  850 C3DE  22 034E     	LD	(ANF),HL	; neue Zeilennummer
  851 C3E1  21 0362     LIN16:	LD	HL,INPBUF+1
  852 C3E4  F5          	PUSH	AF
  853 C3E5  18 47       	JR	LIN5
  854                   	;
  855 C3E7  C8          EDITOR:	RET	Z
  856 C3E8  CD C697     	CALL	IOTEST		; EDIT-Schutz gesetzt?
  857 C3EB  CD C986     	CALL	DCHEX
  858 C3EE  C0          	RET	NZ
  859 C3EF  C1          	POP	BC
  860 C3F0  CD C4BB     EDITO1:	CALL	ZPOIT
  861 C3F3  30 58       	JR	NC,LIN15
  862 C3F5  D5          	PUSH	DE
  863 C3F6  7E          	LD	A,(HL)
  864 C3F7  23          	INC	HL
  865 C3F8  B6          	OR	(HL)
  866 C3F9  23          	INC	HL
  867 C3FA  28 02       	JR	Z,EDITO2
  868 C3FC  3E 7F       	LD	A,7FH
  869 C3FE  32 034D     EDITO2:	LD	(AUTOFG),A
  870 C401  7E          	LD	A,(HL)
  871 C402  23          	INC	HL
  872 C403  66          	LD	H,(HL)
  873 C404  6F          	LD	L,A
  874 C405  22 034E     	LD	(ANF),HL
  875 C408  CD DE98     	CALL	LINEDI
  876 C40B  D1          	POP	DE
  877 C40C  C2 C396     	JP	NZ,LININP
  878 C40F  38 B7       	JR	C,LIN2
  879 C411  3F          	CCF
  880 C412  18 CD       	JR	LIN16
  881                   	;
  882 C414  3E 3E       LIN4:	LD	A,'>'		; Prompt-Zeichen
  883 C416  CD C6AE     	CALL	CHARO		; Eingabebereitschaft anzeigen
  884 C419  CD C5AE     	CALL	EING		; Eingabe einer Zeile
  885 C41C  DA C396     	JP	C,LININP	; BRK -> Eingabe ignorieren
  886 C41F  21 0361     	LD	HL,INPBUF	; Eingabepuffer
  887 C422  CD C8BD     	CALL	TCHAR		; erstes Zeichen holen
  888 C425  3C          	INC	A
  889 C426  3D          	DEC	A
  890 C427  CA C396     	JP	Z,LININP	; leere Eingabezeile
  891 C42A  F5          	PUSH	AF
  892                   ;ZEILENNUMMER PRUEFEN UND IN HEXZAHL WANDELN
  893 C42B  CD C986     	CALL	DCHEX		; Dezimalzahl erfassen
  894 C42E  D5          LIN5:	PUSH	DE
  895                   ;EINGABEZEILE IN VERKUERZTE DARSTELLUNG WANDELN
  896 C42F  CD C4DA     	CALL	SCANN
  897 C432  47          	LD	B,A
  898 C433  D1          	POP	DE
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  16
BASIC   Z80

  899 C434  F1          	POP	AF
  900                   ;UNTERPROGRAMMADRESSE FUER KOMMANDO BILDEN
  901                   ;UND KOMMANDO AUSFUEHREN, WENN KEINE ZEILEN
  902                   ;NUMMER VORHANDEN IST
  903 C435  D2 C88A     	JP	NC,RUNMD2	;DIRECTMODE
  904 C438  D5          	PUSH	DE
  905 C439  C5          	PUSH	BC
  906 C43A  AF          	XOR	A
  907 C43B  32 03CD     	LD	(IPHFLG),A
  908                   ;TEST, OB DER ZEILENNUMMER WEITERE ZEICHEN FOLGEN
  909 C43E  CD C8BD     	CALL	TCHAR
  910 C441  B7          	OR	A
  911 C442  F5          LIN13:	PUSH	AF
  912                   ;ZEIGER (IN REGISTER HL) AUF ZEILE MIT DER
  913                   ;NAECHSTGRRESSEREN ZEILENNUMMER STELLEN
  914 C443  CD C4BB     	CALL	ZPOIT
  915 C446  38 08       	JR	C,LIN6
  916 C448  F1          	POP	AF
  917 C449  F5          	PUSH	AF
  918 C44A  B7          	OR	A
  919 C44B  20 03       	JR	NZ,LIN6
  920                   ;SPRUNG ZUR FEHLERAUSGABE, WENN ZU LOESCHENDE
  921                   ;ZEILE IM PROGRAMM NICHT VORHANDEN IST
  922 C44D  C3 CA20     LIN15:	JP	ULER
  923                   ;EINSORTIEREN DER EINGEGEBENEN ZEILE IN DAS
  924                   ;SCHON IM RAM VORHANDENE PROGRAMM
  925 C450  C5          LIN6:	PUSH	BC
  926 C451  30 11       	JR	NC,LIN8
  927 C453  EB          LIN14:	EX	DE,HL
  928 C454  2A 03D7     	LD	HL,(SVARPT)
  929 C457  1A          LIN7:	LD	A,(DE)
  930 C458  02          	LD	(BC),A
  931 C459  03          	INC	BC
  932 C45A  13          	INC	DE
  933 C45B  CD C689     	CALL	CPREG
  934 C45E  20 F7       	JR	NZ,LIN7
  935 C460  ED 43 03D7  	LD	(SVARPT),BC
  936 C464  D1          LIN8:	POP	DE
  937 C465  F1          	POP	AF
  938 C466  28 22       	JR	Z,LIN10
  939 C468  2A 03D7     	LD	HL,(SVARPT)
  940 C46B  E3          	EX	(SP),HL
  941 C46C  C1          	POP	BC
  942 C46D  09          	ADD	HL,BC
  943 C46E  E5          	PUSH	HL
  944 C46F  CD C4AB     	CALL	LININ
  945 C472  E1          	POP	HL
  946 C473  22 03D7     	LD	(SVARPT),HL
  947 C476  EB          	EX	DE,HL
  948 C477  36 FF       	LD	(HL),-1
  949 C479  D1          	POP	DE
  950 C47A  23          	INC	HL
  951 C47B  23          	INC	HL
  952 C47C  73          	LD	(HL),E
  953 C47D  23          	INC	HL
  954 C47E  72          	LD	(HL),D
  955 C47F  23          	INC	HL
  956 C480  11 0362     	LD	DE,INPBUF+1
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  17
BASIC   Z80

  957 C483  1A          LIN9:	LD	A,(DE)
  958 C484  77          	LD	(HL),A
  959 C485  23          	INC	HL
  960 C486  13          	INC	DE
  961 C487  B7          	OR	A
  962 C488  20 F9       	JR	NZ,LIN9
  963 C48A  CD C64F     LIN10:	CALL	NEW2
  964 C48D  23          	INC	HL
  965 C48E  EB          	EX	DE,HL
  966 C48F  21 C396     	LD	HL,LININP
  967 C492  E5          	PUSH	HL
  968 C493  62          LIN11:	LD	H,D
  969 C494  6B          	LD	L,E
  970 C495  7E          	LD	A,(HL)
  971 C496  23          	INC	HL
  972 C497  B6          	OR	(HL)
  973 C498  C8          	RET	Z
  974 C499  23          	INC	HL
  975 C49A  7E          	LD	A,(HL)
  976 C49B  23          	INC	HL
  977 C49C  A6          	AND	(HL)
  978 C49D  3C          	INC	A
  979 C49E  C8          	RET	Z
  980 C49F  23          	INC	HL
  981 C4A0  AF          	XOR	A
  982 C4A1  BE          LIN12:	CP	(HL)
  983 C4A2  23          	INC	HL
  984 C4A3  20 FC       	JR	NZ,LIN12
  985 C4A5  EB          	EX	DE,HL
  986 C4A6  73          	LD	(HL),E
  987 C4A7  23          	INC	HL
  988 C4A8  72          	LD	(HL),D
  989 C4A9  18 E8       	JR	LIN11
  990                   ;ZEILE EINFUEGEN
  991 C4AB  CD C330     LININ:	CALL	TMEMO1
  992 C4AE  C5          LININ1:	PUSH	BC
  993 C4AF  E3          	EX	(SP),HL
  994 C4B0  C1          	POP	BC
  995 C4B1  CD C689     LININ2:	CALL	CPREG
  996 C4B4  7E          	LD	A,(HL)
  997 C4B5  02          	LD	(BC),A
  998 C4B6  C8          	RET	Z
  999 C4B7  0B          	DEC	BC
 1000 C4B8  2B          	DEC	HL
 1001 C4B9  18 F6       	JR	LININ2
 1002                    
 1003                   ;ZEIGER AUF ANFANG DER ZEILE MIT DER NAECHST-
 1004                   ;GROESSEREN ZEILENNUMMER STELLEN
 1005                   ;Z-FLAG=1 und CY=1, WENN ZEILENNUMMER SCHON VORHANDEN
 1006 C4BB  2A 035F     ZPOIT:	LD	HL,(PSTBEG)	; Programmstart-Adresse
 1007 C4BE  44          ZPOIT1:	LD	B,H
 1008 C4BF  4D          	LD	C,L
 1009 C4C0  7E          	LD	A,(HL)
 1010 C4C1  23          	INC	HL
 1011 C4C2  B6          	OR	(HL)
 1012 C4C3  2B          	DEC	HL
 1013 C4C4  C8          	RET	Z
 1014 C4C5  23          	INC	HL
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  18
BASIC   Z80

 1015 C4C6  23          	INC	HL
 1016 C4C7  7E          	LD	A,(HL)
 1017 C4C8  23          	INC	HL
 1018 C4C9  66          	LD	H,(HL)
 1019 C4CA  6F          	LD	L,A
 1020 C4CB  CD C689     	CALL	CPREG
 1021 C4CE  60          	LD	H,B
 1022 C4CF  69          	LD	L,C
 1023 C4D0  7E          	LD	A,(HL)
 1024 C4D1  23          	INC	HL
 1025 C4D2  66          	LD	H,(HL)
 1026 C4D3  6F          	LD	L,A
 1027 C4D4  3F          	CCF
 1028 C4D5  C8          	RET	Z
 1029 C4D6  3F          	CCF
 1030 C4D7  D0          	RET	NC
 1031 C4D8  18 E4       	JR	ZPOIT1
 1032                   ;
 1033                   ;UMWANDLUNG DER EINGEGEBENEN ZEICHENKETTE IN
 1034                   ;INTERNE (VERKUERZTE) DARSTELLUNG
 1035                   ;DIESE DARSTELLUNG IM EINGABEPUFFER ABLEGEN
 1036 C4DA  AF          SCANN:	XOR	A
 1037 C4DB  32 03AF     	LD	(DSTMNT),A
 1038 C4DE  0E 05       	LD	C,5
 1039 C4E0  11 0362     	LD	DE,INPBUF+1
 1040 C4E3  AF          SCANN1:	XOR	A
 1041 C4E4  32 03FB     	LD	(LSTFLG),A	;Erweiterungsliste noch nicht durch
 1042 C4E7  7E          	LD	A,(HL)
 1043 C4E8  FE 20       	CP	' '
 1044 C4EA  CA C571     	JP	Z,SCANN9
 1045 C4ED  47          	LD	B,A
 1046 C4EE  FE 22       	CP	'"'
 1047 C4F0  CA C591     	JP	Z,SCANND
 1048 C4F3  B7          	OR	A
 1049 C4F4  CA C597     	JP	Z,SCANNE
 1050 C4F7  3A 03AF     	LD	A,(DSTMNT)
 1051 C4FA  B7          	OR	A
 1052 C4FB  7E          	LD	A,(HL)
 1053 C4FC  20 73       	JR	NZ,SCANN9
 1054 C4FE  FE 3F       	CP	'?'
 1055 C500  3E 9E       	LD	A,PNTTOK
 1056 C502  28 6D       	JR	Z,SCANN9
 1057 C504  7E          	LD	A,(HL)
 1058 C505  FE 30       	CP	'0'
 1059 C507  38 04       	JR	C,DCLI0
 1060 C509  FE 3C       	CP	'<'
 1061 C50B  38 64       	JR	C,SCANN9
 1062                   ;TEST, OB EINGEGEBENE ZEICHENKETTE IN DER LISTE
 1063                   ;DER RESERVIERTEN WORTE ENTHALTEN IST
 1064                   ;MERKE STELLE IN DER LISTE
 1065 C50D  D5          DCLI0:	PUSH	DE
 1066 C50E  11 C120     	LD	DE,MNEMTB-01H
 1067 C511  C5          	PUSH	BC
 1068 C512  01 C56D     	LD	BC,SCANN8
 1069 C515  C5          	PUSH	BC
 1070                   ;UMWANDLUNG EINGEGEBENER KLEIN- IN GROSSBUCHSTABEN
 1071 C516  06 7F       	LD	B,ENDTOK-1
 1072 C518  7E          	LD	A,(HL)
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  19
BASIC   Z80

 1073 C519  FE 61       	CP	'a'
 1074 C51B  38 07       	JR	C,SCANN2
 1075 C51D  FE 7B       	CP	'z'+1
 1076 C51F  30 03       	JR	NC,SCANN2
 1077 C521  E6 5F       	AND	5FH
 1078 C523  77          	LD	(HL),A
 1079 C524  4E          SCANN2:	LD	C,(HL)
 1080 C525  EB          	EX	DE,HL
 1081                   ;STELLE ZEIGER AUF NAECHSTEN WORTANFANG  
 1082 C526  23          SCANN3:	INC	HL
 1083 C527  B6          	OR	(HL)
 1084 C528  F2 C526     	JP	P,SCANN3
 1085 C52B  04          	INC	B
 1086 C52C  7E          	LD	A,(HL)
 1087                   ;TEST AUF LISTENENDE
 1088 C52D  E6 7F       	AND	7FH
 1089 C52F  20 15       	JR	NZ,SCANNF	;Listenende noch nicht erreicht
 1090 C531  3A 03FC     	LD	A,(EXTFLG)
 1091 C534  A7          	AND	A
 1092 C535  C8          	RET	Z
 1093 C536  3A 03FB     	LD	A,(LSTFLG)
 1094 C539  A7          	AND	A
 1095 C53A  C0          	RET	NZ
 1096 C53B  3C          	INC	A
 1097 C53C  32 03FB     	LD	(LSTFLG),A
 1098 C53F  2A E00C     	LD	HL,(EXTTAB)	; Token-Tabelle der Erweiterungen
 1099 C542  7E          	LD	A,(HL)
 1100 C543  E6 7F       	AND	7FH		; Listenende der Erweiterungstabelle?
 1101 C545  C8          	RET	Z
 1102                   ;TEST AUF UEBEREINSTIMMUNG DES 1. ZEICHENS
 1103 C546  B9          SCANNF:	CP	C
 1104 C547  20 DD       	JR	NZ,SCANN3
 1105 C549  EB          	EX	DE,HL
 1106 C54A  E5          	PUSH	HL
 1107 C54B  13          SCANN4:	INC	DE
 1108 C54C  1A          	LD	A,(DE)
 1109 C54D  B7          	OR	A
 1110                   ;SPRUNG, WENN WORT VOLLSTAENDIG IDENTIFIZIERT
 1111 C54E  FA C569     	JP	M,SCANN7
 1112 C551  4F          	LD	C,A
 1113 C552  78          	LD	A,B
 1114 C553  FE 88       	CP	GTOTOK
 1115 C555  20 04       	JR	NZ,SCANN5
 1116 C557  CD C8BD     	CALL	TCHAR
 1117 C55A  2B          	DEC	HL
 1118 C55B  23          SCANN5:	INC	HL
 1119 C55C  7E          	LD	A,(HL)
 1120                   ;UMWANDLUNG EINGEGEBENER KLEIN- IN GROSSBUCHSTABEN
 1121 C55D  FE 61       	CP	'a'
 1122 C55F  38 02       	JR	C,SCANN6
 1123 C561  E6 5F       	AND	5FH
 1124                   ;TEST AUF UEBEREINSTIMMUNG DES 2.,3....ZEICHENS
 1125 C563  B9          SCANN6:	CP	C
 1126 C564  28 E5       	JR	Z,SCANN4
 1127 C566  E1          	POP	HL
 1128 C567  18 BB       	JR	SCANN2
 1129                   	;
 1130 C569  48          SCANN7:	LD	C,B
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  20
BASIC   Z80

 1131 C56A  F1          	POP	AF
 1132 C56B  EB          	EX	DE,HL
 1133 C56C  C9          	RET
 1134                   	;
 1135 C56D  EB          SCANN8:	EX	DE,HL
 1136 C56E  79          	LD	A,C
 1137 C56F  C1          	POP	BC
 1138 C570  D1          	POP	DE
 1139 C571  23          SCANN9:	INC	HL
 1140 C572  12          	LD	(DE),A
 1141 C573  13          	INC	DE
 1142 C574  0C          	INC	C
 1143 C575  D6 3A       	SUB	':'
 1144 C577  28 04       	JR	Z,SCANNA
 1145 C579  FE 49       	CP	DATTOK-':'
 1146 C57B  20 03       	JR	NZ,SCANNB
 1147 C57D  32 03AF     SCANNA:	LD	(DSTMNT),A
 1148 C580  D6 54       SCANNB:	SUB	REMTOK-':'
 1149 C582  28 05       	JR	Z,SCANNG
 1150 C584  D6 0E       	SUB	RMTOK-REMTOK
 1151 C586  C2 C4E3     	JP	NZ,SCANN1
 1152 C589  47          SCANNG:	LD	B,A
 1153 C58A  7E          SCANNC:	LD	A,(HL)
 1154 C58B  B7          	OR	A
 1155 C58C  28 09       	JR	Z,SCANNE
 1156 C58E  B8          	CP	B
 1157 C58F  28 E0       	JR	Z,SCANN9
 1158 C591  23          SCANND:	INC	HL
 1159 C592  12          	LD	(DE),A
 1160 C593  0C          	INC	C
 1161 C594  13          	INC	DE
 1162 C595  18 F3       	JR	SCANNC
 1163                   	;
 1164 C597  21 0361     SCANNE:	LD	HL,INPBUF
 1165 C59A  12          	LD	(DE),A
 1166 C59B  13          	INC	DE
 1167 C59C  12          	LD	(DE),A
 1168 C59D  13          	INC	DE
 1169 C59E  12          	LD	(DE),A
 1170 C59F  C9          	RET
 1171                   ;
 1172                   ; ROUTINE ZUR EINGABE EINER ZEILE UND ABLAGE IM EINGABEPUFFER
 1173                   ; BERUECKSICHTIGUNG DER STEUER- UND SONDERZEICHEN
 1174                   ;
 1175 C5A0  4C 49 53 54 TLIST:	DB	'LIST',0
 1176 C5A5  52 55 4E 00 TRUN:	DB	'RUN',0
 1177 C5A9  43 4F 4E 54 TCONT:	DB	'CONT',0
 1178                   ;--------------------------------
 1179 C5AE  E5          EING:	PUSH	HL
 1180 C5AF  21 0362     	LD	HL,INPBUF+1	; Eingabepuffer
 1181 C5B2  E3          EING1:	EX	(SP),HL
 1182 C5B3  CD DDE4     	CALL	CI		; Eingabe ein Zeichen
 1183 C5B6  E3          	EX	(SP),HL
 1184                   ;-------------------------------
 1185 C5B7  FE 1C       	CP	LISTSW		; LIST-Taste? (Code 1CH)
 1186 C5B9  11 C59F     	LD	DE,TLIST-1
 1187 C5BC  28 0E       	JR	Z,EING2
 1188 C5BE  FE 1D       	CP	RUNSW		; RUN-Taste? (Code 1DH)
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  21
BASIC   Z80

 1189 C5C0  11 C5A4     	LD	DE,TRUN-1
 1190 C5C3  28 07       	JR	Z,EING2
 1191 C5C5  FE 1E       	CP	CONTSW		; CONT-Taste? (Code 1EH)
 1192 C5C7  11 C5A8     	LD	DE,TCONT-1
 1193 C5CA  20 14       	JR	NZ,EING3
 1194                   ; LIST, RUN, CONT
 1195 C5CC  21 0361     EING2:	LD	HL,INPBUF
 1196 C5CF  23          EING4:	INC	HL
 1197 C5D0  13          	INC	DE
 1198 C5D1  1A          	LD	A,(DE)
 1199 C5D2  77          	LD	(HL),A
 1200 C5D3  A7          	AND	A
 1201 C5D4  20 F9       	JR	NZ,EING4
 1202 C5D6  21 0362     	LD	HL,INPBUF+1
 1203 C5D9  CD C5F1     	CALL	TEXTOE
 1204 C5DC  E1          	POP	HL
 1205 C5DD  C3 CB5E     	JP	CRWDY6
 1206                   ;-----------------------------
 1207 C5E0  CD DF0F     EING3:	CALL	ZECR		; CR?
 1208 C5E3  20 02       	JR	NZ,EING5	; nein
 1209 C5E5  E1          EING6:	POP	HL
 1210 C5E6  C9          	RET
 1211                   	;
 1212 C5E7  CD DF27     EING5:	CALL	ZSTOP		; BRK?
 1213 C5EA  38 F9       	JR	C,EING6		; ja
 1214 C5EC  CD DF32     	CALL	ZEEDI		; Tastaturausgabe auswerten
 1215 C5EF  18 C1       	JR	EING1		; weiter in Eingaberoutine bleiben
 1216                   ;--------------------------------
 1217 C5F1  7E          TEXTOE:	LD	A,(HL)
 1218 C5F2  B7          	OR	A
 1219 C5F3  C8          	RET	Z
 1220 C5F4  CD DDD5     	CALL	CO
 1221 C5F7  23          	INC	HL
 1222 C5F8  18 F7       	JR	TEXTOE
 1223                   ;--------------------------------
 1224                   ;
 1225 C5FA  11 000A     AUTO:	LD	DE,10
 1226 C5FD  D5          	PUSH	DE
 1227 C5FE  28 17       	JR	Z,AUTO2
 1228 C600  CD C986     	CALL	DCHEX		; Dezimalzahl erfassen
 1229 C603  EB          	EX	DE,HL
 1230 C604  E3          	EX	(SP),HL
 1231 C605  28 11       	JR	Z,AUTO3
 1232 C607  EB          	EX	DE,HL
 1233 C608  CD C8D6     	CALL	CPCOMM
 1234 C60B  ED 5B 0350  	LD	DE,(ENDE)
 1235 C60F  28 06       	JR	Z,AUTO2
 1236 C611  CD C986     	CALL	DCHEX		; Dezimalzahl erfassen
 1237 C614  C2 C348     	JP	NZ,SNER
 1238 C617  EB          AUTO2:	EX	DE,HL
 1239 C618  7D          AUTO3:	LD	A,L
 1240 C619  B4          	OR	H
 1241 C61A  CA C967     	JP	Z,FCER
 1242 C61D  22 0350     	LD	(ENDE),HL
 1243 C620  CB FF       	SET	7,A
 1244 C622  32 034D     	LD	(AUTOFG),A
 1245 C625  E1          	POP	HL
 1246 C626  22 034E     	LD	(ANF),HL
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  22
BASIC   Z80

 1247 C629  C1          	POP	BC
 1248 C62A  C3 C396     AUTO4:	JP	LININP
 1249                    
 1250 C62D  CD DE5F     LOAD:	CALL	INCHNL
 1251 C630  3A 0309     	LD	A,(ININD)	; IN-Index
 1252 C633  E6 03       	AND	OCH_
 1253 C635  28 F3       	JR	Z,AUTO4
 1254 C637  3E D5       	LD	A,D5TYPE
 1255 C639  CD DCB2     	CALL	CASS1
 1256 C63C  F1          	POP	AF
 1257 C63D  AF          	XOR	A
 1258 C63E  18 EA       	JR	AUTO4
 1259                   ;
 1260                   ;PROGRAMMENDEZEICHEN AN DEN ANFANG DES PROGRAMM-
 1261                   ;ABLAGERAMBEREICHS RUECKEN UND NOTIZSPEICHER LOESCHEN
 1262 C640  C0          NEW:	RET	NZ
 1263 C641  2A 035F     NEW1:	LD	HL,(PSTBEG)	; Programmstart-Adresse
 1264 C644  AF          	XOR	A
 1265 C645  32 035E     	LD	(DATFLG),A	; LIST/EDIT/BYE-Schutz ruecksetzen
 1266 C648  77          	LD	(HL),A
 1267 C649  23          	INC	HL
 1268 C64A  77          	LD	(HL),A
 1269 C64B  23          	INC	HL
 1270 C64C  22 03D7     	LD	(SVARPT),HL	; Programmende+1
 1271 C64F  2A 035F     NEW2:	LD	HL,(PSTBEG)	; Programmstart-Adresse
 1272 C652  2B          	DEC	HL
 1273 C653  22 03CF     NEW3:	LD	(CUSTMT),HL	; ZEILENNUMMER/ADRESSE DES AKTUELLEN STATEMENTS
 1274 C656  2A 03B0     	LD	HL,(MEMSIZ)
 1275 C659  22 03C4     	LD	(SWAPTR),HL
 1276 C65C  AF          	XOR	A
 1277 C65D  CD C8DF     	CALL	RESTO
 1278 C660  2A 03D7     	LD	HL,(SVARPT)
 1279 C663  22 03D9     	LD	(DVARPT),HL
 1280 C666  22 03DB     	LD	(FSLPTR),HL
 1281                   ;STACKPOINTER AUF OBERE RAMGRENZE STELLEN
 1282                   ;OBERE STACKBEGRENZUNG EINTRAGEN
 1283 C669  C1          INITR:	POP	BC		; RET-Adresse holen
 1284 C66A  2A 0356     	LD	HL,(STDPTR)
 1285 C66D  F9          	LD	SP,HL		; SP auf oberen Wert neu setzen
 1286 C66E  21 03B4     	LD	HL,LSPTBG
 1287 C671  22 03B2     	LD	(SPTPTR),HL
 1288 C674  CD DE1D     	CALL	SETCO
 1289 C677  AF          	XOR	A
 1290 C678  6F          	LD	L,A
 1291 C679  67          	LD	H,A
 1292 C67A  22 03D5     	LD	(LBYTER),HL
 1293 C67D  32 03CC     	LD	(FORFLG),A
 1294 C680  22 03DF     	LD	(FNPTR),HL
 1295 C683  E5          	PUSH	HL
 1296 C684  C5          	PUSH	BC		; RET-Adresse vom alten Stack
 1297 C685  2A 03CF     INITR2:	LD	HL,(CUSTMT)	; ZEILENNUMMER/ADRESSE DES AKTUELLEN STATEMENTS
 1298 C688  C9          	RET
 1299                   ;
 1300                   ;VERGLEICHE INHALT VON REGISTER DE MIT HL
 1301 C689  7C          CPREG:	LD	A,H
 1302 C68A  92          	SUB	D
 1303 C68B  C0          	RET	NZ
 1304 C68C  7D          	LD	A,L
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  23
BASIC   Z80

 1305 C68D  93          	SUB	E
 1306 C68E  C9          	RET
 1307                   
 1308                   ;TEST AUF GROSSBUCHSTABEN
 1309 C68F  7E          CLETST:	LD	A,(HL)
 1310 C690  FE 41       	CP	'A'
 1311 C692  D8          	RET	C
 1312 C693  FE 5B       	CP	'Z'+1
 1313 C695  3F          	CCF
 1314 C696  C9          	RET
 1315                   
 1316                   ;TEST AUF ZULAESSIGE IO-OPERATION (DATENSCHUTZ)
 1317 C697  3A 035E     IOTEST:	LD	A,(DATFLG)	; LIST/EDIT/BYE-Schutz gesetzt?
 1318 C69A  A7          	AND	A
 1319 C69B  C8          	RET	Z
 1320 C69C  CD C669     	CALL	INITR		; Stackpointer auf obere RAM-Grenze einstellen
 1321 C69F  C3 C36E     	JP	ERROO2
 1322                   ;
 1323 C6A2  CD C689     CLFTOU:	CALL	CPREG
 1324 C6A5  3E 08       	LD	A,CURLFT	;Cursor nach links
 1325 C6A7  18 02       	JR	SPOUT1
 1326                   	;
 1327 C6A9  3E 20       SPOUT:	LD	A,' '
 1328 C6AB  C3 DDD5     SPOUT1:	JP	CO
 1329                    
 1330                   ;GIB ZEICHEN ZUR AUSGABESCHNITTSTELLE UND ORGANISIERE
 1331                   ;ZEILENLAENGE UND MERKE POSITION DES CURSORS
 1332 C6AE  F5          CHARO:	PUSH	AF
 1333 C6AF  C5          	PUSH	BC
 1334 C6B0  4F          	LD	C,A
 1335 C6B1  FE 20       	CP	' '
 1336 C6B3  38 13       	JR	C,CHARO2	;JP IF IT IS A CONTROL
 1337 C6B5  3A 0341     	LD	A,(LINLEN)	;Zeilenlaenge
 1338 C6B8  47          	LD	B,A
 1339 C6B9  3A 03AC     	LD	A,(CURPOS)
 1340 C6BC  04          	INC	B
 1341 C6BD  28 05       	JR	Z,CHARO1	;JP IF LINLEN = 255
 1342 C6BF  05          	DEC	B
 1343 C6C0  B8          	CP	B
 1344 C6C1  CC CB61     	CALL	Z,CRWDY2	;CALL IF LINLEN=CURPOS
 1345 C6C4  3C          CHARO1:	INC	A		;INC CURPOS
 1346 C6C5  32 03AC     	LD	(CURPOS),A
 1347 C6C8  79          CHARO2:	LD	A,C
 1348 C6C9  CD DDD5     	CALL	CO
 1349 C6CC  C1          	POP	BC
 1350 C6CD  F1          	POP	AF
 1351 C6CE  C9          	RET
 1352                   
 1353                   ;EINGABEANFORDERUNG STELLEN
 1354 C6CF  3E 3F       OUT?:	LD	A,'?'
 1355 C6D1  CD C6AE     	CALL	CHARO
 1356 C6D4  3E 09       OUT1?:	LD	A,CURRGT	; Cursor nach rechts
 1357 C6D6  CD C6AE     	CALL	CHARO
 1358 C6D9  CD C6DF     	CALL	INPINI		; Eingabepuffer initialisieren
 1359 C6DC  C3 034A     	JP	INPLOC		; -> JP EING
 1360                   
 1361                   ;Eingabepuffer initialisieren:
 1362 C6DF  21 2000     INPINI:	LD	HL,2000H
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  24
BASIC   Z80

 1363 C6E2  22 0361     	LD	(INPBUF),HL	;INPBUF:= 00 20 00 20
 1364 C6E5  22 0363     	LD	(INPBUF+2),HL
 1365 C6E8  65          	LD	H,L		; HL=0
 1366 C6E9  C9          	RET
 1367                   ;
 1368 C6EA  CD C96C     LINES:	CALL	EPRVL4
 1369 C6ED  ED 53 0346  	LD	(LNFLGC),DE
 1370 C6F1  C9          	RET
 1371                   
 1372                   ;LISTEN DES IM PROGRAMMSPEICHER BEFINDLICHEN
 1373                   ;PROGRAMMS, AUSGABE UEBER AUSGABESCHNITTSTELLE
 1374 C6F2  CD C697     LIST:	CALL	IOTEST		; LIST-Schutz gesetzt?
 1375 C6F5  CD DE25     	CALL	OUTCHL		; I/O-Kanal aktivieren
 1376 C6F8  CD DDC8     	CALL	TESTCO		; Ausgabe auf Bildschirm?
 1377 C6FB  28 12       	JR	Z,LIST0
 1378 C6FD  3E D5       	LD	A,D5TYPE	; UUU = LIST-Ausgabedatei
 1379 C6FF  CD DCB2     	CALL	CASS1
 1380 C702  2A 0346     	LD	HL,(LNFLGC)	; Zeilenanzahl fuer LIST
 1381 C705  22 034E     	LD	(ANF),HL	; hier merken
 1382 C708  21 FFFF     	LD	HL,-1		; maximaler Wert
 1383 C70B  22 0346     	LD	(LNFLGC),HL	; fuer Datei vorgeben (ohne Pause)
 1384 C70E  E1          	POP	HL
 1385 C70F  CD C986     LIST0:	CALL	DCHEX		; Dezimalzahl erfassen und in Hex-Zahl umwandeln
 1386 C712  C0          	RET	NZ
 1387 C713  C1          	POP	BC
 1388 C714  CD C4BB     	CALL	ZPOIT		; Zeiger auf naechste Zeilennummer
 1389 C717  C5          	PUSH	BC
 1390 C718  CD C791     	CALL	LCREG
 1391 C71B  E1          LIST1:	POP	HL		; Zeiger auf Programmadresse
 1392 C71C  4E          	LD	C,(HL)
 1393 C71D  23          	INC	HL
 1394 C71E  46          	LD	B,(HL)		; BC = Adresse der naechsten Zeile
 1395 C71F  23          	INC	HL
 1396 C720  78          	LD	A,B
 1397 C721  B1          	OR	C
 1398 C722  28 59       	JR	Z,LIST6		; Programm-Ende
 1399 C724  CD C767     	CALL	LIST9
 1400 C727  CD C8F9     	CALL	TESC		; TEST AUF UNTERBRECHUNGSANFORDERUNG
 1401 C72A  C5          	PUSH	BC
 1402 C72B  5E          	LD	E,(HL)
 1403 C72C  23          	INC	HL
 1404 C72D  56          	LD	D,(HL)		; DE = Zeilennummer
 1405 C72E  23          	INC	HL
 1406 C72F  E5          	PUSH	HL
 1407 C730  21 03EA     	LD	HL,INTPRB	; PRINT-Puffer
 1408 C733  CD CB61     	CALL	CRWDY2		; Ausgabe CR, LF, Dummy-Zeichen
 1409 C736  CD D82A     	CALL	NUMBO1		; AUSGABE ZEILENNUMMER
 1410 C739  3E 20       	LD	A,' '		; ein Leerzeichen zwischen Zeilennummer und Inhalt
 1411 C73B  E1          	POP	HL		; Programmzeiger
 1412 C73C  CD C6AE     LIST2:	CALL	CHARO		; AUSGABE ZEILENTEXT
 1413 C73F  7E          LIST3:	LD	A,(HL)
 1414 C740  23          	INC	HL
 1415 C741  FE 22       	CP	'"'		; Zeichenkette?
 1416 C743  28 14       	JR	Z,LIST5
 1417 C745  B7          	OR	A
 1418 C746  28 D3       	JR	Z,LIST1		; Zeilenende
 1419 C748  F2 C73C     	JP	P,LIST2		; Gesetztes Bit 7 = Token
 1420 C74B  CD C79A     	CALL	LIST11		; Token aufloesen
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  25
BASIC   Z80

 1421 C74E  CD C6AE     LIST4:	CALL	CHARO		; Token anzeigen
 1422 C751  1A          	LD	A,(DE)
 1423 C752  13          	INC	DE
 1424 C753  B7          	OR	A
 1425 C754  F2 C74E     	JP	P,LIST4		; bis zum naechsten gesetzten Bit 7
 1426 C757  18 E6       	JR	LIST3
 1427                   	;
 1428 C759  CD C6AE     LIST5:	CALL	CHARO		; Zeichen anzeigen
 1429 C75C  7E          	LD	A,(HL)
 1430 C75D  23          	INC	HL
 1431 C75E  B7          	OR	A
 1432 C75F  28 BA       	JR	Z,LIST1		; bis zum Zeilenende
 1433 C761  FE 22       	CP	'"'
 1434 C763  28 D7       	JR	Z,LIST2		; oder bis zum naechsten "
 1435 C765  18 F2       	JR	LIST5
 1436                   
 1437 C767  E5          LIST9:	PUSH	HL		;ZEILEN-ANZAHL-KONTROLLE
 1438 C768  2A 0344     	LD	HL,(LINFLG)
 1439 C76B  7D          	LD	A,L
 1440 C76C  B4          	OR	H
 1441 C76D  2B          	DEC	HL
 1442 C76E  22 0344     	LD	(LINFLG),HL
 1443 C771  E1          	POP	HL
 1444 C772  C0          	RET	NZ
 1445 C773  CD C791     	CALL	LCREG
 1446                   ;TEST AUF ANFORDERUNG ZUM BEENDEN DES LISTEN
 1447 C776  CD DDE4     	CALL	CI
 1448 C779  FE 03       	CP	STOPSW		; BRK-Taste?
 1449 C77B  20 EA       	JR	NZ,LIST9
 1450 C77D  CD DDC8     LIST6:	CALL	TESTCO
 1451 C780  28 0C       	JR	Z,LIST7
 1452 C782  CD CB61     	CALL	CRWDY2
 1453 C785  CD DDFD     	CALL	CLCHNL		; alle benutzten Kanaele schliessen
 1454 C788  2A 034E     	LD	HL,(ANF)	; gemerkter Wert fuer Zeilenanzahl bei LIST
 1455 C78B  22 0346     	LD	(LNFLGC),HL	; wieder regenerieren
 1456 C78E  C3 C08C     LIST7:	JP	SECST
 1457                   	;
 1458 C791  E5          LCREG:	PUSH	HL
 1459 C792  2A 0346     	LD	HL,(LNFLGC)
 1460 C795  22 0344     	LD	(LINFLG),HL
 1461 C798  E1          	POP	HL
 1462 C799  C9          	RET
 1463                   
 1464                   ; 24.01.2021:
 1465                   ; LIST gepatcht, sodass bei Anzeige keine undefinierten Erweiterungstoken mit
 1466                   ; beruecksichtigt werden (bei MC in BASIC-Zeile)
 1467                   
 1468 C79A  D6 7F       LIST11:	SUB	7FH
 1469 C79C  FE 56       	CP	LAST-7FH+1	; Token aus Erweiterungsliste?
 1470 C79E  11 C121     	LD	DE,MNEMTB	; interne Token
 1471 C7A1  38 06       	JR	C,LIST10
 1472 C7A3  D6 55       	SUB	LAST-7FH
 1473 C7A5  ED 5B E00C  	LD	DE,(EXTTAB)	; externe Token
 1474 C7A9  47          LIST10:	LD	B,A		; Position in Tokentabelle
 1475 C7AA  CD DFF9     LIST12:	call	patch		; Patch aufrufen
 1476 C7AD  13          	INC	DE
 1477 C7AE  B7          	OR	A		; Bit 7 gesetzt?
 1478 C7AF  F2 C7AA     	JP	P,LIST12	; nein, gleicher Token
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  26
BASIC   Z80

 1479 C7B2  10 F6       	DJNZ	LIST12		; naechster Token
 1480 C7B4  E6 7F       	AND	7FH		; Bit 7 zurueck setzen
 1481 C7B6  C9          	RET
 1482                   ;
 1483                   ;TRACEFUNKTION - AUSGABE DER ZEILENNUMMER DER
 1484                   ;IN ABARBEITUNG BEFINDLICHEN ZEILE
 1485 C7B7  3E          TRON:	DEFB	3EH
 1486 C7B8  AF          TROFF:	XOR	A
 1487 C7B9  32 030A     	LD	(TRFLAG),A
 1488 C7BC  C9          	RET
 1489                   
 1490                   ;ABLAUFSTEUERUNG INTERPRETIERVORGANG
 1491 C7BD  21 0004     FORSR:	LD	HL,4
 1492 C7C0  39          	ADD	HL,SP
 1493 C7C1  7E          FORSR1:	LD	A,(HL)
 1494 C7C2  23          	INC	HL
 1495 C7C3  FE 81       	CP	FORTOK
 1496 C7C5  C0          	RET	NZ
 1497 C7C6  4E          	LD	C,(HL)
 1498 C7C7  23          	INC	HL
 1499 C7C8  46          	LD	B,(HL)
 1500 C7C9  23          	INC	HL
 1501 C7CA  E5          	PUSH	HL
 1502 C7CB  69          	LD	L,C
 1503 C7CC  60          	LD	H,B
 1504 C7CD  7A          	LD	A,D
 1505 C7CE  B3          	OR	E
 1506 C7CF  EB          	EX	DE,HL
 1507 C7D0  28 04       	JR	Z,FORSR2
 1508 C7D2  EB          	EX	DE,HL
 1509 C7D3  CD C689     	CALL	CPREG
 1510 C7D6  01 000D     FORSR2:	LD	BC,13
 1511 C7D9  E1          	POP	HL
 1512 C7DA  C8          	RET	Z
 1513 C7DB  09          	ADD	HL,BC
 1514 C7DC  18 E3       	JR	FORSR1
 1515                   	;
 1516 C7DE  3E 64       FOR:	LD	A,100
 1517 C7E0  32 03CC     	LD	(FORFLG),A
 1518 C7E3  CD CA5D     	CALL	LET
 1519 C7E6  C1          	POP	BC
 1520 C7E7  E5          	PUSH	HL
 1521 C7E8  CD CA48     	CALL	DATA
 1522 C7EB  22 03C8     	LD	(CSTFOR),HL
 1523 C7EE  21 0002     	LD	HL,2
 1524 C7F1  39          	ADD	HL,SP
 1525 C7F2  CD C7C1     FOR1:	CALL	FORSR1
 1526 C7F5  D1          	POP	DE
 1527 C7F6  20 14       	JR	NZ,FOR2
 1528 C7F8  09          	ADD	HL,BC
 1529 C7F9  D5          	PUSH	DE
 1530 C7FA  2B          	DEC	HL
 1531 C7FB  56          	LD	D,(HL)
 1532 C7FC  2B          	DEC	HL
 1533 C7FD  5E          	LD	E,(HL)
 1534 C7FE  23          	INC	HL
 1535 C7FF  23          	INC	HL
 1536 C800  E5          	PUSH	HL
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  27
BASIC   Z80

 1537 C801  2A 03C8     	LD	HL,(CSTFOR)
 1538 C804  CD C689     	CALL	CPREG
 1539 C807  E1          	POP	HL
 1540 C808  20 E8       	JR	NZ,FOR1
 1541 C80A  D1          	POP	DE
 1542 C80B  F9          	LD	SP,HL
 1543 C80C  EB          FOR2:	EX	DE,HL
 1544 C80D  0E 08       	LD	C,8
 1545 C80F  CD C327     	CALL	TMEMO
 1546 C812  E5          	PUSH	HL
 1547 C813  2A 03C8     	LD	HL,(CSTFOR)
 1548 C816  E3          	EX	(SP),HL
 1549 C817  E5          	PUSH	HL
 1550 C818  2A 0358     	LD	HL,(CULINO)	; aktuelle Zeilennummer
 1551 C81B  E3          	EX	(SP),HL
 1552 C81C  CD CD29     	CALL	SNALY3
 1553 C81F  CD C8CC     	CALL	CPSTX
 1554 C822  A6          	DEFB	TOTOK
 1555 C823  CD CD26     	CALL	SNALY2
 1556 C826  E5          	PUSH	HL
 1557 C827  CD D6EB     	CALL	OPLAD0
 1558 C82A  E1          	POP	HL
 1559 C82B  C5          	PUSH	BC
 1560 C82C  D5          	PUSH	DE
 1561 C82D  01 8100     	LD	BC,8100H	;+1.0
 1562 C830  51          	LD	D,C
 1563 C831  5A          	LD	E,D
 1564 C832  7E          	LD	A,(HL)
 1565 C833  FE AB       	CP	STPTOK
 1566 C835  3E 01       	LD	A,1
 1567 C837  20 0E       	JR	NZ,FOR3
 1568 C839  CD C8BD     	CALL	TCHAR
 1569 C83C  CD CD26     	CALL	SNALY2
 1570 C83F  E5          	PUSH	HL
 1571 C840  CD D6EB     	CALL	OPLAD0
 1572 C843  CD D697     	CALL	TSGNM
 1573 C846  E1          	POP	HL
 1574 C847  C5          FOR3:	PUSH	BC
 1575 C848  D5          	PUSH	DE
 1576 C849  F5          	PUSH	AF
 1577 C84A  33          	INC	SP
 1578 C84B  E5          	PUSH	HL
 1579 C84C  2A 03CF     	LD	HL,(CUSTMT)	; ZEILENNUMMER/ADRESSE DES AKTUELLEN STATEMENTS
 1580 C84F  E3          	EX	(SP),HL
 1581 C850  06 81       FOR4:	LD	B,FORTOK
 1582 C852  C5          	PUSH	BC
 1583 C853  33          	INC	SP
 1584                    
 1585                   ;RUN-MODE ORGANISATION
 1586                   ;TEST AUF UNTERBRECHUNGSANFORDERUNG
 1587 C854  CD DE16     RUNMOD:	CALL	SETCOI
 1588 C857  CD C8F9     	CALL	TESC
 1589 C85A  22 03CF     	LD	(CUSTMT),HL	; ZEILENNUMMER/ADRESSE DES AKTUELLEN STATEMENTS
 1590                   ;TEST AUF FORTSETZUNG DER ZEILE MIT COLON
 1591 C85D  7E          	LD	A,(HL)
 1592 C85E  FE 3A       	CP	':'
 1593 C860  28 28       	JR	Z,RUNMD2
 1594 C862  B7          	OR	A
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  28
BASIC   Z80

 1595 C863  C2 C348     	JP	NZ,SNER
 1596 C866  23          	INC	HL
 1597 C867  7E          	LD	A,(HL)
 1598 C868  23          	INC	HL
 1599 C869  B6          	OR	(HL)
 1600 C86A  CA C922     	JP	Z,END2
 1601 C86D  23          	INC	HL
 1602 C86E  5E          	LD	E,(HL)
 1603 C86F  23          	INC	HL
 1604 C870  56          	LD	D,(HL)
 1605 C871  ED 53 0358  	LD	(CULINO),DE	; aktuelle Zeilennummer
 1606 C875  3A 030A     	LD	A,(TRFLAG)
 1607 C878  B7          	OR	A
 1608 C879  28 0F       	JR	Z,RUNMD2
 1609 C87B  E5          	PUSH	HL
 1610 C87C  3E 3C       	LD	A,'<'
 1611 C87E  CD C6AE     	CALL	CHARO
 1612 C881  CD D82A     	CALL	NUMBO1
 1613 C884  3E 3E       	LD	A,'>'
 1614 C886  CD C6AE     	CALL	CHARO
 1615 C889  E1          	POP	HL
 1616                   ;TEST AUF ZEILENENDE
 1617 C88A  CD C8BD     RUNMD2:	CALL	TCHAR
 1618 C88D  11 C854     	LD	DE,RUNMOD
 1619 C890  D5          	PUSH	DE
 1620 C891  C8          RUNMD3:	RET	Z
 1621                   ;ERMITTLUNG DER ZU DEN KOMMANDOS IM DIRECT-MODE
 1622                   ;(AUCH IM INDIRECT-MODE VERWENDBAR) GEHOERNDEN
 1623                   ;UNTERPROGRAMMADRESSEN
 1624 C892  D6 80       DCLI2:	SUB	ENDTOK
 1625 C894  DA CA5D     	JP	C,LET
 1626 C897  FE 25       	CP	TABTOK-ENDTOK
 1627 C899  38 14       	JR	C,DLI21
 1628 C89B  D6 50       	SUB	LODTOK-ENDTOK
 1629 C89D  38 34       	JR	C,CPSTX2
 1630 C89F  FE 05       	CP	LAST-LODTOK+1	; Kommando aus Grundliste?
 1631 C8A1  38 0A       	JR	C,DLI20		; ja
 1632 C8A3  47          	LD	B,A
 1633 C8A4  3A 03FC     	LD	A,(EXTFLG)
 1634 C8A7  A7          	AND	A		; Erweiterung vorhanden?
 1635 C8A8  28 29       	JR	Z,CPSTX2	; nein --> Fehler
 1636 C8AA  C3 E003     	JP	EXTGO1		; Absprung zur Erweiterung
 1637                   	;
 1638 C8AD  C6 25       DLI20:	ADD	A,TABTOK-ENDTOK
 1639 C8AF  07          DLI21:	RLCA
 1640 C8B0  4F          	LD	C,A
 1641 C8B1  06 00       	LD	B,0
 1642 C8B3  EB          	EX	DE,HL
 1643 C8B4  21 C240     	LD	HL,ADRTB1	; Adresstabelle Grundtoken
 1644 C8B7  09          DLI22:	ADD	HL,BC
 1645 C8B8  4E          	LD	C,(HL)
 1646 C8B9  23          	INC	HL
 1647 C8BA  46          	LD	B,(HL)
 1648 C8BB  C5          	PUSH	BC
 1649 C8BC  EB          	EX	DE,HL
 1650                   ;ZEIGER IN DER ABZUARBEITENDEN ZEILE AUF
 1651                   ;NAECHSTES SIGNIFIKANTES ZEICHEN STELLEN
 1652                   ;TEST AUF ZEILENENDE
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  29
BASIC   Z80

 1653 C8BD  23          TCHAR:	INC	HL
 1654 C8BE  7E          TCHAR1:	LD	A,(HL)
 1655 C8BF  FE 3A       	CP	':'
 1656 C8C1  D0          	RET	NC
 1657 C8C2  FE 20       	CP	' '
 1658 C8C4  28 F7       	JR	Z,TCHAR
 1659 C8C6  FE 30       	CP	'0'
 1660 C8C8  3F          	CCF
 1661 C8C9  3C          	INC	A
 1662 C8CA  3D          	DEC	A
 1663 C8CB  C9          	RET
 1664                   
 1665                   ;VERGLEICHE (HL) MIT ((SP)),ERHOEHE (SP) UM 1
 1666 C8CC  7E          CPSTX:	LD	A,(HL)
 1667 C8CD  E3          	EX	(SP),HL
 1668 C8CE  BE          	CP	(HL)
 1669 C8CF  23          	INC	HL
 1670 C8D0  E3          	EX	(SP),HL
 1671 C8D1  28 EA       CPSTX1:	JR	Z,TCHAR
 1672 C8D3  C3 C348     CPSTX2:	JP	SNER
 1673                    
 1674 C8D6  3E 2C       CPCOMM:	LD	A,','
 1675 C8D8  BE          CPCOM1:	CP	(HL)
 1676 C8D9  18 F6       	JR	CPSTX1
 1677                   	;
 1678 C8DB  3E 29       CPBRGT:	LD	A,')'
 1679 C8DD  18 F9       	JR	CPCOM1
 1680                   ;
 1681                   ;REINITIALISIEREN VON DATEN
 1682 C8DF  EB          RESTO:	EX	DE,HL
 1683 C8E0  2A 035F     	LD	HL,(PSTBEG)	; Programmstart-Adresse
 1684 C8E3  28 0E       	JR	Z,RESTO1
 1685 C8E5  EB          	EX	DE,HL
 1686 C8E6  CD C986     	CALL	DCHEX		; Dezimalzahl erfassen
 1687 C8E9  E5          	PUSH	HL
 1688 C8EA  CD C4BB     	CALL	ZPOIT
 1689 C8ED  60          	LD	H,B
 1690 C8EE  69          	LD	L,C
 1691 C8EF  D1          	POP	DE
 1692 C8F0  D2 CA20     	JP	NC,ULER
 1693 C8F3  2B          RESTO1:	DEC	HL
 1694 C8F4  22 03DD     RESTO2:	LD	(RDPTR),HL
 1695 C8F7  EB          	EX	DE,HL
 1696 C8F8  C9          	RET
 1697                   ;
 1698                   ; PROGRAMMUNTERBRECHUNG UND -FORTSETZUNG
 1699                   ;
 1700 C8F9  CD DDF3     TESC:	CALL	CSTS		; Konsolen(Tastatur-)status abfragen
 1701 C8FC  C0          	RET	NZ		; keine Taste gedrueckt
 1702 C8FD  FE 13       	CP	PAUSSW		; PAUSE-Taste? (13H = STOP)
 1703 C8FF  28 08       	JR	Z,TESC0
 1704 C901  FE 03       	CP	STOPSW		; BRK-Taste? (03H = BRK)
 1705 C903  C0          	RET	NZ
 1706 C904  CD DDE4     	CALL	CI		; BRK-Code abholen von Konsole
 1707 C907  18 0F       	JR	STOP
 1708                   	;
 1709 C909  CD DDE4     TESC0:	CALL	CI		; Konsoleneingabe
 1710 C90C  FE 1E       	CP	CONTSW		; CONTINUE-Taste? (1EH = CONT)
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  30
BASIC   Z80

 1711 C90E  C8          	RET	Z
 1712 C90F  FE 0A       	CP	CURDWN		; Cursor runter?
 1713 C911  C8          	RET	Z
 1714 C912  FE 03       	CP	STOPSW		; BRK-Taste? (03H = BRK)
 1715 C914  28 02       	JR	Z,STOP
 1716 C916  18 F1       	JR	TESC0
 1717                   	;
 1718 C918  C0          STOP:	RET	NZ
 1719 C919  F6          	DEFB	0F6H		; OR n
 1720 C91A  C0          END:	RET	NZ
 1721 C91B  22 03CF     END0:	LD	(CUSTMT),HL	; ZEILENNUMMER/ADRESSE DES AKTUELLEN STATEMENTS
 1722 C91E  21          	DEFB	21H		; LD HL,nn
 1723 C91F  F6 FF       END1:	OR	0FFH
 1724 C921  C1          	POP	BC
 1725 C922  2A 0358     END2:	LD	HL,(CULINO)	; aktuelle Zeilennummer
 1726 C925  F5          	PUSH	AF
 1727 C926  7D          	LD	A,L
 1728 C927  A4          	AND	H
 1729 C928  3C          	INC	A
 1730 C929  28 09       	JR	Z,END3
 1731 C92B  22 03D3     	LD	(LLNOEX),HL
 1732 C92E  2A 03CF     	LD	HL,(CUSTMT)	; ZEILENNUMMER/ADRESSE DES AKTUELLEN STATEMENTS
 1733 C931  22 03D5     	LD	(LBYTER),HL
 1734 C934  AF          END3:	XOR	A
 1735 C935  32 0343     	LD	(OUTFLG),A	; Ausgabe nicht unterdruecken
 1736 C938  CD DE1D     	CALL	SETCO
 1737 C93B  CD CB55     	CALL	CRWDY		; neue Zeile
 1738 C93E  F1          	POP	AF
 1739 C93F  21 C321     	LD	HL,BR
 1740 C942  C2 C371     	JP	NZ,ERROO1
 1741 C945  C3 C388     	JP	EDIT
 1742                    
 1743 C948  2A 03D5     CONT:	LD	HL,(LBYTER)
 1744 C94B  7C          	LD	A,H
 1745 C94C  B5          	OR	L
 1746 C94D  1E 20       CNER:	LD	E,32		; CN-ERROR
 1747 C94F  CA C356     	JP	Z,ERROO
 1748 C952  EB          	EX	DE,HL
 1749 C953  2A 03D3     	LD	HL,(LLNOEX)
 1750 C956  22 0358     	LD	(CULINO),HL	; aktuelle Zeilennummer
 1751 C959  EB          	EX	DE,HL
 1752 C95A  C9          	RET
 1753                   ;
 1754                   ;BESTIMMEN DES WERTES EINES AUSDRUCKS
 1755 C95B  CD C8BD     EPRVAL:	CALL	TCHAR
 1756 C95E  CD CD26     EPRVL1:	CALL	SNALY2
 1757 C961  CD D697     EPRVL2:	CALL	TSGNM
 1758 C964  F2 C96F     	JP	P,EPRVL3
 1759 C967  1E 08       FCER:	LD	E,8		; FC-ERROR
 1760 C969  C3 C356     	JP	ERROO
 1761                   	;
 1762 C96C  CD CD26     EPRVL4:	CALL	SNALY2
 1763 C96F  3A 03E8     EPRVL3:	LD	A,(WRA1+3)
 1764 C972  FE 90       	CP	90H
 1765 C974  DA D745     	JP	C,INTMOV
 1766 C977  01 9080     	LD	BC,9080H
 1767 C97A  11 0000     	LD	DE,0000H
 1768 C97D  E5          	PUSH	HL
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  31
BASIC   Z80

 1769 C97E  CD D718     	CALL	VORZ1
 1770 C981  E1          	POP	HL
 1771 C982  51          	LD	D,C
 1772 C983  C8          	RET	Z
 1773 C984  18 E1       	JR	FCER
 1774                    
 1775                   ;UMWANDLUNG EINGEGEBENER ZAHLEN IM ASCII-CODE
 1776                   ;IN HEXADEZIMALZAHLEN
 1777                   ; PE:	HL	Eingabepuffer, wo Dezimalzahl beginnt
 1778                   ; PA:	DE	erfasste Zahl in hexadezimal
 1779 C986  2B          DCHEX:	DEC	HL
 1780 C987  11 0000     DCHEX1:	LD	DE,0	; Startwert
 1781 C98A  CD C8BD     DCHEX2:	CALL	TCHAR	; naechstes Zeichen
 1782 C98D  D0          	RET	NC	; fertig
 1783 C98E  E5          	PUSH	HL
 1784 C98F  F5          	PUSH	AF
 1785 C990  21 1998     	LD	HL,6552
 1786 C993  CD C689     	CALL	CPREG
 1787 C996  DA C348     	JP	C,SNER
 1788 C999  62          	LD	H,D
 1789 C99A  6B          	LD	L,E
 1790 C99B  19          	ADD	HL,DE	; *2
 1791 C99C  29          	ADD	HL,HL	; *4
 1792 C99D  19          	ADD	HL,DE	; *5
 1793 C99E  29          	ADD	HL,HL	; *10
 1794 C99F  F1          	POP	AF
 1795 C9A0  D6 30       	SUB	'0'
 1796 C9A2  5F          	LD	E,A
 1797 C9A3  16 00       	LD	D,0
 1798 C9A5  19          	ADD	HL,DE	; aktuelle Ziffer addieren
 1799 C9A6  EB          	EX	DE,HL	; Wert in DE
 1800 C9A7  E1          	POP	HL	; Eingabepuffer
 1801 C9A8  18 E0       	JR	DCHEX2	; naechstes Zeichen
 1802                   ;
 1803 C9AA  28 3C       CLEAR:	JR	Z,CLEAR2
 1804 C9AC  CD C95E     	CALL	EPRVL1
 1805 C9AF  CD C8BE     	CALL	TCHAR1
 1806 C9B2  E5          	PUSH	HL
 1807 C9B3  2A 03B0     	LD	HL,(MEMSIZ)
 1808 C9B6  28 10       	JR	Z,CLEAR1
 1809 C9B8  E1          	POP	HL
 1810 C9B9  CD C8D6     	CALL	CPCOMM
 1811 C9BC  D5          	PUSH	DE
 1812 C9BD  CD C96C     	CALL	EPRVL4
 1813 C9C0  CD C8BE     	CALL	TCHAR1
 1814 C9C3  C2 C348     	JP	NZ,SNER
 1815 C9C6  E3          	EX	(SP),HL
 1816 C9C7  EB          	EX	DE,HL
 1817 C9C8  7D          CLEAR1:	LD	A,L
 1818 C9C9  93          	SUB	E
 1819 C9CA  5F          	LD	E,A
 1820 C9CB  7C          	LD	A,H
 1821 C9CC  9A          	SBC	A,D
 1822 C9CD  57          	LD	D,A
 1823 C9CE  DA C33E     	JP	C,OMER		; -> OM ERROR
 1824 C9D1  E5          	PUSH	HL
 1825 C9D2  2A 03D7     	LD	HL,(SVARPT)
 1826 C9D5  01 0028     	LD	BC,40
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  32
BASIC   Z80

 1827 C9D8  09          	ADD	HL,BC
 1828 C9D9  CD C689     	CALL	CPREG
 1829 C9DC  D2 C33E     	JP	NC,OMER		; -> OM ERROR
 1830 C9DF  EB          	EX	DE,HL
 1831 C9E0  22 0356     	LD	(STDPTR),HL
 1832 C9E3  E1          	POP	HL
 1833 C9E4  22 03B0     	LD	(MEMSIZ),HL
 1834 C9E7  E1          	POP	HL
 1835 C9E8  C3 C653     CLEAR2:	JP	NEW3
 1836                   ;
 1837                   ;PROGRAMMSTART, UP-TECHNIK,DATA UND REMARKS
 1838 C9EB  CA C64F     RUN:	JP	Z,NEW2
 1839 C9EE  CD C653     	CALL	NEW3
 1840 C9F1  01 C854     	LD	BC,RUNMOD
 1841 C9F4  18 10       	JR	GOTO0
 1842                    
 1843 C9F6  0E 03       GOSUB:	LD	C,3
 1844 C9F8  CD C327     	CALL	TMEMO
 1845 C9FB  C1          	POP	BC
 1846 C9FC  E5          	PUSH	HL
 1847 C9FD  E5          	PUSH	HL
 1848 C9FE  2A 0358     	LD	HL,(CULINO)	; aktuelle Zeilennummer
 1849 CA01  E3          	EX	(SP),HL
 1850 CA02  3E 8C       	LD	A,GSBTOK
 1851 CA04  F5          	PUSH	AF
 1852 CA05  33          	INC	SP
 1853 CA06  C5          GOTO0:	PUSH	BC
 1854 CA07  CD C986     GOTO:	CALL	DCHEX		; Dezimalzahl erfassen
 1855 CA0A  CD CA4A     	CALL	REM
 1856 CA0D  E5          	PUSH	HL
 1857 CA0E  2A 0358     	LD	HL,(CULINO)	; aktuelle Zeilennummer
 1858 CA11  CD C689     	CALL	CPREG
 1859 CA14  E1          	POP	HL
 1860 CA15  23          	INC	HL
 1861 CA16  DC C4BE     	CALL	C,ZPOIT1
 1862 CA19  D4 C4BB     	CALL	NC,ZPOIT
 1863 CA1C  60          	LD	H,B
 1864 CA1D  69          	LD	L,C
 1865 CA1E  2B          	DEC	HL
 1866 CA1F  D8          	RET	C
 1867 CA20  1E 0E       ULER:	LD	E,14		; UL-ERROR
 1868 CA22  C3 C356     ULER1:	JP	ERROO
 1869                    
 1870 CA25  C0          RETUR:	RET	NZ
 1871 CA26  16 FF       	LD	D,0FFH
 1872 CA28  CD C7BD     	CALL	FORSR
 1873 CA2B  F9          	LD	SP,HL
 1874 CA2C  FE 8C       	CP	GSBTOK
 1875 CA2E  1E 04       RGER:	LD	E,4		; RG-ERROR
 1876 CA30  20 F0       	JR	NZ,ULER1
 1877 CA32  E1          	POP	HL
 1878 CA33  22 0358     	LD	(CULINO),HL	; aktuelle Zeilennummer
 1879 CA36  23          	INC	HL
 1880 CA37  7C          	LD	A,H
 1881 CA38  B5          	OR	L
 1882 CA39  20 07       	JR	NZ,RETUR1
 1883 CA3B  3A 03CD     	LD	A,(IPHFLG)
 1884 CA3E  B7          	OR	A
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  33
BASIC   Z80

 1885 CA3F  C2 C387     	JP	NZ,EDIT0
 1886 CA42  21 C854     RETUR1:	LD	HL,RUNMOD
 1887 CA45  E3          	EX	(SP),HL
 1888 CA46  3E          	DEFB	3EH		; LD A,0E1H
 1889 CA47  E1          DATA0:	POP	HL
 1890 CA48  3A01        DATA:	DEFW	3A01H		; LD BC,0E3AH
 1891 CA4A              ELSE:				; NOP
 1892 CA4A  0E 00       REM:	LD	C,0
 1893 CA4C  06 00       	LD	B,0
 1894 CA4E  79          REM1:	LD	A,C
 1895 CA4F  48          	LD	C,B
 1896 CA50  47          	LD	B,A
 1897 CA51  7E          REM2:	LD	A,(HL)
 1898 CA52  B7          	OR	A
 1899 CA53  C8          	RET	Z
 1900 CA54  B8          	CP	B
 1901 CA55  C8          	RET	Z
 1902 CA56  23          	INC	HL
 1903 CA57  FE 22       	CP	'"'
 1904 CA59  28 F3       	JR	Z,REM1
 1905 CA5B  18 F4       	JR	REM2
 1906                   ;
 1907                   ;WERTZUWEISUNG
 1908 CA5D  CD CF06     LET:	CALL	DIM1
 1909 CA60  CD C8CC     	CALL	CPSTX
 1910 CA63  B4          	DEFB	EQUTOK
 1911 CA64  D5          	PUSH	DE
 1912 CA65  3A 03AE     	LD	A,(DATYPE)
 1913 CA68  F5          	PUSH	AF
 1914 CA69  CD CD3A     	CALL	SNALY
 1915 CA6C  F1          	POP	AF
 1916 CA6D  E3          	EX	(SP),HL
 1917 CA6E  22 03CF     	LD	(CUSTMT),HL	; ZEILENNUMMER/ADRESSE DES AKTUELLEN STATEMENTS
 1918 CA71  1F          	RRA
 1919 CA72  CD CD2B     	CALL	SNALY5
 1920 CA75  28 35       	JR	Z,LET4
 1921 CA77  E5          LET1:	PUSH	HL
 1922 CA78  2A 03E5     	LD	HL,(WRA1)
 1923 CA7B  E5          	PUSH	HL
 1924 CA7C  23          	INC	HL
 1925 CA7D  23          	INC	HL
 1926 CA7E  5E          	LD	E,(HL)
 1927 CA7F  23          	INC	HL
 1928 CA80  56          	LD	D,(HL)
 1929         0000      	COND	ZFT
 1933                   	ENDC
 1934         FFFF      	COND	ZFT-1
 1935 CA81  2A 035F     	LD	HL,(PSTBEG)	; Programmstart-Adresse
 1936 CA84  CD C689     	CALL	CPREG
 1937 CA87  30 12       	JR	NC,LET2
 1938                   	ENDC
 1939 CA89  2A 0356     	LD	HL,(STDPTR)
 1940 CA8C  CD C689     	CALL	CPREG
 1941 CA8F  D1          	POP	DE
 1942 CA90  30 11       	JR	NC,LET3
 1943 CA92  21 03C0     	LD	HL,EOLSPT+1
 1944 CA95  CD C689     	CALL	CPREG
 1945 CA98  30 09       	JR	NC,LET3
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  34
BASIC   Z80

 1946 CA9A  3E          	DEFB	3EH
 1947 CA9B  D1          LET2:	POP	DE
 1948 CA9C  CD D31B     	CALL	SPTSRH
 1949 CA9F  EB          	EX	DE,HL
 1950 CAA0  CD D166     	CALL	STR_1
 1951 CAA3  CD D31B     LET3:	CALL	SPTSRH
 1952 CAA6  E1          	POP	HL
 1953 CAA7  CD D6FA     	CALL	OPTRN1
 1954 CAAA  E1          	POP	HL
 1955 CAAB  C9          	RET
 1956                   	;
 1957 CAAC  E5          LET4:	PUSH	HL
 1958 CAAD  CD D6F7     	CALL	OPTRAN
 1959 CAB0  D1          	POP	DE
 1960 CAB1  E1          	POP	HL
 1961 CAB2  C9          	RET
 1962                   ;
 1963                   ;PROGRAMMVERZWEIGUNGEN
 1964 CAB3  CD D421     ON:	CALL	ARGVL1
 1965 CAB6  7E          	LD	A,(HL)
 1966 CAB7  47          	LD	B,A
 1967 CAB8  FE 8C       	CP	GSBTOK
 1968 CABA  28 05       	JR	Z,ON1
 1969 CABC  CD C8CC     	CALL	CPSTX
 1970 CABF  88          	DEFB	GTOTOK
 1971 CAC0  2B          	DEC	HL
 1972 CAC1  4B          ON1:	LD	C,E
 1973 CAC2  0D          ON2:	DEC	C
 1974 CAC3  78          	LD	A,B
 1975 CAC4  CA C892     	JP	Z,DCLI2
 1976 CAC7  CD C987     	CALL	DCHEX1
 1977 CACA  FE 2C       	CP	','
 1978 CACC  C0          	RET	NZ
 1979 CACD  18 F3       	JR	ON2
 1980                    
 1981 CACF  CD CD3A     IF:	CALL	SNALY
 1982 CAD2  7E          	LD	A,(HL)
 1983 CAD3  FE 88       	CP	GTOTOK
 1984 CAD5  28 05       	JR	Z,IF1
 1985 CAD7  CD C8CC     	CALL	CPSTX
 1986 CADA  A9          	DEFB	THNTOK
 1987 CADB  2B          	DEC	HL
 1988 CADC  CD CD29     IF1:	CALL	SNALY3
 1989 CADF  CD D697     	CALL	TSGNM
 1990 CAE2  20 08       	JR	NZ,IF3
 1991 CAE4  23          IF2:	INC	HL
 1992 CAE5  7E          	LD	A,(HL)
 1993 CAE6  B7          	OR	A
 1994 CAE7  C8          	RET	Z
 1995 CAE8  FE D4       	CP	ELSTOK
 1996 CAEA  20 F8       	JR	NZ,IF2
 1997 CAEC  CD C8BD     IF3:	CALL	TCHAR
 1998 CAEF  DA CA07     	JP	C,GOTO
 1999 CAF2  C3 C891     	JP	RUNMD3
 2000                   ;
 2001                   ;AUSDRUCK VON WERTEN UND STRINGS UND FORMATSTEUERUNG
 2002 CAF5  CD C8BE     PRINT0:	CALL	TCHAR1
 2003 CAF8  18 07       	JR	PRINT1
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  35
BASIC   Z80

 2004                   	;
 2005 CAFA  AF          PRINT:	XOR	A
 2006 CAFB  32 03FD     	LD	(PRTFLG),A	 ;noch keine PRINT-Erweiterung
 2007 CAFE  CD DE25     	CALL	OUTCHL
 2008 CB01  28 5E       PRINT1:	JR	Z,CRWDY2
 2009 CB03  C8          PRINT2:	RET	Z
 2010 CB04  FE D5       	CP	LAST+1
 2011 CB06  38 09       	JR	C,PRINT6	; Token fuer Erweiterung
 2012 CB08  3A 03FC     	LD	A,(EXTFLG)	; nicht in Grundliste
 2013 CB0B  A7          	AND	A		; Erweiterung vorhanden?
 2014 CB0C  28 03       	JR	Z,PRINT6
 2015 CB0E  CD E006     	CALL	EXTGO2
 2016 CB11  FE A5       PRINT6:	CP	TABTOK		; Fehler
 2017 CB13  CA CB92     	JP	Z,TAB
 2018 CB16  FE A8       	CP	SPCTOK
 2019 CB18  28 78       	JR	Z,TAB
 2020 CB1A  E5          	PUSH	HL
 2021 CB1B  FE 2C       	CP	','
 2022 CB1D  28 5D       	JR	Z,FORMAT
 2023 CB1F  FE 3B       	CP	';'
 2024 CB21  CA CBB2     	JP	Z,TAB4
 2025 CB24  C1          	POP	BC
 2026 CB25  CD CD3A     	CALL	SNALY
 2027 CB28  E5          	PUSH	HL
 2028 CB29  3A 03AE     	LD	A,(DATYPE)
 2029 CB2C  B7          	OR	A
 2030 CB2D  20 20       	JR	NZ,PRINT4
 2031 CB2F  CD D834     	CALL	NUMKON
 2032 CB32  CD D18A     	CALL	SLEN0
 2033 CB35  36 20       	LD	(HL),' '
 2034 CB37  2A 03E5     	LD	HL,(WRA1)
 2035 CB3A  34          	INC	(HL)
 2036 CB3B  2A 03E5     	LD	HL,(WRA1)
 2037 CB3E  3A 0341     	LD	A,(LINLEN)
 2038 CB41  47          	LD	B,A
 2039 CB42  04          	INC	B
 2040 CB43  28 0A       	JR	Z,PRINT3
 2041 CB45  04          	INC	B
 2042 CB46  3A 03AC     	LD	A,(CURPOS)
 2043 CB49  86          	ADD	A,(HL)
 2044 CB4A  3D          	DEC	A
 2045 CB4B  B8          	CP	B
 2046 CB4C  D4 CB61     	CALL	NC,CRWDY2
 2047 CB4F              PRINT3:
 2048 CB4F  CD D1CC     PRINT4:	CALL	TEXTO1
 2049 CB52  E1          	POP	HL
 2050 CB53  18 A0       PRINT5:	JR	PRINT0
 2051                    
 2052                   ;AUSGABE EINES LF- UND EINES CR(ASCII)ZEICHENS
 2053                   ;AM ZEILENENDE,ZUSAETZLICH AUSGABE DER VEREIN-
 2054                   ;BARTEN ANZAHL VON DUMMYZEICHEN
 2055 CB55  3A 03AC     CRWDY:	LD	A,(CURPOS)
 2056 CB58  B7          	OR	A
 2057 CB59  C8          	RET	Z		; bereits auf Zeilenanfang
 2058 CB5A  18 05       	JR	CRWDY2
 2059                   	;
 2060 CB5C  36 00       CRWDY1:	LD	(HL),0
 2061 CB5E  21 0361     CRWDY6:	LD	HL,INPBUF
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  36
BASIC   Z80

 2062 CB61  3E 0D       CRWDY2:	LD	A,0DH		; CR
 2063 CB63  CD C6AE     	CALL	CHARO
 2064 CB66  3E 0A       CRWDY5:	LD	A,0AH		; LF
 2065 CB68  CD C6AE     	CALL	CHARO
 2066 CB6B  AF          CRWDY3:	XOR	A
 2067 CB6C  32 03AC     	LD	(CURPOS),A
 2068 CB6F  3A 0340     	LD	A,(DUMMY)	; Anzahl Dummy-Zeichen
 2069 CB72  3D          CRWDY4:	DEC	A
 2070 CB73  C8          	RET	Z		; fertig
 2071 CB74  F5          	PUSH	AF
 2072 CB75  AF          	XOR	A		; Dummy-Zeichen
 2073 CB76  CD C6AE     	CALL	CHARO		; anzeigen
 2074 CB79  F1          	POP	AF
 2075 CB7A  18 F6       	JR	CRWDY4
 2076                    
 2077                   ;ORGANISATION DER AUSGABEFORMATIERUNG BEI
 2078                   ;MEHREREN LISTENELEMENTEN IN DER PRINT-ANWEISUNG
 2079 CB7C  3A 0342     FORMAT:	LD	A,(PRLISI)
 2080 CB7F  47          	LD	B,A
 2081 CB80  3A 03AC     	LD	A,(CURPOS)
 2082 CB83  B8          	CP	B
 2083 CB84  D4 CB61     	CALL	NC,CRWDY2
 2084 CB87  30 29       	JR	NC,TAB4
 2085 CB89  D6 0D       FORM1:	SUB	13
 2086 CB8B  38 02       	JR	C,FORM2
 2087 CB8D  20 FA       	JR	NZ,FORM1
 2088 CB8F  2F          FORM2:	CPL
 2089 CB90  18 15       	JR	TAB2
 2090                   ;ORGANISATION DES TABULATORSPRUNGES
 2091 CB92  F5          TAB:	PUSH	AF
 2092 CB93  CD D41E     	CALL	ARGVAL
 2093 CB96  CD C8DB     	CALL	CPBRGT
 2094 CB99  2B          	DEC	HL
 2095 CB9A  F1          	POP	AF
 2096 CB9B  D6 A8       	SUB	SPCTOK
 2097 CB9D  E5          	PUSH	HL
 2098 CB9E  28 03       	JR	Z,TAB1
 2099 CBA0  3A 03AC     	LD	A,(CURPOS)
 2100 CBA3  2F          TAB1:	CPL
 2101 CBA4  83          	ADD	A,E
 2102 CBA5  30 0B       	JR	NC,TAB4
 2103 CBA7  3C          TAB2:	INC	A
 2104 CBA8  28 08       	JR	Z,TAB4
 2105 CBAA  47          	LD	B,A
 2106 CBAB  3E 20       	LD	A,' '
 2107 CBAD  CD C6AE     TAB3:	CALL	CHARO
 2108 CBB0  10 FB       	DJNZ	TAB3
 2109 CBB2  E1          TAB4:	POP	HL
 2110 CBB3  CD C8BD     	CALL	TCHAR
 2111 CBB6  C3 CB03     	JP	PRINT2
 2112                    
 2113 CBB9  CD D421     WIDTH:	CALL	ARGVL1
 2114 CBBC  32 0341     	LD	(LINLEN),A
 2115 CBBF  C9          	RET
 2116                   
 2117 CBC0  CD D421     NULL:	CALL	ARGVL1
 2118 CBC3  C0          	RET	NZ
 2119 CBC4  3C          	INC	A
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  37
BASIC   Z80

 2120 CBC5  32 0340     	LD	(DUMMY),A		; neue Anzahl Dummy-Zeichen
 2121 CBC8  C9          	RET
 2122                   ;
 2123                   ;EINGABE VON WERTEN (EXT. ODER INT.)
 2124 CBC9  3F 52 45 44 RED:	DEFM	'?REDO FROM START'
 2125 CBD9  000D        	DEFW	ASCCR
 2126 CBDB  3A 03CE     REDOUT:	LD	A,(RDFLAG)
 2127 CBDE  B7          	OR	A
 2128 CBDF  C2 C342     	JP	NZ,SNER0
 2129 CBE2  C1          	POP	BC
 2130 CBE3  21 CBC9     	LD	HL,RED
 2131 CBE6  CD D1C9     	CALL	TEXTO
 2132 CBE9  C3 C685     	JP	INITR2
 2133                    
 2134 CBEC  CD D137     INPUT:	CALL	DMODTS
 2135 CBEF  CD DE5F     	CALL	INCHNL
 2136 CBF2  AF          	XOR	A
 2137 CBF3  32 0343     	LD	(OUTFLG),A	; Ausgabe nicht unterdruecken
 2138 CBF6  7E          	LD	A,(HL)
 2139 CBF7  FE 22       	CP	'"'
 2140 CBF9  20 10       	JR	NZ,INPUT1
 2141 CBFB  CD D18B     	CALL	SOPRND
 2142 CBFE  CD C8CC     	CALL	CPSTX
 2143 CC01  3B          	DEFB	';'
 2144 CC02  E5          	PUSH	HL
 2145 CC03  CD D1CC     	CALL	TEXTO1
 2146 CC06  CD C6D4     	CALL	OUT1?
 2147 CC09  18 04       	JR	INPUT2
 2148                   	;
 2149 CC0B  E5          INPUT1:	PUSH	HL
 2150                   ;EINGABEANFORDERUNG
 2151 CC0C  CD C6CF     	CALL	OUT?
 2152 CC0F  C1          INPUT2:	POP	BC
 2153 CC10  38 36       	JR	C,READ14
 2154 CC12  21 0362     	LD	HL,INPBUF+1
 2155 CC15  7E          	LD	A,(HL)
 2156 CC16  B7          	OR	A
 2157 CC17  2B          	DEC	HL
 2158 CC18  C5          	PUSH	BC
 2159 CC19  28 37       	JR	Z,READ13
 2160 CC1B  36 2C       	LD	(HL),','
 2161 CC1D  18 05       	JR	READ1
 2162                    
 2163 CC1F  E5          READ:	PUSH	HL
 2164 CC20  2A 03DD     	LD	HL,(RDPTR)
 2165 CC23  F6          	DEFB	0F6H
 2166 CC24  AF          READ1:	XOR	A
 2167 CC25  32 03CE     	LD	(RDFLAG),A
 2168 CC28  E3          	EX	(SP),HL
 2169 CC29  18 03       	JR	READ3
 2170                   	;
 2171 CC2B  CD C8D6     READ2:	CALL	CPCOMM
 2172 CC2E  CD CF06     READ3:	CALL	DIM1
 2173 CC31  E3          	EX	(SP),HL
 2174 CC32  D5          	PUSH	DE
 2175 CC33  7E          	LD	A,(HL)
 2176 CC34  FE 2C       	CP	','
 2177 CC36  28 1E       	JR	Z,READ4
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  38
BASIC   Z80

 2178 CC38  3A 03CE     	LD	A,(RDFLAG)
 2179 CC3B  B7          	OR	A
 2180 CC3C  20 7D       	JR	NZ,READ10
 2181                   ;WIEDERHOLTE EINGABEANFORDERUNG
 2182 CC3E  3E 3F       	LD	A,'?'
 2183 CC40  CD C6AE     	CALL	CHARO
 2184 CC43  CD C6CF     	CALL	OUT?
 2185 CC46  D1          	POP	DE
 2186 CC47  C1          	POP	BC
 2187 CC48  DA C91F     READ14:	JP	C,END1
 2188 CC4B  21 0362     	LD	HL,INPBUF+1
 2189 CC4E  7E          	LD	A,(HL)
 2190 CC4F  B7          	OR	A
 2191 CC50  2B          	DEC	HL
 2192 CC51  C5          	PUSH	BC
 2193 CC52  CA CA47     READ13:	JP	Z,DATA0
 2194 CC55  D5          	PUSH	DE
 2195 CC56  3A 03AE     READ4:	LD	A,(DATYPE)
 2196 CC59  B7          	OR	A
 2197 CC5A  28 21       	JR	Z,READ7
 2198 CC5C  CD C8BD     	CALL	TCHAR
 2199 CC5F  57          	LD	D,A
 2200 CC60  47          	LD	B,A
 2201 CC61  FE 22       	CP	'"'
 2202 CC63  28 0C       	JR	Z,READ6
 2203 CC65  3A 03CE     	LD	A,(RDFLAG)
 2204 CC68  B7          	OR	A
 2205 CC69  57          	LD	D,A
 2206 CC6A  28 02       	JR	Z,READ5
 2207 CC6C  16 3A       	LD	D,':'
 2208 CC6E  06 2C       READ5:	LD	B,','
 2209 CC70  2B          	DEC	HL
 2210 CC71  CD D18E     READ6:	CALL	STRLEN
 2211 CC74  EB          	EX	DE,HL
 2212 CC75  21 CC88     	LD	HL,READ8
 2213 CC78  E3          	EX	(SP),HL
 2214 CC79  D5          	PUSH	DE
 2215 CC7A  C3 CA77     	JP	LET1
 2216 CC7D  CD C8BD     READ7:	CALL	TCHAR
 2217 CC80  CD D7A1     	CALL	VALNRM
 2218 CC83  E3          	EX	(SP),HL
 2219 CC84  CD D6F7     	CALL	OPTRAN
 2220 CC87  E1          	POP	HL
 2221 CC88  CD C8BE     READ8:	CALL	TCHAR1
 2222 CC8B  28 05       	JR	Z,READ9
 2223 CC8D  FE 2C       	CP	','
 2224 CC8F  C2 CBDB     	JP	NZ,REDOUT
 2225 CC92  E3          READ9:	EX	(SP),HL
 2226 CC93  CD C8BE     	CALL	TCHAR1
 2227 CC96  20 93       	JR	NZ,READ2
 2228 CC98  D1          	POP	DE
 2229 CC99  3A 03CE     	LD	A,(RDFLAG)
 2230 CC9C  B7          	OR	A
 2231 CC9D  EB          	EX	DE,HL
 2232 CC9E  C2 C8F4     	JP	NZ,RESTO2
 2233 CCA1  D5          	PUSH	DE
 2234 CCA2  B6          	OR	(HL)
 2235 CCA3  21 CCAB     	LD	HL,EXTR
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  39
BASIC   Z80

 2236 CCA6  C4 D1C9     	CALL	NZ,TEXTO
 2237 CCA9  E1          	POP	HL
 2238 CCAA  C9          	RET
 2239                   	;
 2240 CCAB  3F 45 58 54 EXTR:	DEFM	'?EXTRA IGNORED'
 2241 CCB9  000D        	DEFW	ASCCR
 2242 CCBB  CD CA48     READ10:	CALL	DATA
 2243 CCBE  B7          	OR	A
 2244 CCBF  20 11       	JR	NZ,READ11
 2245 CCC1  23          	INC	HL
 2246 CCC2  7E          	LD	A,(HL)
 2247 CCC3  23          	INC	HL
 2248 CCC4  B6          	OR	(HL)
 2249 CCC5  1E 06       ODER:	LD	E,6		; OD-ERROR
 2250 CCC7  CA C356     	JP	Z,ERROO
 2251 CCCA  23          	INC	HL
 2252 CCCB  5E          	LD	E,(HL)
 2253 CCCC  23          	INC	HL
 2254 CCCD  56          	LD	D,(HL)
 2255 CCCE  ED 53 03CA  	LD	(DATPTR),DE
 2256 CCD2  CD C8BD     READ11:	CALL	TCHAR
 2257 CCD5  FE 83       	CP	DATTOK
 2258 CCD7  20 E2       	JR	NZ,READ10
 2259 CCD9  C3 CC56     READ12:	JP	READ4
 2260                   ;
 2261                   ;VORRANGSTEUERUNG DR OPERATOREN UND SCHLEIFENABSCHLUSS
 2262                   ;ENDE DER MIT  F O R  EROEFFNETEN SCHLEIFE
 2263 CCDC  11 0000     NEXT:	LD	DE,0
 2264 CCDF  C4 CF06     NEXT1:	CALL	NZ,DIM1
 2265 CCE2  22 03CF     	LD	(CUSTMT),HL	; ZEILENNUMMER/ADRESSE DES AKTUELLEN STATEMENTS
 2266 CCE5  CD C7BD     	CALL	FORSR
 2267 CCE8  C2 C34E     	JP	NZ,NFER
 2268 CCEB  F9          	LD	SP,HL
 2269 CCEC  D5          	PUSH	DE
 2270 CCED  7E          	LD	A,(HL)
 2271 CCEE  23          	INC	HL
 2272 CCEF  F5          	PUSH	AF
 2273 CCF0  D5          	PUSH	DE
 2274 CCF1  CD D6DD     	CALL	OPKOP
 2275 CCF4  E3          	EX	(SP),HL
 2276 CCF5  E5          	PUSH	HL
 2277 CCF6  CD D461     	CALL	ADD2
 2278 CCF9  E1          	POP	HL
 2279 CCFA  CD D6F7     	CALL	OPTRAN
 2280 CCFD  E1          	POP	HL
 2281 CCFE  CD D6EE     	CALL	OPLAD
 2282 CD01  E5          	PUSH	HL
 2283 CD02  CD D718     	CALL	VORZ1
 2284 CD05  E1          	POP	HL
 2285 CD06  C1          	POP	BC
 2286 CD07  90          	SUB	B
 2287 CD08  CD D6EE     	CALL	OPLAD
 2288 CD0B  28 09       	JR	Z,NEXT2
 2289 CD0D  ED 53 0358  	LD	(CULINO),DE	; aktuelle Zeilennummer
 2290 CD11  69          	LD	L,C
 2291 CD12  60          	LD	H,B
 2292 CD13  C3 C850     	JP	FOR4
 2293                   ;ROUTINE ZUR AUFSTELLUNG EINES RPN-VEKTORS IM
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  40
BASIC   Z80

 2294                   ;STACK, UM VERKETTETE AUFGABEN ZU LOESENN
 2295 CD16  F9          NEXT2:	LD	SP,HL
 2296 CD17  2A 03CF     	LD	HL,(CUSTMT)	; ZEILENNUMMER/ADRESSE DES AKTUELLEN STATEMENTS
 2297 CD1A  7E          	LD	A,(HL)
 2298 CD1B  FE 2C       	CP	','
 2299 CD1D  C2 C854     	JP	NZ,RUNMOD
 2300 CD20  CD C8BD     	CALL	TCHAR
 2301 CD23  CD CCDF     	CALL	NEXT1
 2302 CD26  CD CD3A     SNALY2:	CALL	SNALY
 2303 CD29  F6          SNALY3:	DEFB	0F6H		; OR n setzt CY=0
 2304 CD2A  37          SNALY4:	SCF
 2305 CD2B  3A 03AE     SNALY5:	LD	A,(DATYPE)
 2306 CD2E  8F          	ADC	A,A
 2307 CD2F  B7          	OR	A
 2308 CD30  E8          	RET	PE
 2309 CD31  1E 18       TMER:	LD	E,24		; TM-ERROR
 2310 CD33  C3 C356     	JP	ERROO
 2311                   
 2312 CD36  CD C8CC     SNALY6:	CALL	CPSTX
 2313 CD39  28          	DEFB	'('
 2314 CD3A  2B          SNALY:	DEC	HL
 2315 CD3B  16 00       	LD	D,0
 2316 CD3D  D5          SNALY7:	PUSH	DE
 2317 CD3E  0E 01       	LD	C,1
 2318 CD40  CD C327     	CALL	TMEMO
 2319 CD43  CD CDAD     	CALL	SNLY13
 2320 CD46  22 03D1     SNALY8:	LD	(NTOKPT),HL
 2321 CD49  2A 03D1     SNALY9:	LD	HL,(NTOKPT)
 2322 CD4C  C1          	POP	BC
 2323 CD4D  78          	LD	A,B
 2324 CD4E  FE 78       	CP	78H
 2325 CD50  D4 CD29     	CALL	NC,SNALY3
 2326 CD53  7E          	LD	A,(HL)
 2327 CD54  16 00       	LD	D,0
 2328 CD56  D6 B3       SNLY10:	SUB	GRTTOK
 2329 CD58  38 15       	JR	C,SNLY11
 2330 CD5A  FE 03       	CP	LTHTOK-GRTTOK+1
 2331 CD5C  30 11       	JR	NC,SNLY11
 2332 CD5E  FE 01       	CP	EQUTOK-GRTTOK
 2333 CD60  17          	RLA
 2334 CD61  AA          	XOR	D
 2335 CD62  BA          	CP	D
 2336 CD63  57          	LD	D,A
 2337 CD64  DA C348     	JP	C,SNER
 2338 CD67  22 03C6     	LD	(LBYTEX),HL
 2339 CD6A  CD C8BD     	CALL	TCHAR
 2340 CD6D  18 E7       	JR	SNLY10
 2341                   	;
 2342 CD6F  7A          SNLY11:	LD	A,D
 2343 CD70  B7          	OR	A
 2344 CD71  C2 CE84     	JP	NZ,SNLY24
 2345 CD74  7E          	LD	A,(HL)
 2346 CD75  22 03C6     	LD	(LBYTEX),HL
 2347 CD78  D6 AC       	SUB	PLUTOK
 2348 CD7A  D8          	RET	C
 2349 CD7B  FE 07       	CP	GRTTOK-PLUTOK
 2350 CD7D  D0          	RET	NC
 2351 CD7E  5F          	LD	E,A
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  41
BASIC   Z80

 2352 CD7F  3A 03AE     	LD	A,(DATYPE)
 2353 CD82  3D          	DEC	A
 2354 CD83  B3          	OR	E
 2355 CD84  7B          	LD	A,E
 2356 CD85  CA D2B3     	JP	Z,STRSNA
 2357 CD88  07          	RLCA
 2358 CD89  83          	ADD	A,E
 2359 CD8A  5F          	LD	E,A
 2360 CD8B  21 C2C8     	LD	HL,ADRTB3
 2361 CD8E  19          	ADD	HL,DE
 2362 CD8F  78          	LD	A,B
 2363 CD90  56          	LD	D,(HL)
 2364 CD91  BA          	CP	D
 2365 CD92  D0          	RET	NC
 2366 CD93  23          	INC	HL
 2367 CD94  CD CD29     	CALL	SNALY3
 2368 CD97  C5          SNLY12:	PUSH	BC
 2369 CD98  01 CD49     	LD	BC,SNALY9
 2370 CD9B  C5          	PUSH	BC
 2371 CD9C  43          	LD	B,E
 2372 CD9D  4A          	LD	C,D
 2373 CD9E  CD D6C8     	CALL	OPARST
 2374 CDA1  58          	LD	E,B
 2375 CDA2  51          	LD	D,C
 2376 CDA3  4E          	LD	C,(HL)
 2377 CDA4  23          	INC	HL
 2378 CDA5  46          	LD	B,(HL)
 2379 CDA6  23          	INC	HL
 2380 CDA7  C5          	PUSH	BC
 2381 CDA8  2A 03C6     	LD	HL,(LBYTEX)
 2382 CDAB  18 90       	JR	SNALY7
 2383                   	;
 2384 CDAD  AF          SNLY13:	XOR	A
 2385 CDAE  32 03AE     	LD	(DATYPE),A
 2386 CDB1  CD C8BD     	CALL	TCHAR
 2387                   ;AUSGABE EINES FEHLERS BEI UNVOLLSTAENDIGEM
 2388                   ;VERKETTETEN AUSDRUCK
 2389 CDB4  1E 24       MOER:	LD	E,36		; MO-ERROR
 2390 CDB6  CA C356     	JP	Z,ERROO
 2391 CDB9  DA D7A1     	JP	C,VALNRM
 2392 CDBC  CD C68F     	CALL	CLETST
 2393 CDBF  30 37       	JR	NC,SNLY17
 2394 CDC1  FE AC       	CP	PLUTOK
 2395 CDC3  28 E8       	JR	Z,SNLY13
 2396 CDC5  FE 2E       	CP	'.'
 2397 CDC7  CA D7A1     	JP	Z,VALNRM
 2398 CDCA  FE AD       	CP	MINTOK
 2399 CDCC  28 19       	JR	Z,SNLY15
 2400 CDCE  FE 22       	CP	'"'
 2401 CDD0  CA D18B     	JP	Z,SOPRND
 2402 CDD3  FE AA       	CP	NOTTOK
 2403 CDD5  CA CEE3     	JP	Z,NOT
 2404 CDD8  FE A7       	CP	FNTOK
 2405 CDDA  CA D0F0     	JP	Z,FN
 2406 CDDD  D6 B6       	SUB	SGNTOK
 2407 CDDF  30 28       	JR	NC,SNLY19
 2408 CDE1  CD CD36     SNLY14:	CALL	SNALY6
 2409 CDE4  C3 C8DB     	JP	CPBRGT
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  42
BASIC   Z80

 2410 CDE7  16 7D       SNLY15:	LD	D,7DH
 2411 CDE9  CD CD3D     	CALL	SNALY7
 2412 CDEC  2A 03D1     	LD	HL,(NTOKPT)
 2413 CDEF  E5          	PUSH	HL
 2414 CDF0  CD D6C0     	CALL	ABS1
 2415 CDF3  CD CD29     SNLY16:	CALL	SNALY3
 2416 CDF6  E1          	POP	HL
 2417 CDF7  C9          	RET
 2418                   	;
 2419 CDF8  CD CF06     SNLY17:	CALL	DIM1
 2420 CDFB  E5          SNLY18:	PUSH	HL
 2421 CDFC  EB          	EX	DE,HL
 2422 CDFD  22 03E5     	LD	(WRA1),HL
 2423 CE00  3A 03AE     	LD	A,(DATYPE)
 2424 CE03  B7          	OR	A
 2425 CE04  CC D6DD     	CALL	Z,OPKOP
 2426 CE07  E1          	POP	HL
 2427 CE08  C9          	RET
 2428                   	;
 2429 CE09  06 00       SNLY19:	LD	B,0
 2430 CE0B  07          	RLCA
 2431 CE0C  4F          	LD	C,A
 2432 CE0D  C5          	PUSH	BC
 2433 CE0E  CD C8BD     	CALL	TCHAR
 2434 CE11  79          	LD	A,C
 2435 CE12  FE 33       	CP	1+MIDTOK-SGNTOK+MIDTOK-SGNTOK
 2436 CE14  38 07       	JR	C,SNLY29
 2437 CE16  3A 03FC     	LD	A,(EXTFLG)
 2438 CE19  A7          	AND	A
 2439 CE1A  C2 E009     	JP	NZ,EXTGO3	;TOKEN NICHT IN GRUNDLISTE
 2440 CE1D  FE 22       SNLY29:	CP	PITOK-SGNTOK+PITOK-SGNTOK
 2441 CE1F  28 1E       	JR	Z,SNLY2A
 2442 CE21  FE 2D       	CP	1+CHRTOK-SGNTOK+CHRTOK-SGNTOK
 2443 CE23  38 17       	JR	C,SNLY20
 2444 CE25  CD CD36     	CALL	SNALY6
 2445 CE28  CD C8D6     	CALL	CPCOMM
 2446 CE2B  CD CD2A     	CALL	SNALY4
 2447 CE2E  EB          	EX	DE,HL
 2448 CE2F  2A 03E5     	LD	HL,(WRA1)
 2449 CE32  E3          	EX	(SP),HL
 2450 CE33  E5          	PUSH	HL
 2451 CE34  EB          	EX	DE,HL
 2452 CE35  CD D421     	CALL	ARGVL1
 2453 CE38  EB          	EX	DE,HL
 2454 CE39  E3          	EX	(SP),HL
 2455 CE3A  18 08       	JR	SNLY21
 2456                   	;
 2457 CE3C  CD CDE1     SNLY20:	CALL	SNLY14
 2458 CE3F  E3          SNLY2A:	EX	(SP),HL
 2459 CE40  11 CDF3     	LD	DE,SNLY16
 2460 CE43  D5          	PUSH	DE
 2461 CE44  01 C294     SNLY21:	LD	BC,ADRTB2
 2462 CE47  09          	ADD	HL,BC
 2463 CE48  4E          	LD	C,(HL)
 2464 CE49  23          	INC	HL
 2465 CE4A  66          	LD	H,(HL)
 2466 CE4B  69          	LD	L,C
 2467 CE4C  E9          	JP	(HL)
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  43
BASIC   Z80

 2468 CE4D  15          SNLY22:	DEC	D
 2469 CE4E  FE AD       	CP	MINTOK
 2470 CE50  C8          	RET	Z
 2471 CE51  FE 2D       	CP	'-'
 2472 CE53  C8          	RET	Z
 2473 CE54  14          	INC	D
 2474 CE55  FE 2B       	CP	'+'
 2475 CE57  C8          	RET	Z
 2476 CE58  FE AC       	CP	PLUTOK
 2477 CE5A  C8          	RET	Z
 2478 CE5B  2B          	DEC	HL
 2479 CE5C  C9          	RET
 2480                   ;
 2481                   ;LOGISCHE OPERATOREN - BITWEISE
 2482 CE5D  F6          OR:	DEFB	0F6H
 2483 CE5E  AF          AND:	XOR	A
 2484 CE5F  F5          	PUSH	AF
 2485 CE60  CD CD29     	CALL	SNALY3
 2486 CE63  CD C96F     	CALL	EPRVL3
 2487 CE66  F1          	POP	AF
 2488 CE67  EB          	EX	DE,HL
 2489 CE68  C1          	POP	BC
 2490 CE69  E3          	EX	(SP),HL
 2491 CE6A  EB          	EX	DE,HL
 2492 CE6B  CD D6E0     	CALL	OPKOP1
 2493 CE6E  F5          	PUSH	AF
 2494 CE6F  CD C96F     	CALL	EPRVL3
 2495 CE72  F1          	POP	AF
 2496 CE73  C1          	POP	BC
 2497 CE74  79          	LD	A,C
 2498 CE75  21 D0B0     	LD	HL,FRE2
 2499 CE78  20 05       	JR	NZ,SNLY23
 2500 CE7A  A3          	AND	E
 2501 CE7B  4F          	LD	C,A
 2502 CE7C  78          	LD	A,B
 2503 CE7D  A2          	AND	D
 2504 CE7E  E9          	JP	(HL)
 2505 CE7F  B3          SNLY23:	OR	E
 2506 CE80  4F          	LD	C,A
 2507 CE81  78          	LD	A,B
 2508 CE82  B2          	OR	D
 2509 CE83  E9          	JP	(HL)
 2510                    
 2511 CE84  21 CE96     SNLY24:	LD	HL,SNLY25
 2512 CE87  3A 03AE     	LD	A,(DATYPE)
 2513 CE8A  1F          	RRA
 2514 CE8B  7A          	LD	A,D
 2515 CE8C  17          	RLA
 2516 CE8D  5F          	LD	E,A
 2517 CE8E  16 64       	LD	D,100
 2518 CE90  78          	LD	A,B
 2519 CE91  BA          	CP	D
 2520 CE92  D0          	RET	NC
 2521 CE93  C3 CD97     	JP	SNLY12
 2522                    
 2523 CE96  CE98        SNLY25:	DEFW	SNLY26
 2524 CE98  79          SNLY26:	LD	A,C
 2525 CE99  B7          	OR	A
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  44
BASIC   Z80

 2526 CE9A  1F          	RRA
 2527 CE9B  C1          	POP	BC
 2528 CE9C  D1          	POP	DE
 2529 CE9D  F5          	PUSH	AF
 2530 CE9E  CD CD2B     	CALL	SNALY5
 2531 CEA1  21 CED9     	LD	HL,SNLY28
 2532 CEA4  E5          	PUSH	HL
 2533 CEA5  CA D718     	JP	Z,VORZ1
 2534 CEA8  AF          	XOR	A
 2535 CEA9  32 03AE     	LD	(DATYPE),A
 2536 CEAC  D5          	PUSH	DE
 2537 CEAD  CD D2FE     	CALL	STRZS1
 2538 CEB0  7E          	LD	A,(HL)
 2539 CEB1  23          	INC	HL
 2540 CEB2  23          	INC	HL
 2541 CEB3  4E          	LD	C,(HL)
 2542 CEB4  23          	INC	HL
 2543 CEB5  46          	LD	B,(HL)
 2544 CEB6  D1          	POP	DE
 2545 CEB7  C5          	PUSH	BC
 2546 CEB8  F5          	PUSH	AF
 2547 CEB9  CD D302     	CALL	STRZS3
 2548 CEBC  CD D6EE     	CALL	OPLAD
 2549 CEBF  F1          	POP	AF
 2550 CEC0  57          	LD	D,A
 2551 CEC1  E1          	POP	HL
 2552 CEC2  7B          SNLY27:	LD	A,E
 2553 CEC3  B2          	OR	D
 2554 CEC4  C8          	RET	Z
 2555 CEC5  7A          	LD	A,D
 2556 CEC6  D6 01       	SUB	1
 2557 CEC8  D8          	RET	C
 2558 CEC9  AF          	XOR	A
 2559 CECA  BB          	CP	E
 2560 CECB  3C          	INC	A
 2561 CECC  D0          	RET	NC
 2562 CECD  15          	DEC	D
 2563 CECE  1D          	DEC	E
 2564 CECF  0A          	LD	A,(BC)
 2565 CED0  BE          	CP	(HL)
 2566 CED1  23          	INC	HL
 2567 CED2  03          	INC	BC
 2568 CED3  28 ED       	JR	Z,SNLY27
 2569 CED5  3F          	CCF
 2570 CED6  C3 D6A2     	JP	TSGNM2
 2571                    
 2572 CED9  3C          SNLY28:	INC	A
 2573 CEDA  8F          	ADC	A,A
 2574 CEDB  C1          	POP	BC
 2575 CEDC  A0          	AND	B
 2576 CEDD  C6 FF       	ADD	A,-1
 2577 CEDF  9F          	SBC	A,A
 2578 CEE0  C3 D6A9     	JP	SGN0
 2579                    
 2580 CEE3  16 5A       NOT:	LD	D,5AH
 2581 CEE5  CD CD3D     	CALL	SNALY7
 2582 CEE8  CD CD29     	CALL	SNALY3
 2583 CEEB  CD C96F     	CALL	EPRVL3
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  45
BASIC   Z80

 2584 CEEE  7B          	LD	A,E
 2585 CEEF  2F          	CPL
 2586 CEF0  4F          	LD	C,A
 2587 CEF1  7A          	LD	A,D
 2588 CEF2  2F          	CPL
 2589 CEF3  CD D0B0     	CALL	FRE2
 2590 CEF6  C1          	POP	BC
 2591 CEF7  C3 CD49     	JP	SNALY9
 2592                   ;
 2593                   ;DATENFELDAUFBAU UND -VEERWALTUNG
 2594 CEFA  CD C8BE     DIM0:	CALL	TCHAR1
 2595 CEFD  C8          	RET	Z
 2596 CEFE  CD C8D6     	CALL	CPCOMM
 2597 CF01  01 CEFA     DIM:	LD	BC,DIM0
 2598 CF04  C5          	PUSH	BC
 2599 CF05  F6          	DEFB	0F6H
 2600 CF06  AF          DIM1:	XOR	A
 2601 CF07  32 03AD     	LD	(LOCCRE),A
 2602 CF0A  46          	LD	B,(HL)
 2603 CF0B  CD C68F     DIM2:	CALL	CLETST
 2604 CF0E  DA C348     	JP	C,SNER
 2605 CF11  AF          	XOR	A
 2606 CF12  4F          	LD	C,A
 2607 CF13  32 03AE     	LD	(DATYPE),A
 2608 CF16  CD C8BD     	CALL	TCHAR
 2609 CF19  38 05       	JR	C,DIM3
 2610 CF1B  CD C68F     	CALL	CLETST
 2611 CF1E  38 0B       	JR	C,DIM5
 2612 CF20  4F          DIM3:	LD	C,A
 2613 CF21  CD C8BD     DIM4:	CALL	TCHAR
 2614 CF24  38 FB       	JR	C,DIM4
 2615 CF26  CD C68F     	CALL	CLETST
 2616 CF29  30 F6       	JR	NC,DIM4
 2617 CF2B  D6 24       DIM5:	SUB	'$'
 2618 CF2D  20 0A       	JR	NZ,DIM6
 2619 CF2F  3C          	INC	A
 2620 CF30  32 03AE     	LD	(DATYPE),A
 2621 CF33  0F          	RRCA
 2622 CF34  81          	ADD	A,C
 2623 CF35  4F          	LD	C,A
 2624 CF36  CD C8BD     	CALL	TCHAR
 2625 CF39  3A 03CC     DIM6:	LD	A,(FORFLG)
 2626 CF3C  3D          	DEC	A
 2627 CF3D  CA CFDD     	JP	Z,DIM16
 2628 CF40  F2 CF48     	JP	P,DIM7
 2629 CF43  7E          	LD	A,(HL)
 2630 CF44  D6 28       	SUB	'('
 2631 CF46  28 6F       	JR	Z,DIM14
 2632 CF48  AF          DIM7:	XOR	A
 2633 CF49  32 03CC     	LD	(FORFLG),A
 2634 CF4C  E5          	PUSH	HL
 2635 CF4D  50          	LD	D,B
 2636 CF4E  59          	LD	E,C
 2637 CF4F  2A 03DF     	LD	HL,(FNPTR)
 2638 CF52  CD C689     	CALL	CPREG
 2639 CF55  11 03E1     	LD	DE,WRA0
 2640 CF58  CA D5E0     	JP	Z,MUL5
 2641 CF5B  2A 03D9     	LD	HL,(DVARPT)
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  46
BASIC   Z80

 2642 CF5E  EB          	EX	DE,HL
 2643 CF5F  2A 03D7     	LD	HL,(SVARPT)
 2644 CF62  CD C689     DIM8:	CALL	CPREG
 2645 CF65  28 10       	JR	Z,DIM10
 2646 CF67  79          	LD	A,C
 2647 CF68  96          	SUB	(HL)
 2648 CF69  23          	INC	HL
 2649 CF6A  20 02       	JR	NZ,DIM9
 2650 CF6C  78          	LD	A,B
 2651 CF6D  96          	SUB	(HL)
 2652 CF6E  23          DIM9:	INC	HL
 2653 CF6F  28 38       	JR	Z,DIM12
 2654 CF71  23          	INC	HL
 2655 CF72  23          	INC	HL
 2656 CF73  23          	INC	HL
 2657 CF74  23          	INC	HL
 2658 CF75  18 EB       	JR	DIM8
 2659                   	;
 2660 CF77  E1          DIM10:	POP	HL
 2661 CF78  E3          	EX	(SP),HL
 2662 CF79  D5          	PUSH	DE
 2663 CF7A  11 CDFB     	LD	DE,SNLY18
 2664 CF7D  CD C689     	CALL	CPREG
 2665 CF80  D1          	POP	DE
 2666 CF81  28 29       	JR	Z,DIM13
 2667 CF83  E3          	EX	(SP),HL
 2668 CF84  E5          	PUSH	HL
 2669 CF85  C5          	PUSH	BC
 2670 CF86  01 0006     	LD	BC,6
 2671 CF89  2A 03DB     	LD	HL,(FSLPTR)
 2672 CF8C  E5          	PUSH	HL
 2673 CF8D  09          	ADD	HL,BC
 2674 CF8E  C1          	POP	BC
 2675 CF8F  E5          	PUSH	HL
 2676 CF90  CD C4AB     	CALL	LININ
 2677 CF93  E1          	POP	HL
 2678 CF94  22 03DB     	LD	(FSLPTR),HL
 2679 CF97  60          	LD	H,B
 2680 CF98  69          	LD	L,C
 2681 CF99  22 03D9     	LD	(DVARPT),HL
 2682 CF9C  2B          DIM11:	DEC	HL
 2683 CF9D  36 00       	LD	(HL),0
 2684 CF9F  CD C689     	CALL	CPREG
 2685 CFA2  20 F8       	JR	NZ,DIM11
 2686 CFA4  D1          	POP	DE
 2687 CFA5  73          	LD	(HL),E
 2688 CFA6  23          	INC	HL
 2689 CFA7  72          	LD	(HL),D
 2690 CFA8  23          	INC	HL
 2691 CFA9  EB          DIM12:	EX	DE,HL
 2692 CFAA  E1          DIM121:	POP	HL
 2693 CFAB  C9          	RET
 2694                   	;
 2695 CFAC  32 03E8     DIM13:	LD	(WRA1+3),A
 2696 CFAF  21 C320     	LD	HL,OK+3
 2697 CFB2  22 03E5     	LD	(WRA1),HL
 2698 CFB5  E1          	POP	HL
 2699 CFB6  C9          	RET
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  47
BASIC   Z80

 2700                   	;
 2701 CFB7  E5          DIM14:	PUSH	HL
 2702 CFB8  2A 03AD     	LD	HL,(LOCCRE)
 2703 CFBB  E3          	EX	(SP),HL
 2704 CFBC  57          	LD	D,A
 2705 CFBD  D5          DIM15:	PUSH	DE
 2706 CFBE  C5          	PUSH	BC
 2707 CFBF  CD C95B     	CALL	EPRVAL
 2708 CFC2  C1          	POP	BC
 2709 CFC3  F1          	POP	AF
 2710 CFC4  EB          	EX	DE,HL
 2711 CFC5  E3          	EX	(SP),HL
 2712 CFC6  E5          	PUSH	HL
 2713 CFC7  EB          	EX	DE,HL
 2714 CFC8  3C          	INC	A
 2715 CFC9  57          	LD	D,A
 2716 CFCA  7E          	LD	A,(HL)
 2717 CFCB  FE 2C       	CP	','
 2718 CFCD  28 EE       	JR	Z,DIM15
 2719 CFCF  CD C8DB     	CALL	CPBRGT
 2720 CFD2  22 03D1     	LD	(NTOKPT),HL
 2721 CFD5  E1          	POP	HL
 2722 CFD6  22 03AD     	LD	(LOCCRE),HL
 2723 CFD9  1E 00       	LD	E,0
 2724 CFDB  D5          	PUSH	DE
 2725 CFDC  11          	DEFB	11H
 2726 CFDD  E5          DIM16:	PUSH	HL
 2727 CFDE  F5          	PUSH	AF
 2728 CFDF  2A 03D9     	LD	HL,(DVARPT)
 2729 CFE2  3E          	DEFB	3EH
 2730 CFE3  19          DIM17:	ADD	HL,DE
 2731 CFE4  ED 5B 03DB  	LD	DE,(FSLPTR)
 2732 CFE8  CD C689     	CALL	CPREG
 2733 CFEB  28 23       	JR	Z,DIM19
 2734 CFED  7E          	LD	A,(HL)
 2735 CFEE  B9          	CP	C
 2736 CFEF  23          	INC	HL
 2737 CFF0  20 02       	JR	NZ,DIM18
 2738 CFF2  7E          	LD	A,(HL)
 2739 CFF3  B8          	CP	B
 2740 CFF4  23          DIM18:	INC	HL
 2741 CFF5  5E          	LD	E,(HL)
 2742 CFF6  23          	INC	HL
 2743 CFF7  56          	LD	D,(HL)
 2744 CFF8  23          	INC	HL
 2745 CFF9  20 E8       	JR	NZ,DIM17
 2746 CFFB  3A 03AD     	LD	A,(LOCCRE)
 2747 CFFE  B7          	OR	A
 2748 CFFF  C2 C351     	JP	NZ,DDER
 2749 D002  F1          	POP	AF
 2750 D003  44          	LD	B,H
 2751 D004  4D          	LD	C,L
 2752 D005  CA CFAA     	JP	Z,DIM121
 2753 D008  96          	SUB	(HL)
 2754 D009  28 5F       	JR	Z,DIM23
 2755 D00B  1E 10       BSER:	LD	E,16		; BS-ERROR
 2756 D00D  C3 C356     	JP	ERROO
 2757                   	;
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  48
BASIC   Z80

 2758 D010  11 0004     DIM19:	LD	DE,4
 2759 D013  F1          	POP	AF
 2760 D014  CA C967     	JP	Z,FCER
 2761 D017  71          	LD	(HL),C
 2762 D018  23          	INC	HL
 2763 D019  70          	LD	(HL),B
 2764 D01A  23          	INC	HL
 2765 D01B  4F          	LD	C,A
 2766 D01C  CD C327     	CALL	TMEMO
 2767 D01F  23          	INC	HL
 2768 D020  23          	INC	HL
 2769 D021  22 03C6     	LD	(LBYTEX),HL
 2770 D024  71          	LD	(HL),C
 2771 D025  23          	INC	HL
 2772 D026  3A 03AD     	LD	A,(LOCCRE)
 2773 D029  17          	RLA
 2774 D02A  79          	LD	A,C
 2775 D02B  01 000B     DIM20:	LD	BC,11
 2776 D02E  30 02       	JR	NC,DIM21
 2777 D030  C1          	POP	BC
 2778 D031  03          	INC	BC
 2779 D032  71          DIM21:	LD	(HL),C
 2780 D033  23          	INC	HL
 2781 D034  70          	LD	(HL),B
 2782 D035  23          	INC	HL
 2783 D036  F5          	PUSH	AF
 2784 D037  E5          	PUSH	HL
 2785 D038  CD D789     	CALL	FESRCH
 2786 D03B  EB          	EX	DE,HL
 2787 D03C  E1          	POP	HL
 2788 D03D  F1          	POP	AF
 2789 D03E  3D          	DEC	A
 2790 D03F  20 EA       	JR	NZ,DIM20
 2791 D041  F5          	PUSH	AF
 2792 D042  42          	LD	B,D
 2793 D043  4B          	LD	C,E
 2794 D044  EB          	EX	DE,HL
 2795 D045  19          	ADD	HL,DE
 2796 D046  DA C33E     	JP	C,OMER		; -> OM ERROR
 2797 D049  CD C330     	CALL	TMEMO1
 2798 D04C  22 03DB     	LD	(FSLPTR),HL
 2799 D04F  2B          DIM22:	DEC	HL
 2800 D050  36 00       	LD	(HL),0
 2801 D052  CD C689     	CALL	CPREG
 2802 D055  20 F8       	JR	NZ,DIM22
 2803 D057  03          	INC	BC
 2804 D058  57          	LD	D,A
 2805 D059  2A 03C6     	LD	HL,(LBYTEX)
 2806 D05C  5E          	LD	E,(HL)
 2807 D05D  EB          	EX	DE,HL
 2808 D05E  29          	ADD	HL,HL
 2809 D05F  09          	ADD	HL,BC
 2810 D060  EB          	EX	DE,HL
 2811 D061  2B          	DEC	HL
 2812 D062  2B          	DEC	HL
 2813 D063  73          	LD	(HL),E
 2814 D064  23          	INC	HL
 2815 D065  72          	LD	(HL),D
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  49
BASIC   Z80

 2816 D066  23          	INC	HL
 2817 D067  F1          	POP	AF
 2818 D068  38 22       	JR	C,DIM25
 2819 D06A  47          DIM23:	LD	B,A
 2820 D06B  4F          	LD	C,A
 2821 D06C  7E          	LD	A,(HL)
 2822 D06D  23          	INC	HL
 2823 D06E  16          	DEFB	16H
 2824 D06F  E1          DIM24:	POP	HL
 2825 D070  5E          	LD	E,(HL)
 2826 D071  23          	INC	HL
 2827 D072  56          	LD	D,(HL)
 2828 D073  23          	INC	HL
 2829 D074  E3          	EX	(SP),HL
 2830 D075  F5          	PUSH	AF
 2831 D076  CD C689     	CALL	CPREG
 2832 D079  30 90       	JR	NC,BSER
 2833 D07B  E5          	PUSH	HL
 2834 D07C  CD D789     	CALL	FESRCH
 2835 D07F  D1          	POP	DE
 2836 D080  19          	ADD	HL,DE
 2837 D081  F1          	POP	AF
 2838 D082  3D          	DEC	A
 2839 D083  44          	LD	B,H
 2840 D084  4D          	LD	C,L
 2841 D085  20 E8       	JR	NZ,DIM24
 2842 D087  29          	ADD	HL,HL
 2843 D088  29          	ADD	HL,HL
 2844 D089  C1          	POP	BC
 2845 D08A  09          	ADD	HL,BC
 2846 D08B  EB          	EX	DE,HL
 2847 D08C  2A 03D1     DIM25:	LD	HL,(NTOKPT)
 2848 D08F  C9          	RET
 2849                   ;
 2850 D090  ED 5B 03DB  FRE:	LD	DE,(FSLPTR)
 2851 D094  21 0000     	LD	HL,0
 2852 D097  39          	ADD	HL,SP
 2853 D098  3A 03AE     	LD	A,(DATYPE)
 2854 D09B  B7          	OR	A
 2855 D09C  28 0D       	JR	Z,FRE1
 2856 D09E  CD D2FE     	CALL	STRZS1
 2857 D0A1  CD D209     	CALL	STROP4
 2858 D0A4  ED 5B 0356  	LD	DE,(STDPTR)
 2859 D0A8  2A 03C4     	LD	HL,(SWAPTR)
 2860 D0AB  7D          FRE1:	LD	A,L
 2861 D0AC  93          	SUB	E
 2862 D0AD  4F          	LD	C,A
 2863 D0AE  7C          	LD	A,H
 2864 D0AF  9A          	SBC	A,D
 2865 D0B0  41          FRE2:	LD	B,C
 2866 D0B1  50          FRE3:	LD	D,B
 2867 D0B2  1E 00       	LD	E,0
 2868 D0B4  21 03AE     	LD	HL,DATYPE
 2869 D0B7  73          	LD	(HL),E
 2870 D0B8  06 90       	LD	B,90H
 2871 D0BA  C3 D6AE     	JP	SGN1
 2872                    
 2873 D0BD  3A 03AC     POS:	LD	A,(CURPOS)
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  50
BASIC   Z80

 2874 D0C0  47          POS1:	LD	B,A
 2875 D0C1  AF          	XOR	A
 2876 D0C2  18 ED       	JR	FRE3
 2877                   ;
 2878                   ;BENUTZERDEFINIERTE FUNKTIONEN (BILDUNG UND AUFRUF)
 2879 D0C4  CD D145     DEF:	CALL	FNSRCH
 2880 D0C7  CD D137     	CALL	DMODTS
 2881 D0CA  01 CA48     	LD	BC,DATA
 2882 D0CD  C5          	PUSH	BC
 2883 D0CE  D5          	PUSH	DE
 2884 D0CF  CD C8CC     	CALL	CPSTX
 2885 D0D2  28          	DEFB	'('
 2886 D0D3  CD CF06     	CALL	DIM1
 2887 D0D6  E5          	PUSH	HL
 2888 D0D7  EB          	EX	DE,HL
 2889 D0D8  2B          	DEC	HL
 2890 D0D9  56          	LD	D,(HL)
 2891 D0DA  2B          	DEC	HL
 2892 D0DB  5E          	LD	E,(HL)
 2893 D0DC  E1          	POP	HL
 2894 D0DD  CD CD29     	CALL	SNALY3
 2895 D0E0  CD C8DB     	CALL	CPBRGT
 2896 D0E3  CD C8CC     	CALL	CPSTX
 2897 D0E6  B4          	DEFB	EQUTOK
 2898 D0E7  44          	LD	B,H
 2899 D0E8  4D          	LD	C,L
 2900 D0E9  E3          	EX	(SP),HL
 2901 D0EA  71          	LD	(HL),C
 2902 D0EB  23          	INC	HL
 2903 D0EC  70          	LD	(HL),B
 2904 D0ED  C3 D184     	JP	SADTB2
 2905                    
 2906 D0F0  CD D145     FN:	CALL	FNSRCH
 2907 D0F3  D5          	PUSH	DE
 2908 D0F4  CD CDE1     	CALL	SNLY14
 2909 D0F7  CD CD29     	CALL	SNALY3
 2910 D0FA  E3          	EX	(SP),HL
 2911 D0FB  5E          	LD	E,(HL)
 2912 D0FC  23          	INC	HL
 2913 D0FD  56          	LD	D,(HL)
 2914 D0FE  23          	INC	HL
 2915 D0FF  7A          	LD	A,D
 2916 D100  B3          	OR	E
 2917 D101  CA C354     	JP	Z,UFER
 2918 D104  7E          	LD	A,(HL)
 2919 D105  23          	INC	HL
 2920 D106  66          	LD	H,(HL)
 2921 D107  6F          	LD	L,A
 2922 D108  E5          	PUSH	HL
 2923 D109  2A 03DF     	LD	HL,(FNPTR)
 2924 D10C  E3          	EX	(SP),HL
 2925 D10D  22 03DF     	LD	(FNPTR),HL
 2926 D110  2A 03E3     	LD	HL,(WRA0+2)
 2927 D113  E5          	PUSH	HL
 2928 D114  2A 03E1     	LD	HL,(WRA0)
 2929 D117  E5          	PUSH	HL
 2930 D118  21 03E1     	LD	HL,WRA0
 2931 D11B  D5          	PUSH	DE
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  51
BASIC   Z80

 2932 D11C  CD D6F7     	CALL	OPTRAN
 2933 D11F  E1          	POP	HL
 2934 D120  CD CD26     	CALL	SNALY2
 2935 D123  CD C8BE     	CALL	TCHAR1
 2936 D126  C2 C348     	JP	NZ,SNER
 2937 D129  E1          	POP	HL
 2938 D12A  22 03E1     	LD	(WRA0),HL
 2939 D12D  E1          	POP	HL
 2940 D12E  22 03E3     	LD	(WRA0+2),HL
 2941 D131  E1          	POP	HL
 2942 D132  22 03DF     	LD	(FNPTR),HL
 2943 D135  E1          	POP	HL
 2944 D136  C9          	RET
 2945                   ;
 2946                   ;TEST, OB PROGRAMMABARBEITUNG IM DIREKTMODE
 2947 D137  E5          DMODTS:	PUSH	HL
 2948 D138  2A 0358     	LD	HL,(CULINO)	; aktuelle Zeilennummer
 2949 D13B  23          	INC	HL
 2950 D13C  7C          	LD	A,H
 2951 D13D  B5          	OR	L
 2952 D13E  E1          	POP	HL
 2953 D13F  C0          	RET	NZ
 2954 D140  1E 16       IDER:	LD	E,22		; ID-ERROR
 2955 D142  C3 C356     	JP	ERROO
 2956                    
 2957 D145  CD C8CC     FNSRCH:	CALL	CPSTX
 2958 D148  A7          	DEFB	FNTOK
 2959 D149  3E 80       	LD	A,80H
 2960 D14B  32 03CC     	LD	(FORFLG),A
 2961 D14E  B6          	OR	(HL)
 2962 D14F  47          	LD	B,A
 2963 D150  CD CF0B     	CALL	DIM2
 2964 D153  C3 CD29     	JP	SNALY3
 2965                   ;
 2966                   ;STRINGBEHANDLUNG
 2967 D156  CD CD29     STR_:	CALL	SNALY3
 2968 D159  CD D834     	CALL	NUMKON
 2969 D15C  CD D18A     	CALL	SLEN0
 2970 D15F  CD D2FE     	CALL	STRZS1
 2971 D162  01 D357     	LD	BC,CHR_1
 2972 D165  C5          	PUSH	BC
 2973 D166  7E          STR_1:	LD	A,(HL)
 2974 D167  23          	INC	HL
 2975 D168  23          	INC	HL
 2976 D169  E5          	PUSH	HL
 2977 D16A  CD D1E1     	CALL	STROP
 2978 D16D  E1          	POP	HL
 2979 D16E  4E          	LD	C,(HL)
 2980 D16F  23          	INC	HL
 2981 D170  46          	LD	B,(HL)
 2982 D171  CD D17E     	CALL	SADTB1
 2983 D174  E5          	PUSH	HL
 2984 D175  6F          	LD	L,A
 2985 D176  CD D2F2     	CALL	STRMV1
 2986 D179  D1          	POP	DE
 2987 D17A  C9          	RET
 2988                   
 2989 D17B  CD D1E1     STADTB:	CALL	STROP
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  52
BASIC   Z80

 2990 D17E  21 03C0     SADTB1:	LD	HL,STRDAT
 2991 D181  E5          	PUSH	HL
 2992 D182  77          	LD	(HL),A		; Laenge
 2993 D183  23          	INC	HL
 2994 D184  23          SADTB2:	INC	HL
 2995 D185  73          	LD	(HL),E		; Adresse der Zeichenkette
 2996 D186  23          	INC	HL
 2997 D187  72          	LD	(HL),D
 2998 D188  E1          	POP	HL
 2999 D189  C9          	RET
 3000                   
 3001                   ; Laenge einer Zeichenkette ermitteln
 3002                   ; PE:	HL	Zeiger auf Zeichenkette
 3003                   ; PA:	BC	Laenge der Zeichenkette
 3004 D18A  2B          SLEN0:	DEC	HL
 3005 D18B  06 22       SOPRND:	LD	B,'"'
 3006 D18D  50          	LD	D,B
 3007 D18E  E5          STRLEN:	PUSH	HL
 3008 D18F  0E FF       	LD	C,-1		; Zaehler Startwert
 3009 D191  23          SLEN1:	INC	HL
 3010 D192  7E          	LD	A,(HL)
 3011 D193  0C          	INC	C
 3012 D194  B7          	OR	A
 3013 D195  28 06       	JR	Z,SLEN2		; Ende mit 00
 3014 D197  BA          	CP	D
 3015 D198  28 03       	JR	Z,SLEN2
 3016 D19A  B8          	CP	B
 3017 D19B  20 F4       	JR	NZ,SLEN1	; naechstes Zeichen testen
 3018 D19D  FE 22       SLEN2:	CP	'"'
 3019 D19F  CC C8BD     	CALL	Z,TCHAR
 3020 D1A2  E3          	EX	(SP),HL
 3021 D1A3  23          	INC	HL		; Stringanfang jetzt wieder in HL
 3022 D1A4  EB          	EX	DE,HL
 3023 D1A5  79          	LD	A,C		; Stringlaenge
 3024 D1A6  CD D17E     	CALL	SADTB1		; Adresse und Laenge aktueller String eintragen
 3025 D1A9  11 03C0     SLEN3:	LD	DE,STRDAT
 3026 D1AC  2A 03B2     	LD	HL,(SPTPTR)
 3027 D1AF  22 03E5     	LD	(WRA1),HL
 3028 D1B2  3E 01       	LD	A,1
 3029 D1B4  32 03AE     	LD	(DATYPE),A
 3030 D1B7  CD D6FA     	CALL	OPTRN1
 3031 D1BA  CD C689     	CALL	CPREG
 3032 D1BD  22 03B2     	LD	(SPTPTR),HL
 3033 D1C0  E1          	POP	HL
 3034 D1C1  7E          	LD	A,(HL)
 3035 D1C2  C0          	RET	NZ
 3036 D1C3  1E 1E       STER:	LD	E,30		; ST-ERROR
 3037 D1C5  C3 C356     STER1:	JP	ERROO
 3038                   ;
 3039 D1C8  23          TEXTO0:	INC	HL
 3040                   ;AUSGABE EINER MIT 00 ENDENDEN ASCII-ZEICHENKETTE
 3041                   ;AUS DEM SPEICHER, ANFANGSADRESSE IM REGISTER HL
 3042 D1C9  CD D18A     TEXTO:	CALL	SLEN0		; String-Laenge ermitteln
 3043 D1CC  CD D2FE     TEXTO1:	CALL	STRZS1
 3044 D1CF  CD D6EE     	CALL	OPLAD		; Laenge in Register E / Zeichenkette in BC
 3045 D1D2  1C          	INC	E
 3046 D1D3  1D          TEXTO2:	DEC	E		; fertig?
 3047 D1D4  C8          	RET	Z		; ja.
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  53
BASIC   Z80

 3048 D1D5  0A          	LD	A,(BC)		; Zeichen aus Zeichenkette
 3049 D1D6  CD C6AE     TEXTO3:	CALL	CHARO
 3050 D1D9  FE 0D       	CP	0DH		; CR?
 3051 D1DB  CC CB66     	CALL	Z,CRWDY5	; ja, dann LF anhaengen
 3052 D1DE  03          	INC	BC		; naechste Position in Zeichenkette
 3053 D1DF  18 F2       	JR	TEXTO2
 3054                   
 3055                   ;
 3056                   ;STRINGARITHMETIK
 3057 D1E1  B7          STROP:	OR	A
 3058 D1E2  0E          	DEFB	0EH
 3059 D1E3  F1          STROP1:	POP	AF
 3060 D1E4  F5          	PUSH	AF
 3061 D1E5  ED 5B 0356  	LD	DE,(STDPTR)
 3062 D1E9  2A 03C4     	LD	HL,(SWAPTR)
 3063 D1EC  2F          	CPL
 3064 D1ED  4F          	LD	C,A
 3065 D1EE  06 FF       	LD	B,-1
 3066 D1F0  09          	ADD	HL,BC
 3067 D1F1  23          	INC	HL
 3068 D1F2  CD C689     	CALL	CPREG
 3069 D1F5  38 07       	JR	C,STROP3
 3070 D1F7  22 03C4     	LD	(SWAPTR),HL
 3071 D1FA  23          	INC	HL
 3072 D1FB  EB          	EX	DE,HL
 3073 D1FC  F1          STROP2:	POP	AF
 3074 D1FD  C9          	RET
 3075                   
 3076 D1FE  F1          STROP3:	POP	AF
 3077 D1FF  1E 1A       OSER:	LD	E,26
 3078 D201  28 C2       	JR	Z,STER1
 3079 D203  BF          	CP	A
 3080 D204  F5          	PUSH	AF
 3081 D205  01 D1E3     	LD	BC,STROP1
 3082 D208  C5          	PUSH	BC
 3083 D209  2A 03B0     STROP4:	LD	HL,(MEMSIZ)
 3084 D20C  22 03C4     STROP5:	LD	(SWAPTR),HL
 3085 D20F  21 0000     	LD	HL,0
 3086 D212  E5          	PUSH	HL
 3087 D213  2A 0356     	LD	HL,(STDPTR)
 3088 D216  E5          	PUSH	HL
 3089 D217  21 03B4     	LD	HL,LSPTBG
 3090 D21A  ED 5B 03B2  STROP6:	LD	DE,(SPTPTR)
 3091 D21E  CD C689     	CALL	CPREG
 3092 D221  01 D21A     	LD	BC,STROP6
 3093 D224  20 3F       	JR	NZ,STRO11
 3094 D226  2A 03D7     	LD	HL,(SVARPT)
 3095 D229  ED 5B 03D9  STROP7:	LD	DE,(DVARPT)
 3096 D22D  CD C689     	CALL	CPREG
 3097 D230  28 0A       	JR	Z,STROP9
 3098 D232  7E          	LD	A,(HL)
 3099 D233  23          	INC	HL
 3100 D234  23          	INC	HL
 3101 D235  B7          	OR	A
 3102 D236  CD D268     	CALL	STRO12
 3103 D239  18 EE       	JR	STROP7
 3104                    
 3105 D23B  C1          STROP8:	POP	BC
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  54
BASIC   Z80

 3106 D23C  ED 5B 03DB  STROP9:	LD	DE,(FSLPTR)
 3107 D240  CD C689     	CALL	CPREG
 3108 D243  28 49       	JR	Z,STRO13
 3109 D245  CD D6EE     	CALL	OPLAD
 3110 D248  7B          	LD	A,E
 3111 D249  E5          	PUSH	HL
 3112 D24A  09          	ADD	HL,BC
 3113 D24B  B7          	OR	A
 3114 D24C  F2 D23B     	JP	P,STROP8
 3115 D24F  22 03C6     	LD	(LBYTEX),HL
 3116 D252  E1          	POP	HL
 3117 D253  4E          	LD	C,(HL)
 3118 D254  06 00       	LD	B,0
 3119 D256  09          	ADD	HL,BC
 3120 D257  09          	ADD	HL,BC
 3121 D258  23          	INC	HL
 3122 D259  ED 5B 03C6  STRO10:	LD	DE,(LBYTEX)
 3123 D25D  CD C689     	CALL	CPREG
 3124 D260  28 DA       	JR	Z,STROP9
 3125 D262  01 D259     	LD	BC,STRO10
 3126 D265  C5          STRO11:	PUSH	BC
 3127 D266  F6 80       	OR	80H
 3128 D268  7E          STRO12:	LD	A,(HL)
 3129 D269  23          	INC	HL
 3130 D26A  23          	INC	HL
 3131 D26B  5E          	LD	E,(HL)
 3132 D26C  23          	INC	HL
 3133 D26D  56          	LD	D,(HL)
 3134 D26E  23          	INC	HL
 3135 D26F  F0          	RET	P
 3136 D270  B7          	OR	A
 3137 D271  C8          	RET	Z
 3138 D272  44          	LD	B,H
 3139 D273  4D          	LD	C,L
 3140 D274  2A 03C4     	LD	HL,(SWAPTR)
 3141 D277  CD C689     	CALL	CPREG
 3142 D27A  60          	LD	H,B
 3143 D27B  69          	LD	L,C
 3144 D27C  D8          	RET	C
 3145 D27D  E1          	POP	HL
 3146 D27E  E3          	EX	(SP),HL
 3147 D27F  CD C689     	CALL	CPREG
 3148 D282  E3          	EX	(SP),HL
 3149 D283  E5          	PUSH	HL
 3150 D284  60          	LD	H,B
 3151 D285  69          	LD	L,C
 3152 D286  D0          	RET	NC
 3153 D287  C1          	POP	BC
 3154 D288  F1          	POP	AF
 3155 D289  F1          	POP	AF
 3156 D28A  E5          	PUSH	HL
 3157 D28B  D5          	PUSH	DE
 3158 D28C  C5          	PUSH	BC
 3159 D28D  C9          	RET
 3160                   
 3161 D28E  D1          STRO13:	POP	DE
 3162 D28F  E1          	POP	HL
 3163 D290  7D          	LD	A,L
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  55
BASIC   Z80

 3164 D291  B4          	OR	H
 3165 D292  C8          	RET	Z
 3166 D293  2B          	DEC	HL
 3167 D294  46          	LD	B,(HL)
 3168 D295  2B          	DEC	HL
 3169 D296  4E          	LD	C,(HL)
 3170 D297  E5          	PUSH	HL
 3171 D298  2B          	DEC	HL
 3172 D299  2B          	DEC	HL
 3173 D29A  6E          	LD	L,(HL)
 3174 D29B  26 00       	LD	H,0
 3175 D29D  09          	ADD	HL,BC
 3176 D29E  50          	LD	D,B
 3177 D29F  59          	LD	E,C
 3178 D2A0  2B          	DEC	HL
 3179 D2A1  44          	LD	B,H
 3180 D2A2  4D          	LD	C,L
 3181 D2A3  2A 03C4     	LD	HL,(SWAPTR)
 3182 D2A6  CD C4AE     	CALL	LININ1
 3183 D2A9  E1          	POP	HL
 3184 D2AA  71          	LD	(HL),C
 3185 D2AB  23          	INC	HL
 3186 D2AC  70          	LD	(HL),B
 3187 D2AD  69          	LD	L,C
 3188 D2AE  60          	LD	H,B
 3189 D2AF  2B          	DEC	HL
 3190 D2B0  C3 D20C     	JP	STROP5
 3191                    
 3192 D2B3  C5          STRSNA:	PUSH	BC
 3193 D2B4  E5          	PUSH	HL
 3194 D2B5  2A 03E5     	LD	HL,(WRA1)
 3195 D2B8  E3          	EX	(SP),HL
 3196 D2B9  CD CDAD     	CALL	SNLY13
 3197 D2BC  E3          	EX	(SP),HL
 3198 D2BD  CD CD2A     	CALL	SNALY4
 3199 D2C0  7E          	LD	A,(HL)
 3200 D2C1  E5          	PUSH	HL
 3201 D2C2  2A 03E5     	LD	HL,(WRA1)
 3202 D2C5  E5          	PUSH	HL
 3203 D2C6  86          	ADD	A,(HL)
 3204 D2C7  1E 1C       LSER:	LD	E,28		; LS-ERROR
 3205 D2C9  DA C356     	JP	C,ERROO
 3206 D2CC  CD D17B     	CALL	STADTB
 3207 D2CF  D1          	POP	DE
 3208 D2D0  CD D302     	CALL	STRZS3
 3209 D2D3  E3          	EX	(SP),HL
 3210 D2D4  CD D301     	CALL	STRZS2
 3211 D2D7  E5          	PUSH	HL
 3212 D2D8  2A 03C2     	LD	HL,(STRDAT+2)
 3213 D2DB  EB          	EX	DE,HL
 3214 D2DC  CD D2E9     	CALL	STRMOV
 3215 D2DF  CD D2E9     	CALL	STRMOV
 3216 D2E2  21 CD46     	LD	HL,SNALY8
 3217 D2E5  E3          	EX	(SP),HL
 3218 D2E6  E5          	PUSH	HL
 3219 D2E7  18 6F       	JR	CHR_2
 3220                    
 3221 D2E9  E1          STRMOV:	POP	HL
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  56
BASIC   Z80

 3222 D2EA  E3          	EX	(SP),HL
 3223 D2EB  7E          	LD	A,(HL)
 3224 D2EC  23          	INC	HL
 3225 D2ED  23          	INC	HL
 3226 D2EE  4E          	LD	C,(HL)
 3227 D2EF  23          	INC	HL
 3228 D2F0  46          	LD	B,(HL)
 3229 D2F1  6F          	LD	L,A
 3230 D2F2  2C          STRMV1:	INC	L
 3231 D2F3  2D          STRMV2:	DEC	L
 3232 D2F4  C8          	RET	Z
 3233 D2F5  0A          	LD	A,(BC)
 3234 D2F6  12          	LD	(DE),A
 3235 D2F7  03          	INC	BC
 3236 D2F8  13          	INC	DE
 3237 D2F9  18 F8       	JR	STRMV2
 3238                    
 3239 D2FB  CD CD2A     STRZSP:	CALL	SNALY4
 3240 D2FE  2A 03E5     STRZS1:	LD	HL,(WRA1)
 3241 D301  EB          STRZS2:	EX	DE,HL
 3242 D302  CD D31B     STRZS3:	CALL	SPTSRH
 3243 D305  EB          	EX	DE,HL
 3244 D306  C0          	RET	NZ
 3245 D307  D5          	PUSH	DE
 3246 D308  50          	LD	D,B
 3247 D309  59          	LD	E,C
 3248 D30A  1B          	DEC	DE
 3249 D30B  4E          	LD	C,(HL)
 3250 D30C  2A 03C4     	LD	HL,(SWAPTR)
 3251 D30F  CD C689     	CALL	CPREG
 3252 D312  20 05       	JR	NZ,STRZS4
 3253 D314  47          	LD	B,A
 3254 D315  09          	ADD	HL,BC
 3255 D316  22 03C4     	LD	(SWAPTR),HL
 3256 D319  E1          STRZS4:	POP	HL
 3257 D31A  C9          	RET
 3258                   
 3259 D31B  2A 03B2     SPTSRH:	LD	HL,(SPTPTR)
 3260 D31E  2B          	DEC	HL
 3261 D31F  46          	LD	B,(HL)
 3262 D320  2B          	DEC	HL
 3263 D321  4E          	LD	C,(HL)
 3264 D322  2B          	DEC	HL
 3265 D323  2B          	DEC	HL
 3266 D324  CD C689     	CALL	CPREG
 3267 D327  C0          	RET	NZ
 3268 D328  22 03B2     	LD	(SPTPTR),HL
 3269 D32B  C9          	RET
 3270                   ;
 3271                   ;STANDARDFUNKTIONEN FUER STRINGBEHANDLUNG
 3272 D32C  01 D0C0     LEN:	LD	BC,POS1
 3273 D32F  C5          	PUSH	BC
 3274 D330  CD D2FB     LEN1:	CALL	STRZSP
 3275 D333  AF          	XOR	A
 3276 D334  57          	LD	D,A
 3277 D335  32 03AE     	LD	(DATYPE),A
 3278 D338  7E          	LD	A,(HL)
 3279 D339  B7          	OR	A
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  57
BASIC   Z80

 3280 D33A  C9          	RET
 3281                   
 3282 D33B  01 D0C0     ASC:	LD	BC,POS1
 3283 D33E  C5          	PUSH	BC
 3284 D33F  CD D330     ASC1:	CALL	LEN1
 3285 D342  28 55       	JR	Z,MID_2
 3286 D344  23          	INC	HL
 3287 D345  23          	INC	HL
 3288 D346  5E          	LD	E,(HL)
 3289 D347  23          	INC	HL
 3290 D348  56          	LD	D,(HL)
 3291 D349  1A          	LD	A,(DE)
 3292 D34A  C9          	RET
 3293                   
 3294 D34B  3E 01       CHR_:	LD	A,1
 3295 D34D  CD D17B     	CALL	STADTB
 3296 D350  CD D424     	CALL	ARGVL2
 3297 D353  2A 03C2     	LD	HL,(STRDAT+2)
 3298 D356  73          	LD	(HL),E
 3299 D357  C1          CHR_1:	POP	BC
 3300 D358  C3 D1A9     CHR_2:	JP	SLEN3
 3301                    
 3302 D35B  CD D3DA     LEFT_:	CALL	STREND
 3303 D35E  AF          	XOR	A
 3304 D35F  E3          LEFT_1:	EX	(SP),HL
 3305 D360  4F          	LD	C,A
 3306 D361  E5          LEFT_2:	PUSH	HL
 3307 D362  7E          	LD	A,(HL)
 3308 D363  B8          	CP	B
 3309 D364  38 02       	JR	C,LEFT_3
 3310 D366  78          	LD	A,B
 3311 D367  11          	DEFB	11H
 3312 D368  0E 00       LEFT_3:	LD	C,0
 3313 D36A  C5          	PUSH	BC
 3314 D36B  CD D1E1     	CALL	STROP
 3315 D36E  C1          	POP	BC
 3316 D36F  E1          	POP	HL
 3317 D370  E5          	PUSH	HL
 3318 D371  23          	INC	HL
 3319 D372  23          	INC	HL
 3320 D373  46          	LD	B,(HL)
 3321 D374  23          	INC	HL
 3322 D375  66          	LD	H,(HL)
 3323 D376  68          	LD	L,B
 3324 D377  06 00       	LD	B,0
 3325 D379  09          	ADD	HL,BC
 3326 D37A  44          	LD	B,H
 3327 D37B  4D          	LD	C,L
 3328 D37C  CD D17E     	CALL	SADTB1
 3329 D37F  6F          	LD	L,A
 3330 D380  CD D2F2     	CALL	STRMV1
 3331 D383  D1          	POP	DE
 3332 D384  CD D302     	CALL	STRZS3
 3333 D387  18 CF       	JR	CHR_2
 3334                    
 3335 D389  CD D3DA     RGHT_:	CALL	STREND
 3336 D38C  D1          	POP	DE
 3337 D38D  D5          	PUSH	DE
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  58
BASIC   Z80

 3338 D38E  1A          	LD	A,(DE)
 3339 D38F  90          	SUB	B
 3340 D390  18 CD       	JR	LEFT_1
 3341                    
 3342 D392  EB          MID_:	EX	DE,HL
 3343 D393  7E          	LD	A,(HL)
 3344 D394  CD D3DE     	CALL	STRED1
 3345 D397  04          	INC	B
 3346 D398  05          	DEC	B
 3347 D399  CA C967     MID_2:	JP	Z,FCER
 3348 D39C  C5          	PUSH	BC
 3349 D39D  1E FF       	LD	E,-1
 3350 D39F  FE 29       	CP	')'
 3351 D3A1  28 06       	JR	Z,MID_1
 3352 D3A3  CD C8D6     	CALL	CPCOMM
 3353 D3A6  CD D421     	CALL	ARGVL1
 3354 D3A9  CD C8DB     MID_1:	CALL	CPBRGT
 3355 D3AC  F1          	POP	AF
 3356 D3AD  E3          	EX	(SP),HL
 3357 D3AE  01 D361     	LD	BC,LEFT_2
 3358 D3B1  C5          	PUSH	BC
 3359 D3B2  3D          	DEC	A
 3360 D3B3  BE          	CP	(HL)
 3361 D3B4  06 00       	LD	B,0
 3362 D3B6  D0          	RET	NC
 3363 D3B7  4F          	LD	C,A
 3364 D3B8  7E          	LD	A,(HL)
 3365 D3B9  91          	SUB	C
 3366 D3BA  BB          	CP	E
 3367 D3BB  47          	LD	B,A
 3368 D3BC  D8          	RET	C
 3369 D3BD  43          	LD	B,E
 3370 D3BE  C9          	RET
 3371                   
 3372 D3BF  CD D330     VAL:	CALL	LEN1
 3373 D3C2  CA D4CF     	JP	Z,ADD12
 3374 D3C5  5F          	LD	E,A
 3375 D3C6  23          	INC	HL
 3376 D3C7  23          	INC	HL
 3377 D3C8  7E          	LD	A,(HL)
 3378 D3C9  23          	INC	HL
 3379 D3CA  66          	LD	H,(HL)
 3380 D3CB  6F          	LD	L,A
 3381 D3CC  E5          	PUSH	HL
 3382 D3CD  19          	ADD	HL,DE
 3383 D3CE  46          	LD	B,(HL)
 3384 D3CF  72          	LD	(HL),D
 3385 D3D0  E3          	EX	(SP),HL
 3386 D3D1  C5          	PUSH	BC
 3387 D3D2  7E          	LD	A,(HL)
 3388 D3D3  CD D7A1     	CALL	VALNRM
 3389 D3D6  C1          	POP	BC
 3390 D3D7  E1          	POP	HL
 3391 D3D8  70          	LD	(HL),B
 3392 D3D9  C9          	RET
 3393                   
 3394 D3DA  EB          STREND:	EX	DE,HL
 3395 D3DB  CD C8DB     	CALL	CPBRGT
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  59
BASIC   Z80

 3396 D3DE  C1          STRED1:	POP	BC
 3397 D3DF  D1          	POP	DE
 3398 D3E0  C5          	PUSH	BC
 3399 D3E1  43          	LD	B,E
 3400 D3E2  C9          	RET
 3401                   ;
 3402                   ;EIN-AUSGEBE FUER RECHNERPORTS
 3403 D3E3  CD D424     INP:	CALL	ARGVL2
 3404 D3E6  4F          	LD	C,A
 3405 D3E7  ED 78       	IN	A,(C)
 3406 D3E9  C3 D0C0     INP1:	JP	POS1
 3407                    
 3408 D3EC  CD D414     OUT:	CALL	ARGVL0
 3409 D3EF  3A 0306     	LD	A,(PORTAD)
 3410 D3F2  4F          	LD	C,A
 3411 D3F3  7B          	LD	A,E
 3412 D3F4  ED 79       	OUT	(C),A
 3413 D3F6  C9          	RET
 3414                   
 3415 D3F7  CD D414     WAIT:	CALL	ARGVL0
 3416 D3FA  F5          	PUSH	AF
 3417 D3FB  1E 00       	LD	E,0
 3418 D3FD  CD C8BE     	CALL	TCHAR1
 3419 D400  28 06       	JR	Z,WAIT1
 3420 D402  CD C8D6     	CALL	CPCOMM
 3421 D405  CD D421     	CALL	ARGVL1
 3422 D408  C1          WAIT1:	POP	BC
 3423 D409  3A 0306     	LD	A,(PORTAD)
 3424 D40C  4F          	LD	C,A
 3425 D40D  ED 78       WAIT2:	IN	A,(C)
 3426 D40F  AB          	XOR	E
 3427 D410  A0          	AND	B
 3428 D411  28 FA       	JR	Z,WAIT2
 3429 D413  C9          	RET
 3430                   
 3431 D414  CD D421     ARGVL0:	CALL	ARGVL1
 3432 D417  32 0306     	LD	(PORTAD),A
 3433 D41A  CD C8D6     	CALL	CPCOMM
 3434 D41D  2B          	DEC	HL
 3435 D41E  CD C8BD     ARGVAL:	CALL	TCHAR
 3436 D421  CD CD26     ARGVL1:	CALL	SNALY2
 3437 D424  CD C961     ARGVL2:	CALL	EPRVL2
 3438 D427  7A          	LD	A,D
 3439 D428  B7          	OR	A
 3440 D429  C2 C967     	JP	NZ,FCER
 3441 D42C  CD C8BE     	CALL	TCHAR1
 3442 D42F  7B          	LD	A,E
 3443 D430  C9          	RET
 3444                   ;
 3445                   ;SPEICHERMANIPULATION
 3446 D431  CD C96F     PEEK:	CALL	EPRVL3
 3447 D434  1A          	LD	A,(DE)
 3448 D435  18 B2       	JR	INP1
 3449                    
 3450 D437  CD C96C     POKE:	CALL	EPRVL4
 3451 D43A  D5          	PUSH	DE
 3452 D43B  CD C8D6     	CALL	CPCOMM
 3453 D43E  CD D421     	CALL	ARGVL1
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  60
BASIC   Z80

 3454 D441  D1          	POP	DE
 3455 D442  12          	LD	(DE),A
 3456 D443  C9          	RET
 3457                   
 3458 D444  CD C96F     DEEK:	CALL	EPRVL3
 3459 D447  EB          	EX	DE,HL
 3460 D448  46          	LD	B,(HL)
 3461 D449  23          	INC	HL
 3462 D44A  7E          	LD	A,(HL)
 3463 D44B  C3 D0B1     	JP	FRE3
 3464                    
 3465 D44E  CD C96C     DOKE:	CALL	EPRVL4
 3466 D451  D5          	PUSH	DE
 3467 D452  CD C8D6     	CALL	CPCOMM
 3468 D455  CD C96C     	CALL	EPRVL4
 3469 D458  E3          	EX	(SP),HL
 3470 D459  73          	LD	(HL),E
 3471 D45A  23          	INC	HL
 3472 D45B  72          	LD	(HL),D
 3473 D45C  E1          	POP	HL
 3474 D45D  C9          	RET
 3475                   ;
 3476                   ;ARITHMETIKMODUL
 3477                   ;ADDITION UND SUBTRAKTION
 3478 D45E  21 D904     ADD1:	LD	HL,SQRL
 3479 D461  CD D6EE     ADD2:	CALL	OPLAD
 3480 D464  18 09       	JR	ADD5
 3481                   	;
 3482 D466  CD D6EE     ADD3:	CALL	OPLAD
 3483 D469  21          	DEFB	21H
 3484 D46A  C1          MINUS:	POP	BC
 3485 D46B  D1          	POP	DE
 3486 D46C  CD D6C0     ADD4:	CALL	ABS1
 3487 D46F  78          ADD5:	LD	A,B
 3488 D470  B7          	OR	A
 3489 D471  C8          	RET	Z
 3490 D472  3A 03E8     	LD	A,(WRA1+3)
 3491 D475  B7          	OR	A
 3492 D476  CA D6E0     	JP	Z,OPKOP1
 3493 D479  90          	SUB	B
 3494 D47A  30 0C       	JR	NC,ADD7
 3495 D47C  2F          	CPL
 3496 D47D  3C          	INC	A
 3497 D47E  EB          	EX	DE,HL
 3498 D47F  CD D6C8     	CALL	OPARST
 3499 D482  EB          	EX	DE,HL
 3500 D483  CD D6E0     	CALL	OPKOP1
 3501 D486  C1          ADD6:	POP	BC
 3502 D487  D1          	POP	DE
 3503 D488  FE 19       ADD7:	CP	19H
 3504 D48A  D0          	RET	NC
 3505 D48B  F5          	PUSH	AF
 3506 D48C  CD D703     	CALL	VORZ
 3507 D48F  67          	LD	H,A
 3508 D490  F1          	POP	AF
 3509 D491  CD D52A     	CALL	ADD21
 3510 D494  B4          	OR	H
 3511 D495  21 03E5     	LD	HL,WRA1
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  61
BASIC   Z80

 3512 D498  F2 D4AB     	JP	P,ADD8
 3513 D49B  CD D50A     	CALL	ADD19
 3514 D49E  30 4B       	JR	NC,ADD16
 3515 D4A0  23          	INC	HL
 3516 D4A1  34          	INC	(HL)
 3517 D4A2  28 63       	JR	Z,ADD26
 3518 D4A4  2E 01       	LD	L,1
 3519 D4A6  CD D53E     	CALL	ADD25
 3520 D4A9  18 40       	JR	ADD16
 3521                    
 3522 D4AB  AF          ADD8:	XOR	A
 3523 D4AC  90          	SUB	B
 3524 D4AD  47          	LD	B,A
 3525 D4AE  7E          	LD	A,(HL)
 3526 D4AF  9B          	SBC	A,E
 3527 D4B0  5F          	LD	E,A
 3528 D4B1  23          	INC	HL
 3529 D4B2  7E          	LD	A,(HL)
 3530 D4B3  9A          	SBC	A,D
 3531 D4B4  57          	LD	D,A
 3532 D4B5  23          	INC	HL
 3533 D4B6  7E          	LD	A,(HL)
 3534 D4B7  99          	SBC	A,C
 3535 D4B8  4F          	LD	C,A
 3536 D4B9  DC D516     ADD9:	CALL	C,ADD20
 3537 D4BC  68          ADD10:	LD	L,B
 3538 D4BD  63          	LD	H,E
 3539 D4BE  AF          	XOR	A
 3540 D4BF  47          ADD11:	LD	B,A
 3541 D4C0  79          	LD	A,C
 3542 D4C1  B7          	OR	A
 3543 D4C2  20 16       	JR	NZ,ADD15
 3544 D4C4  4A          	LD	C,D
 3545 D4C5  54          	LD	D,H
 3546 D4C6  65          	LD	H,L
 3547 D4C7  6F          	LD	L,A
 3548 D4C8  78          	LD	A,B
 3549 D4C9  D6 08       	SUB	8
 3550 D4CB  FE E0       	CP	0E0H
 3551 D4CD  20 F0       	JR	NZ,ADD11
 3552 D4CF  AF          ADD12:	XOR	A
 3553 D4D0  32 03E8     ADD13:	LD	(WRA1+3),A
 3554 D4D3  C9          	RET
 3555                   	;
 3556 D4D4  05          ADD14:	DEC	B
 3557 D4D5  29          	ADD	HL,HL
 3558 D4D6  CB 12       	RL	D
 3559 D4D8  CB 11       	RL	C
 3560 D4DA  F2 D4D4     ADD15:	JP	P,ADD14
 3561 D4DD  78          	LD	A,B
 3562 D4DE  5C          	LD	E,H
 3563 D4DF  45          	LD	B,L
 3564 D4E0  B7          	OR	A
 3565 D4E1  28 08       	JR	Z,ADD16
 3566 D4E3  21 03E8     	LD	HL,WRA1+3
 3567 D4E6  86          	ADD	A,(HL)
 3568 D4E7  77          	LD	(HL),A
 3569 D4E8  30 E5       	JR	NC,ADD12
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  62
BASIC   Z80

 3570 D4EA  C8          	RET	Z
 3571 D4EB  78          ADD16:	LD	A,B
 3572 D4EC  21 03E8     ADD17:	LD	HL,WRA1+3
 3573 D4EF  B7          	OR	A
 3574 D4F0  FC D4FD     	CALL	M,ADD18
 3575 D4F3  46          	LD	B,(HL)
 3576 D4F4  23          	INC	HL
 3577 D4F5  7E          	LD	A,(HL)
 3578 D4F6  E6 80       	AND	80H
 3579 D4F8  A9          	XOR	C
 3580 D4F9  4F          	LD	C,A
 3581 D4FA  C3 D6E0     	JP	OPKOP1
 3582                    
 3583 D4FD  1C          ADD18:	INC	E
 3584 D4FE  C0          	RET	NZ
 3585 D4FF  14          	INC	D
 3586 D500  C0          	RET	NZ
 3587 D501  0C          	INC	C
 3588 D502  C0          	RET	NZ
 3589 D503  0E 80       	LD	C,80H
 3590 D505  34          	INC	(HL)
 3591 D506  C0          	RET	NZ
 3592 D507  C3 D653     ADD26:	JP	OVER
 3593                    
 3594 D50A  7E          ADD19:	LD	A,(HL)
 3595 D50B  83          	ADD	A,E
 3596 D50C  5F          	LD	E,A
 3597 D50D  23          	INC	HL
 3598 D50E  7E          	LD	A,(HL)
 3599 D50F  8A          	ADC	A,D
 3600 D510  57          	LD	D,A
 3601 D511  23          	INC	HL
 3602 D512  7E          	LD	A,(HL)
 3603 D513  89          	ADC	A,C
 3604 D514  4F          	LD	C,A
 3605 D515  C9          	RET
 3606                   
 3607 D516  21 03E9     ADD20:	LD	HL,SGNORS
 3608 D519  7E          	LD	A,(HL)
 3609 D51A  2F          	CPL
 3610 D51B  77          	LD	(HL),A
 3611 D51C  AF          	XOR	A
 3612 D51D  6F          	LD	L,A
 3613 D51E  90          	SUB	B
 3614 D51F  47          	LD	B,A
 3615 D520  7D          	LD	A,L
 3616 D521  9B          	SBC	A,E
 3617 D522  5F          	LD	E,A
 3618 D523  7D          	LD	A,L
 3619 D524  9A          	SBC	A,D
 3620 D525  57          	LD	D,A
 3621 D526  7D          	LD	A,L
 3622 D527  99          	SBC	A,C
 3623 D528  4F          	LD	C,A
 3624 D529  C9          	RET
 3625                   
 3626 D52A  06 00       ADD21:	LD	B,0
 3627 D52C  D6 08       ADD22:	SUB	8
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  63
BASIC   Z80

 3628 D52E  38 07       	JR	C,ADD23
 3629 D530  43          	LD	B,E
 3630 D531  5A          	LD	E,D
 3631 D532  51          	LD	D,C
 3632 D533  0E 00       	LD	C,0
 3633 D535  18 F5       	JR	ADD22
 3634                    
 3635 D537  C6 09       ADD23:	ADD	A,9
 3636 D539  6F          	LD	L,A
 3637 D53A  AF          ADD24:	XOR	A
 3638 D53B  2D          	DEC	L
 3639 D53C  C8          	RET	Z
 3640 D53D  79          	LD	A,C
 3641 D53E  1F          ADD25:	RRA
 3642 D53F  4F          	LD	C,A
 3643 D540  CB 1A       	RR	D
 3644 D542  CB 1B       	RR	E
 3645 D544  CB 18       	RR	B
 3646 D546  18 F2       	JR	ADD24
 3647                   ;
 3648                   ;LOGARITHMUS
 3649                   ;KONSTANTENLISTE FUER LN-FUNKTION
 3650 D548  0000        LOGL:	DEFW	0000H	;1.0
 3651 D54A  8100        	DEFW	8100H
 3652 D54C  03          LOGL1:	DEFB	03H	;ANZAHL DER GLIEDER DER REIHE
 3653 D54D  56AA        	DEFW	56AAH	; .5988
 3654 D54F  8019        	DEFW	8019H
 3655 D551  22F1        	DEFW	22F1H	; .96145
 3656 D553  8076        	DEFW	8076H
 3657 D555  AA45        	DEFW	0AA45H	;2.88539
 3658 D557  8238        	DEFW	8238H
 3659                    
 3660 D559  CD D697     LOG:	CALL	TSGNM
 3661 D55C  B7          	OR	A
 3662 D55D  EA C967     	JP	PE,FCER
 3663 D560  21 03E8     	LD	HL,WRA1+3
 3664 D563  7E          	LD	A,(HL)
 3665 D564  01 8035     	LD	BC,8035H	; .707092
 3666 D567  11 04F3     	LD	DE,04F3H
 3667 D56A  90          	SUB	B
 3668 D56B  F5          	PUSH	AF
 3669 D56C  70          	LD	(HL),B
 3670 D56D  D5          	PUSH	DE
 3671 D56E  C5          	PUSH	BC
 3672 D56F  CD D46F     	CALL	ADD5
 3673 D572  C1          	POP	BC
 3674 D573  D1          	POP	DE
 3675 D574  04          	INC	B
 3676 D575  CD D5F5     	CALL	DIV1
 3677 D578  21 D548     	LD	HL,LOGL
 3678 D57B  CD D466     	CALL	ADD3
 3679 D57E  21 D54C     	LD	HL,LOGL1
 3680 D581  CD D9CE     	CALL	REIHE
 3681 D584  01 8080     	LD	BC,8080H	;-.5
 3682 D587  11 0000     	LD	DE,0
 3683 D58A  CD D46F     	CALL	ADD5
 3684 D58D  F1          	POP	AF
 3685 D58E  CD D80B     	CALL	PLUS0
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  64
BASIC   Z80

 3686 D591  01 8031     LOG1:	LD	BC,8031H	; .693115
 3687 D594  11 7218     	LD	DE,7218H
 3688 D597  21          	DEFB	21H
 3689                   ;
 3690                   ;MULTIPLIKATION UND DIVISION
 3691 D598  C1          MUL:	POP	BC
 3692 D599  D1          	POP	DE
 3693 D59A  CD D697     MUL1:	CALL	TSGNM
 3694 D59D  C8          	RET	Z
 3695 D59E  2E 00       	LD	L,0
 3696 D5A0  CD D658     	CALL	HIROU1
 3697 D5A3  79          	LD	A,C
 3698 D5A4  32 03F7     	LD	(WRA2),A
 3699 D5A7  EB          	EX	DE,HL
 3700 D5A8  22 03F8     	LD	(WRA2+1),HL
 3701 D5AB  01 0000     	LD	BC,0
 3702 D5AE  50          	LD	D,B
 3703 D5AF  58          	LD	E,B
 3704 D5B0  21 D4BC     	LD	HL,ADD10
 3705 D5B3  E5          	PUSH	HL
 3706 D5B4  21 D5BC     	LD	HL,MUL2
 3707 D5B7  E5          	PUSH	HL
 3708 D5B8  E5          	PUSH	HL
 3709 D5B9  21 03E5     	LD	HL,WRA1
 3710 D5BC  7E          MUL2:	LD	A,(HL)
 3711 D5BD  23          	INC	HL
 3712 D5BE  B7          	OR	A
 3713 D5BF  28 21       	JR	Z,MUL6
 3714 D5C1  E5          	PUSH	HL
 3715 D5C2  2E 08       	LD	L,8
 3716 D5C4  1F          MUL3:	RRA
 3717 D5C5  67          	LD	H,A
 3718 D5C6  79          	LD	A,C
 3719 D5C7  30 0B       	JR	NC,MUL4
 3720 D5C9  E5          	PUSH	HL
 3721 D5CA  2A 03F8     	LD	HL,(WRA2+1)
 3722 D5CD  19          	ADD	HL,DE
 3723 D5CE  EB          	EX	DE,HL
 3724 D5CF  E1          	POP	HL
 3725 D5D0  3A 03F7     	LD	A,(WRA2)
 3726 D5D3  89          	ADC	A,C
 3727 D5D4  1F          MUL4:	RRA
 3728 D5D5  4F          	LD	C,A
 3729 D5D6  CB 1A       	RR	D
 3730 D5D8  CB 1B       	RR	E
 3731 D5DA  CB 18       	RR	B
 3732 D5DC  2D          	DEC	L
 3733 D5DD  7C          	LD	A,H
 3734 D5DE  20 E4       	JR	NZ,MUL3
 3735 D5E0  E1          MUL5:	POP	HL
 3736 D5E1  C9          	RET
 3737                   	;
 3738 D5E2  43          MUL6:	LD	B,E
 3739 D5E3  5A          	LD	E,D
 3740 D5E4  51          	LD	D,C
 3741 D5E5  4F          	LD	C,A
 3742 D5E6  C9          	RET
 3743                   
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  65
BASIC   Z80

 3744 D5E7  CD D6C8     DIV0:	CALL	OPARST
 3745 D5EA  01 8420     	LD	BC,8420H	;10.0
 3746 D5ED  11 0000     	LD	DE,0
 3747 D5F0  CD D6E0     	CALL	OPKOP1
 3748 D5F3  C1          DIV:	POP	BC
 3749 D5F4  D1          	POP	DE
 3750 D5F5  CD D697     DIV1:	CALL	TSGNM
 3751 D5F8  CA C34B     	JP	Z,DIVER
 3752 D5FB  2E FF       	LD	L,-1
 3753 D5FD  CD D658     	CALL	HIROU1
 3754 D600  34          	INC	(HL)
 3755 D601  34          	INC	(HL)
 3756 D602  2B          	DEC	HL
 3757 D603  7E          	LD	A,(HL)
 3758 D604  32 0314     	LD	(DVAR3),A
 3759 D607  2B          	DEC	HL
 3760 D608  7E          	LD	A,(HL)
 3761 D609  32 0310     	LD	(DVAR2),A
 3762 D60C  2B          	DEC	HL
 3763 D60D  7E          	LD	A,(HL)
 3764 D60E  32 030C     	LD	(DVAR1),A
 3765 D611  41          	LD	B,C
 3766 D612  EB          	EX	DE,HL
 3767 D613  AF          	XOR	A
 3768 D614  4F          	LD	C,A
 3769 D615  57          	LD	D,A
 3770 D616  5F          	LD	E,A
 3771 D617  32 0317     	LD	(DVAR4),A
 3772 D61A  E5          DIV2:	PUSH	HL
 3773 D61B  C5          	PUSH	BC
 3774 D61C  7D          	LD	A,L
 3775 D61D  CD 030B     	CALL	DIVVAR
 3776 D620  DE 00       	SBC	A,0
 3777 D622  3F          	CCF
 3778 D623  30 07       	JR	NC,DIV3
 3779 D625  32 0317     	LD	(DVAR4),A
 3780 D628  F1          	POP	AF
 3781 D629  F1          	POP	AF
 3782 D62A  37          	SCF
 3783 D62B  D2          	DEFB	0D2H
 3784 D62C  C1          DIV3:	POP	BC
 3785 D62D  E1          	POP	HL
 3786 D62E  79          	LD	A,C
 3787 D62F  3C          	INC	A
 3788 D630  3D          	DEC	A
 3789 D631  1F          	RRA
 3790 D632  FA D4EC     	JP	M,ADD17
 3791 D635  17          	RLA
 3792 D636  CB 13       	RL	E
 3793 D638  CB 12       	RL	D
 3794 D63A  CB 11       	RL	C
 3795 D63C  29          	ADD	HL,HL
 3796 D63D  CB 10       	RL	B
 3797 D63F  3A 0317     	LD	A,(DVAR4)
 3798 D642  17          	RLA
 3799 D643  32 0317     	LD	(DVAR4),A
 3800 D646  79          	LD	A,C
 3801 D647  B2          	OR	D
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  66
BASIC   Z80

 3802 D648  B3          	OR	E
 3803 D649  20 CF       	JR	NZ,DIV2
 3804 D64B  E5          	PUSH	HL
 3805 D64C  21 03E8     	LD	HL,WRA1+3
 3806 D64F  35          	DEC	(HL)
 3807 D650  E1          	POP	HL
 3808 D651  20 C7       	JR	NZ,DIV2
 3809 D653  1E 0A       OVER:	LD	E,10		; OV-ERROR
 3810 D655  C3 C356     	JP	ERROO
 3811                   ;
 3812                   ;HILFSROUTINEN FUER ARITHMETIK
 3813 D658  78          HIROU1:	LD	A,B
 3814 D659  B7          	OR	A
 3815 D65A  CA D67C     	JP	Z,HIROU4
 3816 D65D  7D          	LD	A,L
 3817 D65E  21 03E8     	LD	HL,WRA1+3
 3818 D661  AE          	XOR	(HL)
 3819 D662  80          	ADD	A,B
 3820 D663  47          	LD	B,A
 3821 D664  1F          	RRA
 3822 D665  A8          	XOR	B
 3823 D666  78          	LD	A,B
 3824 D667  F2 D67B     	JP	P,HIROU3
 3825 D66A  C6 80       	ADD	A,80H
 3826 D66C  77          	LD	(HL),A
 3827 D66D  CA D5E0     	JP	Z,MUL5
 3828 D670  CD D703     	CALL	VORZ
 3829 D673  77          	LD	(HL),A
 3830 D674  2B          	DEC	HL
 3831 D675  C9          	RET
 3832                   
 3833 D676  CD D697     HIROU2:	CALL	TSGNM
 3834 D679  2F          	CPL
 3835 D67A  E1          	POP	HL
 3836 D67B  B7          HIROU3:	OR	A
 3837 D67C  E1          HIROU4:	POP	HL
 3838 D67D  F2 D4CF     	JP	P,ADD12
 3839 D680  18 D1       	JR	OVER
 3840                    
 3841 D682  CD D6EB     HIROU5:	CALL	OPLAD0
 3842 D685  78          	LD	A,B
 3843 D686  B7          	OR	A
 3844 D687  C8          	RET	Z
 3845 D688  C6 02       	ADD	A,2
 3846 D68A  38 C7       	JR	C,OVER
 3847 D68C  47          	LD	B,A
 3848 D68D  CD D46F     	CALL	ADD5
 3849 D690  21 03E8     	LD	HL,WRA1+3
 3850 D693  34          	INC	(HL)
 3851 D694  C0          	RET	NZ
 3852 D695  18 BC       	JR	OVER
 3853                    
 3854                   ;VORZEICHENTEST
 3855 D697  3A 03E8     TSGNM:	LD	A,(WRA1+3)
 3856 D69A  B7          	OR	A
 3857 D69B  C8          	RET	Z
 3858 D69C  3A 03E7     	LD	A,(WRA1+2)
 3859 D69F  FE          	DEFB	0FEH
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  67
BASIC   Z80

 3860 D6A0  2F          TSGNM1:	CPL
 3861 D6A1  17          	RLA
 3862 D6A2  9F          TSGNM2:	SBC	A,A
 3863 D6A3  C0          	RET	NZ
 3864 D6A4  3C          	INC	A
 3865 D6A5  C9          	RET
 3866                   
 3867 D6A6  CD D697     SGN:	CALL	TSGNM
 3868 D6A9  06 88       SGN0:	LD	B,88H
 3869 D6AB  11 0000     	LD	DE,0
 3870 D6AE  21 03E8     SGN1:	LD	HL,WRA1+3
 3871 D6B1  4F          	LD	C,A
 3872 D6B2  70          	LD	(HL),B
 3873 D6B3  06 00       	LD	B,0
 3874 D6B5  23          	INC	HL
 3875 D6B6  36 80       	LD	(HL),80H
 3876 D6B8  17          	RLA
 3877 D6B9  C3 D4B9     	JP	ADD9
 3878                    
 3879 D6BC  CD D697     ABS:	CALL	TSGNM
 3880 D6BF  F0          	RET	P
 3881 D6C0  21 03E7     ABS1:	LD	HL,WRA1+2
 3882 D6C3  7E          	LD	A,(HL)
 3883 D6C4  EE 80       	XOR	80H
 3884 D6C6  77          	LD	(HL),A
 3885 D6C7  C9          	RET
 3886                   
 3887 D6C8  EB          OPARST:	EX	DE,HL
 3888 D6C9  2A 03E5     	LD	HL,(WRA1)
 3889 D6CC  E3          	EX	(SP),HL
 3890 D6CD  E5          	PUSH	HL
 3891 D6CE  2A 03E7     	LD	HL,(WRA1+2)
 3892 D6D1  E3          	EX	(SP),HL
 3893 D6D2  E5          	PUSH	HL
 3894 D6D3  EB          	EX	DE,HL
 3895 D6D4  C9          	RET
 3896                   
 3897 D6D5  01 8249     PI:	LD	BC,8249H	;PI
 3898 D6D8  11 0FDB     	LD	DE,0FDBH
 3899 D6DB  18 03       	JR	OPKOP1
 3900                    
 3901 D6DD  CD D6EE     OPKOP:	CALL	OPLAD
 3902 D6E0  ED 53 03E5  OPKOP1:	LD	(WRA1),DE
 3903 D6E4  ED 43 03E7  	LD	(WRA1+2),BC
 3904 D6E8  50          	LD	D,B
 3905 D6E9  59          	LD	E,C
 3906 D6EA  C9          	RET
 3907                   
 3908 D6EB  21 03E5     OPLAD0:	LD	HL,WRA1
 3909                   ;ZAHL AUS SPEICHER IN REGISTER BCDE LADEN
 3910                   ;ZEIGER IN REGISTER HL
 3911 D6EE  5E          OPLAD:	LD	E,(HL)
 3912 D6EF  23          	INC	HL
 3913 D6F0  56          	LD	D,(HL)
 3914 D6F1  23          	INC	HL
 3915 D6F2  4E          	LD	C,(HL)
 3916 D6F3  23          	INC	HL
 3917 D6F4  46          	LD	B,(HL)
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  68
BASIC   Z80

 3918 D6F5  23          OPLAD1:	INC	HL
 3919 D6F6  C9          	RET
 3920                   
 3921 D6F7  11 03E5     OPTRAN:	LD	DE,WRA1
 3922 D6FA  06 04       OPTRN1:	LD	B,4
 3923 D6FC  1A          OPTRN2:	LD	A,(DE)
 3924 D6FD  77          	LD	(HL),A
 3925 D6FE  13          	INC	DE
 3926 D6FF  23          	INC	HL
 3927 D700  10 FA       	DJNZ	OPTRN2
 3928 D702  C9          	RET
 3929                   
 3930 D703  21 03E7     VORZ:	LD	HL,WRA1+2
 3931 D706  7E          	LD	A,(HL)
 3932 D707  07          	RLCA
 3933 D708  37          	SCF
 3934 D709  1F          	RRA
 3935 D70A  77          	LD	(HL),A
 3936 D70B  3F          	CCF
 3937 D70C  1F          	RRA
 3938 D70D  23          	INC	HL
 3939 D70E  23          	INC	HL
 3940 D70F  77          	LD	(HL),A
 3941 D710  79          	LD	A,C
 3942 D711  07          	RLCA
 3943 D712  37          	SCF
 3944 D713  1F          	RRA
 3945 D714  4F          	LD	C,A
 3946 D715  1F          	RRA
 3947 D716  AE          	XOR	(HL)
 3948 D717  C9          	RET
 3949                   
 3950 D718  78          VORZ1:	LD	A,B
 3951 D719  B7          	OR	A
 3952 D71A  CA D697     	JP	Z,TSGNM
 3953 D71D  21 D6A0     	LD	HL,TSGNM1
 3954 D720  E5          	PUSH	HL
 3955 D721  CD D697     	CALL	TSGNM
 3956 D724  79          	LD	A,C
 3957 D725  C8          	RET	Z
 3958 D726  21 03E7     	LD	HL,WRA1+2
 3959 D729  AE          	XOR	(HL)
 3960 D72A  79          	LD	A,C
 3961 D72B  F8          	RET	M
 3962 D72C  CD D732     	CALL	CPOPER
 3963 D72F  1F          	RRA
 3964 D730  A9          	XOR	C
 3965 D731  C9          	RET
 3966                   
 3967 D732  23          CPOPER:	INC	HL
 3968 D733  78          	LD	A,B
 3969 D734  BE          	CP	(HL)
 3970 D735  C0          	RET	NZ
 3971 D736  2B          	DEC	HL
 3972 D737  79          	LD	A,C
 3973 D738  BE          	CP	(HL)
 3974 D739  C0          	RET	NZ
 3975 D73A  2B          	DEC	HL
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  69
BASIC   Z80

 3976 D73B  7A          	LD	A,D
 3977 D73C  BE          	CP	(HL)
 3978 D73D  C0          	RET	NZ
 3979 D73E  2B          	DEC	HL
 3980 D73F  7B          	LD	A,E
 3981 D740  96          	SUB	(HL)
 3982 D741  C0          	RET	NZ
 3983 D742  E1          	POP	HL
 3984 D743  E1          	POP	HL
 3985 D744  C9          	RET
 3986                   
 3987 D745  47          INTMOV:	LD	B,A
 3988 D746  4F          	LD	C,A
 3989 D747  57          	LD	D,A
 3990 D748  5F          	LD	E,A
 3991 D749  B7          	OR	A
 3992 D74A  C8          	RET	Z
 3993 D74B  E5          	PUSH	HL
 3994 D74C  CD D6EB     	CALL	OPLAD0
 3995 D74F  CD D703     	CALL	VORZ
 3996 D752  AE          	XOR	(HL)
 3997 D753  67          	LD	H,A
 3998 D754  FC D769     	CALL	M,DEZERO
 3999 D757  3E 98       	LD	A,98H
 4000 D759  90          	SUB	B
 4001 D75A  CD D52A     	CALL	ADD21
 4002 D75D  7C          	LD	A,H
 4003 D75E  17          	RLA
 4004 D75F  DC D4FD     	CALL	C,ADD18
 4005 D762  06 00       	LD	B,0
 4006 D764  DC D516     	CALL	C,ADD20
 4007 D767  E1          	POP	HL
 4008 D768  C9          	RET
 4009                   
 4010 D769  1B          DEZERO:	DEC	DE
 4011 D76A  7A          	LD	A,D
 4012 D76B  A3          	AND	E
 4013 D76C  3C          	INC	A
 4014 D76D  C0          	RET	NZ
 4015 D76E  0B          	DEC	BC
 4016 D76F  C9          	RET
 4017                   
 4018 D770  21 03E8     INT:	LD	HL,WRA1+3
 4019 D773  7E          	LD	A,(HL)
 4020 D774  FE 98       	CP	98H
 4021 D776  3A 03E5     	LD	A,(WRA1)
 4022 D779  D0          	RET	NC
 4023 D77A  7E          	LD	A,(HL)
 4024 D77B  CD D745     	CALL	INTMOV
 4025 D77E  36 98       	LD	(HL),98H
 4026 D780  7B          	LD	A,E
 4027 D781  F5          	PUSH	AF
 4028 D782  79          	LD	A,C
 4029 D783  17          	RLA
 4030 D784  CD D4B9     	CALL	ADD9
 4031 D787  F1          	POP	AF
 4032 D788  C9          	RET
 4033                   
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  70
BASIC   Z80

 4034 D789  21 0000     FESRCH:	LD	HL,0
 4035 D78C  78          	LD	A,B
 4036 D78D  B1          	OR	C
 4037 D78E  C8          	RET	Z
 4038 D78F  3E 10       	LD	A,16
 4039 D791  29          FESRH1:	ADD	HL,HL
 4040 D792  38 06       	JR	C,FESRH3
 4041 D794  EB          	EX	DE,HL
 4042 D795  29          	ADD	HL,HL
 4043 D796  EB          	EX	DE,HL
 4044 D797  30 04       	JR	NC,FESRH2
 4045 D799  09          	ADD	HL,BC
 4046 D79A  DA D00B     FESRH3:	JP	C,BSER
 4047 D79D  3D          FESRH2:	DEC	A
 4048 D79E  20 F1       	JR	NZ,FESRH1
 4049 D7A0  C9          	RET
 4050                   
 4051 D7A1  FE 2D       VALNRM:	CP	'-'
 4052 D7A3  F5          	PUSH	AF
 4053 D7A4  28 05       	JR	Z,VALNR1
 4054 D7A6  FE 2B       	CP	'+'
 4055 D7A8  28 01       	JR	Z,VALNR1
 4056 D7AA  2B          	DEC	HL
 4057 D7AB  CD D4CF     VALNR1:	CALL	ADD12
 4058 D7AE  47          	LD	B,A
 4059 D7AF  57          	LD	D,A
 4060 D7B0  5F          	LD	E,A
 4061 D7B1  2F          	CPL
 4062 D7B2  4F          	LD	C,A
 4063 D7B3  CD C8BD     VALNR2:	CALL	TCHAR
 4064 D7B6  38 3D       	JR	C,VALN10
 4065 D7B8  FE 2E       	CP	'.'
 4066 D7BA  28 16       	JR	Z,VALNR4
 4067 D7BC  FE 45       	CP	'E'
 4068 D7BE  20 15       	JR	NZ,VALNR5
 4069 D7C0  CD C8BD     	CALL	TCHAR
 4070 D7C3  CD CE4D     	CALL	SNLY22
 4071 D7C6  CD C8BD     VALNR3:	CALL	TCHAR
 4072 D7C9  38 4B       	JR	C,VALN11
 4073 D7CB  14          	INC	D
 4074 D7CC  20 07       	JR	NZ,VALNR5
 4075 D7CE  AF          	XOR	A
 4076 D7CF  93          	SUB	E
 4077 D7D0  5F          	LD	E,A
 4078 D7D1  0C          	INC	C
 4079 D7D2  0C          VALNR4:	INC	C
 4080 D7D3  28 DE       	JR	Z,VALNR2
 4081 D7D5  E5          VALNR5:	PUSH	HL
 4082 D7D6  7B          	LD	A,E
 4083 D7D7  90          	SUB	B
 4084 D7D8  F4 D7ED     VALNR6:	CALL	P,VALNR8
 4085 D7DB  F2 D7E4     	JP	P,VALNR7
 4086 D7DE  F5          	PUSH	AF
 4087 D7DF  CD D5E7     	CALL	DIV0
 4088 D7E2  F1          	POP	AF
 4089 D7E3  3C          	INC	A
 4090 D7E4  20 F2       VALNR7:	JR	NZ,VALNR6
 4091 D7E6  D1          	POP	DE
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  71
BASIC   Z80

 4092 D7E7  F1          	POP	AF
 4093 D7E8  CC D6C0     	CALL	Z,ABS1
 4094 D7EB  EB          	EX	DE,HL
 4095 D7EC  C9          	RET
 4096                   
 4097 D7ED  C8          VALNR8:	RET	Z
 4098 D7EE  F5          VALNR9:	PUSH	AF
 4099 D7EF  CD D682     	CALL	HIROU5
 4100 D7F2  F1          	POP	AF
 4101 D7F3  3D          	DEC	A
 4102 D7F4  C9          	RET
 4103                   
 4104 D7F5  D5          VALN10:	PUSH	DE
 4105 D7F6  57          	LD	D,A
 4106 D7F7  78          	LD	A,B
 4107 D7F8  89          	ADC	A,C
 4108 D7F9  47          	LD	B,A
 4109 D7FA  C5          	PUSH	BC
 4110 D7FB  E5          	PUSH	HL
 4111 D7FC  D5          	PUSH	DE
 4112 D7FD  CD D682     	CALL	HIROU5
 4113 D800  F1          	POP	AF
 4114 D801  D6 30       	SUB	'0'
 4115 D803  CD D80B     	CALL	PLUS0
 4116 D806  E1          	POP	HL
 4117 D807  C1          	POP	BC
 4118 D808  D1          	POP	DE
 4119 D809  18 A8       	JR	VALNR2
 4120                    
 4121 D80B  CD D6C8     PLUS0:	CALL	OPARST
 4122 D80E  CD D6A9     	CALL	SGN0
 4123 D811  C1          PLUS:	POP	BC
 4124 D812  D1          	POP	DE
 4125 D813  C3 D46F     	JP	ADD5
 4126                    
 4127 D816  7B          VALN11:	LD	A,E
 4128 D817  07          	RLCA
 4129 D818  07          	RLCA
 4130 D819  83          	ADD	A,E
 4131 D81A  07          	RLCA
 4132 D81B  86          	ADD	A,(HL)
 4133 D81C  D6 30       	SUB	'0'
 4134 D81E  5F          	LD	E,A
 4135 D81F  18 A5       	JR	VALNR3
 4136                   ;
 4137                   ;FORMATIERTE ZAHLENAUSGABE
 4138 D821  E5          INOUT:	PUSH	HL
 4139 D822  21 C30D     	LD	HL,IN		; Zeichenkette "IN"
 4140 D825  CD D1C9     	CALL	TEXTO
 4141 D828  E1          	POP	HL
 4142 D829  EB          NUMBO:	EX	DE,HL
 4143 D82A  AF          NUMBO1:	XOR	A
 4144 D82B  06 98       	LD	B,98H
 4145 D82D  CD D6AE     	CALL	SGN1
 4146 D830  21 D1C8     	LD	HL,TEXTO0
 4147 D833  E5          	PUSH	HL
 4148 D834  21 03EA     NUMKON:	LD	HL,INTPRB
 4149 D837  E5          	PUSH	HL
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  72
BASIC   Z80

 4150 D838  CD D697     	CALL	TSGNM
 4151 D83B  36 20       	LD	(HL),' '
 4152 D83D  F2 D842     	JP	P,NORM1
 4153 D840  36 2D       	LD	(HL),'-'
 4154 D842  23          NORM1:	INC	HL
 4155 D843  36 30       	LD	(HL),'0'
 4156 D845  CA D8EF     	JP	Z,NORM12
 4157 D848  E5          	PUSH	HL
 4158 D849  FC D6C0     	CALL	M,ABS1
 4159 D84C  AF          	XOR	A
 4160 D84D  F5          	PUSH	AF
 4161 D84E  CD D8F5     	CALL	NORM14
 4162 D851  01 9143     NORM2:	LD	BC,9143H	;99999.9
 4163 D854  11 4FF8     	LD	DE,4FF8H
 4164 D857  CD D718     	CALL	VORZ1
 4165 D85A  B7          	OR	A
 4166 D85B  E2 D86E     	JP	PO,NORM4
 4167 D85E  F1          	POP	AF
 4168 D85F  CD D7EE     	CALL	VALNR9
 4169 D862  F5          	PUSH	AF
 4170 D863  18 EC       	JR	NORM2
 4171                    
 4172 D865  CD D5E7     NORM3:	CALL	DIV0
 4173 D868  F1          	POP	AF
 4174 D869  3C          	INC	A
 4175 D86A  F5          	PUSH	AF
 4176 D86B  CD D8F5     	CALL	NORM14
 4177 D86E  CD D45E     NORM4:	CALL	ADD1
 4178 D871  3C          	INC	A
 4179 D872  CD D745     	CALL	INTMOV
 4180 D875  CD D6E0     	CALL	OPKOP1
 4181 D878  01 0306     	LD	BC,0306H
 4182 D87B  F1          	POP	AF
 4183 D87C  81          	ADD	A,C
 4184 D87D  3C          	INC	A
 4185 D87E  FA D889     	JP	M,NORM5
 4186 D881  FE 08       	CP	8
 4187 D883  30 04       	JR	NC,NORM5
 4188 D885  3C          	INC	A
 4189 D886  47          	LD	B,A
 4190 D887  3E 02       	LD	A,2
 4191 D889  3D          NORM5:	DEC	A
 4192 D88A  3D          	DEC	A
 4193 D88B  E1          	POP	HL
 4194 D88C  F5          	PUSH	AF
 4195 D88D  11 D908     	LD	DE,POF10
 4196 D890  05          	DEC	B
 4197 D891  20 06       	JR	NZ,NORM6
 4198 D893  36 2E       	LD	(HL),'.'
 4199 D895  23          	INC	HL
 4200 D896  36 30       	LD	(HL),'0'
 4201 D898  23          	INC	HL
 4202 D899  05          NORM6:	DEC	B
 4203 D89A  36 2E       	LD	(HL),'.'
 4204 D89C  CC D6F5     	CALL	Z,OPLAD1
 4205 D89F  C5          	PUSH	BC
 4206 D8A0  E5          	PUSH	HL
 4207 D8A1  D5          	PUSH	DE
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  73
BASIC   Z80

 4208 D8A2  CD D6EB     	CALL	OPLAD0
 4209 D8A5  E1          	POP	HL
 4210 D8A6  06 2F       	LD	B,'0'-1
 4211 D8A8  04          NORM7:	INC	B
 4212 D8A9  7B          	LD	A,E
 4213 D8AA  96          	SUB	(HL)
 4214 D8AB  5F          	LD	E,A
 4215 D8AC  23          	INC	HL
 4216 D8AD  7A          	LD	A,D
 4217 D8AE  9E          	SBC	A,(HL)
 4218 D8AF  57          	LD	D,A
 4219 D8B0  23          	INC	HL
 4220 D8B1  79          	LD	A,C
 4221 D8B2  9E          	SBC	A,(HL)
 4222 D8B3  4F          	LD	C,A
 4223 D8B4  2B          	DEC	HL
 4224 D8B5  2B          	DEC	HL
 4225 D8B6  30 F0       	JR	NC,NORM7
 4226 D8B8  CD D50A     	CALL	ADD19
 4227 D8BB  23          	INC	HL
 4228 D8BC  CD D6E0     	CALL	OPKOP1
 4229 D8BF  EB          	EX	DE,HL
 4230 D8C0  E1          	POP	HL
 4231 D8C1  70          	LD	(HL),B
 4232 D8C2  23          	INC	HL
 4233 D8C3  C1          	POP	BC
 4234 D8C4  0D          	DEC	C
 4235 D8C5  20 D2       	JR	NZ,NORM6
 4236 D8C7  05          	DEC	B
 4237 D8C8  28 0B       	JR	Z,NORM9
 4238 D8CA  2B          NORM8:	DEC	HL
 4239 D8CB  7E          	LD	A,(HL)
 4240 D8CC  FE 30       	CP	'0'
 4241 D8CE  28 FA       	JR	Z,NORM8
 4242 D8D0  FE 2E       	CP	'.'
 4243 D8D2  C4 D6F5     	CALL	NZ,OPLAD1
 4244 D8D5  F1          NORM9:	POP	AF
 4245 D8D6  28 1A       	JR	Z,NORM13
 4246 D8D8  36 45       	LD	(HL),'E'
 4247 D8DA  23          	INC	HL
 4248 D8DB  36 2B       	LD	(HL),'+'
 4249 D8DD  F2 D8E4     	JP	P,NORM10
 4250 D8E0  36 2D       	LD	(HL),'-'
 4251 D8E2  2F          	CPL
 4252 D8E3  3C          	INC	A
 4253 D8E4  06 2F       NORM10:	LD	B,'0'-1
 4254 D8E6  04          NORM11:	INC	B
 4255 D8E7  D6 0A       	SUB	10
 4256 D8E9  30 FB       	JR	NC,NORM11
 4257 D8EB  C6 3A       	ADD	A,'9'+1
 4258 D8ED  23          	INC	HL
 4259 D8EE  70          	LD	(HL),B
 4260 D8EF  23          NORM12:	INC	HL
 4261 D8F0  77          	LD	(HL),A
 4262 D8F1  23          	INC	HL
 4263 D8F2  71          NORM13:	LD	(HL),C
 4264 D8F3  E1          	POP	HL
 4265 D8F4  C9          	RET
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  74
BASIC   Z80

 4266                   
 4267 D8F5  01 9474     NORM14:	LD	BC,9474H	;999999
 4268 D8F8  11 23F7     	LD	DE,23F7H
 4269 D8FB  CD D718     	CALL	VORZ1
 4270 D8FE  B7          	OR	A
 4271 D8FF  E1          	POP	HL
 4272 D900  E2 D865     	JP	PO,NORM3
 4273 D903  E9          	JP	(HL)
 4274                   
 4275                   	;KONSTANTE FUER SQR-FUNKTION
 4276 D904  0000        SQRL:	DEFW	0000H	;.5
 4277 D906  8000        	DEFW	8000H
 4278                   	;KONSTANTENLISTE FUER KONVERTIERUNG VON ZAHLEN
 4279                   	;INS AUSGABEFORMAT
 4280 D908  86A0        POF10:	DEFW	86A0H	;100000
 4281 D90A  01          	DEFB	01H
 4282 D90B  2710        	DEFW	2710H	;10000
 4283 D90D  00          	DEFB	00H
 4284 D90E  03E8        	DEFW	03E8H	;1000
 4285 D910  00          	DEFB	00H
 4286 D911  0064        	DEFW	0064H	;100
 4287 D913  00          	DEFB	00H
 4288 D914  000A        	DEFW	000AH	;10
 4289 D916  00          	DEFB	00H
 4290 D917  0001        	DEFW	0001H	;1
 4291 D919  00          	DEFB	00H
 4292                   ;
 4293                   ;EXPONENTIALFUNKTION UND QUADRATWURZEL
 4294 D91A  21 D6C0     EXPO3:	LD	HL,ABS1
 4295 D91D  E3          	EX	(SP),HL
 4296 D91E  E9          	JP	(HL)
 4297                    
 4298 D91F  CD D6C8     SQR:	CALL	OPARST
 4299 D922  21 D904     	LD	HL,SQRL
 4300 D925  CD D6DD     	CALL	OPKOP
 4301 D928  C1          EXPO:	POP	BC
 4302 D929  D1          	POP	DE
 4303 D92A  CD D697     	CALL	TSGNM
 4304 D92D  78          	LD	A,B
 4305 D92E  CA D96D     	JP	Z,EXP
 4306 D931  F2 D938     	JP	P,EXPO1
 4307 D934  B7          	OR	A
 4308 D935  CA C34B     	JP	Z,DIVER
 4309 D938  B7          EXPO1:	OR	A
 4310 D939  CA D4D0     	JP	Z,ADD13
 4311 D93C  D5          	PUSH	DE
 4312 D93D  C5          	PUSH	BC
 4313 D93E  79          	LD	A,C
 4314 D93F  F6 7F       	OR	7FH
 4315 D941  CD D6EB     	CALL	OPLAD0
 4316 D944  F2 D955     	JP	P,EXPO2
 4317 D947  D5          	PUSH	DE
 4318 D948  C5          	PUSH	BC
 4319 D949  CD D770     	CALL	INT
 4320 D94C  C1          	POP	BC
 4321 D94D  D1          	POP	DE
 4322 D94E  F5          	PUSH	AF
 4323 D94F  CD D718     	CALL	VORZ1
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  75
BASIC   Z80

 4324 D952  E1          	POP	HL
 4325 D953  7C          	LD	A,H
 4326 D954  1F          	RRA
 4327 D955  E1          EXPO2:	POP	HL
 4328 D956  22 03E7     	LD	(WRA1+2),HL
 4329 D959  E1          	POP	HL
 4330 D95A  22 03E5     	LD	(WRA1),HL
 4331 D95D  DC D91A     	CALL	C,EXPO3
 4332 D960  CC D6C0     	CALL	Z,ABS1
 4333 D963  D5          	PUSH	DE
 4334 D964  C5          	PUSH	BC
 4335 D965  CD D559     	CALL	LOG
 4336 D968  C1          	POP	BC
 4337 D969  D1          	POP	DE
 4338 D96A  CD D59A     	CALL	MUL1
 4339 D96D  CD D6C8     EXP:	CALL	OPARST
 4340 D970  01 8138     	LD	BC,8138H	;1.4427
 4341 D973  11 AA3B     	LD	DE,0AA3BH
 4342 D976  CD D59A     	CALL	MUL1
 4343 D979  3A 03E8     	LD	A,(WRA1+3)
 4344 D97C  FE 88       	CP	88H
 4345 D97E  D2 D676     	JP	NC,HIROU2
 4346 D981  CD D770     	CALL	INT
 4347 D984  C6 80       	ADD	A,80H
 4348 D986  C6 02       	ADD	A,2
 4349 D988  DA D676     	JP	C,HIROU2
 4350 D98B  F5          	PUSH	AF
 4351 D98C  21 D548     	LD	HL,LOGL
 4352 D98F  CD D461     	CALL	ADD2
 4353 D992  CD D591     	CALL	LOG1
 4354 D995  F1          	POP	AF
 4355 D996  C1          	POP	BC
 4356 D997  D1          	POP	DE
 4357 D998  F5          	PUSH	AF
 4358 D999  CD D46C     	CALL	ADD4
 4359 D99C  CD D6C0     	CALL	ABS1
 4360 D99F  21 D9AD     	LD	HL,EXPL
 4361 D9A2  CD D9DD     	CALL	REIHE1
 4362 D9A5  11 0000     	LD	DE,0
 4363 D9A8  C1          	POP	BC
 4364 D9A9  4A          	LD	C,D
 4365 D9AA  C3 D59A     	JP	MUL1
 4366                   ;
 4367                   ;KONSTANTENLISTE FUER REIHENENTWICKLUNG DER EXPONENTIALFUNKTION
 4368 D9AD  08          EXPL:	DEFB	08H	;ANZAHL DER GLIEDER DER REIHE
 4369 D9AE  2E40        	DEFW	2E40H	;-1.41316*10E-4
 4370 D9B0  7494        	DEFW	7494H
 4371 D9B2  4F70        	DEFW	4F70H	; 1.32988*10E-3
 4372 D9B4  772E        	DEFW	772EH
 4373 D9B6  026E        	DEFW	026EH	;-8.30136*10E-3
 4374 D9B8  7A88        	DEFW	7A88H
 4375 D9BA  A0E6        	DEFW	0A0E6H	;  .0416574
 4376 D9BC  7C2A        	DEFW	7C2AH
 4377 D9BE  AA50        	DEFW	0AA50H	;- .166665
 4378 D9C0  7EAA        	DEFW	7EAAH
 4379 D9C2  FFFF        	DEFW	0FFFFH	;  .5
 4380 D9C4  7F7F        	DEFW	7F7FH
 4381 D9C6  0000        	DEFW	0000H	;-1.0
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  76
BASIC   Z80

 4382 D9C8  8180        	DEFW	8180H
 4383 D9CA  0000        	DEFW	0000H	; 1.0
 4384 D9CC  8100        	DEFW	8100H
 4385                   ;
 4386                   ;ROUTINE ZUR ENTWICKLUNG VON FUNKTIONEN IN REIHEN
 4387 D9CE  CD D6C8     REIHE:	CALL	OPARST
 4388 D9D1  11 D598     	LD	DE,MUL
 4389 D9D4  D5          	PUSH	DE
 4390 D9D5  E5          	PUSH	HL
 4391 D9D6  CD D6EB     	CALL	OPLAD0
 4392 D9D9  CD D59A     	CALL	MUL1
 4393 D9DC  E1          	POP	HL
 4394 D9DD  CD D6C8     REIHE1:	CALL	OPARST
 4395 D9E0  7E          	LD	A,(HL)
 4396 D9E1  23          	INC	HL
 4397 D9E2  CD D6DD     	CALL	OPKOP
 4398 D9E5  06          	DEFB	06H
 4399 D9E6  F1          REIHE2:	POP	AF
 4400 D9E7  C1          	POP	BC
 4401 D9E8  D1          	POP	DE
 4402 D9E9  3D          	DEC	A
 4403 D9EA  C8          	RET	Z
 4404 D9EB  D5          	PUSH	DE
 4405 D9EC  C5          	PUSH	BC
 4406 D9ED  F5          	PUSH	AF
 4407 D9EE  E5          	PUSH	HL
 4408 D9EF  CD D59A     	CALL	MUL1
 4409 D9F2  E1          	POP	HL
 4410 D9F3  CD D6EE     	CALL	OPLAD
 4411 D9F6  E5          	PUSH	HL
 4412 D9F7  CD D46F     	CALL	ADD5
 4413 D9FA  E1          	POP	HL
 4414 D9FB  18 E9       	JR	REIHE2
 4415                   ;
 4416                   ;ZUFALLSZAHLERZEUGUNG
 4417 D9FD  CD D697     RND:	CALL	TSGNM		; Vorzeichentest von WRA1
 4418                   				;PA: WRA1>0:    A=1,    SF=0, ZF=0
 4419                   				;    WRA1=0:    A=0,    SF=0, ZF=1
 4420                   				;    WRA1<0:    A=0FFh, SF=1, ZF=0
 4421 DA00  21 031B     	LD	HL,RNDVR3
 4422 DA03  FA DA5D     	JP	M,RND3		; Sprung bei RND mit X<0
 4423 DA06  21 033C     	LD	HL,RNDVR4
 4424 DA09  CD D6DD     	CALL	OPKOP		; RNDVR4 => WRA1
 4425 DA0C  21 031B     	LD	HL,RNDVR3	; Index von Konstantenfeld (RNDVR3+1)
 4426 DA0F  C8          	RET	Z		; raus bei RND mit X=0
 4427                   ; RND mit X>0:
 4428                   ; Multipliziere RNDVR4 mit Konstante im WSP
 4429 DA10  86          	ADD	A,(HL)		; +RNDVR3 (A ist 1)
 4430 DA11  E6 07       	AND	7		; Wertebereich 0..7
 4431 DA13  06 00       	LD	B,0
 4432 DA15  77          	LD	(HL),A
 4433 DA16  23          	INC	HL		; HL auf Konstantenfeld im WSP
 4434 DA17  87          	ADD	A,A		; Index*2
 4435 DA18  87          	ADD	A,A		;      *4
 4436 DA19  4F          	LD	C,A
 4437 DA1A  09          	ADD	HL,BC		; Adr. der indizierten Konstante im WSP
 4438 DA1B  CD D6EE     	CALL	OPLAD		; nach BCDE laden
 4439 DA1E  CD D59A     	CALL	MUL1		; BCDE mit WRA1 multiplizieren
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  77
BASIC   Z80

 4440                   ; Addiere WRA1 mit Konstante im ROM
 4441 DA21  3A 031A     	LD	A,(RNDVR2)	; Index auf Konstantenfeld im ROM (RNDL)
 4442 DA24  3C          	INC	A		; naechster Index
 4443 DA25  E6 03       	AND	3
 4444 DA27  06 00       	LD	B,0
 4445 DA29  FE 01       	CP	1
 4446 DA2B  88          	ADC	A,B		; Wertebereich 1..3
 4447 DA2C  32 031A     	LD	(RNDVR2),A
 4448 DA2F  21 DA60     	LD	HL,RNDL-4H
 4449 DA32  87          	ADD	A,A
 4450 DA33  87          	ADD	A,A
 4451 DA34  4F          	LD	C,A
 4452 DA35  09          	ADD	HL,BC		; Adr. der indizierten Konstante im ROM
 4453 DA36  CD D461     	CALL	ADD2		; mit WRA1 addieren
 4454                   ; fuer WRA1 eine bestimmte Zufallszahl ermitteln
 4455 DA39  CD D6EB     RND1:	CALL	OPLAD0		; WRA1 nach BCDE, HL auf SGNORS
 4456 DA3C  7B          	LD	A,E		; Mantisse veraendern
 4457 DA3D  59          	LD	E,C
 4458 DA3E  EE 4F       	XOR	4FH
 4459 DA40  4F          	LD	C,A
 4460 DA41  36 80       	LD	(HL),80H	; fuer ADD10:positive Zahl
 4461 DA43  2B          	DEC	HL		; HL auf Exponent von WRA1
 4462 DA44  46          	LD	B,(HL)
 4463 DA45  36 80       	LD	(HL),80H	; Exponent auf +0
 4464 DA47  21 0319     	LD	HL,RNDVR1
 4465 DA4A  34          	INC	(HL)		; Zaehler
 4466 DA4B  7E          	LD	A,(HL)
 4467 DA4C  D6 AB       	SUB	0ABH		; wenn = 171
 4468 DA4E  20 04       	JR	NZ,RND2
 4469 DA50  77          	LD	(HL),A		; zuruecksetzen und Mantisse veraendern
 4470 DA51  0C          	INC	C
 4471 DA52  15          	DEC	D
 4472 DA53  1C          	INC	E
 4473 DA54  CD D4BC     RND2:	CALL	ADD10		; Korrektur der Zahl und speichern in WRA1
 4474 DA57  21 033C     	LD	HL,RNDVR4
 4475 DA5A  C3 D6F7     	JP	OPTRAN		; nach RNDVR4 kopieren
 4476                   
 4477                   ; RND mit X<0:
 4478                   ; Argument in eine bestimmte Zufallszahl umrechnen
 4479 DA5D  77          RND3:	LD	(HL),A		; A ist 0FFh vom Vorzeichentest
 4480 DA5E  2B          	DEC	HL		; RNDVR1..3 auf 0FFh setzen
 4481 DA5F  77          	LD	(HL),A		; RNDVR2 und 3 werden beim naechsten Aufruf
 4482 DA60  2B          	DEC	HL		; von RND(1) auf den Anfang der Indizes
 4483 DA61  77          	LD	(HL),A		; gesetzt
 4484 DA62  18 D5       	JR	RND1
 4485                   
 4486                   ; Aufbau der Gleitkommazahl:
 4487                   ; https://hc-ddr.hucki.net/wiki/doku.php/z9001/basic
 4488                   
 4489                   ;KONSTANTENLISTE FUER ZUFALLSZAHLERZEUGUNG
 4490 DA64  B168        RNDL:	DEFW	0B168H	; 4.62618*10E-8
 4491 DA66  6846        	DEFW	6846H
 4492 DA68  E999        	DEFW	0E999H	;-6.84115*10E-8
 4493 DA6A  6992        	DEFW	6992H
 4494 DA6C  D110        	DEFW	0D110H	; 5.72337*10E-8
 4495 DA6E  6875        	DEFW	6875H
 4496                   ;
 4497                   ;TRIGONOMETRISCHE FUNKTIONEN
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  78
BASIC   Z80

 4498 DA70  21 DABA     COS:	LD	HL,COSL
 4499 DA73  CD D461     	CALL	ADD2
 4500 DA76  CD D6C8     SIN:	CALL	OPARST
 4501 DA79  01 8349     	LD	BC,8349H	;6.28319
 4502 DA7C  11 0FDB     	LD	DE,0FDBH
 4503 DA7F  CD D6E0     	CALL	OPKOP1
 4504 DA82  C1          	POP	BC
 4505 DA83  D1          	POP	DE
 4506 DA84  CD D5F5     	CALL	DIV1
 4507 DA87  CD D6C8     	CALL	OPARST
 4508 DA8A  CD D770     	CALL	INT
 4509 DA8D  C1          	POP	BC
 4510 DA8E  D1          	POP	DE
 4511 DA8F  CD D46C     	CALL	ADD4
 4512 DA92  21 DABE     	LD	HL,SINL1
 4513 DA95  CD D466     	CALL	ADD3
 4514 DA98  CD D697     	CALL	TSGNM
 4515 DA9B  37          	SCF
 4516 DA9C  F2 DAA6     	JP	P,SIN1
 4517 DA9F  CD D45E     	CALL	ADD1
 4518 DAA2  CD D697     	CALL	TSGNM
 4519 DAA5  B7          	OR	A
 4520 DAA6  F5          SIN1:	PUSH	AF
 4521 DAA7  F4 D6C0     	CALL	P,ABS1
 4522 DAAA  21 DABE     	LD	HL,SINL1
 4523 DAAD  CD D461     	CALL	ADD2
 4524 DAB0  F1          	POP	AF
 4525 DAB1  D4 D6C0     	CALL	NC,ABS1
 4526 DAB4  21 DAC2     	LD	HL,SINL
 4527 DAB7  C3 D9CE     	JP	REIHE
 4528                    
 4529                   ;KONSTANTE FUER UEBERFUEHRUNG DER BERECHNUNG
 4530                   ;DES COS(X) IN DIE BERECHNUNG SN(F(X))
 4531 DABA  0FDB        COSL:	DEFW	0FDBH	; PI/2
 4532 DABC  8149        	DEFW	8149H
 4533                    
 4534                   ;KONSTANTENLISTE FUER ENTWICKLUNG DER SINUS-
 4535                   ;FUNKTION IN EINER REIHE
 4536 DABE  0000        SINL1:	DEFW	0000H	;  .25
 4537 DAC0  7F00        	DEFW	7F00H
 4538 DAC2  05          SINL:	DEFB	05H	;ANZAHL DER GLIEDER DER REIHE
 4539 DAC3  D7BA        	DEFW	0D7BAH	;39.7107
 4540 DAC5  861E        	DEFW	861EH
 4541 DAC7  2664        	DEFW	2664H	;-76.575
 4542 DAC9  8799        	DEFW	8799H
 4543 DACB  3458        	DEFW	3458H	;81.6022
 4544 DACD  8723        	DEFW	8723H
 4545 DACF  5DE0        	DEFW	5DE0H	;-41.3417
 4546 DAD1  86A5        	DEFW	86A5H
 4547 DAD3  0FDA        	DEFW	0FDAH	;  6.28319
 4548 DAD5  8349        	DEFW	8349H
 4549                    
 4550 DAD7  CD D6C8     TAN:	CALL	OPARST
 4551 DADA  CD DA76     	CALL	SIN
 4552 DADD  C1          	POP	BC
 4553 DADE  E1          	POP	HL
 4554 DADF  CD D6C8     	CALL	OPARST
 4555 DAE2  EB          	EX	DE,HL
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  79
BASIC   Z80

 4556 DAE3  CD D6E0     	CALL	OPKOP1
 4557 DAE6  CD DA70     	CALL	COS
 4558 DAE9  C3 D5F3     	JP	DIV
 4559                    
 4560 DAEC  CD D697     ATN:	CALL	TSGNM
 4561 DAEF  FC D91A     	CALL	M,EXPO3
 4562 DAF2  FC D6C0     	CALL	M,ABS1
 4563 DAF5  3A 03E8     	LD	A,(WRA1+3)
 4564 DAF8  FE 81       	CP	81H
 4565 DAFA  DA DB09     	JP	C,ATN1
 4566 DAFD  01 8100     	LD	BC,8100H	;1.0
 4567 DB00  51          	LD	D,C
 4568 DB01  59          	LD	E,C
 4569 DB02  CD D5F5     	CALL	DIV1
 4570 DB05  21 D466     	LD	HL,ADD3
 4571 DB08  E5          	PUSH	HL
 4572 DB09  21 DB13     ATN1:	LD	HL,ATNL
 4573 DB0C  CD D9CE     	CALL	REIHE
 4574 DB0F  21 DABA     	LD	HL,COSL
 4575 DB12  C9          	RET
 4576                   
 4577                   ;KONSTANTENLISTE FUER REIHENENTWICKLUNG DER
 4578                   ;ARCUS-TANGENS-FUNKTION
 4579 DB13  09          ATNL:	DEFB	09H	;ANZAHL DER GLIEDER DER REIHE
 4580 DB14  D74A        	DEFW	0D74AH	; 2.86623*10E-3
 4581 DB16  783B        	DEFW	783BH
 4582 DB18  6E02        	DEFW	6E02H	;- .0161657
 4583 DB1A  7B84        	DEFW	7B84H
 4584 DB1C  C1FE        	DEFW	0C1FEH	;  .0429096
 4585 DB1E  7C2F        	DEFW	7C2FH
 4586 DB20  3174        	DEFW	3174H	;- .0752896
 4587 DB22  7D9A        	DEFW	7D9AH
 4588 DB24  3D84        	DEFW	3D84H	;  .105586
 4589 DB26  7D5A        	DEFW	7D5AH
 4590 DB28  7FC8        	DEFW	7FC8H	;- .142089
 4591 DB2A  7E91        	DEFW	7E91H
 4592 DB2C  BBE4        	DEFW	0BBE4H	;- .199936
 4593 DB2E  7E4C        	DEFW	7E4CH
 4594 DB30  AA6C        	DEFW	0AA6CH	;- .333331
 4595 DB32  7FAA        	DEFW	7FAAH
 4596 DB34  0000        	DEFW	0000H	; 1.0
 4597 DB36  8100        	DEFW	8100H
 4598                   ;
 4599                   ;AUFRUF VON MASCHINENPROGRAMMEN
 4600 DB38  CD DB49     CALL:	CALL	HEX
 4601 DB3B  28 03       	JR	Z,CALL1
 4602 DB3D  CD C96C     	CALL	EPRVL4
 4603 DB40  E5          CALL1:	PUSH	HL
 4604 DB41  21 DB47     	LD	HL,CALL2
 4605 DB44  E5          	PUSH	HL
 4606 DB45  EB          	EX	DE,HL
 4607 DB46  E9          	JP	(HL)
 4608                    
 4609 DB47  E1          CALL2:	POP	HL
 4610 DB48  C9          	RET
 4611                   
 4612 DB49  FE AE       HEX:	CP	MULTOK
 4613 DB4B  C0          	RET	NZ
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  80
BASIC   Z80

 4614 DB4C  11 0000     	LD	DE,0
 4615 DB4F  CD C8BD     HEX1:	CALL	TCHAR
 4616 DB52  C8          	RET	Z
 4617 DB53  38 0B       	JR	C,HEX2
 4618 DB55  FE 94       	CP	DEFTOK
 4619 DB57  28 16       	JR	Z,HEX3
 4620 DB59  FE 47       	CP	'G'
 4621 DB5B  D2 C348     	JP	NC,SNER
 4622 DB5E  D6 07       	SUB	7
 4623 DB60  D6 30       HEX2:	SUB	'0'
 4624 DB62  DA C348     	JP	C,SNER
 4625 DB65  EB          	EX	DE,HL
 4626 DB66  29          	ADD	HL,HL
 4627 DB67  29          	ADD	HL,HL
 4628 DB68  29          	ADD	HL,HL
 4629 DB69  29          	ADD	HL,HL
 4630 DB6A  B5          	OR	L
 4631 DB6B  6F          	LD	L,A
 4632 DB6C  EB          	EX	DE,HL
 4633 DB6D  18 E0       	JR	HEX1
 4634                   	;
 4635 DB6F  7B          HEX3:	LD	A,E
 4636 DB70  87          	ADD	A,A
 4637 DB71  87          	ADD	A,A
 4638 DB72  87          	ADD	A,A
 4639 DB73  87          	ADD	A,A
 4640 DB74  F6 0D       	OR	0DH
 4641 DB76  57          	LD	D,A
 4642 DB77  1E EF       	LD	E,0EFH
 4643 DB79  18 D4       	JR	HEX1
 4644                   ;
 4645                   ;KASSETTEN-EIN/AUSGABEROUTINEN
 4646 DB7B  D5          CLOAD_:	PUSH	DE
 4647 DB7C  E5          	PUSH	HL
 4648 DB7D  36 00       CLOA_1:	LD	(HL),0		;ALLE LAENGEN = 0
 4649 DB7F  23          	INC	HL
 4650 DB80  CD C689     	CALL	CPREG
 4651 DB83  20 F8       	JR	NZ,CLOA_1
 4652 DB85  E3          	EX	(SP),HL
 4653 DB86  E5          	PUSH	HL
 4654 DB87  CD D2FE     	CALL	STRZS1
 4655 DB8A  CD D209     	CALL	STROP4
 4656 DB8D  2A 03C4     	LD	HL,(SWAPTR)
 4657 DB90  ED 5B 0356  	LD	DE,(STDPTR)
 4658 DB94  AF          	XOR	A
 4659 DB95  ED 52       	SBC	HL,DE
 4660 DB97  D1          	POP	DE
 4661 DB98  E3          	EX	(SP),HL
 4662 DB99  ED 52       	SBC	HL,DE
 4663 DB9B  E5          	PUSH	HL
 4664 DB9C  CD DD28     	CALL	INIT8I		; Datei oeffnen, erstes Byte einlesen
 4665 DB9F  4F          	LD	C,A
 4666 DBA0  CD DDE4     	CALL	CI
 4667 DBA3  47          	LD	B,A
 4668 DBA4  E1          	POP	HL
 4669 DBA5  CD DDE4     CLOA_2:	CALL	CI
 4670 DBA8  12          	LD	(DE),A
 4671 DBA9  13          	INC	DE
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  81
BASIC   Z80

 4672 DBAA  2B          	DEC	HL
 4673 DBAB  7D          	LD	A,L
 4674 DBAC  B4          	OR	H
 4675 DBAD  20 F6       	JR	NZ,CLOA_2
 4676 DBAF  E1          	POP	HL
 4677 DBB0  CD DDE4     	CALL	CI
 4678 DBB3  5F          	LD	E,A
 4679 DBB4  CD DDE4     	CALL	CI
 4680 DBB7  57          	LD	D,A
 4681 DBB8  AF          	XOR	A		; CY=0
 4682 DBB9  ED 52       	SBC	HL,DE
 4683 DBBB  38 44       	JR	C,CLOA_7
 4684 DBBD  2A 0356     	LD	HL,(STDPTR)
 4685 DBC0  23          	INC	HL
 4686 DBC1  CD DDE4     CLOA_3:	CALL	CI
 4687 DBC4  77          	LD	(HL),A
 4688 DBC5  23          	INC	HL
 4689 DBC6  1B          	DEC	DE
 4690 DBC7  7B          	LD	A,E
 4691 DBC8  B2          	OR	D
 4692 DBC9  20 F6       	JR	NZ,CLOA_3
 4693 DBCB  D1          	POP	DE
 4694 DBCC  E3          	EX	(SP),HL
 4695 DBCD  C5          	PUSH	BC
 4696 DBCE  CD DCF8     	CALL	CHSUM
 4697 DBD1  E3          	EX	(SP),HL
 4698 DBD2  ED 42       	SBC	HL,BC
 4699 DBD4  20 2D       	JR	NZ,CLOA_6
 4700 DBD6  E1          	POP	HL
 4701 DBD7  CD DD77     	CALL	LAENGE
 4702 DBDA  E3          	EX	(SP),HL
 4703 DBDB  2B          	DEC	HL
 4704 DBDC  D5          	PUSH	DE
 4705 DBDD  ED 5B 03C4  	LD	DE,(SWAPTR)
 4706 DBE1  ED B8       	LDDR
 4707 DBE3  ED 53 03C4  	LD	(SWAPTR),DE
 4708 DBE7  E1          	POP	HL
 4709 DBE8  42          	LD	B,D
 4710 DBE9  4B          	LD	C,E
 4711 DBEA  03          	INC	BC
 4712 DBEB  D1          	POP	DE
 4713 DBEC  2B          CLOA_4:	DEC	HL
 4714 DBED  70          	LD	(HL),B
 4715 DBEE  2B          	DEC	HL
 4716 DBEF  71          	LD	(HL),C
 4717 DBF0  2B          	DEC	HL
 4718 DBF1  35          CLOA_5:	DEC	(HL)
 4719 DBF2  03          	INC	BC
 4720 DBF3  20 FC       	JR	NZ,CLOA_5
 4721 DBF5  0B          	DEC	BC
 4722 DBF6  2B          	DEC	HL
 4723 DBF7  CD C689     	CALL	CPREG
 4724 DBFA  20 F0       	JR	NZ,CLOA_4
 4725 DBFC  E1          	POP	HL
 4726 DBFD  CD DDFD     CLOA_8:	CALL	CLCHNL		; alle benutzten Kanaele schliessen
 4727 DC00  C9          	RET
 4728                   	;
 4729 DC01  D1          CLOA_7:	POP	DE
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  82
BASIC   Z80

 4730 DC02  E1          	POP	HL
 4731 DC03  36 00       CLOA_6:	LD	(HL),0
 4732 DC05  23          	INC	HL
 4733 DC06  CD C689     	CALL	CPREG
 4734 DC09  20 F8       	JR	NZ,CLOA_6
 4735 DC0B  18 29       	JR	CLOAD3
 4736                    
 4737                   ; Variablenfeld laden mit CLOAD*
 4738 DC0D  CD DC87     CLOADD:	CALL	CASS00
 4739 DC10  E5          	PUSH	HL
 4740 DC11  E2 DB7B     	JP	PO,CLOAD_
 4741 DC14  EB          	EX	DE,HL
 4742 DC15  ED 52       	SBC	HL,DE
 4743 DC17  E5          	PUSH	HL
 4744 DC18  CD DD28     	CALL	INIT8I		; Datei oeffnen, erstes Byte einlesen
 4745 DC1B  4F          	LD	C,A
 4746 DC1C  CD DDE4     	CALL	CI
 4747 DC1F  47          	LD	B,A
 4748 DC20  E1          	POP	HL
 4749 DC21              CLOAD2:
 4750 DC21  CD DDE4     	CALL	CI
 4751 DC24  12          	LD	(DE),A
 4752 DC25  13          	INC	DE
 4753 DC26  2B          	DEC	HL
 4754 DC27  7D          	LD	A,L
 4755 DC28  B4          	OR	H
 4756 DC29  20 F6       	JR	NZ,CLOAD2
 4757 DC2B  E1          	POP	HL
 4758 DC2C  C5          	PUSH	BC
 4759 DC2D  CD DCF8     	CALL	CHSUM
 4760 DC30  E1          	POP	HL
 4761 DC31  ED 42       	SBC	HL,BC
 4762 DC33  E1          	POP	HL
 4763 DC34  28 C7       	JR	Z,CLOA_8
 4764 DC36  CD DE1D     CLOAD3:	CALL	SETCO
 4765 DC39  21 DC3F     	LD	HL,BAD
 4766 DC3C  C3 C371     	JP	ERROO1
 4767 DC3F  42 41 44    BAD:	DEFM	'BAD'
 4768 DC42  00          	DEFB	0
 4769                    
 4770 DC43  FE AE       CLOAD:	CP	MULTOK		; folgt ein *
 4771 DC45  28 C6       	JR	Z,CLOADD	; dann Variablenfeld
 4772                   	; Programm einlesen
 4773 DC47  CD DCB0     	CALL	CASS01		; *.SSS Name holen
 4774 DC4A  ED 5B 03D7  	LD	DE,(SVARPT)	; Programmende+1
 4775 DC4E  1B          	DEC	DE
 4776 DC4F  1B          	DEC	DE
 4777 DC50  21 0000     	LD	HL,0
 4778 DC53  39          	ADD	HL,SP		; HL = Stackpointer
 4779 DC54  01 FFD1     	LD	BC,-47
 4780 DC57  ED 52       	SBC	HL,DE		; minus aktuelles Programmende
 4781 DC59  09          	ADD	HL,BC		; minus 47 Byte
 4782 DC5A  44          	LD	B,H
 4783 DC5B  4D          	LD	C,L		; BC = freier Speicherplatz
 4784 DC5C  CD DD28     	CALL	INIT8I		; Datei oeffnen, erstes Byte einlesen
 4785 DC5F  6F          	LD	L,A
 4786 DC60  CD DDE4     	CALL	CI		; zweites Byte lesen
 4787 DC63  67          	LD	H,A		; HL = Programmlaenge
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  83
BASIC   Z80

 4788 DC64  E5          	PUSH	HL
 4789 DC65  ED 42       	SBC	HL,BC		; freier Speicher ausreichend?
 4790 DC67  E1          	POP	HL
 4791 DC68  D2 C33E     	JP	NC,OMER		; nein -> OM ERROR
 4792 DC6B  CD DDE4     CLOAD1:	CALL	CI		; Byte lesen
 4793 DC6E  12          	LD	(DE),A		; Byte in Speicher
 4794 DC6F  13          	INC	DE
 4795 DC70  2B          	DEC	HL
 4796 DC71  7D          	LD	A,L
 4797 DC72  B4          	OR	H
 4798 DC73  20 F6       	JR	NZ,CLOAD1	; bis HL=0
 4799 DC75  ED 53 03D7  	LD	(SVARPT),DE	; Programmende
 4800 DC79  21 C312     	LD	HL,FILE		; FILE FOUND
 4801 DC7C  CD D1C9     	CALL	TEXTO
 4802 DC7F  C3 C48A     	JP	LIN10
 4803                    
 4804 DC82  1E 26       IOERR:	LD	E,38		; IO-ERROR
 4805 DC84  C3 C356     	JP	ERROO
 4806                    
 4807 DC87  CD DCAC     CASS00:	CALL	CASS0		; *.TTT
 4808 DC8A  E1          	POP	HL
 4809 DC8B  CD C8CC     	CALL	CPSTX
 4810 DC8E  3B          	DEFB	';'
 4811 DC8F  3E 01       	LD	A,1
 4812 DC91  32 03CC     	LD	(FORFLG),A
 4813 DC94  CD CF06     	CALL	DIM1
 4814 DC97  32 03CC     	LD	(FORFLG),A
 4815 DC9A  E3          	EX	(SP),HL
 4816 DC9B  E5          	PUSH	HL
 4817 DC9C  60          	LD	H,B
 4818 DC9D  69          	LD	L,C
 4819 DC9E  EB          	EX	DE,HL
 4820 DC9F  19          	ADD	HL,DE
 4821 DCA0  EB          	EX	DE,HL
 4822 DCA1  4E          	LD	C,(HL)
 4823 DCA2  06 00       	LD	B,0
 4824 DCA4  09          	ADD	HL,BC
 4825 DCA5  09          	ADD	HL,BC
 4826 DCA6  23          	INC	HL
 4827 DCA7  3A 03AE     	LD	A,(DATYPE)
 4828 DCAA  B7          	OR	A
 4829 DCAB  C9          	RET
 4830                   
 4831 DCAC  3E D4       CASS0:	LD	A,D4TYPE	; TTT = Variablenfeld
 4832 DCAE  23          	INC	HL
 4833 DCAF  01          	DEFB	1
 4834 DCB0  3E D3       CASS01:	LD	A,D3TYPE	; SSS = BASIC-Programm
 4835 DCB2  F5          CASS1:	PUSH	AF
 4836 DCB3  3A 035D     	LD	A,(DATBYT)	; geschuetzte Datei erzeugen?
 4837 DCB6  A7          	AND	A
 4838 DCB7  3E 00       	LD	A,0		; nur einmalig, dann gleich wieder ruecksetzen
 4839 DCB9  32 035D     	LD	(DATBYT),A
 4840 DCBC  28 04       	JR	Z,CASS5
 4841 DCBE  F1          	POP	AF
 4842 DCBF  C6 04       	ADD	A,4		; SSS => WWW / TTT => XXX / UUU => YYY
 4843 DCC1  F5          	PUSH	AF
 4844 DCC2  CD C8BE     CASS5:	CALL	TCHAR1
 4845 DCC5  CD CD3A     	CALL	SNALY
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  84
BASIC   Z80

 4846 DCC8  F1          	POP	AF
 4847 DCC9  E3          	EX	(SP),HL
 4848 DCCA  E5          	PUSH	HL
 4849 DCCB  F5          	PUSH	AF
 4850 DCCC  CD D33F     	CALL	ASC1
 4851 DCCF  21 03F7     	LD	HL,INTPRB+13	; PRINTPUFFER ENDE
 4852 DCD2  06 0D       	LD	B,13
 4853 DCD4  2B          CASS2:	DEC	HL
 4854 DCD5  36 20       	LD	(HL),' '	; mit Leerzeichen vorbelegen
 4855 DCD7  10 FB       	DJNZ	CASS2
 4856 DCD9  D5          	PUSH	DE
 4857 DCDA  11 DC82     	LD	DE,IOERR
 4858 DCDD  73          	LD	(HL),E		; als Erstes Fehlersprung eintragen
 4859 DCDE  23          	INC	HL
 4860 DCDF  72          	LD	(HL),D
 4861 DCE0  D1          	POP	DE
 4862 DCE1  23          	INC	HL
 4863 DCE2  F1          	POP	AF
 4864 DCE3  77          	LD	(HL),A		; dann 3x Dateityp
 4865 DCE4  23          	INC	HL
 4866 DCE5  77          	LD	(HL),A
 4867 DCE6  23          	INC	HL
 4868 DCE7  77          	LD	(HL),A
 4869 DCE8  23          	INC	HL
 4870 DCE9  EB          	EX	DE,HL
 4871 DCEA  06 00       	LD	B,0
 4872 DCEC  79          CASS3:	LD	A,C		; Anzahl Zeichen
 4873 DCED  FE 09       	CP	9		; kleiner als 9
 4874 DCEF  38 04       	JR	C,CASS4		; dann kopieren
 4875 DCF1  0D          	DEC	C
 4876 DCF2  23          	INC	HL		; ansonsten nur die letzten 8 Zeichen
 4877 DCF3  18 F7       	JR	CASS3
 4878                   	;
 4879 DCF5  ED B0       CASS4:	LDIR
 4880 DCF7  C9          	RET
 4881                   
 4882 DCF8  E5          CHSUM:	PUSH	HL
 4883 DCF9  AF          	XOR	A
 4884 DCFA  47          	LD	B,A
 4885 DCFB  86          CHSUM1:	ADD	A,(HL)
 4886 DCFC  CD DD03     	CALL	CHSUM2
 4887 DCFF  20 FA       	JR	NZ,CHSUM1
 4888 DD01  E1          	POP	HL
 4889 DD02  C9          	RET
 4890                   
 4891 DD03  4F          CHSUM2:	LD	C,A
 4892 DD04  30 01       	JR	NC,CHSUM3
 4893 DD06  04          	INC	B
 4894 DD07  23          CHSUM3:	INC	HL
 4895 DD08  CD C689     	CALL	CPREG
 4896 DD0B  79          	LD	A,C
 4897 DD0C  C9          	RET
 4898                   
 4899                   ;ROUTINE ZUM SETZEN OCH_ (8 BIT)
 4900 DD0D  F5          INIT8O:	PUSH	AF
 4901 DD0E  3A 0307     	LD	A,(IOCHNL)	; E/A-Flag
 4902 DD11  CB 4F       	BIT	OM_,A		; Bit 1
 4903 DD13  CB CF       	SET	OM_,A		; Bit 1
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  85
BASIC   Z80

 4904 DD15  32 0307     	LD	(IOCHNL),A	; E/A-Flag
 4905 DD18  3E 13       	LD	A,OCH_+BIT8	; Kassettenausgabe 8 Bit
 4906 DD1A  20 02       	JR	NZ,SETOO1
 4907 DD1C  C6 08       	ADD	A,INIT		; INIT-Bit setzen
 4908 DD1E  32 0308     SETOO1:	LD	(OUTIND),A	; OUT-Index einstellen
 4909                   ;-------------------------
 4910 DD21  21 03EA     	LD	HL,INTPRB	; PRINT-Puffer (Dateiname)
 4911 DD24  F1          	POP	AF
 4912 DD25  C3 DDD5     	JP	CO		; Byte ausgeben
 4913                   
 4914                   ;ROUTINE ZUM SETZEN ICH_ (8 BIT)
 4915 DD28  3A 0307     INIT8I:	LD	A,(IOCHNL)	; E/A-Flag
 4916 DD2B  CB 47       	BIT	IM_,A		; Bit 0?
 4917 DD2D  CB C7       	SET	IM_,A		; Bit 0 setzen
 4918 DD2F  32 0307     	LD	(IOCHNL),A	; E/A-Flag
 4919 DD32  3E 12       	LD	A,ICH_+BIT8	; Kassetteneingabe 8 Bit
 4920 DD34  20 02       	JR	NZ,SETOI1
 4921 DD36  C6 08       	ADD	A,INIT		; INIT-Bit setzen
 4922 DD38  32 0309     SETOI1:	LD	(ININD),A	; IN-Index
 4923                   ;------------------------
 4924 DD3B  21 03EA     	LD	HL,INTPRB	; PRINT-Puffer (Dateiname)
 4925 DD3E  C3 DDE4     	JP	CI		; Byte einlesen
 4926                    
 4927 DD41  FE AE       CSAVE:	CP	MULTOK		; folgt ein *
 4928 DD43  28 24       	JR	Z,CSAVED	; dann Variablenfeld
 4929 DD45  CD C697     	CALL	IOTEST		; LIST/EDIT/BYE-Schutz?
 4930 DD48  CD DCB0     	CALL	CASS01
 4931 DD4B  2A 03D7     	LD	HL,(SVARPT)
 4932 DD4E  11 FBFF     	LD	DE,-PRAM
 4933 DD51  19          	ADD	HL,DE
 4934 DD52  44          	LD	B,H
 4935 DD53  4D          	LD	C,L
 4936 DD54  11 0401     	LD	DE,PRAM
 4937 DD57  CD DDB5     CSAVE0:	CALL	CSAVE2
 4938 DD5A  E1          CSAVE4:	POP	HL
 4939                   ;ROUTINE ZUM SCHLIEZSEN OCH_ (8 BIT)
 4940 DD5B  E5          RES8OO:	PUSH	HL
 4941 DD5C  21 0307     	LD	HL,IOCHNL
 4942 DD5F  CB 8E       	RES	OM_,(HL)	; Bit 1
 4943 DD61  11 0343     	LD	DE,0300H+OCH_+CLOSE
 4944 DD64  CD DFF6     	CALL	IO
 4945 DD67  E1          	POP	HL
 4946 DD68  C9          	RET
 4947                   
 4948                   ; Variablenfeld speichern mit CSAVE*
 4949 DD69  CD DC87     CSAVED:	CALL	CASS00
 4950 DD6C  E2 DD89     	JP	PO,CSAVE_
 4951 DD6F  CD DCF8     	CALL	CHSUM
 4952 DD72  EB          	EX	DE,HL
 4953 DD73  ED 52       	SBC	HL,DE
 4954 DD75  18 E0       	JR	CSAVE0
 4955                    
 4956 DD77  E5          LAENGE:	PUSH	HL
 4957 DD78  01 0000     	LD	BC,0
 4958 DD7B  7E          LAENG1:	LD	A,(HL)
 4959 DD7C  23          	INC	HL
 4960 DD7D  77          	LD	(HL),A
 4961 DD7E  34          	INC	(HL)
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  86
BASIC   Z80

 4962 DD7F  81          	ADD	A,C
 4963 DD80  23          	INC	HL
 4964 DD81  23          	INC	HL
 4965 DD82  CD DD03     	CALL	CHSUM2
 4966 DD85  20 F4       	JR	NZ,LAENG1
 4967 DD87  E1          	POP	HL
 4968 DD88  C9          	RET
 4969                   
 4970 DD89  CD DD77     CSAVE_:	CALL	LAENGE
 4971 DD8C  C5          	PUSH	BC
 4972 DD8D  CD DCF8     	CALL	CHSUM
 4973 DD90  EB          	EX	DE,HL
 4974 DD91  ED 52       	SBC	HL,DE
 4975 DD93  CD DDB5     	CALL	CSAVE2
 4976 DD96  C1          	POP	BC
 4977 DD97  79          	LD	A,C
 4978 DD98  CD DDD5     	CALL	CO
 4979 DD9B  78          	LD	A,B
 4980 DD9C  EB          	EX	DE,HL
 4981 DD9D  CD DDD5     	CALL	CO
 4982 DDA0  2B          CSAV_2:	DEC	HL
 4983 DDA1  2B          	DEC	HL
 4984 DDA2  78          	LD	A,B
 4985 DDA3  B1          	OR	C
 4986 DDA4  28 B4       	JR	Z,CSAVE4
 4987 DDA6  56          	LD	D,(HL)
 4988 DDA7  2B          	DEC	HL
 4989 DDA8  5E          	LD	E,(HL)
 4990 DDA9  2B          	DEC	HL
 4991 DDAA  35          CSAV_3:	DEC	(HL)
 4992 DDAB  28 F3       	JR	Z,CSAV_2
 4993 DDAD  1A          	LD	A,(DE)
 4994 DDAE  CD DDD5     	CALL	CO
 4995 DDB1  13          	INC	DE
 4996 DDB2  0B          	DEC	BC
 4997 DDB3  18 F5       	JR	CSAV_3
 4998                    
 4999 DDB5  23          CSAVE2:	INC	HL
 5000 DDB6  E5          	PUSH	HL
 5001 DDB7  79          	LD	A,C
 5002 DDB8  CD DD0D     	CALL	INIT8O
 5003 DDBB  78          	LD	A,B
 5004 DDBC  E1          	POP	HL
 5005 DDBD              CSAVE1:
 5006 DDBD  CD DDD5     	CALL	CO
 5007 DDC0  2B          	DEC	HL
 5008 DDC1  7D          	LD	A,L
 5009 DDC2  B4          	OR	H
 5010 DDC3  1A          	LD	A,(DE)
 5011 DDC4  13          	INC	DE
 5012 DDC5  20 F6       	JR	NZ,CSAVE1
 5013 DDC7  C9          	RET
 5014                   
 5015         00D3      D3TYPE	EQU	0D3H
 5016         00D4      D4TYPE	EQU	0D4H
 5017         00D5      D5TYPE	EQU	0D5H
 5018                    
 5019                   ;
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  87
BASIC   Z80

 5020                   ;EIN/AUSGABE-SCHNITTSTELLE VARIABLENVEREINBARUNG
 5021         0000      CICH	EQU	00		; Eingabe Kanal 0 = Tastatur
 5022         0001      COCH	EQU	01		; Ausgabe Kanal 0 = Bildschirm
 5023         0002      ICH_	EQU	02		; Eingabe Kanal 1 = Kassette
 5024         0003      OCH_	EQU	03		; Ausgabe Kanal 1 = Kassette
 5025         0004      ICH?	EQU	04		; Eingabe Kanal 2 = Anwenderkanal 1
 5026         0005      OCH?	EQU	05		; Ausgabe Kanal 2 = Anwenderkanal 1
 5027         0006      ICH??	EQU	06		; Eingabe Kanal 3 = Anwenderkanal 2
 5028         0007      OCH??	EQU	07		; Ausgabe Kanal 3 = Anwenderkanal 2
 5029         00FF      MONIT	EQU	0FFH		; Bit 5 = Code fuer Ruecksprung zu CAOS
 5030         0080      IMRET	EQU	80H		; Bit 7 = Abfrage Tastaturstatus
 5031         0040      CLOSE	EQU	40H		; Bit 6 = Close
 5032         0008      INIT	EQU	08H		; Bit 3 = Init
 5033         0010      BIT8	EQU	10H		; Bit 4
 5034                   
 5035                   ;TEST, OB COCH (Bildschirmausgabe) GESETZT IST
 5036 DDC8  3A 0308     TESTCO:	LD	A,(OUTIND)	; OUT-Index
 5037 DDCB  E6 07       	AND	OCH??
 5038 DDCD  D6 01       	SUB	COCH
 5039 DDCF  C9          	RET
 5040                   
 5041                   ;BILDSCHIRM LOESCHEN
 5042 DDD0  CD DE1D     CLS:	CALL	SETCO
 5043 DDD3  3E 0C       	LD	A,0CH
 5044                    
 5045                   ;AUSGABE EINES ZEICHENS
 5046 DDD5  F5          CO:	PUSH	AF
 5047 DDD6  D5          	PUSH	DE
 5048 DDD7  57          	LD	D,A
 5049 DDD8  3A 0308     	LD	A,(OUTIND)	; OUT-Index
 5050 DDDB  5F          	LD	E,A
 5051 DDDC  7A          	LD	A,D
 5052 DDDD  CD DFF6     	CALL	IO
 5053 DDE0  7B          	LD	A,E
 5054 DDE1  D1          	POP	DE
 5055 DDE2  18 3C       	JR	SETCO1		; OUT-Index aktualisieren
 5056                    
 5057                   ;EINGABE EINES ZEICHENS
 5058 DDE4  D5          CI:	PUSH	DE
 5059 DDE5  3A 0309     	LD	A,(ININD)	; IN-Index
 5060 DDE8  5F          	LD	E,A
 5061 DDE9  CD DFF6     	CALL	IO
 5062 DDEC  7B          	LD	A,E
 5063 DDED  32 0309     	LD	(ININD),A	; IN-Index
 5064 DDF0  7A          	LD	A,D		; gelesenes Zeichen
 5065 DDF1  18 06       	JR	CSTS1
 5066                    
 5067                   ; Konsolen(Tastatur-)status abfragen vom CICH
 5068 DDF3  D5          CSTS:	PUSH	DE
 5069 DDF4  1E 80       	LD	E,CICH+IMRET
 5070 DDF6  CD DFF6     	CALL	IO		; Tastaturstatusabfrage
 5071 DDF9  CB 7B       CSTS1:	BIT	7,E		; Taste gedrueckt?
 5072 DDFB  D1          	POP	DE
 5073 DDFC  C9          	RET
 5074                   
 5075                   ;ALLE BENUTZTEN KANAELE SCHLIESSEN, AUSSER COIO
 5076 DDFD  F5          CLCHNL:	PUSH	AF
 5077 DDFE  E5          	PUSH	HL
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  88
BASIC   Z80

 5078 DDFF  D5          	PUSH	DE
 5079 DE00  C5          	PUSH	BC
 5080 DE01  11 0342     	LD	DE,0300H+ICH_+CLOSE
 5081 DE04  06 06       	LD	B,6
 5082 DE06  7A          	LD	A,D
 5083 DE07  21 0307     	LD	HL,IOCHNL
 5084 DE0A  CB 3E       CLCHN1:	SRL	(HL)
 5085 DE0C  DC DFF6     	CALL	C,IO
 5086 DE0F  1C          CLCHN2:	INC	E
 5087 DE10  10 F8       	DJNZ	CLCHN1
 5088 DE12  C1          	POP	BC
 5089 DE13  D1          	POP	DE
 5090 DE14  E1          	POP	HL
 5091 DE15  3E          	DEFB	3EH
 5092                   ;Setze Tastatur als Eingabekanal
 5093 DE16  F5          SETCOI:	PUSH	AF
 5094 DE17  3E 00       	LD	A,CICH		; Tastatureingabe
 5095 DE19  32 0309     	LD	(ININD),A	; IN-Index setzen
 5096 DE1C  3E          	DEFB	3EH
 5097                   ;SETZE Bildschirm als Ausgabekanal
 5098 DE1D  F5          SETCO:	PUSH	AF
 5099 DE1E  3E 01       	LD	A,COCH		; Bildschirmausgabe
 5100 DE20  32 0308     SETCO1:	LD	(OUTIND),A	; OUT-Index setzen
 5101 DE23  F1          	POP	AF
 5102 DE24  C9          	RET
 5103                   
 5104                   ;ROUTINE ZUM AKTIVIEREN DER I/O-KANAELE
 5105                   ;AUSGABE
 5106 DE25  7E          OUTCHL:	LD	A,(HL)
 5107 DE26  FE 23       	CP	'#'
 5108 DE28  20 31       	JR	NZ,TCHNL4
 5109 DE2A  CD C8BD     	CALL	TCHAR
 5110 DE2D  30 38       	JR	NC,TCHNLA
 5111 DE2F  23          	INC	HL
 5112 DE30  E5          	PUSH	HL
 5113 DE31  E6 03       	AND	3
 5114 DE33  28 12       	JR	Z,TCHNL1
 5115 DE35  21 0307     	LD	HL,IOCHNL	; E/A-Flag
 5116 DE38  87          	ADD	A,A
 5117 DE39  FE 04       	CP	OCH?-1
 5118 DE3B  28 12       	JR	Z,TCHNL2
 5119 DE3D  30 16       	JR	NC,TCHNL3
 5120 DE3F  CB 4E       	BIT	OM_,(HL)	; Bit 1
 5121 DE41  CB CE       	SET	OM_,(HL)	; Bit 1
 5122 DE43  20 02       TCHNO1:	JR	NZ,TCHNL1
 5123 DE45  C6 08       TCHNLO:	ADD	A,INIT
 5124 DE47  3C          TCHNL1:	INC	A
 5125 DE48  32 0308     	LD	(OUTIND),A	; OUT-Index
 5126 DE4B  E1          TCHNO2:	POP	HL
 5127 DE4C  C3 C8BE     TCHNO0:	JP	TCHAR1
 5128 DE4F  CB 5E       TCHNL2:	BIT	OM?,(HL)	; Bit 3
 5129 DE51  CB DE       	SET	OM?,(HL)	; Bit 3
 5130 DE53  18 EE       	JR	TCHNO1
 5131                   	;
 5132 DE55  CB 6E       TCHNL3:	BIT	OM??,(HL)	; Bit 5
 5133 DE57  CB EE       	SET	OM??,(HL)	; Bit 5
 5134 DE59  18 E8       	JR	TCHNO1
 5135                   	;
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  89
BASIC   Z80

 5136 DE5B  E5          TCHNL4:	PUSH	HL
 5137 DE5C  AF          	XOR	A
 5138 DE5D  18 E8       	JR	TCHNL1
 5139                   	
 5140                   ;EINGABE
 5141 DE5F  7E          INCHNL:	LD	A,(HL)
 5142 DE60  FE 23       	CP	'#'
 5143 DE62  20 30       	JR	NZ,TCHNL9
 5144 DE64  CD C8BD     	CALL	TCHAR
 5145 DE67  D2 C348     TCHNLA:	JP	NC,SNER
 5146 DE6A  23          	INC	HL
 5147 DE6B  E5          	PUSH	HL
 5148 DE6C  E6 03       	AND	3
 5149 DE6E  28 12       	JR	Z,TCHNL6
 5150 DE70  21 0307     	LD	HL,IOCHNL	; E/A-Flag
 5151 DE73  87          	ADD	A,A
 5152 DE74  FE 04       	CP	ICH?
 5153 DE76  28 10       	JR	Z,TCHNL7
 5154 DE78  38 14       	JR	C,TCHNL8
 5155 DE7A  CB 66       	BIT	IM??,(HL)	; Bit 4
 5156 DE7C  CB E6       	SET	IM??,(HL)	; Bit 4
 5157 DE7E  20 02       TCHNL5:	JR	NZ,TCHNL6
 5158 DE80  C6 08       	ADD	A,INIT
 5159 DE82  32 0309     TCHNL6:	LD	(ININD),A	; IN-Index
 5160 DE85  E1          	POP	HL
 5161 DE86  18 C4       	JR	TCHNO0
 5162                   	;
 5163 DE88  CB 56       TCHNL7:	BIT	IM?,(HL)	; Bit 2
 5164 DE8A  CB D6       	SET	IM?,(HL)	; Bit 2
 5165 DE8C  18 F0       	JR	TCHNL5
 5166                   	;
 5167 DE8E  CB 46       TCHNL8:	BIT	IM_,(HL)	; Bit 0
 5168 DE90  CB C6       	SET	IM_,(HL)	; Bit 0
 5169 DE92  18 EA       	JR	TCHNL5
 5170                   	;
 5171 DE94  E5          TCHNL9:	PUSH	HL
 5172 DE95  AF          	XOR	A
 5173 DE96  18 EA       	JR	TCHNL6
 5174                    
 5175                   ;ZEILENEDITOR
 5176 DE98  C5          LINEDI:	PUSH	BC
 5177 DE99  CD D82A     	CALL	NUMBO1
 5178 DE9C  E1          	POP	HL
 5179 DE9D  23          	INC	HL
 5180 DE9E  23          	INC	HL
 5181 DE9F  23          	INC	HL
 5182 DEA0  23          	INC	HL
 5183 DEA1  01 0361     	LD	BC,INPBUF
 5184 DEA4  C5          	PUSH	BC
 5185 DEA5  18 03       	JR	EDI2
 5186                   	;
 5187 DEA7  CD DED7     EDI1:	CALL	WRINPB
 5188 DEAA  7E          EDI2:	LD	A,(HL)
 5189 DEAB  23          	INC	HL
 5190 DEAC  FE 22       	CP	'"'
 5191 DEAE  28 16       	JR	Z,EDI4
 5192 DEB0  B7          	OR	A
 5193 DEB1  28 1F       	JR	Z,EDI5
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  90
BASIC   Z80

 5194 DEB3  F2 DEA7     	JP	P,EDI1
 5195 DEB6  C5          	PUSH	BC
 5196 DEB7  CD C79A     	CALL	LIST11		; Token aufloesen
 5197 DEBA  C1          	POP	BC
 5198 DEBB  CD DED7     EDI3:	CALL	WRINPB
 5199 DEBE  1A          	LD	A,(DE)
 5200 DEBF  13          	INC	DE
 5201 DEC0  B7          	OR	A
 5202 DEC1  F2 DEBB     	JP	P,EDI3
 5203 DEC4  18 E4       	JR	EDI2
 5204                   	;
 5205 DEC6  CD DED7     EDI4:	CALL	WRINPB
 5206 DEC9  7E          	LD	A,(HL)
 5207 DECA  23          	INC	HL
 5208 DECB  FE 22       	CP	'"'
 5209 DECD  28 D8       	JR	Z,EDI1
 5210 DECF  B7          	OR	A
 5211 DED0  20 F4       	JR	NZ,EDI4
 5212 DED2  3E 20       EDI5:	LD	A,' '
 5213 DED4  03          	INC	BC
 5214 DED5  18 0C       	JR	EDI6
 5215                   	;
 5216 DED7  03          WRINPB:	INC	BC
 5217 DED8  02          	LD	(BC),A
 5218 DED9  E5          	PUSH	HL
 5219 DEDA  21 FC56     	LD	HL,-EOINPB+1	; ??? Originalquelltext ohne +1
 5220                   				; Dann stimmt aber ROM-Code nicht ???
 5221 DEDD  09          	ADD	HL,BC
 5222 DEDE  E1          	POP	HL
 5223 DEDF  D0          	RET	NC
 5224 DEE0  E1          	POP	HL
 5225 DEE1  3E 2A       	LD	A,'*'
 5226 DEE3  CD DDD5     EDI6:	CALL	CO
 5227 DEE6  AF          	XOR	A
 5228 DEE7  02          	LD	(BC),A
 5229 DEE8  E1          	POP	HL
 5230 DEE9  77          	LD	(HL),A
 5231 DEEA  23          	INC	HL
 5232 DEEB  E5          EDI7:	PUSH	HL
 5233 DEEC  CD C5F1     	CALL	TEXTOE
 5234 DEEF  D1          	POP	DE
 5235 DEF0  23          	INC	HL
 5236 DEF1  36 00       	LD	(HL),0
 5237 DEF3  2B          	DEC	HL
 5238 DEF4  36 20       	LD	(HL),' '
 5239                   ;================================
 5240 DEF6  CD DDE4     EDI9:	CALL	CI
 5241 DEF9  FE 0A       	CP	CURDWN		; Cursor nach unten?
 5242 DEFB  20 05       	JR	NZ,EDIA
 5243 DEFD  CD DF12     	CALL	ZECR0
 5244 DF00  3C          	INC	A
 5245 DF01  C9          	RET
 5246                   ;--------------------------------
 5247 DF02  CD DF0F     EDIA:	CALL	ZECR
 5248 DF05  C8          	RET	Z
 5249 DF06  CD DF27     	CALL	ZSTOP
 5250 DF09  D8          	RET	C
 5251                   ;--------------------------------
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  91
BASIC   Z80

 5252 DF0A  CD DF32     	CALL	ZEEDI
 5253 DF0D  18 E7       	JR	EDI9
 5254                   ;--------------------------------
 5255 DF0F  FE 0D       ZECR:	CP	ASCCR		; CR?
 5256 DF11  C0          	RET	NZ		; nein
 5257 DF12  3E 09       ZECR0:	LD	A,CURRGT	; Cursor nach rechts
 5258 DF14  CD DDD5     	CALL	CO		; ausgeben
 5259 DF17  23          	INC	HL
 5260 DF18  7E          	LD	A,(HL)
 5261 DF19  B7          	OR	A
 5262 DF1A  20 F6       	JR	NZ,ZECR0
 5263 DF1C  2B          	DEC	HL
 5264 DF1D  7E          	LD	A,(HL)
 5265 DF1E  FE 20       	CP	' '
 5266 DF20  20 02       	JR	NZ,ZECR1
 5267 DF22  36 00       	LD	(HL),0
 5268 DF24  C3 CB5E     ZECR1:	JP	CRWDY6
 5269                   ;--------------------------------
 5270 DF27  FE 03       ZSTOP:	CP	STOPSW		; BRK-Taste?
 5271 DF29  28 02       	JR	Z,ZSTOP1	; ja
 5272 DF2B  A7          	AND	A		; CY=0
 5273 DF2C  C9          	RET
 5274                   	;
 5275 DF2D  CD DF12     ZSTOP1:	CALL	ZECR0
 5276 DF30  37          	SCF			; CY=1
 5277 DF31  C9          	RET
 5278                   ;--------------------------------
 5279                   ;Eingabe und Editiertasten auswerten:
 5280 DF32  FE 08       ZEEDI:	CP	CURLFT		; Cursor nach links?
 5281 DF34  28 44       	JR	Z,ZEDI3
 5282 DF36  FE 09       	CP	CURRGT		; Cursor nach rechts?
 5283 DF38  28 2A       	JR	Z,ZEDI4
 5284 DF3A  FE 1F       	CP	CURDEL		; DEL?
 5285 DF3C  28 47       	JR	Z,ZEDI5
 5286 DF3E  FE 19       	CP	CURLI		; Shift + Cursor links?
 5287 DF40  CA DFC5     	JP	Z,ZEDI6
 5288 DF43  FE 18       	CP	CURRE		; Shift + Cursor rechts?
 5289 DF45  CA DFCF     	JP	Z,ZEDI7
 5290 DF48  FE 02       	CP	CLLN		; Shift+DEL?
 5291 DF4A  CA DFDB     	JP	Z,ZEDI8
 5292 DF4D  FE 1A       	CP	CURSP		; INS?
 5293 DF4F  28 48       	JR	Z,ZEDI9
 5294 DF51  FE 0B       	CP	CURHIG		; Cursor nach oben?
 5295 DF53  C8          	RET	Z		; keine Reaktion
 5296 DF54  FE 0A       	CP	CURDWN		; Cursor nach unten?
 5297 DF56  C8          	RET	Z		; keine Reaktion
 5298 DF57  FE 01       	CP	1		; CLR?
 5299 DF59  C8          	RET	Z		; keine Reaktion
 5300 DF5A  FE 20       	CP	ASCSP
 5301 DF5C  30 05       	JR	NC,ZEDI42	; ASCII-Zeichen
 5302 DF5E  3F          	CCF		; CY=0
 5303 DF5F  CD DDD5     	CALL	CO		; restliche Steuerzeichen ausfuehren
 5304 DF62  C9          	RET
 5305                   ;--------------------------------
 5306 DF63  77          ZEDI42:	LD	(HL),A		; Zeichen in Puffer eintragen
 5307                   ; Cursor nach rechts
 5308 DF64  CD DDD5     ZEDI4:	CALL	CO		; Zeichen anzeigen
 5309 DF67  23          	INC	HL		; Puffer + 1
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  92
BASIC   Z80

 5310 DF68  7E          	LD	A,(HL)
 5311 DF69  B7          	OR	A		; Zeichen auf Puffer-Position?
 5312 DF6A  C0          	RET	NZ
 5313 DF6B  11 03AB     ZEDI41:	LD	DE,EOINPB
 5314 DF6E  CD C689     	CALL	CPREG
 5315 DF71  28 07       	JR	Z,ZEDI3
 5316 DF73  36 20       	LD	(HL),' '
 5317 DF75  23          	INC	HL
 5318 DF76  36 00       	LD	(HL),0
 5319 DF78  18 03       	JR	ZEDI31
 5320                   ;--------------------------------
 5321                   ; Cursor nach links:
 5322 DF7A  CD C6A2     ZEDI3:	CALL	CLFTOU	;CURLFT
 5323 DF7D  2B          ZEDI31:	DEC	HL
 5324 DF7E  7E          	LD	A,(HL)
 5325 DF7F  B7          	OR	A
 5326 DF80  C0          	RET	NZ
 5327 DF81  3E 09       ZEDI32:	LD	A,CURRGT
 5328 DF83  18 DF       	JR	ZEDI4
 5329                   ;--------------------------------
 5330 DF85  E5          ZEDI5:	PUSH	HL	;CURDEL
 5331 DF86  23          	INC	HL
 5332 DF87  CD C5F1     	CALL	TEXTOE
 5333 DF8A  CD C6A9     	CALL	SPOUT
 5334 DF8D  D1          	POP	DE
 5335 DF8E  AF          	XOR	A
 5336 DF8F  2B          ZEDI51:	DEC	HL
 5337 DF90  46          	LD	B,(HL)
 5338 DF91  77          	LD	(HL),A
 5339 DF92  CD C6A2     	CALL	CLFTOU
 5340 DF95  78          	LD	A,B
 5341 DF96  20 F7       	JR	NZ,ZEDI51
 5342 DF98  C9          	RET
 5343                   ;--------------------------------
 5344 DF99  CD C6A9     ZEDI9:	CALL	SPOUT	;CURSP
 5345 DF9C  E5          	PUSH	HL
 5346 DF9D  CD C5F1     	CALL	TEXTOE
 5347 DFA0  11 03AB     	LD	DE,EOINPB
 5348 DFA3  CD C689     	CALL	CPREG
 5349 DFA6  20 0C       	JR	NZ,ZEDI91
 5350 DFA8  CD C6A2     	CALL	CLFTOU
 5351 DFAB  CD C6A9     	CALL	SPOUT
 5352 DFAE  CD C6A2     	CALL	CLFTOU
 5353 DFB1  2B          	DEC	HL
 5354 DFB2  36 00       	LD	(HL),0
 5355 DFB4  D1          ZEDI91:	POP	DE
 5356 DFB5  44          	LD	B,H
 5357 DFB6  4D          	LD	C,L
 5358 DFB7  03          	INC	BC
 5359 DFB8  7E          ZEDI92:	LD	A,(HL)
 5360 DFB9  02          	LD	(BC),A
 5361 DFBA  0B          	DEC	BC
 5362 DFBB  CD C6A2     	CALL	CLFTOU
 5363 DFBE  2B          	DEC	HL
 5364 DFBF  20 F7       	JR	NZ,ZEDI92
 5365 DFC1  23          	INC	HL
 5366 DFC2  36 20       	LD	(HL),' '
 5367 DFC4  C9          	RET
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  93
BASIC   Z80

 5368                   ;--------------------------------
 5369 DFC5  CD C6A2     ZEDI6:	CALL	CLFTOU	;CURLI
 5370 DFC8  2B          	DEC	HL
 5371 DFC9  7E          	LD	A,(HL)
 5372 DFCA  B7          	OR	A
 5373 DFCB  20 F8       	JR	NZ,ZEDI6
 5374 DFCD  18 B2       	JR	ZEDI32
 5375                   ;--------------------------------
 5376 DFCF  3E 09       ZEDI7:	LD	A,CURRGT	;CURRE
 5377 DFD1  CD DDD5     	CALL	CO
 5378 DFD4  23          	INC	HL
 5379 DFD5  7E          	LD	A,(HL)
 5380 DFD6  B7          	OR	A
 5381 DFD7  20 F6       	JR	NZ,ZEDI7
 5382 DFD9  18 90       	JR	ZEDI41
 5383                   ;--------------------------------
 5384 DFDB  CD DFC5     ZEDI8:	CALL	ZEDI6	;CLLN
 5385 DFDE  E5          	PUSH	HL
 5386 DFDF  7E          ZEDI82:	LD	A,(HL)
 5387 DFE0  B7          	OR	A
 5388 DFE1  28 05       	JR	Z,ZEDI81
 5389 DFE3  36 20       	LD	(HL),' '
 5390 DFE5  23          	INC	HL
 5391 DFE6  18 F7       	JR	ZEDI82
 5392                   	;
 5393 DFE8  E1          ZEDI81:	POP	HL
 5394 DFE9  CD C5F1     	CALL	TEXTOE
 5395 DFEC  CD DFC5     	CALL	ZEDI6
 5396 DFEF  23          	INC	HL
 5397 DFF0  36 00       	LD	(HL),0
 5398 DFF2  2B          	DEC	HL
 5399 DFF3  C9          	RET
 5400                   ;=================================
 5401                   ;
 5402                   ;Ruecksprung ins uebergeordnete System
 5403 DFF4  1E FF       MONI:	LD	E,MONIT		; Bit 5=1, d.h. Ruecksprung zu CAOS
 5404 DFF6  C3 E00E     IO:	JP	VERT
 5405                   
 5406                   ; 24.01.2021:
 5407                   ; Patch fuer LIST - Ende der Token-Tabelle abfragen
 5408                   
 5409 DFF9  1A          patch:	LD	A,(DE)		; Token-Tabelle lesen
 5410 DFFA  FE 80       	cp	80h		; Ende der Tabelle
 5411 DFFC  C0          	ret	nz		; nein
 5412 DFFD  C1          	pop	bc		; Stack clear
 5413 DFFE  AF          	xor	a		; nichts tun
 5414 DFFF  C9          	ret			; und Abbruch 
 5415                   
 5416                   ;*************************Programmende*********
 5417                   
 5418 E000              ENDX:	
 5419         0000      IF	ENDX LT 0E000H
 5421                   ENDIF
 5422 E000              ROMEND:
 5423                   	.DEPHASE
 5424                   	END
HC-BASIC ROM-Version 07.01.1987 					    SLR180 1.31 Page  94


 0 Error(s) Detected.
 8320 Absolute Bytes. 869 Symbols Detected.
	LD	E,MONIT		; Bit 5=1, d.h. Ruecksprung zu CAOS
 5404 DFF6  C3 E00E     IO:	JP	VERT
 5405                   
 54