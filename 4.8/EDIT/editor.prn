SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   1
EDITOR  Z80

    1                   ;-----------------------------------------------------------------------;
    2                   ;	80-Zeichen Text-Editor fuer CAOS - Version 0.5			;
    3                   ;	----------------------------------------------			;
    4                   ;	05.02.2018: EDIT 0.1 veroeffentlicht mit CAOS 4.7 beta5		;
    5                   ;	03.04.2018: EDIT 0.2 veroeffentlicht mit CAOS 4.7 beta6		;
    6                   ;	04.12.2018: EDIT 0.3 veroeffentlicht mit CAOS 4.7 beta7		;
    7                   ;	04.10.2019: EDIT 0.4 veroeffentliche mit CAOS 4.7 final		;
    8                   ;	07.08.2022: EDIT 0.5 veroeffentlicht mit CAOS 4.8 Patch 2	;
    9                   ;									;
   10                   ;				(c) ML-Soft 11.03.2017 - 07.08.2022	;
   11                   ;-----------------------------------------------------------------------;
   12                   ;
   13                   ; - Editor aehnlich EDAS (auch von ASM mit genutzt, gleiche Arbeitszellen!)
   14                   ; - 80-Zeichen-Modus aehnlich ZAS: 25 Zeilen => 2000 Zeichen / Bildschirm
   15                   ; - Zeile 1 = Statuszeile, Zeile 2 = Lineal, 23 Zeilen Text
   16                   ;	Zeichengroesse 4x10 Pixel (wie ZAS)
   17                   ;	Video-RAM von AD00h bis B4D0h (unabhaengig vom Bild)
   18                   ;	IRM von B4D0h bis B6FFh teilweise als Arbeitszellen benutzt!
   19                   ; - Menue zum Laden, Speichern, Blockfunktionen ...
   20                   ; - Laden von ASCII- und WordPro6-Dateien
   21                   ; - Importfilter nachladbar fuer TEXOR, WordPro'86, WordPro9 ...
   22                   ; Textspeicher 0200h bis BFFFh (oder bis DFFFh wenn RAM-Modul auf C000h steckt)
   23                   ;
   24                   ; Der Text liegt immer geteilt vor, Teiltext 1 - Bildschirminhalt - Teiltext 2
   25                   ;
   26                   ; Editieren erfolgt auf dem angezeigten Bildschirm. Nur beim Scrollen wird der
   27                   ; Text gespeichert und dann neu angezeigt. Dabei wird beruecksichtigt, was
   28                   ; bereits auf dem Bildschirm angezeigt ist - geht schneller
   29                   ;
   30                   ; Sonderfunktionen durch ESC-Aufrufe
   31                   ;-------------------------------------------------------------------------------
   32                   	.Z80
   33                   
   34         0001      EXRAM	EQU	1		; RAM zur Textspeichererweiterung verwenden
   35                   
   36                   	INCLUDE	CAOS48.INC	; CAOS-Vereinbarungen
    1                   ;-----------------------------------------------;
    2                   ;	CAOS-Vereinbarungen (bis CAOS 4.8)	;
    3                   ;	---------------------------------	;
    4                   ;						;
    5                   ; als INCLUDE fuer ASM-Quelltexte		;
    6                   ;						;
    7                   ; CAOS48.INC	ML-Soft 08.01.1994-30.05.2021	;
    8                   ;-----------------------------------------------;
    9                   
   10                   ; Portadressen im Grundgeraet:
   11                   
   12         0084      PORT1	EQU	84H	; Ausgabe-Port D08A	Merkzelle ist (IX+1)
   13                   			;	Bit 0 - Anzeige Bild 0 oder 1
   14                   			;	Bit 1 - Zugriff auf 0=Pixel- oder 1=Farbebene
   15                   			;	Bit 2 - Zugriff auf Bild 0 oder 1
   16                   			;	Bit 3 - 0=hohe Farbaufloesung oder 1=niedrige
   17                   			;	Bit 4-7 Auswahl der RAM8-Ebene (256K)
   18         0086      PORT2	EQU	86H	; Ausgabe-Port D09A	Merkzelle ist (IX+4)
   19                   			;	Bit 0 - RAM4 ein/aus
   20                   			;	Bit 1 - RAM4 Schreibschutz (1=aus)
   21                   			;	Bit 2-4 Bankauswahl fuer 2MB RAM On Board
   22                   			;	Bit 5-6 Auswahl der USER-ROM-Ebene
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   2
CAOS48  INC

   23                   			;	Bit 7 - CAOS-ROM C ein/aus
   24         0088      PIOAD	EQU	88H	; System-PIO Datenbyte Port A
   25                   			;	Bit 0 - CAOS ROM-E ein/aus
   26                   			;	Bit 1 - RAM0 ein/aus
   27                   			;	Bit 2 - IRM ein/aus
   28                   			;	Bit 3 - Schreibschutz RAM0
   29                   			;	Bit 4 - K_OUT
   30                   			;	Bit 5 - System-LED
   31                   			;	Bit 6 - Motorschaltspannung
   32                   			;	Bit 7 - USER-ROM ein/aus
   33         0089      PIOBD	EQU	89H	; System-PIO Datenbyte Port B
   34                   			;	Bit 0 - Symmetrie-Flip-Flop Tonausgabe
   35                   			;	Bit 1 \
   36                   			;	Bit 2 - Lautstaerke Tonausgabe
   37                   			;	Bit 3 - 4 Bit (Low-aktiv)
   38                   			;	Bit 4 /
   39                   			;	Bit 5 - RAM8 ein/aus
   40                   			;	Bit 6 - Schreibschutz RAM8
   41                   			;	Bit 7 - Blinken ein/aus
   42         008A      PIOAS	EQU	8AH	; System-PIO Steuerbyte Port A
   43         008B      PIOBS	EQU	8BH	; System-PIO Steuerbyte Port B
   44         008C      CTC0	EQU	8CH	; CTC Kanal 0 (Tonhoehe 1)
   45         008D      CTC1	EQU	8DH	; CTC Kanal 1 (Kassettenausgabe)
   46         008E      CTC2	EQU	8EH	; CTC Kanal 2 (Tondauer)
   47         008F      CTC3	EQU	8FH	; CTC Kanal 3 (Tastatur)
   48                   
   49                   ; Portadressen des Koppel-RAM (D004):
   50                   
   51         00F1      ERRTX	EQU	000F1H	; Fehlertext			(ab DEP 2.0)
   52         80F1      STBYT2	EQU	080F1H	; 2. Steuerbyte:		(ab DEP 2.0)
   53                   			;	Bit 0 - Anforderung
   54                   			;	Bit 1 - Laufwerkswechsel
   55                   			;	Bit 2 - Userwechsel
   56                   			;	Bit 3..6 reserviert
   57                   			;	Bit 7 - Fehlerrueckmeldung
   58         81F1      LWANF	EQU	081F1H	; Laufwerk ('A', 'B', ... 'P')
   59         82F1      UANF	EQU	082F1H	; User-Bereich (00H ... 1FH)	(ab DEP 3.5 bis 31)
   60         83F1      DEPVER	EQU	083F1H	; DEP-Version BCD
   61         84F1      DATE	EQU	084F1H	; Datum BCD			(ab DEP 3.0)
   62                   			;	Jahr (00..99)
   63                   			;	Monat (1..12)
   64                   			;	Tag (1..31)
   65         87F1      TIME	EQU	087F1H	; Uhrzeit BCD			(ab DEP 3.0)
   66                   			;	Stunde (0..23)
   67                   			;	Minute (0..59)
   68                   			;	Sekunde (0..59)
   69                   
   70         80F2      FDATA	EQU	080F2H	; Daten- bzw. Sektorpuffer 128 Byte lang
   71         80F3      STBYT1	EQU	080F3H	; 1. Steuerbyte:
   72                   			;	Bit 0 - Anforderung
   73                   			;	Bit 1 - 1=schreiben/0=lesen
   74                   			;	Bit 3 - oeffnen
   75                   			;	Bit 6 - schliessen
   76                   			;	Bit 7 - Fehlerrueckmeldung
   77                   			;	Bit	5 4 2	Funktionsauswahl:
   78                   			;		0 0 0	Sektor lesen/schreiben
   79                   			;		0 0 1	DIR-Anforderung
   80                   			;		0 1 0	ERA
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   3
CAOS48  INC

   81                   			;		0 1 1	STAT
   82                   			;		1 0 0	REN
   83                   			;		1 0 1	SETRO
   84                   			;		1 1 0	SETWR
   85                   			;		1 1 1	BASIC-Byte lesen/schreiben
   86         81F3      FCODE	EQU	081F3H	; Fehlercode
   87         82F3      DIRBUF	EQU	082F3H	; Puffer fuer Dateiname oder Directory
   88         8EF3      BASBYT	EQU	08EF3H	; Datenbyte fuer BASIC-Byte-Schnittstelle
   89         B3F3      UROK	EQU	0B3F3H	; Betriebsart	0 = Anfangswert
   90                   			;		1 = CP/M-System lauft
   91                   			;		2 = Not ready
   92                   			;		3 = Can't read
   93                   			;		4 = No system
   94                   			;		5 = CAOS-Betriebsart / DEP laeuft
   95                   
   96                   ; RAM0-Arbeitszellen:
   97                   
   98         01F0      SIX	EQU	1F0H	; CAOS-Belegung IX-Register
   99                   
  100                   ; Belegung der IX - Zellen:
  101                   
  102                   ; IX+0	Zeitkonstante fuer Kassettenroutinen
  103                   ; IX+1	Merkzelle fuer Ausgabeport 84H
  104                   ; IX+2	gelesene Blocknummer (Kassette)
  105                   ; IX+3	erwartete Blocknummer (Kassette)
  106                   ; IX+4	Merkzelle fuer Ausgabeport 86H
  107                   ; IX+5	Ein- Ausgabepufferadresse (low)
  108                   ; IX+6	Ein- Ausgabepufferadresse (high)
  109                   ; IX+7	Kennbyte fuer LOAD/VERIFY
  110                   ;	 BIT 0: =1 ->LOAD  =0 ->VERIFY
  111                   ;	 BIT 1: =1 kein Selbstart bei LOAD (in BASIC Kennung fuer 1. Block)
  112                   ;	 BIT 2-4 : Anzahl Argumente (bei SAVE)/ARGN>3 (Startoffset)
  113                   ;	 BIT 5-7 : BASIC: fuer CLOAD/CSAVE 
  114                   ; IX+8	Kennbyte Tastatur
  115                   ;	 BIT 0: gueltiges Byte (ASCII) in IX+13
  116                   ;	 BIT 1: Tonausgabe laeuft
  117                   ;	 BIT 2-4: aktuelles Speichergeraet
  118                   ;		  0=Kassette, 1=Diskette, 2=USB (M052), 3=Netzwerk (M052)
  119                   ;		  4=Headersave, 5..7 frei
  120                   ;	 BIT 5: Tastenclick ein/aus
  121                   ;	 BIT 6: Code kommt von F-Taste
  122                   ;	 BIT 7: 0=Shiftlock
  123                   ; IX+9	Prologbyte (normal 7FH)
  124                   ; IX+10	Autorepeatzaehler (Tastatur)
  125                   ; IX+11	Merkzelle fuer Akku (bei BWS on/off mit Stackverlagerung)
  126                   ;	und Pruefsummenberechnung fuer MB-Eingabe
  127                   ; IX+12	7-Bit-Scancode von Tastatur
  128                   ; IX+13	ASCII-Code von Tastatur
  129                   ; IX+14	Tastaturcodetabelle low
  130                   ; IX+15	Tastaturcodetabelle high
  131                   
  132                   ; IRM-Arbeitszellen:
  133                   
  134         A800      V24PL	EQU	0A800H	; Steckplatz V.24-Modul				  1 Byte
  135                   ;INTV1		0A801H	; Initialisierungsdaten V.24-Druckausgabe	  8 Byte
  136                   ;INTV2		0A809H	; Initialisierungsdaten V.24-duplex		  9 Byte
  137                   	; bis	0A811H
  138                   ;		0A820H	; urspruenglich geplant fuer Arbeitszellen Maustreiber
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   4
CAOS48  INC

  139                   	; bis	0A87FH	; frei					       (96 Byte)
  140                   
  141         A880      INITU	EQU	0A880h	; Kommandoablage von INITIAL.UUU als Tastencode
  142                   	; bis	0A8FFh	; und Assemblierpuffer von EDAS/ASM
  143                   
  144         A900      DEVTAB	EQU	0A900H	; Tabelle der 8 Geraetetreiber: 8*32=256 Byte gross
  145         AA00      SULEN	EQU	0AA00H	; letzte benutzte UP-Nr. in SUTAB
  146         AA01      SUT_IRM	EQU	0AA01H	; SUTAB per Default im IRM
  147                   	; bis	0AA94h	fuer UP 00 bis 49h				148 Byte
  148                   ;		0AA95H	reserviert fuer kuenftige CAOS-Erweiterungen
  149                   	; bis	0AABEH	z.B. CAOS-UP's 4Ah bis 5Eh			 42 Byte
  150                   ; 1 Byte frei
  151         AAC0      JOYIRM	EQU	0AAC0H	; Joystick-Tabelle (noch nicht endgueltig)
  152                   	; bis	0AACBh							 12 Byte
  153                   
  154         AACC      JWORK	EQU	0AACCH	; Arbeitszellen vom Joystick-Editor
  155                   	; bis	0AADCH							 17 Byte
  156                   
  157         AADD      WIN2	EQU	0AADDH	; Schattenspeicher fuer WINNR bis WEND (Bildwechsel)
  158                   	; bis	0AAE7	; 30.09.2020 neu definiert			 11 Byte
  159                   
  160         AAE8      WTEMO	EQU	0AAE8H	; TEMO-Arbeitszellen zur Ablage von 2 Fenster-Daten
  161                   	; bis	0AAFFH							 24 Byte
  162                   
  163                   ;		0AB00H	; reserviert fuer anwenderspez. Systemerweiterungen
  164                   	; bis	0ACFFH	; z.B. Treiber UOUT1/2 oder UIN1/2		512 Byte
  165                   
  166         AD00      VRAM1	EQU	0AD00H	; ASCII-RAM Bild 1
  167                   	; bis	0B1FFH
  168         B200      VRAM0	EQU	0B200H	; ASCII-RAM Bild 0
  169                   	; bis	0B6FFh
  170         B700      CASS	EQU	0B700H	; 128 Byte Kassettenpuffer (bis	0B77FH)
  171         B780      ARGC	EQU	0B780H	; UP-Nummer fuer PV2 und PV6
  172         B781      ARGN	EQU	0B781H	; Anzahl Argumente
  173         B782      ARG1	EQU	0B782H	; Argument 1
  174         B784      ARG2	EQU	0B784H	;    "	   2
  175         B786      ARG3	EQU	0B786H	;    "	   3
  176         B788      ARG4	EQU	0B788H	;    "	   4
  177         B78A      ARG5	EQU	0B78AH	;    "	   5
  178         B78C      ARG6	EQU	0B78CH	;    "	   6
  179         B78E      ARG7	EQU	0B78EH	;    "	   7
  180         B790      ARG8	EQU	0B790H	;    "	   8
  181         B792      ARG9	EQU	0B792H	;    "	   9
  182         B794      ARG10	EQU	0B794H	;    "	  10
  183         B796      NUMNX	EQU	0B796H	; Anzahl Zeichen einer Hex-Zahl
  184         B797      NUMVX	EQU	0B797H	; Wert HEX-Zahl
  185         B799      HCADR	EQU	0B799H	; Hardcopy-Aufruf
  186         B79B      WINNR	EQU	0B79BH	; Nr. des aktuellen Bildschirmfensters
  187         B79C      WINON	EQU	0B79CH	; Fenster-Anfang
  188         B79E      WINLG	EQU	0B79EH	; Fenster-Groesse
  189         B7A0      CURSO	EQU	0B7A0H	; Cursor-Position
  190         B7A2      STBT	EQU	0B7A2H	; Bildschirm-Steuerbyte
  191                   		; Bit 0 = 1 Schreiben Pixel-IRM AUS
  192                   		; Bit 1 = 1 Schreiben Color-IRM AUS
  193                   		; Bit 2 = 1 Inversdarstellung EIN (ab CAOS 3.4)
  194                   		; Bit 3 = 1 Steuercode als Zeichen darstellen
  195                   		; Bit 4 = 1 ESC aktiv (ab CAOS 4.1)
  196                   		; Bit 5 = 1 IBM-Zeichensatz EIN (ab CAOS 4.3)
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   5
CAOS48  INC

  197                   		; Bit 6 = 1 HRG-Modus EIN (ab CAOS 4.3)
  198                   		; Bit 7 = 1 2-Monitor-Modus aktiv (ab CAOS 4.8)
  199         B7A3      COLOR	EQU	0B7A3H	; Farbe
  200         B7A4      WEND	EQU	0B7A4H	; Reaktionsprogramm auf Bildschirmende
  201         B7A6      CCTL0	EQU	0B7A6H	; Zeichentabelle 0 20H...5FH
  202         B7A8      CCTL1	EQU	0B7A8H	;	"	 1 00H...1FH und 60H...7FH
  203         B7AA      CCTL2	EQU	0B7AAH	;	"	 2 A0H...DFH
  204         B7AC      CCTL3	EQU	0B7ACH	;	"	 3 80H...9FH und E0H...FFH
  205         B7AE      SYSP	EQU	0B7AEH	; System Stackpointer
  206         B7B0      SUTAB	EQU	0B7B0H	; Adresse der Unterprogrammtabelle
  207         B7B2      CTAB	EQU	0B7B2H	; CRT-Steuerprogramm-Tabelle
  208         B7B4      NCAOS	EQU	0B7B4H	; Sprung in neues System ueber IRM
  209         B7B9      OUTAB	EQU	0B7B9H	; Adresse fuer Zeiger auf UP-Nr. bei Ausgabe
  210         B7BB      INTAB	EQU	0B7BBH	; Adresse fuer Zeiger auf UP-Nr. bei Eingabe
  211         B7BD      UOUT1	EQU	0B7BDH	; Sprung zu USER-Ausgabekanal 2 (Drucker)
  212         B7C0      UIN1	EQU	0B7C0H	; Sprung zu USER-Eingabekanal 2
  213         B7C3      UOUT2	EQU	0B7C3H	; Sprung zu USER-Ausgabekanal 3 V.24-duplex
  214         B7C6      UIN2	EQU	0B7C6H	; Sprung zu USER-Eingabekanal 3 V.24-duplex
  215         B7C9      IOERR	EQU	0B7C9H	; Reaktionsprogramm fuer BASIC I/O-Error bis CAOS 4.7
  216         B7CB      VRAM	EQU	0B7CBH	; VRAM-Adresse des eingestellten Bildes
  217         B7CD      ZOTAB	EQU	0B7CDH	; Zwischenspeicher fuer OUTAB
  218         B7CF      ZWEND	EQU	0B7CFH	; Zwischenspeicher fuer WEND
  219         B7D1      FTAST	EQU	0B7D1H	; F-Tastenpointer
  220         B7D3      HOR	EQU	0B7D3H	; Grafik Horizontalposition (X-Wert)
  221         B7D5      VERT	EQU	0B7D5H	; Grafik Vertikalposition (Y-Wert)
  222         B7D6      FARB	EQU	0B7D6H	; Grafik Farbe
  223                   		; Bit 0=1	XOR-Funktion
  224                   		; Bit 1=1	Punkt loeschen
  225                   		; Bit 2=1	Farbebene nicht veraendern
  226                   		; Bit 3-7	Vordergrundfarbe + Blinken
  227         B7D7      MIXIT	EQU	0B7D7H	; IX-Merker (H-Teil von IX und I-Tabelle)
  228         B7D8      VORTN	EQU	0B7D8H	; Vortonlaenge fuer byteweise Kassettenausgabe
  229         B7DA      DTPTR	EQU	0B7DAH	; CASS-Pointer (Zeiger in Kassettenpuffer)
  230         B7DB      CTCMD	EQU	0B7DBH	; CTC2-Modus
  231         B7DC      BLINK	EQU	0B7DCH	; Blinkfrequenz
  232         B7DD      L3TAB	EQU	0B7DDH	; Adresse der ESC-Steuerfunktionstabelle
  233         B7DF      L3SIZ	EQU	0B7DFH	; Anzahl der ESC-Steuerfunktionenn
  234         B7E0      COUNT	EQU	0B7E0H	; Zeiteinheiten fuer 1. Autorepeat (Tastatur)
  235         B7E1      HCPZ	EQU	0B7E1H	; Steuerbyte Druckerausgabe
  236                   		; Bit 0=0	Protokollfunktion
  237                   		; Bit 0=1	Hardcopyfunktion
  238                   		; Bit 1=0/1	USER I/O-Kanal 1/2
  239                   		; Bit 2=0/1	SIO-Kanal A oder B
  240                   		; Bit 3		-
  241                   		; Bit 4..7	Druckertyp (0 bis F)
  242                   		; Bit 7=0	Matrixdrucker
  243                   		; Bit 7=1	Schreibmaschine
  244         B7E2      INTV1	EQU	0B7E2H	; Adresse V.24-Init-Tabelle fuer Druckerausgabe
  245         B7E4      INTV1L	EQU	0B7E4H	; Laenge V.24-Initialisierungtabelle
  246         B7E5      INTV2	EQU	0B7E5H	; Adresse V.24-Init-Tabelle fuer Duplexroutine
  247         B7E7      INTV2L	EQU	0B7E7H	; Laenge V.24-Initialisierungstabelle
  248         B7E8      HCPZ2	EQU	0B7E8H	; Steuerbyte Duplexroutine
  249                   		; Bit 0		-
  250                   		; Bit 1=0/1	USER I/O-Kanal 1/2
  251                   		; Bit 2=0/1	SIO-Kanal A oder B
  252                   		; Bit 3		WR5 Bit 3: Senden ein/aus
  253                   		; Bit 4		-
  254                   		; Bit 5,6	WR5 Bit 5,6: 5-8 Bit pro Zeichen (Senden)
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   6
CAOS48  INC

  255                   		; Bit 7		WR3 Bit 7: 7/8 Bit pro Zeichen (Empfang)
  256         B7E9      OFILT	EQU	0B7E9H	; Sprung zu Druckroutine (ungefiltert)
  257         B7EC      PROMPT	EQU	0B7ECH	; Systemprompt
  258         B7ED      LINTYP	EQU	0B7EDH	; Linientyp
  259         B7EE      CUMUST	EQU	0B7EEH	; Zeiger zu Cursormuster
  260         B7F0      JOYTAB	EQU	0B7F0H	; Zeiger zu Joystick-Tastencodes
  261         B800      MODST	EQU	0B800H	; Modulsteuerbytespeicher (bis B8FFH)
  262         B900      FTASTE	EQU	0B900H	; Funktionstastenspeicher (bis B99BH)
  263         B99C      WNDFN	EQU	0B99CH	; Fenstersvektorpeicher (bis B9FFH)
  264                   
  265                   ; Sprungadressen:
  266                   
  267         E000      RESET	EQU	0E000H	; Einsprungadresse bei "RESET"
  268         EDFF      CAOSNR	EQU	0EDFFH	; Versionsnummer von CAOS
  269         F000      PWRON	EQU	0F000H	; Einsprungadresse bei "POWER ON"
  270         F003      PV1	EQU	0F003H	; Programmverteiler 1
  271         F006      PV2	EQU	0F006H	; Programmverteiler 2
  272         F008      ZEI2	EQU	0F008H	; Zeiger auf 2 = UOUT1 ab CAOS 4.7
  273         F009      PV3	EQU	0F009H	; Programmverteiler 3
  274         F00B      ZEI3	EQU	0F00BH	; Zeiger auf 3 = UOUT2 ab CAOS 4.7
  275         F00C      PV4	EQU	0F00CH	; Programmverteiler 4
  276         F00F      UREL	EQU	0F00FH	; Relativer UP-Aufruf
  277         F012      JMPADR	EQU	0F012H	; Einsprungadresse "JUMP"
  278         F015      PV5	EQU	0F015H	; Programmverteiler 5
  279         F018      IRMON	EQU	0F018H	; IRM einschalten
  280         F01B      IRMOF	EQU	0F01BH	; IRM abschalten
  281         F01E      PV6	EQU	0F01EH	; Programmverteiler 6
  282         F021      PV7	EQU	0F021H	; Programmverteiler fuer Treiberaufrufe
  283                   			; (bis CAOS 4.5 Floppy-Treiber wie SERVICE.KCC)
  284         FDF8      BITTAB	EQU	0FDF8H	; Bittabelle
  285                   
  286                   ; Bildschirm-Steuerzeichen:
  287                   
  288         0009      TAB	EQU	09H	; Tabulator
  289         000A      LF	EQU	0AH	; Zeilenvorschub
  290         000C      CLS	EQU	0CH	; Bildschirm loeschen
  291         000D      CR	EQU	0DH	; zum Zeilenanfang
  292         001B      ESC	EQU	1BH	; Steuerzeichen
  293                   
  294                   ; CAOS-Unterprogramme:
  295                   
  296         0000      CRT	EQU	00H	; Zeichenausgabe auf Bildschirm
  297         0001      MBO	EQU	01H	; Ausgabe Datenblock auf Kassette
  298         0002      UOT1	EQU	02H	; Ausgabe auf Anwenderkanal 1
  299         0003      UOT2	EQU	03H	; Ausgabe auf Anwenderkanal 2
  300         0004      KBD	EQU	04H	; Tastatureingebe mit Cursoreinblendung
  301         0005      MBI	EQU	05H	; Datenblock von Kassette einlesen
  302         0006      USIN1	EQU	06H	; Eingabe von Anwenderkanal 1
  303         0007      USIN2	EQU	07H	; Eingabe von Anwenderkanal 2
  304         0008      ISRO	EQU	08H	; Ausgabe 1. Block auf Kassette
  305         0009      CSRO	EQU	09H	; Ausgabe letzten Block auf Kassette
  306         000A      ISRI	EQU	0AH	; Einlesen 1. Block von Kassette
  307         000B      CSRI	EQU	0BH	; Abschluss Magnetbandeingabe
  308         000C      KBDS	EQU	0CH	; Tastenstatusabfrage ohne Quittung
  309         000D      BYE	EQU	0DH	; Sprung zu RESET (Warmstart)
  310         000E      KBDZ	EQU	0EH	; Tastenstatusabfrage mit Quittung
  311         000F      COLORUP	EQU	0FH	; Farbe einstellen
  312         0010      LOAD	EQU	10H	; Einlesen MC-Programm von Kassette
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   7
CAOS48  INC

  313         0011      VERIF	EQU	11H	; Ueberpruefung von Kassettenaufzeichnungen
  314         0012      LOOP	EQU	12H	; Ruecksprung zu CAOS-Menueschleife
  315         0013      NORM	EQU	13H	; Rueckschalten Ein-/Ausgabe auf CRT und KBD
  316         0014      WAIT	EQU	14H	; Warteschleife
  317         0015      LARG	EQU	15H	; Register mit Argumenten laden
  318         0016      INTB	EQU	16H	; Eingabe vom aktuellen Eingabekanal
  319         0017      INLIN	EQU	17H	; Eingabe einer Zeile
  320         0018      RHEX	EQU	18H	; Erfassung HEX-Zahl aus Zeichenkette
  321         0019      ERRM	EQU	19H	; Fehlermeldung "ERROR"
  322         001A      HLHX	EQU	1AH	; Ausgabe des Wertes von HL als HEX-Zahl
  323         001B      HLDE	EQU	1BH	; Ausgabe der Werte von HL und DE als HEX-Zahlen
  324         001C      AHEX	EQU	1CH	; Ausgabe des Wertes von A als HEX-Zahl
  325         001D      ZSUCH	EQU	1DH	; Suche nach Zeichenkette (Menuewort)
  326         001E      SOUT	EQU	1EH	; Zeiger auf Ausgabetabelle setzen
  327         001F      SIN	EQU	1FH	; Zeiger auf Eingabetabelle setzen
  328         0020      NOUT	EQU	20H	; Zeiger auf Normalausgabe (CRT) setzen
  329         0021      NIN	EQU	21H	; Zeiger auf Normaleingabe (KBD) setzen
  330         0022      GARG	EQU	22H	; Erfassen von max. 10 HEX-Zahlen
  331         0023      OSTR	EQU	23H	; Ausgabe folgender Zeichenkette
  332         0024      OCHR	EQU	24H	; Zeichenausgabe ueber Ausgabetabelle
  333         0025      CUCP	EQU	25H	; Cursor komplementieren
  334         0026      MODU	EQU	26H	; Modulsteuerung
  335         0027      JUMP	EQU	27H	; Neues Betriebssystem anspringen
  336         0028      LDMA	EQU	28H	; Speicher (IRM) schreiben
  337         0029      LDAM	EQU	29H	; Speicher (IRM) lesen
  338         002A      BRKT	EQU	2AH	; Test BRK-Taste
  339         002B      SPACE	EQU	2BH	; Ausgabe Leerzeichen
  340         002C      CRLF	EQU	2CH	; Ausgabe CR und LF
  341         002D      HOME	EQU	2DH	; Ausgabe HOME
  342         002E      MODI	EQU	2EH	; Systemkommando "MODIFY"
  343         002F      PUDE	EQU	2FH	; Punkt loeschen
  344         0030      PUSE	EQU	30H	; Punkt setzen
  345         0031      SIXD	EQU	31H	; Verlagerung IX-Arbeitsbereich von CAOS
  346         0032      DABR	EQU	32H	; Berechnung VRAM-Adresse
  347         0033      TCIF	EQU	33H	; Test, ob Cursorposition im Fenster
  348         0034      PADR	EQU	34H	; Berechnen Pixel- und Farbadresse
  349         0035      TON	EQU	35H	; Tonausgabe
  350         0036      SAVE	EQU	36H	; Ausgabe MC-Programm auf Kassette
  351         0037      MBIN	EQU	37H	; Byteweise Eingabe von Kassette
  352         0038      MBOUT	EQU	38H	; Byteweise Ausgabe auf Kassette
  353         0039      KEY	EQU	39H	; Belegen einer F-Taste
  354         003A      KEYLI	EQU	3AH	; Anzeige F-Tastenbelegung
  355         003B      DISP	EQU	3BH	; Systemkommando "DISPLAY"
  356         003C      WININ	EQU	3CH	; Fenster initialisieren
  357         003D      WINAK	EQU	3DH	; Fenster ueber Nummer aufrufen
  358         003E      LINE	EQU	3EH	; Linie zeichnen
  359         003F      CIRCLE	EQU	3FH	; Kreis zeichnen
  360         0040      SQR	EQU	40H	; Quadratwurzel berechnen
  361         0041      MULT	EQU	41H	; Multiplikation
  362         0042      CSTBT	EQU	42H	; Bildschirmanzeige Steuerzeichensymbol
  363         0043      INIEA	EQU	43H	; Initialisierung E/A-Kanal
  364         0044      INIME	EQU	44H	; Initialisierung mehrerer E/A-Kanaele
  365         0045      ZKOUT	EQU	45H	; Ausgabe Zeichenkette
  366         0046      MENU	EQU	46H	; aktuelles Menue ausschreiben
  367         0047      V24OUT	EQU	47H	; Initialisierung Druckerausgabe
  368         0048      V24DUP	EQU	48H	; Initialisierung V.24-Duplexroutine
  369         0049      DEVICE	EQU	49H	; DEVICE-Funktionen ab CAOS 4.6
  370         004A      HLDEZ	EQU	4AH	; HL dezimal anzeigen ab CAOS 4.8
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   8
CAOS48  INC

  371         004B      RDEZ	EQU	4BH	; Erfassung Dezimalzahl aus Zeichenkette ab CAOS 4.8
  372         004C      GARGC	EQU	4CH	; bis zu 10 Argumente mit variabler Zahlenbasis erfassen
  373                   
  374                   ; allgemeine Macros:
  375                   
  376                   MESSAGE	MACRO	MSG1,N,MSG2
  377                   	 .PRINTX MSG1 N MSG2
  378                   	ENDM
  379                   
  380                   ; Mit FF auffuellen, bis die absolute Adresse LOC erreicht ist:
  381                   ABSFILL	MACRO	LOC,WHAT
  382                   	 IF $ GT LOC
  383                   	  MESSAGE <Fehler! LOC:>,% $ - LOC,<Byte zu viel vor WHAT>
  384                   	 ELSE
  385                   	  IF2
  386                   	   MESSAGE <LOC:>,% LOC - $,<Byte frei vor WHAT>
  387                   	  ENDIF
  388                   	  DS	LOC - $,0FFh
  389                   	 ENDIF
  390                   	ENDM
  391                   
  392                   ; end of include
   37                   	INCLUDE EDAS.INC	; EDAS-Arbeitszellen (auch fuer Editor)
    1                   ;-------------------------------------------------------;
    2                   ;	EDAS Arbeitszellen (fuer EDAS 1.7 / 2.0)	;
    3                   ;	----------------------------------------	;
    4                   ;	(und CAOS-Editor, Assembler und Reassembler)	;
    5                   ;							;
    6                   ; EDAS.INC		ML-Soft 21.01.2018-04.03.2020	;
    7                   ;-------------------------------------------------------;
    8                   
    9         0000      NAME0	EQU	0000H		; Dateiname 8 Zeichen, Typ 3 Zeichen
   10                   ;MODE	EQU	000Bh		; M052: 1 Byte fuer Interrupt-Mode USB
   11                   ;DATUM	EQU	000Ch		; M052: 4 Byte fuer Datum
   12                   
   13         B7F5      NAMP	EQU	0B7F5h		; Namenspuffer der geladenen (Quell-)Textdatei
   14                   				; 11 Zeichen bis 0B7FFh
   15                   
   16         0010      RANDL	EQU	0010h		; Position linker Rand
   17         0011      RANDR	EQU	RANDL+1		; Position rechter Rand
   18         0012      MEML	EQU	RANDR+1		; Zeilennummer von Textanfang an
   19         0014      FTXT	EQU	MEML+2		; Zeiger auf Suchtext bei REPLACE
   20         0016      RTXT	EQU	FTXT+2		; Zeiger auf Ersetz-Text bei REPLACE
   21                   
   22         0018      T1A	EQU	RTXT+2		; Beginn Text 1
   23         001A      T2E	EQU	T1A+2		; nach Ende Text 2
   24         001C      T1E	EQU	T2E+2		; nach Ende Text 1
   25         001E      T2A	EQU	T1E+2		; Beginn Text 2
   26                   
   27         0020      COL	EQU	T2A+2		; EDIT-Cursor (Spalte)
   28         0021      LIN	EQU	COL+1		; EDIT-Cursor (Zeile)
   29         0022      M4A	EQU	LIN+1		; wenn ungleich 0 -> no Memory
   30         0023      STRING	EQU	M4A+1		; String-Puffer
   31         001B      LSTR	EQU	27		; max. Laenge Stringpuffer (26 Zeichen + 00)
   32         003E      STAT	EQU	STRING+LSTR	; Merkzelle fuer verschiedene Einstellungen
   33                   		;Bit 0 = 1 - Floppy vorhanden
   34                   		;Bit 1 = 1 - DEP mit LW-Steuerung
   35                   		;Bit 2 = 1 - Fehler bei Diskette
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   9
EDAS    INC

   36                   		;	     oder MTAB-Ueberschreitung aufgetreten
   37                   		;Bit 3 = 1 - Option 'S' merken
   38                   		;Bit 4 = 1 - Ueberschreiben (0=Einfuegen)
   39                   		;Bit 5 = 1 - Zeichensatz (0=IBM, 1=deutsch)
   40                   		;Bit 6 = 1 - Zeichensatz (0=IBM, 1=CAOS)
   41                   		;Bit 7 = 1 - END-Befehl erkannt (ASM)
   42                   
   43                   ; Assembler-Arbeitszellen:
   44                   
   45         003F      OPT	EQU	STAT+1		; Assembler-Optionen
   46                   		;Bit 0	L - Listing ausgeben
   47                   		;Bit 1	P - Umschaltung Drucker
   48                   		;Bit 2	+ - Markentabelle erweitern
   49                   		;Bit 3	1 - nur PASS 1!
   50                   		;Bit 4	3 - PASS 3 laeuft (Save MC)
   51                   		;Bit 5	B - Bildschirmformat (40 Spalten)
   52                   		;Bit 6	O - MC in Speicher laden
   53                   		;Bit 7	2 - nur PASS 2
   54         0040      OFFS	EQU	OPT+1		; Assembler-Offset
   55         0042      OBJ	EQU	OFFS+2		; Beginn Maschinencode
   56         0044      MBOT	EQU	OBJ+2		; RAM-Ende+1	8000H oder C000H
   57         0046      MTOP	EQU	MBOT+2		; Marken-Tabelle (Anfang)
   58         0048      PBL	EQU	MTOP+2		; Pointer auf Byte-Liste
   59         004A      M78	EQU	PBL+2
   60         004B      M79	EQU	M78+1
   61         004C      MPC	EQU	M79+1		; Adressenzaehler fuer MC-Erzeugung
   62         004E      ERRNO	EQU	MPC+2		; Zaehler (BCD) fuer Fehler beim Assemblieren
   63         0050      MCL	EQU	ERRNO+2		; MC-Endadresse
   64         0052      NUMB	EQU	MCL+2		; + Berechneter Wert eines Ausdrucks (Operand)
   65         0054      DDFD	EQU	NUMB+2		; | DD/FD-Speicher
   66         0055      KLAM	EQU	DDFD+1		; | Klammer-Speicher
   67         0056      M84	EQU	KLAM+1		; | Merker, ob Operand gefunden wurde
   68         0057      VORZ	EQU	M84+1		; | Rechenzeichen-Speicher
   69         0058      REGNR	EQU	VORZ+1		; + Registerkennbyte
   70         0059      REGC	EQU	REGNR+1		; Registercode
   71                   	; Registerkennbyte	Registercode	DDFD
   72                   	;				Bit
   73                   	; A	00H		07H	8
   74                   	; B	01H		00H	8
   75                   	; C	02H		01H	8
   76                   	; D	03H		02H	8
   77                   	; E	04H		03H	8
   78                   	; H	07H		04H	8
   79                   	; HX	07H		04H	8	DD
   80                   	; HY	07H		04H	8	FD
   81                   	; L	0BH		05H	8
   82                   	; LX	0BH		05H	8	DD
   83                   	; LY	0BH		05H	8	FD
   84                   	; I	08H		47H	8
   85                   	; R	11H		4FH	8
   86                   	; M(HL)	3AH		06H	8
   87                   	; (IX+)	3AH		06H	8	DD	
   88                   	; (IY+)	3AH		06H	8	FD
   89                   	; BC	2BH		00H	16
   90                   	; (BC)	2BH		00H	8
   91                   	; DE	2FH		10H	16
   92                   	; (DE)	2FH		10H	8
   93                   	; HL	3AH		20H	16
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  10
EDAS    INC

   94                   	; IX	3AH		20H	16	DD
   95                   	; IY	3AH		20H	16	FD
   96                   	; SP	49H		30H	16
   97                   	; AF	2DH		31H	16
   98                   
   99                   ; Hilfsprogramme fuer Speicherzugriff hinter IRM und ROM-C bis DFFFh
  100                   
  101         005A      RAMC	EQU	REGC+1		; Hilfsprogramme fuer Speicherzugriff bis DFFFh
  102                   	; 005Ch bis 00A0h	  nur bei ext. Editor erforderlich
  103                   
  104                   ; Assemblierpuffer:	(hier steht die erzeugte Quelltextzeile)
  105                   
  106         A880      NERR	EQU	0A880h		; 1 Byte Assembler-Fehlercode
  107                   				; 1 Byte "Stern" wenn Fehlercode vorhanden ist
  108         A882      ADR	EQU	NERR+2		; 4 Byte fuer Adresse
  109                   				; 10 Byte fuer Hexcodes
  110         A890      TEXT	EQU	NERR+16		; Quelltext (max. 80 Byte bei ext. Editor)
  111                   	; A880h bis A8FFh
   38                   
   39                   ; IRM-Arbeitszellen im nicht genutzten VRAM-Bereich:
   40                   
   41         B4D0      CRT40	EQU	0B4D0h		; Merkzelle fuer UP 00h CRT-Routine
   42         B4D2      CUCP40	EQU	CRT40+2		; Merkzelle fuer UP 25h CUCP-Routine
   43         B4D4      L3T40	EQU	CUCP40+2	; Merkzelle fuer Adresse der ESC-Tabelle
   44         B4D6      L3S40	EQU	L3T40+2		; Merkzelle fuer Laenge der ESC-Tabelle
   45         B4D8      T1merk	EQU	L3S40+2		; Merkzelle fuer T1E beim Editieren
   46         B4DA      T2merk	EQU	T1MERK+2	; Merkzelle fuer T2A beim Editieren
   47         B4DC      Mmerk	EQU	T2MERK+2	; Merkzelle fuer Zeilennummer bei ESC-K
   48         B4DE      GCURS	EQU	MMERK+2		; Cursorposition fuer ESC-G
   49         B4E0      Cmerk	EQU	GCURS+2		; Zeichen aktuelle Cursorpos. fuer COPY/MOVE
   50         B4E1      GTCR	EQU	Cmerk+1		; 10 Byte ein/aus-Merker fuer Druckersteuercodes
   51         B4EB      L3EDIT	EQU	GTCR+10		; 34 Byte ESC-Tabelle fuer 80-Zeichen-Mode
   52                   				; (17 Funktionen ESC-0 bis ESC-G)
   53                   ;-----------------------------------------------------------------------
   54                   IF1
   56                   ENDIF
   57                   ;-------
   58                   
   59                   ; CAOS-Vorblock:
   60                   
   61 0100  45 44 49 54 	DB	'EDITOR  KCC'	; 11 Byte Dateiname
   62 010B  00 00 00 00 	DS	5,0
   63 0110  02          	DB	2		; 2 Argumente
   64 0111  C000        	DW	ROMBEG		; Anfangsadresse
   65 0113  E000        	DW	ROMEND		; Endadresse
   66 0115  0000        	DW	0
   67 0117  00 00 00 00 	DS	95,0
   68 0176  30 37 2E 30 	DB	'07.08.2022'	; Datum
   69                   ;-------
   70                   	.PHASE	0C000H
   71                   ;
   72 C000              ROMBEG:	INCLUDE CCTL80.INC	; Zeichensatz 10*5 Pixel wie in ZAS
    1                   ;----------------------------------------------------
    2                   ; Include-Datei von ZAS >> Zeichenbildtabelle <<
    3                   ; Erweitert fuer CAOS-Editor mit Codes 00-1Fh
    4                   ;
    5                   ; Aufbau: 5 Byte je Zeichen
    6                   ;
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  11
CCTL80  INC

    7                   ; CCTL80.INC			04.01.1997-30.01.2019
    8                   ;----------------------------------------------------
    9                   
   10 C000  00 00 00 00 CCTL80:	DB	0,0,0,0,0		;00	wie Leerzeichen angezeigt
   11                   
   12                   ; Sonderzeichen Statuszeile (aehnlich WordPro6):
   13 C005  22 22 22 22 	DB	22H,22H,22H,22H,22H	;01	senkr. Strich
   14 C00A  00 FF EC 80 	DB	0,0FFh,0ECh,80h,0	;02	linke Randmarke
   15 C00F  00 FF 73 10 	DB	0,0FFh,73h,10h,0 	;03	rechte Randmarke
   16 C014  07 65 11 11 	DB	7,65H,11H,11H,0		;04	CLS/Eject
   17 C019  00 01 E6 20 	DB	0,1,0E6h,20h,0		;05	Gloeckchensymbol Statuszeile
   18                   ;	DB	0,0F0h,1Eh,62h,0	;05	Spaltenglocke normal
   19                   ;	DB	0,0F0h,87h,64h,0	;06	Spaltenglocke invers
   20 C01E  00 F0 20 20 	DB	0,0F0h,20h,20h,0	;06	Lineal mit TAB-Stop
   21 C023  88 F0 00 00 	DB	88h,0F0h,0,0,0		;07	Lineal mit linkem Rand
   22                   ;	DB	0,27h,22h,72h,0		;07	CAPS-Symbol Statuszeile
   23                   
   24                   ;						Bildschirm:	Drucker:
   25 C028  00 26 F6 20 	DB	0,26h,0F6h,20h,0	;08	Cursor links	Rueckschritt
   26 C02D  00 46 F6 40 	DB	0,46h,0F6h,40h,0	;09	Cursor rechts	TAB
   27 C032  02 22 22 72 	DB	2,22h,22h,72h,0		;0A	Cursor runter
   28 C037  02 72 22 22 	DB	2,72h,22h,22h,0		;0B	Cursor hoch
   29 C03C  0E CA 22 27 	DB	0Eh,0CAh,22h,27h,0	;0C	CLS		Seitenwechsel
   30 C041  01 11 5F 40 	DB	1,11h,5Fh,40h,0		;0D	CR
   31 C046  01 11 13 73 	DB	1,11h,13h,73h,0		;0E	Zeile binden	kein CR+LF
   32 C04B  01 24 A5 24 	DB	1,24h,0A5h,24h,80h	;0F	Hardcopy	HEX-Sequenz
   33                   
   34                   ; Druckersteuerzeichen (WordPro6):		    Bedeutung:
   35 C050  07 55 57 00 	DB	7,55H,57H,0,0		;10	0 - unidirectional	ein/aus
   36 C055  01 31 11 00 	DB	1,31H,11H,0,0		;11	1 - Exponent		ein/aus
   37 C05A  07 17 47 00 	DB	7,17H,47H,0,0		;12	2 - Schmalschrift	ein/aus
   38 C05F  07 17 17 00 	DB	7,17H,17H,0,0		;13	3 - Unterstreichen	ein/aus
   39 C064  04 57 11 00 	DB	4,57H,11H,0,0		;14	4 - Elite		ein/aus
   40 C069  07 47 17 00 	DB	7,47H,17H,0,0		;15	5 - Breitdruck		ein/aus
   41 C06E  07 47 57 00 	DB	7,47H,57H,0,0		;16	6 - Doppelt (Kursiv)	ein/aus
   42 C073  07 11 11 00 	DB	7,11H,11H,0,0		;17	7 - Index		ein/aus
   43 C078  07 57 57 00 	DB	7,57H,57H,0,0		;18	8 - Fettdruck		ein/aus
   44 C07D  07 57 17 00 	DB	7,57H,17H,0,0		;19	9 - NLQ			ein/aus
   45                   ;	DB	0Eh,0CAh,22h,22h,0	;1A	Textendemarke CP/M-Format
   46 C082  0F F0 FF 0F 	DB	0Fh,0F0h,0FFh,0Fh,0F0h	;1A	Kennung fuer Suchzeichen
   47 C087  96 69 96 69 	DB	96H,69H,96H,69H,0	;1B	ESC
   48 C08C  00 13 73 10 	DB	0,13H,73H,10H,0		;1C	Dreieck Blockanfang
   49 C091  02 72 22 20 	DB	2,72H,22H,20H,0		;1D	Pfeil nach oben     CAPS "gross"
   50 C096  00 46 76 40 	DB	0,46H,76H,40H,0		;1E	Dreieck Blockende
   51 C09B  02 22 27 20 	DB	2,22H,27H,20H,0		;1F	Pfeil nach unten    CAPS "klein"
   52                   
   53 C0A0  00 00 00 00 	DB	0,0,0,0,0		;20	SPC
   54 C0A5  02 77 22 02 	DB	2,77H,22H,2,0		;21	!
   55 C0AA  05 50 00 00 	DB	5,50H,0,0,0		;22	"
   56 C0AF  00 57 57 50 	DB	0,57H,57H,50H,0		;23	#
   57 C0B4  02 76 23 72 	DB	2,76H,23H,72H,0		;24	$
   58 C0B9  00 51 22 45 	DB	0,51H,22H,45H,0		;25	%
   59 C0BE  00 25 25 43 	DB	0,25H,25H,43H,0		;26	&
   60 C0C3  02 20 00 00 	DB	2,20H,0,0,0		;27	'
   61 C0C8  01 22 22 21 	DB	1,22H,22H,21H,0		;28	(
   62 C0CD  04 22 22 24 	DB	4,22H,22H,24H,0		;29	)
   63 C0D2  00 05 25 00 	DB	0,5,25H,0,0		;2A	*
   64 C0D7  00 02 72 00 	DB	0,2,72H,0,0		;2B	+
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  12
CCTL80  INC

   65 C0DC  00 00 00 22 	DB	0,0,0,22H,40H		;2C	,
   66 C0E1  00 00 70 00 	DB	0,0,70H,0,0		;2D	-
   67 C0E6  00 00 00 02 	DB	0,0,0,2,0		;2E	.
   68 C0EB  01 12 22 44 	DB	1,12H,22H,44H,0		;2F	/
   69 C0F0  02 55 55 52 	DB	2,55H,55H,52H,0		;30	0
   70 C0F5  01 35 11 11 	DB	1,35H,11H,11H,0		;31	1
   71 C0FA  02 55 12 47 	DB	2,55H,12H,47H,0		;32	2
   72 C0FF  02 51 21 52 	DB	2,51H,21H,52H,0		;33	3
   73 C104  04 55 71 11 	DB	4,55H,71H,11H,0		;34	4
   74 C109  07 44 71 52 	DB	7,44H,71H,52H,0		;35	5
   75 C10E  02 44 65 52 	DB	2,44H,65H,52H,0		;36	6
   76 C113  07 11 12 22 	DB	7,11H,12H,22H,0		;37	7
   77 C118  02 55 25 52 	DB	2,55H,25H,52H,0		;38	8
   78 C11D  02 55 31 52 	DB	2,55H,31H,52H,0		;39	9
   79 C122  00 02 00 20 	DB	0,2,0,20H,0		;3A	:
   80 C127  00 02 00 22 	DB	0,2,0,22H,40H		;3B	;
   81 C12C  00 12 42 10 	DB	0,12H,42H,10H,0		;3C	<
   82 C131  00 07 07 00 	DB	0,7,7,0,0		;3D	=
   83 C136  00 42 12 40 	DB	0,42H,12H,40H,0		;3E	>
   84 C13B  02 51 22 02 	DB	2,51H,22H,2,0		;3F	?
   85                   
   86 C140  06 51 25 53 	DB	6,51H,25H,53H,0		;40	@
   87 C145  02 55 75 55 	DB	2,55H,75H,55H,0		;41	A
   88 C14A  06 55 65 56 	DB	6,55H,65H,56H,0		;42	B
   89 C14F  02 54 44 52 	DB	2,54H,44H,52H,0		;43	C
   90 C154  06 55 55 56 	DB	6,55H,55H,56H,0		;44	D
   91 C159  07 44 64 47 	DB	7,44H,64H,47H,0		;45	E
   92 C15E  07 44 64 44 	DB	7,44H,64H,44H,0		;46	F
   93 C163  02 54 45 53 	DB	2,54H,45H,53H,0		;47	G
   94 C168  05 55 75 55 	DB	5,55H,75H,55H,0		;48	H
   95 C16D  07 22 22 27 	DB	7,22H,22H,27H,0		;49	I
   96 C172  07 11 11 52 	DB	7,11H,11H,52H,0		;4A	J
   97 C177  05 56 46 55 	DB	5,56H,46H,55H,0		;4B	K
   98 C17C  04 44 44 47 	DB	4,44H,44H,47H,0		;4C	L
   99 C181  05 77 55 55 	DB	5,77H,55H,55H,0		;4D	M
  100 C186  06 55 55 55 	DB	6,55H,55H,55H,0		;4E	N
  101 C18B  07 55 55 57 	DB	7,55H,55H,57H,0		;4F	O
  102 C190  06 55 64 44 	DB	6,55H,64H,44H,0		;50	P
  103 C195  07 55 55 77 	DB	7,55H,55H,77H,10H	;51	Q
  104 C19A  06 55 65 55 	DB	6,55H,65H,55H,0		;52	R
  105 C19F  02 54 21 52 	DB	2,54H,21H,52H,0		;53	S
  106 C1A4  07 22 22 22 	DB	7,22H,22H,22H,0		;54	T
  107 C1A9  05 55 55 57 	DB	5,55H,55H,57H,0		;55	U
  108 C1AE  05 55 55 52 	DB	5,55H,55H,52H,0		;56	V
  109 C1B3  05 55 57 75 	DB	5,55H,57H,75H,0		;57	W
  110 C1B8  05 55 25 55 	DB	5,55H,25H,55H,0		;58	X
  111 C1BD  05 55 72 22 	DB	5,55H,72H,22H,0		;59	Y
  112 C1C2  07 11 24 47 	DB	7,11H,24H,47H,0		;5A	Z
  113                   
  114 C1C7  07 44 44 47 	DB	7,44H,44H,47H,0		;5B	[
  115 C1CC  04 42 22 11 	DB	4,42H,22H,11H,0		;5C	\
  116 C1D1  07 11 11 17 	DB	7,11H,11H,17H,0		;5D	]
  117 C1D6  00 25 00 00 	DB	0,25H,0,0,0		;5E	^
  118 C1DB  00 00 00 00 	DB	0,0,0,0,70H		;5F	_
  119 C1E0  00 21 00 00 	DB	0,21H,0,0,0		;60	`
  120 C1E5  00 02 55 53 	DB	0,2,55H,53H,0		;61	a
  121 C1EA  04 46 55 56 	DB	4,46H,55H,56H,0		;62	b
  122 C1EF  00 03 44 43 	DB	0,3,44H,43H,0		;63	c
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  13
CCTL80  INC

  123 C1F4  01 13 55 53 	DB	1,13H,55H,53H,0		;64	d
  124 C1F9  00 02 57 47 	DB	0,2,57H,47H,0		;65	e
  125 C1FE  02 54 64 44 	DB	2,54H,64H,44H,40H	;66	f
  126 C203  00 03 55 31 	DB	0,3,55H,31H,60H		;67	g
  127 C208  04 46 55 55 	DB	4,46H,55H,55H,0		;68	h
  128 C20D  00 20 22 22 	DB	0,20H,22H,22H,0		;69	i
  129 C212  00 20 22 22 	DB	0,20H,22H,22H,60H	;6A	j
  130 C217  04 45 56 55 	DB	4,45H,56H,55H,0		;6B	k
  131 C21C  04 44 44 52 	DB	4,44H,44H,52H,0		;6C	l
  132 C221  00 05 75 55 	DB	0,5,75H,55H,0		;6D	m
  133 C226  00 02 55 55 	DB	0,2,55H,55H,0		;6E	n
  134 C22B  00 02 55 52 	DB	0,2,55H,52H,0		;6F	o
  135 C230  00 02 55 64 	DB	0,2,55H,64H,40H		;70	p
  136 C235  00 02 55 31 	DB	0,2,55H,31H,10H		;71	q
  137 C23A  00 06 54 44 	DB	0,6,54H,44H,0		;72	r
  138 C23F  00 03 42 16 	DB	0,3,42H,16H,0		;73	s
  139 C244  02 27 22 21 	DB	2,27H,22H,21H,0		;74	t
  140 C249  00 05 55 57 	DB	0,5,55H,57H,0		;75	u
  141 C24E  00 05 55 52 	DB	0,5,55H,52H,0		;76	v
  142 C253  00 05 57 75 	DB	0,5,57H,75H,0		;77	w
  143 C258  00 05 52 55 	DB	0,5,52H,55H,0		;78	x
  144 C25D  00 05 55 31 	DB	0,5,55H,31H,60H		;79	y
  145 C262  00 07 12 47 	DB	0,7,12H,47H,0		;7A	z
  146                   
  147 C267  03 22 42 23 	DB	3,22H,42H,23H,0		;7B	{
  148 C26C  02 22 22 22 	DB	2,22H,22H,22H,0		;7C	|
  149 C271  06 22 12 26 	DB	6,22H,12H,26H,0		;7D	}
  150 C276  07 00 00 00 	DB	7,0,0,0,0		;7E	~
  151 C27B  07 77 77 77 	DB	7,77H,77H,77H,70H	;7F	Vollzeichen
  152                   
  153 C280  02 54 44 52 	DB	2,54H,44H,52H,40H	;80
  154 C285  00 50 55 57 	DB	0,50H,55H,57H,0		;81
  155 C28A  12 02 57 43 	DB	12H,2,57H,43H,0		;82
  156 C28F  02 50 25 53 	DB	2,50H,25H,53H,0		;83
  157 C294  00 50 25 53 	DB	0,50H,25H,53H,0		;84
  158 C299  04 20 25 53 	DB	4,20H,25H,53H,0		;85
  159 C29E  00 20 25 53 	DB	0,20H,25H,53H,0		;86
  160 C2A3  00 03 44 43 	DB	0,3,44H,43H,40H		;87
  161 C2A8  25 02 57 47 	DB	25H,2,57H,47H,0		;88
  162 C2AD  05 02 57 47 	DB	5,2,57H,47H,0		;89
  163 C2B2  42 02 57 47 	DB	42H,2,57H,47H,0		;8A
  164 C2B7  05 02 22 22 	DB	5,2,22H,22H,0		;8B
  165 C2BC  25 02 22 22 	DB	25H,2,22H,22H,0		;8C
  166 C2C1  04 20 22 22 	DB	4,20H,22H,22H,0		;8D
  167 C2C6  05 25 57 55 	DB	5,25H,57H,55H,0		;8E
  168 C2CB  25 25 57 55 	DB	25H,25H,57H,55H,0	;8F
  169                   
  170 C2D0  12 07 46 47 	DB	12H,7,46H,47H,0		;90
  171 C2D5  00 05 37 65 	DB	0,5,37H,65H,0		;91
  172 C2DA  07 AA FA AB 	DB	7,0AAH,0FAH,0ABH,0	;92
  173 C2DF  02 50 25 52 	DB	2,50H,25H,52H,0		;93
  174 C2E4  00 50 25 52 	DB	0,50H,25H,52H,0		;94
  175 C2E9  04 20 25 52 	DB	4,20H,25H,52H,0		;95
  176 C2EE  02 50 55 53 	DB	2,50H,55H,53H,0		;96
  177 C2F3  04 20 55 53 	DB	4,20H,55H,53H,0		;97
  178 C2F8  05 05 55 31 	DB	5,5,55H,31H,60H		;98
  179 C2FD  05 07 55 57 	DB	5,7,55H,57H,0		;99
  180 C302  05 05 55 57 	DB	5,5,55H,57H,0		;9A
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  14
CCTL80  INC

  181 C307  00 27 66 67 	DB	0,27H,66H,67H,20H	;9B
  182 C30C  02 54 64 47 	DB	2,54H,64H,47H,0		;9C
  183 C311  05 52 72 72 	DB	5,52H,72H,72H,0		;9D
  184 C316  0C AC AB AB 	DB	0CH,0ACH,0ABH,0ABH,0	;9E
  185 C31B  00 32 72 22 	DB	0,32H,72H,22H,60H	;9F
  186                   
  187 C320  01 20 25 53 	DB	1,20H,25H,53H,0		;A0
  188 C325  01 20 22 22 	DB	1,20H,22H,22H,0		;A1
  189 C32A  01 20 25 52 	DB	1,20H,25H,52H,0		;A2
  190 C32F  01 20 55 57 	DB	1,20H,55H,57H,0		;A3
  191 C334  00 70 25 55 	DB	0,70H,25H,55H,0		;A4
  192 C339  07 06 55 55 	DB	7,6,55H,55H,0		;A5
  193 C33E  00 25 55 30 	DB	0,25H,55H,30H,70H	;A6
  194 C343  00 25 55 20 	DB	0,25H,55H,20H,70H	;A7
  195 C348  02 02 24 52 	DB	2,2,24H,52H,0		;A8
  196 C34D  00 F8 00 00 	DB	0,0F8H,0,0,0		;A9
  197 C352  00 F1 00 00 	DB	0,0F1H,0,0,0		;AA
  198 C357  44 52 51 27 	DB	44H,52H,51H,27H,0	;AB
  199 C35C  44 41 25 71 	DB	44H,41H,25H,71H,0	;AC
  200 C361  02 02 27 72 	DB	2,2,27H,72H,0		;AD
  201 C366  00 05 A5 00 	DB	0,5,0A5H,0,0		;AE
  202 C36B  00 0A 5A 00 	DB	0,0AH,5AH,0,0		;AF
  203                   
  204 C370  05 05 05 05 	DB	5,5,5,5,5		;B0
  205 C375  AA 55 AA 55 	DB	0AAH,55H,0AAH,55H,0AAH	;B1
  206 C37A  A5 A5 A5 A5 	DB	0A5H,0A5H,0A5H,0A5H,0A5H;B2
  207 C37F  22 22 22 22 	DB	22H,22H,22H,22H,22H	;B3
  208 C384  22 2E 22 22 	DB	22H,2EH,22H,22H,22H	;B4
  209 C389  22 E2 E2 22 	DB	22H,0E2H,0E2H,22H,22H	;B5
  210 C38E  66 6E 66 66 	DB	66H,6EH,66H,66H,66H	;B6
  211 C393  00 0E 66 66 	DB	0,0EH,66H,66H,66H	;B7
  212 C398  00 E2 E2 22 	DB	0,0E2H,0E2H,22H,22H	;B8
  213 C39D  66 E2 E6 66 	DB	66H,0E2H,0E6H,66H,66H	;B9
  214 C3A2  66 66 66 66 	DB	66H,66H,66H,66H,66H	;BA
  215 C3A7  00 E2 E6 66 	DB	0,0E2H,0E6H,66H,66H	;BB
  216 C3AC  66 E2 E0 00 	DB	66H,0E2H,0E0H,0,0	;BC
  217 C3B1  66 6E 00 00 	DB	66H,6EH,0,0,0		;BD
  218 C3B6  22 E2 E0 00 	DB	22H,0E2H,0E0H,0,0	;BE
  219 C3BB  00 0E 22 22 	DB	0,0EH,22H,22H,22H	;BF
  220                   
  221 C3C0  22 23 00 00 	DB	22H,23H,0,0,0		;C0
  222 C3C5  22 2F 00 00 	DB	22H,2FH,0,0,0		;C1
  223 C3CA  00 0F 22 22 	DB	0,0FH,22H,22H,22H	;C2
  224 C3CF  22 23 22 22 	DB	22H,23H,22H,22H,22H	;C3
  225 C3D4  00 0F 00 00 	DB	0,0FH,0,0,0		;C4
  226 C3D9  22 2F 22 22 	DB	22H,2FH,22H,22H,22H	;C5
  227 C3DE  22 32 32 22 	DB	22H,32H,32H,22H,22H	;C6
  228 C3E3  66 67 66 66 	DB	66H,67H,66H,66H,66H	;C7
  229 C3E8  66 74 70 00 	DB	66H,74H,70H,0,0		;C8
  230 C3ED  00 74 76 66 	DB	0,74H,76H,66H,66H	;C9
  231 C3F2  66 F0 F0 00 	DB	66H,0F0H,0F0H,0,0	;CA
  232 C3F7  00 F0 F6 66 	DB	0,0F0H,0F6H,66H,66H	;CB
  233 C3FC  66 74 76 66 	DB	66H,74H,76H,66H,66H	;CC
  234 C401  00 F0 F0 00 	DB	0,0F0H,0F0H,0,0		;CD
  235 C406  66 F0 F6 66 	DB	66H,0F0H,0F6H,66H,66H	;CE
  236 C40B  22 F0 F0 00 	DB	22H,0F0H,0F0H,0,0	;CF
  237                   
  238 C410  66 6F 00 00 	DB	66H,6FH,0,0,0		;D0
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  15
CCTL80  INC

  239 C415  00 F0 F2 22 	DB	0,0F0H,0F2H,22H,22H	;D1
  240 C41A  00 0F 66 66 	DB	0,0FH,66H,66H,66H	;D2
  241 C41F  66 67 00 00 	DB	66H,67H,0,0,0		;D3
  242 C424  22 32 30 00 	DB	22H,32H,30H,0,0		;D4
  243 C429  00 32 32 22 	DB	0,32H,32H,22H,22H	;D5
  244 C42E  00 07 66 66 	DB	0,7,66H,66H,66H		;D6
  245 C433  66 6F 66 66 	DB	66H,6FH,66H,66H,66H	;D7
  246 C438  22 F2 F2 22 	DB	22H,0F2H,0F2H,22H,22H	;D8
  247 C43D  22 2E 00 00 	DB	22H,2EH,0,0,0		;D9
  248 C442  00 03 22 22 	DB	0,3,22H,22H,22H		;DA
  249 C447  FF FF FF FF 	DB	-1,-1,-1,-1,-1		;DB	Vollzeichen
  250 C44C  00 00 0F FF 	DB	0,0,0FH,-1,-1		;DC
  251 C451  CC CC CC CC 	DB	0CCH,0CCH,0CCH,0CCH,0CCH;DD
  252 C456  33 33 33 33 	DB	33H,33H,33H,33H,33H	;DE
  253 C45B  FF FF F0 00 	DB	-1,-1,0F0H,0,0		;DF
  254                   
  255 C460  00 00 16 61 	DB	0,0,16H,61H,0		;E0
  256 C465  02 55 65 56 	DB	2,55H,65H,56H,40H	;E1
  257 C46A  07 55 44 44 	DB	7,55H,44H,44H,0		;E2
  258 C46F  00 00 75 55 	DB	0,0,75H,55H,0		;E3
  259 C474  07 42 12 47 	DB	7,42H,12H,47H,0		;E4
  260 C479  00 01 25 52 	DB	0,1,25H,52H,0		;E5
  261 C47E  00 05 55 57 	DB	0,5,55H,57H,44H		;E6
  262 C483  00 07 22 24 	DB	0,7,22H,24H,0		;E7
  263 C488  07 25 55 27 	DB	7,25H,55H,27H,0		;E8
  264 C48D  02 55 75 52 	DB	2,55H,75H,52H,0		;E9
  265 C492  02 55 52 25 	DB	2,55H,52H,25H,0		;EA
  266 C497  00 34 25 52 	DB	0,34H,25H,52H,0		;EB
  267 C49C  00 00 6F 60 	DB	0,0,6FH,60H,0		;EC
  268 C4A1  07 55 75 57 	DB	7,55H,75H,57H,0		;ED
  269 C4A6  00 34 74 30 	DB	0,34H,74H,30H,0		;EE
  270 C4AB  00 25 55 55 	DB	0,25H,55H,55H,0		;EF
  271                   
  272 C4B0  00 70 70 70 	DB	0,70H,70H,70H,0		;F0
  273 C4B5  00 27 20 07 	DB	0,27H,20H,7,0		;F1
  274 C4BA  04 21 24 07 	DB	4,21H,24H,7,0		;F2
  275 C4BF  01 24 21 07 	DB	1,24H,21H,7,0		;F3
  276 C4C4  02 54 44 42 	DB	2,54H,44H,42H,22H	;F4
  277 C4C9  22 11 11 52 	DB	22H,11H,11H,52H,0	;F5
  278 C4CE  00 20 70 20 	DB	0,20H,70H,20H,0		;F6
  279 C4D3  00 63 06 30 	DB	0,63H,6,30H,0		;F7
  280 C4D8  02 52 00 00 	DB	2,52H,0,0,0		;F8
  281 C4DD  00 02 20 00 	DB	0,2,20H,0,0		;F9
  282 C4E2  00 00 20 00 	DB	0,0,20H,0,0		;FA
  283 C4E7  03 22 E6 44 	DB	3,22H,0E6H,44H,0	;FB
  284 C4EC  06 55 00 00 	DB	6,55H,0,0,0		;FC
  285 C4F1  02 51 27 00 	DB	2,51H,27H,0,0		;FD
  286 C4F6  00 00 33 00 	DB	0,0,33H,0,0		;FE
  287 C4FB  0F 99 99 99 	DB	0FH,99H,99H,99H,0F0H	;FF	(Rahmen)
  288                   
  289 C500              CCTL81:	; alternativer Zeichensatz 1 (ASCII-deutsch)
  290 C500  03 42 52 16 	DB	3,42H,52H,16H,0		;40	u
  291 C505  05 25 57 55 	DB	5,25H,57H,55H,0		;5B	Ae
  292 C50A  05 07 55 57 	DB	5,7,55H,57H,0		;5C	Oe
  293 C50F  05 05 55 57 	DB	5,5,55H,57H,0		;5D	Ue
  294 C514  00 21 00 00 	DB	0,21H,0,0,0		;60	`
  295 C519  00 50 25 53 	DB	0,50H,25H,53H,0		;7B	ae
  296 C51E  00 50 25 52 	DB	0,50H,25H,52H,0		;7C	oe
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  16
CCTL80  INC

  297 C523  00 50 55 57 	DB	0,50H,55H,57H,0		;7D	ue
  298 C528  02 55 65 56 	DB	2,55H,65H,56H,40H	;7E	ss
  299                   
  300 C52D              CCTL82:	; alternativer Zeichensatz 2 (CAOS-Zeichensatz)
  301 C52D  06 51 25 53 	DB	6,51H,25H,53H,0		;40	@
  302 C532  0F FF FF FF 	DB	0Fh,0FFh,0FFh,0FFh,0F0h	;5B	Vollzeichen
  303 C537  02 22 22 22 	DB	2,22H,22H,22H,0		;5C	|
  304 C53C  00 F1 00 00 	DB	0,0F1H,0,0,0		;5D	Negationszeichen
  305 C541  06 9F DF 96 	DB	6,9FH,0DFH,96H,0	;60	(c)
  306 C546  00 50 25 53 	DB	0,50H,25H,53H,0		;7B	ae
  307 C54B  00 50 25 52 	DB	0,50H,25H,52H,0		;7C	oe
  308 C550  00 50 55 57 	DB	0,50H,55H,57H,0		;7D	ue
  309 C555  02 55 65 56 	DB	2,55H,65H,56H,40H	;7E	ss
   73                   ;
   74                   ; Einsprungtabelle aus EDAS (Adresse C55Ah)
   75                   ;
   76 C55A  CD CAEB     	CALL	NORAM		; Hilfsprogramme fuer Aufruf aus EDAS regenerieren
   77                   ;	JP	MAIN		; bis 07.08.2022: erst zum kurzen EDIT-Menu
   78 C55D  E5          	PUSH	HL		; beliebige RET-Adresse auf Stack legen
   79 C55E  C3 D2C9     	JP	EDIT		; 07.08.2022: direkt zum Quelltext
   80                   
   81                   ;
   82                   ; VRAM-Adresse der Cursorposition berechnen
   83                   ;	als Video-RAM wird der IRM von AD00h bis B4CFh genutzt
   84                   ;	keine Unterscheidung zwischen Bild 0 und Bild 1!
   85                   ; PE:	DE	Cursorposition
   86                   ; PA:	HL	VRAM-Adresse
   87                   ;	CY=1	ausserhalb des Fensters!
   88                   ; VR:	HL, F
   89                   ;
   90 C561  F5          DABR80:	PUSH	AF		; **32**
   91 C562  CD F003     	CALL	PV1
   92 C565  33          	DB	TCIF		; Cursor im Fenster?
   93 C566  38 1F       	JR	C,IAD2		; Fehler
   94 C568  D5          	PUSH	DE
   95 C569  3A B79C     	LD	A,(WINON)	; Fensterbeginn
   96 C56C  83          	ADD	A,E		; Cursor-Spalte + Fensterbeginn
   97 C56D  5F          	LD	E,A		; Spalte absolut
   98 C56E  D5          	push	de
   99 C56F  3A B79D     	LD	A,(WINON+1)
  100 C572  82          	ADD	A,D		; Cursor-Zeile + Fensterbeginn
  101 C573  87          	ADD	A,A
  102 C574  87          	ADD	A,A
  103 C575  87          	ADD	A,A		; Zeile*8
  104 C576  6F          	LD	L,A
  105 C577  26 00       	LD	H,0
  106 C579  29          	ADD	HL,HL		; Zeile*16
  107 C57A  54          	LD	D,H
  108 C57B  5D          	LD	E,L
  109 C57C  29          	ADD	HL,HL		; Zeile*32
  110 C57D  29          	ADD	HL,HL		; Zeile*64
  111 C57E  19          	ADD	HL,DE		; 64+16=80
  112 C57F  D1          	pop	de		; E=Spalte
  113 C580  16 AD       	LD	D,0ADh		; D=Beginn Video-RAM (ASCII-Speicher)
  114 C582  19          	ADD	HL,DE		; Position in Video-RAM
  115 C583  D1          	POP	DE		; Cursorposition
  116 C584  F1          	POP	AF
  117 C585  A7          	AND	A		; CY=0
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  17
EDITOR  Z80

  118 C586  C9          	RET
  119                   	;
  120 C587  F1          IAD2:	POP	AF
  121 C588  37          	SCF			; CY=1
  122 C589  C9          	RET
  123                   ;
  124                   ; Bildschirmadresse berechnen (fuer 10 Byte lange Zeichen!):
  125                   ; PE:	HL	Cursorposition
  126                   ; PA:	CY	0-links, 1-rechts
  127                   ;	HL	BS-Adresse
  128                   ; VR:	AF, HL, B
  129                   ;
  130 C58A  D5          CUADR:	PUSH	DE
  131 C58B  ED 5B B79C  	LD	DE,(WINON)	; Fensterbeginn dazu rechnen
  132 C58F  19          	ADD	HL,DE
  133 C590  D1          	POP	DE
  134 C591  CB 3D       	SRL	L		; Spalte/2
  135 C593  F5          	PUSH	AF		; CY merken
  136 C594  3E 80       	LD	A,80H		; IRM-Adresse KC85/4
  137 C596  85          	ADD	A,L
  138 C597  44          	LD	B,H
  139 C598  67          	LD	H,A		; H=80H+Spalte/2
  140 C599  78          	LD	A,B
  141 C59A  87          	ADD	A,A
  142 C59B  87          	ADD	A,A
  143 C59C  87          	ADD	A,A
  144 C59D  80          	ADD	A,B
  145 C59E  80          	ADD	A,B
  146 C59F  C6 06       	ADD	A,6		; erste Pixelzeile beginnt bei 6
  147 C5A1  6F          	LD	L,A		; L=10*Zeile + 6
  148 C5A2  F1          	POP	AF
  149 C5A3  C9          	RET
  150                   ;
  151                   ; Bildschirmausgabe, auch Steuerzeichen darstellen
  152                   ;
  153 C5A4  E5          CST80:	PUSH	HL		; **42**
  154 C5A5  21 B7A2     	LD	HL,STBT
  155 C5A8  CB DE       	SET	3,(HL)		; Steuerzeichen darstellen
  156 C5AA  CD C637     	CALL	CRT80		; Zeichenausgabe
  157 C5AD  CB 9E       	RES	3,(HL)		; Normalzustand
  158 C5AF  E1          	POP	HL
  159 C5B0  C9          	RET
  160                   ;
  161                   ; Zeichenausgaberoutine mit VRAM-Test:
  162                   ; PE:	DE	Cursorposition
  163                   ;	HL	VRAM-Adresse
  164                   ;	A	Zeichen
  165                   ;
  166 C5B1  AF          WRZCH0:	XOR	A		; Nullcode (leer) anzeigen
  167 C5B2  BE          WRZCH:	CP	(HL)		; Vergleich mit VRAM
  168 C5B3  C8          	RET	Z		; Zeichen bereits richtig angezeigt
  169 C5B4  77          	LD	(HL),A		; neuen Zeichencode eintragen
  170                   	; and anzeigen mit WPIX
  171                   ;
  172                   ; Zeichen auf Grafikbildschirm sichtbar machen (nur Pixel)
  173                   ; PE:	DE	Cursorposition
  174                   ;	A	Zeichencode
  175                   ;	STBT	Bildschirmsteuerbyte
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  18
EDITOR  Z80

  176                   ; VR:	-
  177                   ;
  178 C5B5  E5          WPIX:	PUSH	HL
  179 C5B6  D5          	PUSH	DE
  180 C5B7  C5          	PUSH	BC
  181 C5B8  F5          	PUSH	AF
  182                   
  183 C5B9  21 003E     	ld	hl,stat		; Zeichensatz pruefen
  184 C5BC  CB 6E       	bit	5,(hl)
  185 C5BE  20 09       	jr	nz,wx1
  186 C5C0  CB 76       	bit	6,(hl)
  187 C5C2  28 36       	jr	z,wp1		; Zeichensatz 0
  188 C5C4  21 C52D     	ld	hl,cctl82	; alternativer Zeichensatz 2
  189 C5C7  18 03       	jr	wx2
  190                   	;
  191 C5C9  21 C500     wx1:	ld	hl,cctl81	; alternativer Zeichensatz 1
  192 C5CC  FE 40       wx2:	cp	40h
  193 C5CE  28 36       	jr	z,wp3		; Klammeraffe
  194 C5D0  01 0005     	ld	bc,5
  195 C5D3  FE 5B       	cp	5bh		; Eckige Klammer auf
  196 C5D5  28 2E       	jr	z,wp2
  197 C5D7  09          	add	hl,bc
  198 C5D8  FE 5C       	cp	5ch		; Backslash
  199 C5DA  28 29       	jr	z,wp2
  200 C5DC  09          	add	hl,bc
  201 C5DD  FE 5D       	cp	5dh		; Eckige Klammer zu
  202 C5DF  28 24       	jr	z,wp2
  203 C5E1  09          	add	hl,bc
  204 C5E2  FE 60       	cp	60h		; (c)
  205 C5E4  28 1F       	jr	z,wp2
  206 C5E6  09          	add	hl,bc
  207 C5E7  FE 7B       	cp	7bh		; geschweifte Klammer auf
  208 C5E9  28 1A       	jr	z,wp2
  209 C5EB  09          	add	hl,bc
  210 C5EC  FE 7C       	cp	7ch		; senkr. Strich
  211 C5EE  28 15       	jr	z,wp2
  212 C5F0  09          	add	hl,bc
  213 C5F1  FE 7D       	cp	7dh		; geschweifte Klammer zu
  214 C5F3  28 10       	jr	z,wp2
  215 C5F5  09          	add	hl,bc
  216 C5F6  FE 7E       	cp	7eh		; Wellenlinie
  217 C5F8  28 0B       	jr	z,wp2
  218                   
  219 C5FA  26 00       wp1:	LD	H,0
  220 C5FC  6F          	LD	L,A
  221 C5FD  44          	LD	B,H
  222 C5FE  4F          	LD	C,A		; DE=*1
  223 C5FF  29          	ADD	HL,HL		; HL=*2
  224 C600  29          	ADD	HL,HL		; HL=*4
  225 C601  09          	ADD	HL,BC		; HL=*5, CCTL-Adr. fuer lange Zeichen
  226 C602  01 C000     	LD	BC,CCTL80	; Zeichenbildtabelle fuer 0..FFh
  227 C605  09          wp2:	ADD	HL,BC
  228 C606  EB          wp3:	EX	DE,HL		; DE=Zeichenadresse / HL=Cursorpos.
  229 C607  CD C58A     	CALL	CUADR		; BS-Adresse berechnen (HL=IRM, CY=rechts/links)
  230                   ;80-Zeichen-Routine fuer KC85/4:
  231 C60A  06 05       	LD	B,5		; Zeichenlaenge in CCTL80
  232 C60C  C5          LAB1:	PUSH	BC		; Byteanzahl
  233 C60D  F5          	PUSH	AF		; links oder rechts in CY merken
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  19
EDITOR  Z80

  234 C60E  1A          	LD	A,(DE)		; Zeichencode
  235 C60F  13          	INC	DE
  236 C610  47          	LD	B,A		; Pixelcode 2
  237 C611  07          	RLCA
  238 C612  07          	RLCA
  239 C613  07          	RLCA
  240 C614  07          	RLCA
  241 C615  4F          	LD	C,A		; Pixelcode 1
  242 C616  F1          	POP	AF
  243 C617  38 0D       	JR	C,LAB3		; rechts
  244                   	;
  245 C619  ED 6F       	RLD
  246 C61B  79          	LD	A,C		; erster Teil
  247 C61C  ED 67       	RRD
  248 C61E  23          	INC	HL
  249 C61F  ED 6F       	RLD
  250 C621  78          	LD	A,B		; zweiter Teil
  251 C622  ED 67       	RRD
  252 C624  18 0B       	JR	LAB4
  253                   	;
  254 C626  ED 67       LAB3:	RRD
  255 C628  79          	LD	A,C		; erster Teil
  256 C629  ED 6F       	RLD
  257 C62B  23          	INC	HL
  258 C62C  ED 67       	RRD
  259 C62E  78          	LD	A,B		; zweiter Teil
  260 C62F  ED 6F       	RLD
  261                   	;
  262 C631  23          LAB4:	INC	HL		; naechste BS-Zeile
  263 C632  C1          	POP	BC
  264 C633  10 D7       	DJNZ	LAB1		; bis Zeichen fertig
  265 C635  18 36       	JR	POP4
  266                   ;
  267                   ; CRT-Routine mit 80-Zeichen-Ausgabe
  268                   ; VR:	-
  269                   ;
  270 C637  E5          CRT80:	PUSH	HL		; **00**
  271 C638  D5          	PUSH	DE
  272 C639  C5          	PUSH	BC
  273 C63A  F5          	PUSH	AF
  274 C63B  CD C672     	CALL	PCHR80		; Zeichen anzeigen
  275 C63E  ED 53 B7A0  	LD	(CURSO),DE	; neue Cursorposition setzen
  276 C642  18 29       	JR	POP4
  277                   ;
  278                   ; Cursor komplementieren (fuer Blinken)
  279                   ;
  280 C644  E5          CUCP80:	PUSH	HL		; **25**
  281 C645  D5          	PUSH	DE
  282 C646  C5          	PUSH	BC
  283 C647  F5          	PUSH	AF
  284 C648  ED 5B B7A0  	LD	DE,(CURSO)
  285 C64C  CD C561     	CALL	DABR80		; VRAM-Adresse berechnen
  286 C64F  7E          	LD	A,(HL)		; Zeichencode auf Cursorposition
  287 C650  A7          	AND	A
  288 C651  F5          	PUSH	AF
  289 C652  EB          	EX	DE,HL		; HL jetzt Cursorposition
  290 C653  CD C58A     	CALL	CUADR		; BS-Adresse berechnen
  291                   ;	INC	HL
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  20
EDITOR  Z80

  292 C656  06 0A       	LD	B,10		; Cursorhoehe
  293 C658  0E F0       	LD	C,0F0H		; Maske fuer Zeichen links
  294 C65A  30 02       	JR	NC,CUCP3
  295 C65C  0E 0F       	LD	C,0FH		; Maske fuer Zeichen rechts
  296 C65E  F1          CUCP3:	POP	AF
  297 C65F  20 06       	JR	NZ,CUCP4	; Klotzcursor
  298 C661  3E 08       	LD	A,8
  299 C663  85          	ADD	A,L
  300 C664  6F          	LD	L,A
  301 C665  06 02       	LD	B,2		; 2 Byte Cursorhoehe
  302 C667  7E          CUCP4:	LD	A,(HL)
  303 C668  A9          	XOR	C		; mit Maske negieren
  304 C669  77          	LD	(HL),A
  305 C66A  23          	INC	HL
  306 C66B  10 FA       	DJNZ	CUCP4		; Cursorhoehe
  307 C66D  F1          POP4:	POP	AF
  308 C66E  C1          	POP	BC
  309 C66F  D1          	POP	DE
  310 C670  E1          	POP	HL
  311 C671  C9          NOOP:	RET
  312                   ;
  313                   ; CRT-Grundprogramm (ohne Auswertung der ESC-Sequenzen)
  314                   ; PE:	A	Zeichencode
  315                   ;
  316 C672  ED 5B B7A0  PCHR80:	LD	DE,(CURSO)
  317 C676  FE 20       	CP	20H		; Steuerfunktion?
  318 C678  30 14       	JR	NC,PCHR5
  319 C67A  21 B7A2     	LD	HL,STBT
  320 C67D  CB 5E       	BIT	3,(HL)		; darstellen?
  321 C67F  20 0D       	JR	NZ,PCHR5
  322 C681  87          	ADD	A,A		; *2
  323 C682  21 DF0A     	LD	HL,CTAB80	; Tabelle der Steuercodes
  324 C685  4F          	LD	C,A
  325 C686  06 00       	LD	B,0
  326 C688  09          	ADD	HL,BC
  327 C689  7E          	LD	A,(HL)
  328 C68A  23          	INC	HL
  329 C68B  66          	LD	H,(HL)
  330 C68C  6F          	LD	L,A
  331 C68D  E9          	JP	(HL)		; anspringen
  332                   
  333 C68E  CD C561     PCHR5:	CALL	DABR80		; Adresse Video-RAM berechnen
  334 C691  D8          	RET	C		; ausserhalb
  335 C692  77          	LD	(HL),A		; ASCII eintragen
  336 C693  CD C5B5     	CALL	WPIX		; Zeichen darstellen
  337                   ;
  338                   ; 09H = Cursor nach rechts
  339                   ; PA:	CY=1	nicht moeglich (Textende)
  340                   ;
  341 C696  3A B79E     CUR80:	LD	A,(WINLG)	; Anzahl Spalten
  342 C699  3D          	DEC	A		; letzte Spalte
  343 C69A  BB          	CP	E		; ganz rechts?
  344 C69B  28 03       	JR	Z,CUR1
  345 C69D  1C          	INC	E		; eine Position nach rechts gehen
  346 C69E  18 0F       	JR	CUR3
  347                   	;
  348 C6A0  3A B79F     CUR1:	LD	A,(WINLG+1)	; Anzahl Zeilen
  349 C6A3  3D          	DEC	A		; letzte Zeile
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  21
EDITOR  Z80

  350 C6A4  BA          	CP	D		; ganz unten?
  351 C6A5  20 05       	JR	NZ,CUR2		; nein
  352 C6A7  CD C6F7     	CALL	CUD3		; scrollen
  353 C6AA  D8          	RET	C		; nicht gescrollt
  354 C6AB  3E          	DB	3Eh		; LD A,n (in Zeile 0 bleiben)
  355                   	;
  356 C6AC  14          CUR2:	INC	D		; eine Zeile nach unten gehen
  357 C6AD  1E 00       	LD	E,0		; Spalte 0
  358 C6AF  7B          CUR3:	LD	A,E		; neue Spalte
  359 C6B0  E6 07       	AND	7		; modulo 8
  360 C6B2  C8          	RET	Z		; wir stehen auf Tab-Stopp
  361 C6B3  CD C561     	CALL	DABR80		; VRAM-Adresse berechnen
  362 C6B6  7E          	LD	A,(HL)
  363 C6B7  B7          	OR	A		; Dummy?
  364 C6B8  C0          	RET	NZ		; nein -> fertig
  365 C6B9  2B          	DEC	HL
  366 C6BA  7E          	LD	A,(HL)
  367 C6BB  B7          	OR	A		; Dummy davor?
  368 C6BC  28 D8       	JR	Z,CUR80		; ja, dann weiter nach rechts
  369 C6BE  C9          	RET
  370                   ;
  371                   ; 18H = Wort nach rechts (Shift-CUR)
  372                   ;	- Leerzeichen suchen
  373                   ;	- nicht leeres Zeichen suchen
  374                   ;
  375 C6BF  CD C696     WRE0:	CALL	CUR80		; Cursor nach rechts
  376 C6C2  D8          	RET	C		; Textende erreicht
  377 C6C3  CD C561     WRIGH:	CALL	DABR80		; VRAM-Adresse berechnen
  378 C6C6  7E          	LD	A,(HL)
  379 C6C7  FE 21       	CP	21h		; Leerzeichen?
  380 C6C9  30 F4       	JR	NC,WRE0		; nein
  381                   	;
  382 C6CB  CD C561     WRE1:	CALL	DABR80		; VRAM-Adresse berechnen
  383 C6CE  7E          	LD	A,(HL)
  384 C6CF  FE 21       	CP	21h		; Leerzeichen?
  385 C6D1  D0          	RET	NC		; nein
  386 C6D2  CD C696     	CALL	CUR80		; Cursor nach rechts
  387 C6D5  D8          	RET	C		; Textende erreicht
  388 C6D6  18 F3       	JR	WRE1		; bis wir auf einem Wort stehen
  389                   ;
  390                   ; 0AH = Cursor nach unten
  391                   ;
  392 C6D8  3A B79F     CUD80:	LD	A,(WINLG+1)	; Anzahl Zeilen
  393 C6DB  3D          	DEC	A		; letzte Zeile
  394 C6DC  BA          	CP	D		; ganz unten?
  395 C6DD  20 05       	JR	NZ,CUD0		; nein
  396 C6DF  CD C6F7     	CALL	CUD3		; scrollen
  397 C6E2  D8          	RET	C		; nicht gescrollt
  398 C6E3  3E          	DB	3Eh		; LD A,n (in Zeile 0 bleiben)
  399                   	;
  400 C6E4  14          CUD0:	INC	D		; eine Zeile runter
  401 C6E5  CD C561     CUD1:	CALL	DABR80		; HL=VRAM-Adresse
  402 C6E8  7E          	LD	A,(HL)
  403 C6E9  FE 20       	CP	' '
  404 C6EB  D0          	RET	NC		; Zeichen vorhanden
  405 C6EC  7B          CUD2:	LD	A,E
  406 C6ED  A7          	AND	A
  407 C6EE  C8          	RET	Z		; Spalte 0
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  22
EDITOR  Z80

  408 C6EF  2B          	DEC	HL
  409 C6F0  7E          	LD	A,(HL)		; Zeichen vor akt. Cursorposition
  410 C6F1  FE 20       	CP	' '
  411 C6F3  D0          	RET	NC		; Zeichen davor vorhanden
  412 C6F4  1D          	DEC	E		; eine Spalte zurueck gehen
  413 C6F5  18 F5       	JR	CUD2
  414                   	;
  415 C6F7  D5          CUD3:	PUSH	DE		; Cursorposition
  416 C6F8  2A 001A     	LD	HL,(T2E)
  417 C6FB  ED 5B 001E  	LD	DE,(T2A)
  418 C6FF  A7          	AND	A
  419 C700  ED 52       	SBC	HL,DE		; sind wir bereits am Textende?
  420 C702  D1          	POP	DE
  421 C703  37          	SCF			; nicht gescrollt
  422 C704  C8          	RET	Z		; kein Text 2
  423 C705  D5          CUD4:	PUSH	DE
  424 C706  11 0000     	LD	DE,0		; Position links oben
  425 C709  CD C561     	CALL	DABR80		; VRAM-Adresse berechnen
  426 C70C  CD D730     	CALL	MLINE		; 1. Zeile speichern
  427 C70F  38 24       	JR	C,CUD5		; No Memory!
  428 C711  CD C7A5     	CALL	UPSCRL		; Bild nach oben scrollen
  429 C714  ED 5B B79E  	LD	DE,(WINLG)
  430 C718  15          	DEC	D		; letzte Zeile
  431 C719  1E 00       	LD	E,0		; Spalte 0
  432 C71B  CD C561     	CALL	DABR80		; HL=VRAM-Adresse
  433 C71E  ED 4B 001E  	LD	BC,(T2A)	; aus Teiltext 2 neu anzeigen
  434 C722  E5          	push	hl
  435 C723  2A 001A     	ld	hl,(t2e)	; Ende Text 2
  436 C726  A7          	and	a
  437 C727  ED 42       	sbc	hl,bc		; sind wir am Textende angekommen?
  438 C729  E1          	pop	hl
  439 C72A  C4 D78D     	CALL	NZ,WRZLE	; Letzte Zeile anzeigen
  440 C72D  2A 0012     	LD	HL,(MEML)
  441 C730  23          	INC	HL		; Textzeile +1
  442 C731  22 0012     	LD	(MEML),HL
  443 C734  A7          	AND	A		; erfolgreich gescrollt
  444 C735  D1          CUD5:	POP	DE
  445 C736  C9          	RET
  446                   ;
  447                   ; 0Bh = Cursor nach oben
  448                   ;
  449 C737  7A          CUU80:	LD	A,D		; aktuelle Zeile
  450 C738  A7          	AND	A		; ganz oben?
  451 C739  20 05       	JR	NZ,CUU2		; nein
  452 C73B  CD C743     	CALL	CUU3		; scrollen
  453 C73E  D8          	RET	C		; nicht gescrollt
  454 C73F  3E          	DB	3Eh		; LD A,n (in Zeile 0 bleiben)
  455                   	;
  456 C740  15          CUU2:	DEC	D		; eine Zeile hoch
  457 C741  18 A2       	JR	CUD1		; hinter letztes Zeichen gehen
  458                   	;
  459 C743  D5          CUU3:	PUSH	DE		; Cursorposition
  460 C744  2A 001C     	LD	HL,(T1E)
  461 C747  ED 5B 0018  	LD	DE,(T1A)
  462 C74B  A7          	AND	A
  463 C74C  ED 52       	SBC	HL,DE		; sind wir bereits am Textanfang?
  464 C74E  D1          	POP	DE
  465 C74F  37          	SCF			; nicht gescrollt
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  23
EDITOR  Z80

  466 C750  C8          	RET	Z		; kein Text 1
  467 C751  D5          	PUSH	DE
  468 C752  2A 001C     	LD	HL,(T1E)	; Ende Text 1 merken
  469 C755  E5          	PUSH	HL
  470 C756  ED 5B B79E  	LD	DE,(WINLG)
  471 C75A  15          	DEC	D
  472 C75B  1E 00       	LD	E,0		; letzte Zeile
  473 C75D  CD C561     	CALL	DABR80		; VRAM-Adresse berechnen
  474 C760  CD D730     	CALL	MLINE		; Zeile abspeichern, ab T1E
  475 C763  D1          	POP	DE		; alter Wert von T1E
  476 C764  D4 D6ED     	CALL	NC,TXE4		; zum Anfang von Text 2 verschieben
  477 C767  D1          	POP	DE
  478                   ;	SCF
  479                   ;	RET	NZ		; no Memory
  480 C768  D5          	PUSH	DE
  481 C769  CD C7FF     	CALL	DOSCRL		; Bild nach unten scrollen
  482 C76C  2A 001C     	LD	HL,(T1E)	; Ende Text 1
  483 C76F  06 02       	LD	B,2		; 2x CR suchen
  484 C771  2B          CUU4:	DEC	HL
  485 C772  CD 0086     	CALL	GET		; Zeichen aus Textspeicher
  486 C775  FE 0D       	CP	CR		; Zeilenende?
  487 C777  20 F8       	JR	NZ,CUU4
  488 C779  10 F6       	DJNZ	CUU4
  489 C77B  23          CUU5:	INC	HL		; nach CR+LF
  490 C77C  CD 0086     	CALL	GET
  491 C77F  FE 0A       	CP	LF		; noch ein LF dahinter?
  492 C781  28 F8       	JR	Z,CUU5
  493 C783  22 001C     	LD	(T1E),HL
  494 C786  2A 001E     	LD	HL,(T2A)
  495 C789  E5          	PUSH	HL
  496 C78A  11 0000     	LD	DE,0		; erste Zeile
  497 C78D  CD C561     	CALL	DABR80		; HL=VRAM-Adresse
  498 C790  ED 4B 001C  	LD	BC,(T1E)	; aus Teiltext 1 neu anzeigen
  499 C794  CD D78D     	CALL	WRZLE		; erste Zeile anzeigen
  500 C797  E1          	POP	HL
  501 C798  22 001E     	LD	(T2A),HL
  502 C79B  2A 0012     	LD	HL,(MEML)
  503 C79E  2B          	DEC	HL		; Textzeile -1
  504 C79F  22 0012     	LD	(MEML),HL
  505 C7A2  D1          	POP	DE
  506 C7A3  A7          	AND	A		; erfolgreich gescrollt
  507 C7A4  C9          	RET
  508                   ;
  509                   ; Bildschirminhalt eine Zeile nach oben scrollen (fuer CUD, CUR, Sh-DEL)
  510                   ; (ohne Statuszeile, aber mit VRAM)
  511                   ; PE:	B	Rollweite in Zeilen (bis Bildschirmende)
  512                   ;
  513 C7A5  06 16       UPSCRL:	LD	B,22		; 22 Zeilen = Textfenster nach oben scrollen
  514                   	; 10 Pixel/Zeile (max. 220 Byte) im Pixel-RAM scrollen
  515 C7A7  3E 16       UROLL:	LD	A,22
  516 C7A9  90          	SUB	B
  517 C7AA  D8          	RET	C		; ausserhalb!
  518 C7AB  67          	LD	H,A		; aktuelle Zeile
  519 C7AC  2E 00       	LD	L,0		; Spalte 0
  520 C7AE  78          	LD	A,B
  521 C7AF  87          	ADD	A,A	;*2
  522 C7B0  4F          	LD	C,A
  523 C7B1  87          	ADD	A,A	;*4
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  24
EDITOR  Z80

  524 C7B2  87          	ADD	A,A	;*8
  525 C7B3  81          	ADD	A,C	;*10 Pixel pro Zeile
  526 C7B4  4F          	LD	C,A		; Anzahl Bytes bis BS-Ende
  527 C7B5  C5          	PUSH	BC
  528 C7B6  CD C58A     	CALL	CUADR		; Pixel-Adresse berechnen
  529 C7B9  54          	LD	D,H
  530 C7BA  5D          	LD	E,L		; DE = aktuelle Zeile
  531 C7BB  7D          	LD	A,L
  532 C7BC  C6 0A       	ADD	A,10
  533 C7BE  6F          	LD	L,A		; HL = Folgezeile
  534 C7BF  3E 28       	LD	A,40		; BS-Breite in Bytes
  535 C7C1  E5          ROLL1:	PUSH	HL
  536 C7C2  D5          	PUSH	DE
  537 C7C3  C5          	PUSH	BC
  538 C7C4  06 00       	LD	B,0
  539 C7C6  ED B0       	LDIR			; Pixel fuer eine Spalte scrollen
  540 C7C8  EB          	EX	DE,HL
  541 C7C9  06 0A       	LD	B,10		; Zeichenhoehe
  542 C7CB  36 00       ROLL2:	LD	(HL),0		; letzte Zeile loeschen
  543 C7CD  23          	INC	HL
  544 C7CE  10 FB       	DJNZ	ROLL2
  545 C7D0  C1          	POP	BC
  546 C7D1  D1          	POP	DE
  547 C7D2  E1          	POP	HL
  548 C7D3  14          	INC	D		; naechste Spalte
  549 C7D4  24          	INC	H		;	"
  550 C7D5  3D          	DEC	A
  551 C7D6  20 E9       	JR	NZ,ROLL1	; bis alle Spalten gescrollt sind
  552                   	; 80 Byte/Zeile (max. 220 Byte) im VRAM scrollen
  553 C7D8  C1          	POP	BC		; C = 10*Zeilen bis BS-Ende
  554 C7D9  06 00       	LD	B,0
  555 C7DB  CB 21       	sla	c	; *20
  556 C7DD  CB 10       	rl	b
  557 C7DF  CB 21       	sla	c	; *40
  558 C7E1  CB 10       	rl	b
  559 C7E3  CB 21       	sla	c	; *80
  560 C7E5  CB 10       	rl	b		; BC = Scrollweite in Byte
  561 C7E7  21 B480     	LD	HL,0B480h	; VRAM-Adresse letzte Zeile
  562 C7EA  ED 42       	SBC	HL,BC
  563 C7EC  54          	LD	D,H
  564 C7ED  5D          	LD	E,L		; DE = VRAM-Adresse Ziel
  565 C7EE  C5          	PUSH	BC
  566 C7EF  01 0050     	LD	BC,80		; eine Zeile darunter
  567 C7F2  09          	ADD	HL,BC		; HL = VRAM-Adresse Quelle
  568 C7F3  C1          	POP	BC
  569 C7F4  ED B0       	LDIR			; VRAM scrollen
  570 C7F6  EB          	EX	DE,HL		; HL=VRAM letzte Zeile
  571 C7F7  06 50       ROLL3:	LD	B,80
  572 C7F9  AF          	XOR	A
  573 C7FA  77          ROLL4:	LD	(HL),A		; letzte Zeile im VRAM loeschen
  574 C7FB  23          	INC	HL
  575 C7FC  10 FC       	DJNZ	ROLL4
  576 C7FE  C9          	RET
  577                   ;
  578                   ; Bildschirminhalt eine Zeile nach unten scrollen (fuer CUU, CUL, Enter)
  579                   ; (ohne Statuszeile, aber mit VRAM)
  580                   ; PE:	B	Rollweite in Zeilen (bis Bildschirmende)
  581                   ;
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  25
EDITOR  Z80

  582 C7FF  06 16       DOSCRL:	LD	B,22		; 22 Zeilen = Textfenster nach unten scrollen
  583                   	; 10 Pixel/Zeile (max. 220 Byte) im Pixel-RAM scrollen
  584 C801  3E 16       DROLL:	LD	A,22
  585 C803  90          	SUB	B
  586 C804  D8          	RET	C		; ausserhalb!
  587 C805  78          	LD	A,B
  588 C806  87          	ADD	A,A	;*2
  589 C807  4F          	LD	C,A
  590 C808  87          	ADD	A,A	;*4
  591 C809  87          	ADD	A,A	;*8
  592 C80A  81          	ADD	A,C	;*10 Pixel pro Zeile
  593 C80B  4F          	LD	C,A
  594 C80C  06 00       	LD	B,0		; BC = Anzahl Bytes bis BS-Ende
  595 C80E  16 80       	LD	D,80h		; IRM Spalte 0
  596 C810  62          	LD	H,D
  597 C811  3E 28       	LD	A,40		; BS-Breite in Bytes
  598 C813  1E FF       ROLL5:	LD	E,0FFh		; Ende letzte Zeile
  599 C815  2E F5       	LD	L,0FFh-10	; Ende vorletzte Zeile
  600 C817  C5          	PUSH	BC
  601 C818  0C          	INC	C
  602 C819  0D          	DEC	C		; sind wir in der letzten Zeile?
  603 C81A  28 02       	JR	Z,ROLL6		; dann nicht scrollen, nur loeschen!
  604 C81C  ED B8       	LDDR			; Pixel fuer eine Spalte scrollen
  605 C81E  06 0A       ROLL6:	LD	B,10		; Zeichenhoehe
  606 C820  23          ROLL7:	INC	HL
  607 C821  36 00       	LD	(HL),0		; oberste Zeile loeschen
  608 C823  10 FB       	DJNZ	ROLL7
  609 C825  C1          	POP	BC
  610 C826  14          	INC	D		; naechste Spalte
  611 C827  24          	INC	H		;	"
  612 C828  3D          	DEC	A
  613 C829  20 E8       	JR	NZ,ROLL5	; bis alle Spalten gescrollt sind
  614                   	; 80 Byte/Zeile (max. 220 Byte) im VRAM scrollen
  615                   			; BC = 10*Zeilen bis BS-Ende
  616 C82B  11 B4CF     	LD	DE,0B4CFH	; VRAM Ende letzte Zeile
  617 C82E  21 B47F     	LD	HL,0B4CFH-80	; VRAM Ende vorletzte Zeile
  618 C831  0C          	INC	C
  619 C832  0D          	DEC	C		; sind wir in der letzten Zeile?
  620 C833  28 0E       	JR	Z,ROLL8		; dann auch VRAM nicht scrollen, nur loeschen!
  621 C835  CB 21       	sla	c	; *20
  622 C837  CB 10       	rl	b
  623 C839  CB 21       	sla	c	; *40
  624 C83B  CB 10       	rl	b
  625 C83D  CB 21       	sla	c	; *80
  626 C83F  CB 10       	rl	b		; BC = Scrollweite in Byte
  627 C841  ED B8       	LDDR			; VRAM 80 Byte/Zeile scrollen
  628 C843  23          ROLL8:	INC	HL
  629 C844  18 B1       	JR	ROLL3		; VRAM oberste Zeile loeschen
  630                   ;
  631                   ; 12H - naechste Seite (Shift-CUD)
  632                   ;
  633 C846  2A 001A     ENPG:	LD	HL,(T2E)	; Ende Teiltext 2
  634 C849  ED 4B 001E  	LD	BC,(T2A)	; Anfang Teiltext 2
  635 C84D  B7          	OR	A		; CY=0
  636 C84E  ED 42       	SBC	HL,BC
  637 C850  C8          	RET	Z		; Textende bereits erreicht
  638 C851  CD D70A     	CALL	MPAGE		; Seite speichern
  639 C854  D8          	RET	C		; No Memory
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  26
EDITOR  Z80

  640 C855  11 0016     	LD	DE,22
  641 C858  CD D64F     	CALL	TXANF		; 22 Zeilen vorwaerts
  642 C85B  2A 001A     	LD	HL,(T2E)
  643 C85E  ED 5B 001E  	LD	DE,(T2A)
  644 C862  ED 52       	SBC	HL,DE
  645 C864  CC D2B6     	CALL	Z,BOT		; wenn Textende
  646 C867  18 15       	JR	SCUU3
  647                   ;
  648                   ; 11h - vorherige Seite (Shift-CUU)
  649                   ;
  650 C869  2A 001C     EVPG:	LD	HL,(T1E)	; Ende Teiltext 1
  651 C86C  ED 4B 0018  	LD	BC,(T1A)	; Anfang Teiltext 1
  652 C870  B7          	OR	A		; CY=0
  653 C871  ED 42       	SBC	HL,BC
  654 C873  C8          	RET	Z		; Textanfang bereits erreicht
  655 C874  CD D70A     	CALL	MPAGE		; Seite speichern
  656 C877  D8          	RET	C		; No Memory
  657 C878  11 0016     	LD	DE,22
  658 C87B  CD D6A4     	CALL	TXEND		; 22 Zeilen rueckwaerts
  659 C87E  CD D7F5     SCUU3:	CALL	WRPG0		; Seite neu anzeigen (ohne Statuszeile)
  660 C881  C3 C6E5     	JP	CUD1		; Cursor nach Ende des letzten Zeichens setzen
  661                   ;
  662                   ; 0Ch = Bildschirm loeschen (ab Home-Posision bis Bildschrimende)
  663                   ;	also mit oder ohne Statuszeile moeglich
  664                   ;
  665 C884  2A B79C     CLS80:	LD	HL,(WINON)	; Home-Position
  666 C887  CD C58A     	CALL	CUADR		; IRM-Adresse berechnen
  667 C88A  54          	LD	D,H
  668 C88B  5D          	LD	E,L
  669 C88C  13          	INC	DE
  670 C88D  3A B79F     	LD	A,(WINLG+1)	; Anzahl Zeilen
  671 C890  87          	ADD	A,A		; *2
  672 C891  4F          	LD	C,A
  673 C892  87          	ADD	A,A		; *4
  674 C893  87          	ADD	A,A		; *8
  675 C894  81          	ADD	A,C		; *10
  676 C895  3D          	DEC	A		; -1
  677 C896  06 00       	LD	B,0
  678 C898  4F          	LD	C,A		; BC = Pixel in der Hoehe
  679 C899  3A B79E     	LD	A,(WINLG)	; Fensterbreite
  680 C89C  CB 3F       	SRL	A		; /2 = Anzahl Bytes in der Breite
  681 C89E  E5          CLS1:	PUSH	HL
  682 C89F  D5          	PUSH	DE
  683 C8A0  C5          	PUSH	BC
  684 C8A1  36 00       	LD	(HL),0
  685 C8A3  ED B0       	LDIR			; Pixel fuer eine BS-Spalte loeschen
  686 C8A5  C1          	POP	BC
  687 C8A6  D1          	POP	DE
  688 C8A7  E1          	POP	HL
  689 C8A8  24          	INC	H		; naechste Spalte
  690 C8A9  14          	INC	D
  691 C8AA  3D          	DEC	A
  692 C8AB  20 F1       	JR	NZ,CLS1
  693                   
  694 C8AD  ED 4B B79E  	LD	BC,(WINLG)	; C=Spalten, B=Zeilen
  695 C8B1  50          	LD	D,B
  696 C8B2  CD F003     	CALL	PV1
  697 C8B5  41          	DB	MULT		; BA = D*B
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  27
EDITOR  Z80

  698 C8B6  4F          	LD	C,A		; BC = Anzahl Zeichen bis Bildschirm-Ende
  699 C8B7  ED 5B B79C  	LD	DE,(WINON)	; Home-Position
  700 C8BB  CD C561     	CALL	DABR80		; VRAM-Adresse berechnen
  701 C8BE  54          	LD	D,H
  702 C8BF  5D          	LD	E,L
  703 C8C0  13          	INC	DE
  704 C8C1  0B          	DEC	BC
  705 C8C2  36 00       	LD	(HL),0
  706 C8C4  ED B0       	LDIR			; VRAM bis Bildschirmende loeschen
  707                   ;
  708                   ; 10h = Home-Position
  709                   ;
  710 C8C6  16 00       HOME80:	LD	D,0		; Zeile 0
  711                   
  712                   ; 0Dh = CR = Cursor auf Spalte 0
  713                   
  714 C8C8  1E 00       CBL80:	LD	E,0		; Spalte 0
  715 C8CA  C9          	RET
  716                   ;
  717                   ; 17h = Shift-HOME (Cursor rechts runter):
  718                   ;
  719 C8CB  ED 5B B79E  ECLS:	LD	DE,(WINLG)	; Fenstergroesse
  720 C8CF  15          	DEC	D		; letzte Zeile
  721 C8D0  1D          	DEC	E		; letzte Spalte
  722 C8D1  C9          	RET
  723                   
  724                   ; 02h = aktuelle Zeile loeschen
  725                   
  726                   ;CLLN80:	LD	HL,(CURSO)
  727                   ;	CALL	CUADR		; BS-Adresse berechnen (HL=IRM, CY=rechts/links)
  728                   ;	XOR	A
  729                   ;	LD	C,40		; Bytes in der Breite
  730                   ;CLL1:	LD	B,10
  731                   ;	PUSH	HL
  732                   ;CLL2:	LD	(HL),A		; Pixel loeschen
  733                   ;	INC	HL
  734                   ;	DJNZ	CLL2
  735                   ;	POP	HL
  736                   ;	INC	H		; naechste Spalte
  737                   ;	DEC	C
  738                   ;	JR	NZ,CLL1
  739                   ;	LD	DE,(CURSO)
  740                   ;	CALL	DABR80		; Adresse Video-RAM berechnen
  741                   ;	LD	D,H
  742                   ;	LD	E,L
  743                   ;	INC	DE
  744                   ;	LD	(HL),0
  745                   ;	LD	BC,79		; eine Zeile breit
  746                   ;	LDIR			; VRAM loeschen
  747                   ;	LD	DE,(CURSO)
  748                   ;	JR	CBL80		; Spalte 0 einstellen
  749                   ;
  750                   ; 08H = Cursor nach links
  751                   ; PA:	CY=1	nicht moeglich (Textanfang)
  752                   ;
  753 C8D2  7B          CUL80:	LD	A,E		; Spalte
  754 C8D3  A7          	AND	A		; ganz links?
  755 C8D4  28 03       	JR	Z,CUL1
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  28
EDITOR  Z80

  756 C8D6  1D          	DEC	E		; eine Position nach links gehen
  757 C8D7  18 0F       	JR	CUL3
  758                   	;
  759 C8D9  7A          CUL1:	LD	A,D		; Zeile
  760 C8DA  A7          	AND	A		; ganz oben?
  761 C8DB  20 05       	JR	NZ,CUL2		; nein
  762                   ;	PUSH	DE
  763 C8DD  CD C743     	CALL	CUU3		; scrollen
  764                   ;	POP	DE
  765 C8E0  D8          	RET	C		; nicht gescrollt
  766 C8E1  3E          	DB	3Eh		; LD A,n (in Zeile 0 bleiben)
  767                   	;
  768 C8E2  15          CUL2:	DEC	D		; eine Zeile nach oben gehen
  769 C8E3  3A B79E     	LD	A,(WINLG)	; Spalten im aktuellen Fenster
  770 C8E6  3D          	DEC	A		; letzte Spalte
  771 C8E7  5F          	LD	E,A		; Cursor auf letzte Spalte setzen
  772 C8E8  7B          CUL3:	LD	A,E		; neue Spalte
  773 C8E9  E6 07       	AND	7		; modulo 8
  774 C8EB  C8          	RET	Z		; wir stehen auf Tab-Stopp
  775 C8EC  CD C561     	CALL	DABR80		; VRAM-Adresse berechnen
  776 C8EF  7E          	LD	A,(HL)
  777 C8F0  B7          	OR	A		; Dummy?
  778 C8F1  C0          	RET	NZ		; nein -> fertig
  779 C8F2  2B          	DEC	HL
  780 C8F3  7E          	LD	A,(HL)
  781 C8F4  B7          	OR	A		; Dummy davor?
  782 C8F5  28 DB       	JR	Z,CUL80		; ja, weiter nach links
  783 C8F7  C9          	RET
  784                   ;
  785                   ; 19H = Wort nach links (Shift-CUL)
  786                   ;	- Leerzeichen suchen
  787                   ;	- nicht leeres Zeichen bis links davon leer
  788                   ;
  789 C8F8  CD C8D2     WLE0:	CALL	CUL80		; Cursor nach links
  790 C8FB  D8          	RET	C		; Textanfang erreicht
  791 C8FC  CD C561     WLEFT:	CALL	DABR80		; VRAM-Adresse berechnen
  792 C8FF  7E          	LD	A,(HL)
  793 C900  FE 21       	CP	21h		; Leerzeichen?
  794 C902  30 F4       	JR	NC,WLE0		; nein
  795                   	;
  796 C904  CD C561     WLE1:	CALL	DABR80		; VRAM-Adresse berechnen
  797 C907  7E          	LD	A,(HL)
  798 C908  FE 21       	CP	21h		; Leerzeichen?
  799 C90A  30 0D       	JR	NC,WLE3		; nein
  800 C90C  CD C8D2     	CALL	CUL80		; Cursor nach links
  801 C90F  D8          	RET	C		; Textanfang erreicht
  802 C910  18 F2       	JR	WLE1		; bis wir auf einem Wort stehen
  803                   	;
  804 C912  CD C8D2     WLE2:	CALL	CUL80		; Cursor nach links
  805 C915  D8          	RET	C		; Textanfang erreicht
  806 C916  CD C561     	CALL	DABR80		; VRAM-Adresse berechnen
  807 C919  2B          WLE3:	DEC	HL		; Zeichen links davon
  808 C91A  7E          	LD	A,(HL)
  809 C91B  FE 21       	CP	21h		; Wortanfang?
  810 C91D  D8          	RET	C		; ja, davor ist ein Leerzeichen
  811 C91E  18 F2       	JR	WLE2		; zurueck bis zum Anfang des Wortes
  812                   ;
  813                   ; 0Fh = Hardcopy (Verlassen des 80-Zeichen-Modus, da CALC das nicht kennt)
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  29
EDITOR  Z80

  814                   ;
  815 C920  D5          HCOPY:	PUSH	DE		; Cursorposition
  816 C921  CD CA97     	CALL	SET40		; 40-Zeichen-Modus aktivieren
  817 C924  2A B799     	LD	HL,(HCADR)	; ShCLR
  818 C927  CD C931     	CALL	JPHL		; Routine aufrufen
  819 C92A  CD CA38     	CALL	SET80		; zurueck zum 80-Zeichenmodus
  820 C92D  D1          	POP	DE		; Cursorposition
  821 C92E  C3 D982     	JP	WIN82		; Editor-Fenster einstellen
  822                   	;
  823 C931  E9          JPHL:	JP	(HL)
  824                   ;
  825                   ; 13h = Rotation 3 Zeichensaetze CAOS -> IBM -> ASCII deutsch (STOP)
  826                   ;
  827 C932  21 003E     ASCII:	LD	HL,STAT
  828 C935  7E          asc0:	LD	A,(HL)
  829 C936  C6 20       	ADD	A,20H		; 00 -> 20 -> 40 -> 60
  830 C938  77          	LD	(HL),A
  831 C939  E6 60       	AND	60H		; Bit 5+6 vom Zeichensatz ausfiltern
  832 C93B  FE 60       	CP	60H
  833 C93D  28 F6       	JR	Z,asc0		; einen 4. Zeichensatz gibt es (noch) nicht!
  834                   ; Bildschirm aktualisieren
  835 C93F  11 0000     	ld	de,0		; Zeile 0, Spalte 0
  836 C942  21 ADA0     	ld	hl,0ada0h	; zugehoerige VRAM-Adresse
  837 C945  7E          asc1:	ld	a,(hl)
  838 C946  23          	inc	hl
  839 C947  FE 40       	cp	40h
  840 C949  28 14       	jr	z,asc2		; Klammeraffe
  841 C94B  FE 60       	cp	60h
  842 C94D  28 10       	jr	z,asc2		; (c)
  843 C94F  FE 5B       	cp	5bh
  844 C951  38 0F       	jr	c,asc3
  845 C953  FE 5E       	cp	5eh
  846 C955  38 08       	jr	c,asc2		; Umlaute in Grossbuchstaben
  847 C957  FE 7B       	cp	7bh
  848 C959  38 07       	jr	c,asc3
  849 C95B  FE 7F       	cp	7fh
  850 C95D  30 03       	jr	nc,asc3
  851 C95F  CD C5B5     asc2:	call	wpix		; Zeichen neu anzeigen
  852 C962  1C          asc3:	inc	e		; Spalte+1
  853 C963  3E 50       	ld	a,80
  854 C965  93          	sub	e
  855 C966  20 DD       	jr	nz,asc1
  856 C968  5F          	ld	e,a		; Spalte 0
  857 C969  14          	inc	d		; Zeile+1
  858 C96A  3E 17       	ld	a,23
  859 C96C  BA          	cp	d
  860 C96D  20 D6       	jr	nz,asc1
  861 C96F  18 12       	JR	CLI1
  862                   ;
  863                   ; 1Ah = Umschaltung Einfuegen <-> Ueberschreiben (INS)
  864                   ;
  865 C971  3A 003E     INS80:	LD	A,(STAT)
  866 C974  EE 10       	XOR	10H		; Umschaltung INS-Mode Bit 4
  867 C976  32 003E     SETST:	LD	(STAT),A
  868 C979  18 08       	JR	CLI1
  869                   ;
  870                   ; 14h = Tastenclick EIN/AUS (Shift+INS wie unter CAOS)
  871                   ;
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  30
EDITOR  Z80

  872 C97B  DD 7E 08    CLICK:	LD	A,(IX+8)
  873 C97E  EE 20       	XOR	20H		; Click EIN/AUS
  874 C980  DD 77 08    	LD	(IX+8),A
  875 C983  CD D845     CLI1:	CALL	STATUS		; und in Statuszeile anzeigen
  876 C986  ED 5B 0020  CLI2:	LD	DE,(COL)
  877 C98A  ED 53 B7A0  	LD	(CURSO),DE
  878 C98E  C9          	RET
  879                   ;
  880                   ; 01H = CLR	Zeichen vor Cursor loeschen und nach links gehen
  881                   ;
  882 C98F  7B          CLR80:	LD	A,E		; Spalte
  883 C990  A7          	AND	A		; ganz links?
  884 C991  28 03       	JR	Z,CLR1
  885 C993  1D          	DEC	E		; eine Position nach links gehen
  886 C994  18 10       	JR	CLR3
  887                   	;
  888 C996  7A          CLR1:	LD	A,D		; Zeile
  889 C997  A7          	AND	A		; ganz oben?
  890 C998  20 09       	JR	NZ,CLR2		; nein
  891 C99A  3C          	INC	A		; wir srollen und gehen in naechste Zeile
  892 C99B  32 B7A1     	LD	(CURSO+1),A	; als aktuelle Position eintragen
  893 C99E  CD C743     	CALL	CUU3		; 1 Zeile hoch scrollen
  894 C9A1  D8          	RET	C		; nicht gescrollt, wir sind am Textanfang!
  895 C9A2  3E          	DB	3Eh		; LD A,n (in Zeile 0 bleiben)
  896 C9A3  15          CLR2:	DEC	D		; eine Zeile nach oben gehen
  897 C9A4  1E 4F       	LD	E,79		; letzte Spalte
  898 C9A6  CD C561     CLR3:	CALL	DABR80		; VRAM-Adresse berechnen
  899 C9A9  7E          	LD	A,(HL)
  900 C9AA  A7          	AND	A		; steht da ein Zeichen?
  901 C9AB  20 10       	JR	NZ,CLR9		; ja, das kann geloescht werden
  902                   ;ansonsten von der vorherigen TAB-Position mit Leerzeichen auffuellen
  903 C9AD  7D          	LD	A,L
  904 C9AE  E6 F8       	AND	0F8h		; zurueck zur vorherigen TAB-Position
  905 C9B0  6F          	LD	L,A
  906 C9B1  7E          CLR4:	LD	A,(HL)		; Zeichen testen
  907 C9B2  A7          	AND	A		; leer?
  908 C9B3  20 02       	JR	NZ,CLR5
  909 C9B5  36 20       	LD	(HL),' '	; wenn leer, dann Space eintragen
  910 C9B7  23          CLR5:	INC	HL		; naechstes Zeichen
  911 C9B8  7D          	LD	A,L
  912 C9B9  E6 07       	AND	7		; naechster TAB-Stop?
  913 C9BB  20 F4       	JR	NZ,CLR4		; nein, weiter auffuellen
  914 C9BD  ED 5B B7A0  CLR9:	LD	DE,(CURSO)
  915 C9C1  CD C8D2     	CALL	CUL80		; Cursor nach links
  916 C9C4  D8          	RET	C		; Textanfang erreicht
  917                   ;
  918                   ; 1FH = DEL	Zeichen auf Cursorposition loeschen, Rest nach links nachruecken
  919                   ;
  920 C9C5  D5          DEL80:	PUSH	DE		; Cursor retten
  921 C9C6  CD C561     	CALL	DABR80		; VRAM-Adresse berechnen
  922 C9C9  7E          	LD	A,(HL)
  923 C9CA  B7          	OR	A		; Dummy?
  924 C9CB  28 24       	JR	Z,DEL4		; ja, nichts weiter zu tun...
  925 C9CD  E5          	PUSH	HL		; VRAM
  926 C9CE  D5          DEL1:	PUSH	DE		; Cursorpos.
  927 C9CF  1C          	INC	E		; naechste Spalte
  928 C9D0  CD C561     	CALL	DABR80		; raus?
  929 C9D3  30 08       	JR	NC,DEL2
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  31
EDITOR  Z80

  930 C9D5  1E 00       	LD	E,0		; ja, wie NL
  931 C9D7  14          	INC	D
  932 C9D8  CD C561     	CALL	DABR80		; raus?
  933 C9DB  38 0F       	JR	C,DEL3		; ja, Ende
  934 C9DD  7E          DEL2:	LD	A,(HL)
  935 C9DE  A7          	AND	A		; Ende?
  936 C9DF  28 0B       	JR	Z,DEL3
  937 C9E1  42          	LD	B,D
  938 C9E2  4B          	LD	C,E		; BC:=DE
  939 C9E3  D1          	POP	DE		; DE=Cursorpos. links davon
  940 C9E4  E3          	EX	(SP),HL		; HL=VRAM links
  941 C9E5  CD C5B2     	CALL	WRZCH		; Zeichen eintragen und anzeigen
  942 C9E8  50          	LD	D,B
  943 C9E9  59          	LD	E,C		; DE:=BC
  944 C9EA  18 E2       	JR	DEL1		; von vorn
  945                   	;
  946 C9EC  D1          DEL3:	POP	DE
  947 C9ED  E1          	POP	HL
  948 C9EE  CD C5B1     	CALL	WRZCH0		; Zeichen loeschen
  949 C9F1  D1          DEL4:	POP	DE
  950 C9F2  C9          	RET
  951                   
  952         0001      IF EXRAM	; Routinen fuer Textspeicherzugriff
  953                   ;
  954                   ; IRM und LED ausschalten
  955                   ;
  956 C9F3  F5          IRM_OF:	PUSH	AF
  957 C9F4  DB 88       	IN	A,(88H)
  958 C9F6  E6 5B       	AND	5BH		; IRM, USER-ROM und LED off
  959 C9F8  D3 88       	OUT	(88H),A
  960 C9FA  F1          	POP	AF
  961 C9FB  C9          	RET
  962                   ;
  963                   ; Text kopieren mit LDIR
  964                   ;
  965         0063      TLDIR	EQU	$+RAMC-IRM_OF
  966 C9FC  CD 005A     	CALL	RAMC		; IRM OFF
  967 C9FF  ED B0       	LDIR
  968 CA01  18 2C       	JR	IRM_ON
  969                   ;
  970                   ; Text kopieren mit LDDR
  971                   ;
  972         006A      TLDDR	EQU	$+RAMC-IRM_OF
  973 CA03  CD 005A     	CALL	RAMC		; IRM OFF
  974 CA06  ED B8       	LDDR
  975 CA08  18 25       	JR	IRM_ON
  976                   ;
  977                   ; Zeichen suchen mit CPIR
  978                   ;
  979         0071      TCPIR	EQU	$+RAMC-IRM_OF
  980 CA0A  CD 005A     	CALL	RAMC		; IRM OFF
  981 CA0D  ED B1       	CPIR
  982 CA0F  18 1E       	JR	IRM_ON
  983                   ;
  984                   ; Zeichen suchen mit CPDR
  985                   ;
  986         0078      TCPDR	EQU	$+RAMC-IRM_OF
  987 CA11  CD 005A     	CALL	RAMC		; IRM OFF
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  32
EDITOR  Z80

  988 CA14  ED B9       	CPDR
  989 CA16  18 17       	JR	IRM_ON
  990                   ;
  991                   ; Zeichen suchen mit CPI
  992                   ;
  993         007F      TCPI	EQU	$+RAMC-IRM_OF
  994 CA18  CD 005A     	CALL	RAMC		; IRM OFF
  995 CA1B  ED A1       	CPI
  996 CA1D  18 10       	JR	IRM_ON
  997                   ;
  998                   ; Zeichen aus Textspeicher lesen
  999                   ;
 1000         0086      GET	EQU	$+RAMC-IRM_OF	; Adresse im RAM0
 1001 CA1F  CD 005A     	CALL	RAMC		; IRM OFF
 1002 CA22  7E          	LD	A,(HL)
 1003 CA23  18 0A       	JR	IRM_ON
 1004                   ;
 1005                   ; Zeichen aus Textspeicher lesen
 1006                   ;
 1007         008C      GETBC	EQU	$+RAMC-IRM_OF	; Adresse im RAM0
 1008 CA25  CD 005A     	CALL	RAMC		; IRM OFF
 1009 CA28  0A          	LD	A,(BC)
 1010 CA29  18 04       	JR	IRM_ON
 1011                   ;
 1012                   ; Zeichen in Textspeicher schreiben
 1013                   ;
 1014         0092      PUT	EQU	$+RAMC-IRM_OF
 1015 CA2B  CD 005A     	CALL	RAMC		; IRM OFF
 1016 CA2E  77          	LD	(HL),A
 1017                   ;
 1018                   ; IRM und LED einschalten
 1019                   ;
 1020 CA2F  F5          IRM_ON:	PUSH	AF
 1021 CA30  DB 88       	IN	A,(88H)
 1022 CA32  F6 A4       	OR	0A4H		; IRM, USER-ROM und LED on
 1023 CA34  D3 88       	OUT	(88H),A
 1024 CA36  F1          	POP	AF
 1025 CA37  C9          	RET
 1026 CA38              ENDC:
 1027                   ELSE		; Routinen fuer Textspeicherzugriff
 1093                   ENDIF
 1094                   ;
 1095                   ; 80-Zeichen-Ausgabe initialisieren:
 1096                   ;
 1097 CA38  2A B7B0     SET80:	LD	HL,(SUTAB)	; aktuelle SUTAB (liegt bei CAOS 4.7 im IRM)
 1098 CA3B  5E          	LD	E,(HL)
 1099 CA3C  23          	INC	HL
 1100 CA3D  56          	LD	D,(HL)		; aktuelle CRT-Routine
 1101 CA3E  ED 53 B4D0  	LD	(CRT40),DE	; merken
 1102 CA42  11 C637     	LD	DE,CRT80	; neue CRT-Routine
 1103 CA45  72          	LD	(HL),D
 1104 CA46  2B          	DEC	HL
 1105 CA47  73          	LD	(HL),E
 1106                   
 1107                   ; Routine fuer Cursorblinken umstellen
 1108                   
 1109 CA48  11 004A     	LD	DE,2*25h	; UP 25 = Routine CUCP
 1110 CA4B  19          	ADD	HL,DE
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  33
EDITOR  Z80

 1111 CA4C  5E          	LD	E,(HL)
 1112 CA4D  23          	INC	HL
 1113 CA4E  56          	LD	D,(HL)		; aktuelle CUCP-Routine
 1114 CA4F  ED 53 B4D2  	LD	(CUCP40),DE	; merken
 1115 CA53  11 C644     	LD	DE,CUCP80	; neue CUCP-Routine
 1116 CA56  72          	LD	(HL),D
 1117 CA57  2B          	DEC	HL
 1118 CA58  73          	LD	(HL),E
 1119                   
 1120                   ; ESC-Funktionen umstellen
 1121                   
 1122 CA59  2A B7DD     	LD	HL,(L3TAB)	; aktuelle ESC-Tabelle
 1123 CA5C  22 B4D4     	LD	(L3T40),HL	; merken
 1124 CA5F  3A B7DF     	LD	A,(L3SIZ)	; Laenge der ESC-Tabelle
 1125 CA62  32 B4D6     	LD	(L3S40),A	; merken
 1126 CA65  21 B4EB     	LD	HL,L3EDIT
 1127 CA68  22 B7DD     	LD	(L3TAB),HL	; ESC-Tabelle fuer 80-Zeichen-Modus
 1128 CA6B  3E 24       	LD	A,36		; Anzahl=17 (Druckersteuerzeichen ESC0-9
 1129 CA6D  32 B7DF     	LD	(L3SIZ),A	;	     sowie ESC-A bis ESC-Z)
 1130 CA70  11 DB71     	LD	DE,ESC0		; 10x die gleiche Routine fuer ESC0-9
 1131 CA73  06 0A       	LD	B,10
 1132 CA75  73          SETESC:	LD	(HL),E
 1133 CA76  23          	INC	HL
 1134 CA77  72          	LD	(HL),D
 1135 CA78  23          	INC	HL
 1136 CA79  10 FA       	DJNZ	SETESC
 1137 CA7B  EB          	EX	DE,HL		; und 7 separate Routinen fuer
 1138 CA7C  21 DF4A     	LD	HL,ESCTAB	; ESC-A bis ESC-Z
 1139 CA7F  01 0034     	LD	BC,52		; max. 26 Routinen
 1140 CA82  ED B0       	LDIR
 1141                   
 1142                   ; Position fuer ESC-G auf erstes Grafikzeichen voreinstellen
 1143                   
 1144 CA84  21 0020     	ld	hl,20h		; Zeile 0, Spalte 32
 1145 CA87  22 B4DE     	LD	(GCURS),HL	; hier merken
 1146                   
 1147                   ; Fenstergroesse einstellen auf 25*80
 1148                   
 1149 CA8A  21 0000     WIN80:	LD	HL,0		; Fenster ab links/oben
 1150 CA8D  22 B79C     	LD	(WINON),HL
 1151 CA90  21 1950     	LD	HL,1950H	; 25 Zeilen, 80 Spalten
 1152 CA93  22 B79E     	LD	(WINLG),HL
 1153 CA96  C9          	RET
 1154                   ;
 1155                   ; 80-Zeichen-Ausgabe abschalten
 1156                   ;
 1157 CA97  2A B7B0     SET40:	LD	HL,(SUTAB)	; aktuelle SUTAB (liegt bei CAOS 4.7 im IRM)
 1158 CA9A  ED 5B B4D0  	LD	DE,(CRT40)	; alte CRT-Routine
 1159 CA9E  73          	LD	(HL),E		; regenerieren
 1160 CA9F  23          	INC	HL
 1161 CAA0  72          	LD	(HL),D
 1162                   
 1163                   ; CUCP regenerieren
 1164                   
 1165 CAA1  11 0049     	LD	DE,2*25h-1	; UP 25 = Routine CUCP
 1166 CAA4  19          	ADD	HL,DE
 1167 CAA5  ED 5B B4D2  	LD	DE,(CUCP40)	; alte CUCP-Routine
 1168 CAA9  73          	LD	(HL),E		; regenerieren
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  34
EDITOR  Z80

 1169 CAAA  23          	INC	HL
 1170 CAAB  72          	LD	(HL),D
 1171                   
 1172                   ; ESC-Tabelle regenerieren
 1173                   
 1174 CAAC  2A B4D4     	LD	HL,(L3T40)	; alte ESC-Tabelle
 1175 CAAF  22 B7DD     	LD	(L3TAB),HL	; regenerieren
 1176 CAB2  3A B4D6     	LD	A,(L3S40)	; alte Laenge
 1177 CAB5  32 B7DF     	LD	(L3SIZ),A	; regenerieren
 1178                   
 1179                   ; Fenstergroesse einstellen auf 32*40
 1180                   
 1181 CAB8  21 0000     WIN40:	LD	HL,0		; Fenster ab links/oben
 1182 CABB  22 B79C     	LD	(WINON),HL
 1183 CABE  21 2028     	LD	HL,2028H	; 32 Zeilen, 40 Spalten
 1184 CAC1  22 B79E     	LD	(WINLG),HL
 1185 CAC4  CD F003     	CALL	PV1
 1186 CAC7  20          	DB	NOUT		; Normalausgabe (CRT)
 1187 CAC8  3E 12       	LD	A,12H
 1188 CACA  CD F003     	CALL	PV1
 1189 CACD  00          	DB	CRT		; Scroll-Modus
 1190 CACE  C9          	RET
 1191         0001      IF EXRAM
 1192                   ;
 1193                   ; 16K oder 64K RAM suchen und einschalten
 1194                   ; Hilfsprogramme in den RAM0 kopieren
 1195                   ;
 1196 CACF  06 08       RAMSW:	LD	B,8		; ab Steckplatz 8 suchen
 1197 CAD1  0E 80       NEXT:	LD	C,80H		; I/O-Adresse Modulsteuerung
 1198 CAD3  ED 78       	IN	A,(C)		; Kennbyte lesen
 1199 CAD5  FE F6       	CP	0F6h		; M011 = 64K RAM ?
 1200 CAD7  28 09       	JR	Z,FOUND
 1201 CAD9  FE F4       	CP	0F4h		; M022 = 16K RAM ?
 1202 CADB  28 05       	JR	Z,FOUND
 1203 CADD  04          	INC	B		; naechster Steckplatz
 1204 CADE  20 F1       	JR	NZ,NEXT
 1205 CAE0  18 09       	JR	NORAM		; kein RAM-Modul gefunden
 1206                   	;
 1207 CAE2  16 C3       FOUND:	LD	D,0C3h		; Steuerbyte fuer Adresse C000h
 1208 CAE4  68          	LD	L,B		; Steckplatz
 1209 CAE5  3E 02       	LD	A,2		; Modul "schalten"
 1210 CAE7  CD F003     	CALL	PV1
 1211 CAEA  26          	DB	MODU		; RAM-Modul zuschalten
 1212                   ; Hilfsprogramme fuer Zugriff Textspeicher
 1213 CAEB  21 C9F3     NORAM:	LD	HL,IRM_OF	; von hier aus dem ROM
 1214 CAEE  11 005A     	LD	DE,RAMC		; in den RAM0 (EDAS Assemblierpuffer)
 1215 CAF1  01 0045     	LD	BC,ENDC-IRM_OF
 1216 CAF4  ED B0       	LDIR			; kopieren
 1217 CAF6  C9          	RET
 1218                   ENDIF
 1219                   ;------------------------------------------------------------------------------
 1220 CAF7  7F7F        	DEFW	7F7FH
 1221 CAF9  45 44 49 54 	DB	'EDIT',1
 1222 CAFE  32 BFE7     	LD	(0BFE7H),A	; kein Menuewort QUIT von ASM
 1223 CB01  CD D1DD     	CALL	KEY0		; F-Tasten Standardbelegung
 1224         0001      IF EXRAM
 1225 CB04  CD CACF     	CALL	RAMSW		; RAM zuschalten, Hilfsprogramm kopieren
 1226                   ENDIF
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  35
EDITOR  Z80

 1227 CB07  21 0200     	LD	HL,0200h	; Beginn Textspeicher
 1228 CB0A  36 0D       	LD	(HL),CR		; Anfangszeichen eintragen
 1229 CB0C  23          	INC	HL
 1230 CB0D  22 0018     	LD	(T1A),HL	; Textspeicher 1 Anfang
 1231 CB10  22 001C     	LD	(T1E),HL	; und Ende setzen
 1232 CB13  23          	INC	HL		; Jetzt ermitteln wie weit RAM vorliegt
 1233 CB14  2E FF       	LD	L,0FFh		; zum Ende der Page gehen
 1234 CB16  CD 0086     RAM1:	CALL	GET		; Inhalt lesen
 1235 CB19  4F          	LD	C,A		; merken
 1236 CB1A  2F          	CPL			; negieren
 1237 CB1B  CD 0092     	CALL	PUT		; negierten Wert einschreiben
 1238 CB1E  CD 0086     	CALL	GET		; und wieder zurueck lesen
 1239 CB21  2F          	CPL			; und nochmals negieren
 1240 CB22  B9          	CP	C		; wenn gleich, dann RAM
 1241 CB23  79          	LD	A,C
 1242 CB24  CD 0092     	CALL	PUT		; Originalwert zurueck schreiben
 1243 CB27  20 03       	JR	NZ,RAM2		; kein RAM
 1244 CB29  24          	INC	H		; 1 Page weiter
 1245 CB2A  18 EA       	JR	RAM1
 1246                   	;
 1247 CB2C  25          RAM2:	DEC	H		; letzte RAM-Zelle
 1248 CB2D  3E 03       	LD	A,3
 1249 CB2F  CD 0092     	CALL	PUT		; Endekennung eintragen
 1250 CB32  22 001A     	LD	(T2E),HL	; Textende
 1251 CB35  22 001E     	LD	(T2A),HL	; und Anfang Teil 2
 1252                   
 1253 CB38  21 0000     	LD	HL,0
 1254 CB3B  22 0020     	LD	(COL),HL	; EDIT-Cursor (Spalte 0)
 1255                   
 1256 CB3E  CD CDE8     	CALL	NACLR		; Dateiname loeschen
 1257 CB41  AF          	XOR	A
 1258 CB42  32 0022     	LD	(M4A),A		; 'no memory' ruecksetzen
 1259 CB45  21 4808     	LD	HL,4808H
 1260 CB48  22 0010     	LD	(RANDL),HL	; linker Rand=8, rechter Rand=72
 1261                   ;	LD	HL,1
 1262                   ;	LD	(MEML),HL	; Zeilennummer 1 einstellen
 1263 CB4B  18 0C       	JR	CAOSOK
 1264                   
 1265 CB4D  7F7F        	DEFW	7F7FH
 1266 CB4F  52 45 45 44 	DB	'REEDIT',1
 1267         0001      IF EXRAM
 1268 CB56  CD CACF     	CALL	RAMSW		; RAM zuschalten, Hilfsprogramme kopieren
 1269                   ENDIF
 1270 CB59  01 83F1     CAOSOK:	LD	BC,83F1H
 1271 CB5C  ED 79       	OUT	(C),A		; DEP-Version ruecksetzen!
 1272                   
 1273 CB5E  CD F003     	CALL	PV1
 1274 CB61  23          	DB	OSTR
 1275 CB62  1B 33 00    	DB	ESC,'3',0	; Bild 1
 1276 CB65  CD CAB8     	CALL	WIN40		; grosses Fenster 40-Zeichen-Mode
 1277 CB68  CD F003     	CALL	PV1
 1278 CB6B  23          	DB	OSTR
 1279 CB6C  0C          	DB	CLS		; Bild 1 loeschen
 1280 CB6D  1B 31 00    	DB	ESC,'1',0	; Bild 0
 1281 CB70  CD CAB8     	CALL	WIN40		; grosses Fenster 40-Zeichen-Mode
 1282 CB73  CD F003     	CALL	PV1
 1283 CB76  23          	DB	OSTR
 1284 CB77  0C 00       	DB	CLS,0		; Bild 0 loeaschen
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  36
EDITOR  Z80

 1285 CB79  21 B7A2     	LD	HL,STBT
 1286 CB7C  CB CE       	SET	1,(HL)		; Schreiben Farbe aus (geht schneller!)
 1287                   
 1288 CB7E  21 003E     	LD	HL,STAT		; Statusbits
 1289 CB81  36 00       	LD	(HL),0		; zunaechst ruecksetzen, IBM-Zeichensatz
 1290                   
 1291 CB83  01 FC80     	LD	BC,0FC80H
 1292 CB86  ED 78       	IN	A,(C)
 1293 CB88  FE A7       	CP	0A7H		; Floppy vorhanden?
 1294 CB8A  20 0D       	JR	NZ,REE0		; nein
 1295 CB8C  34          	INC	(HL)		; Bit 0 = 1 (Floppy vorhanden)
 1296                   
 1297 CB8D  01 83F1     	LD	BC,83F1H
 1298 CB90  ED 78       	IN	A,(C)
 1299 CB92  3C          	INC	A
 1300 CB93  FE 21       	CP	21H		; DEP ab V2.0?
 1301 CB95  38 02       	JR	C,REE0		; nein
 1302 CB97  CB CE       	SET	1,(HL)		; Laufwerksabfrage moeglich
 1303                   
 1304                   ; Ein eventuell vorhandenes Menuewort ab 00h (z.B. FLOAD oder ASM) deaktivieren:
 1305 CB99  21 0000     REE0:	LD	HL,0		; ab Adresse 0000H
 1306 CB9C  06 FF       	LD	B,0FFh		; bis zu Adresse 00FFH
 1307 CB9E  7E          REE1:	LD	A,(HL)
 1308 CB9F  23          	INC	HL
 1309 CBA0  FE 7F       	CP	7FH		; CAOS-Prolog?
 1310 CBA2  28 04       	JR	Z,REE2		; gefunden
 1311 CBA4  FE DD       	CP	0DDH		; EDAS/Editor-Prolog?
 1312 CBA6  20 05       	JR	NZ,REE3
 1313 CBA8  BE          REE2:	CP	(HL)		; 2 mal?
 1314 CBA9  20 02       	JR	NZ,REE3
 1315 CBAB  36 00       	LD	(HL),0		; 2. Vorkommen loeschen
 1316 CBAD  10 EF       REE3:	DJNZ	REE1
 1317                   	;
 1318 CBAF  01 18C9     MAIN:	LD	BC,EDIT-0BA00H	; kurzes Menue
 1319 CBB2  18 0B       	JR	MEN0
 1320                   
 1321                   ;-------
 1322 CBB4  DDDD        	DEFW	0DDDDH
 1323 CBB6  4D 45 4E 55 CMENU:	DB	'MENU',1Fh
 1324 CBBB  E1          MEN:	POP	HL		; Stack reinigen
 1325 CBBC  01 4700     	LD	BC,4700H	; langes Menue BA00h-0100h
 1326 CBBF  C5          MEN0:	PUSH	BC		; Menuelaenge
 1327 CBC0  CD CAB8     	CALL	WIN40		; grosses Fenster
 1328 CBC3  CD F003     	CALL	PV1
 1329 CBC6  23          	DB	OSTR
 1330 CBC7  0C 0A 0A 00 	DB	CLS,LF,LF,0	; Bildschirm komplett loeschen
 1331 CBCB  06 28       	LD	B,40
 1332 CBCD  CD F003     ULIN:	CALL	PV1
 1333 CBD0  23          	DB	OSTR
 1334 CBD1  5F 00       	DB	'_',0		; unterstreichen
 1335 CBD3  10 F8       	DJNZ	ULIN
 1336 CBD5  CD CC77     	CALL	TNAME		; Anzeige Dateiname (oder Titel)
 1337 CBD8  CD CCFC     	CALL	PERI		; Anzeige DEVICE
 1338 CBDB  CD CCC2     	CALL	FREE		; Anzeige freier Speicher
 1339 CBDE  CD F003     	CALL	PV1
 1340 CBE1  2D          	DB	HOME
 1341 CBE2  21 BA00     	LD	HL,0BA00H	; Beginn Menuewortsuche (wegen Erweiterungen)
 1342 CBE5  C1          	POP	BC		; Menuelaenge
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  37
EDITOR  Z80

 1343 CBE6  CD F003     MEN1:	CALL	PV1
 1344 CBE9  23          	DB	OSTR
 1345 CBEA  02 2D 00    	DB	2,'-',0		; Prompt
 1346 CBED  CD F003     	CALL	PV1
 1347 CBF0  2A          	DB	BRKT
 1348 CBF1  38 4B       	JR	C,MEN7
 1349 CBF3  3E DD       	LD	A,0DDH		; Edas-Prolog (fest codiert, nicht ueber IX+9)
 1350 CBF5  ED B1       MEN2:	CPIR
 1351 CBF7  E2 CC3E     	JP	PO,MEN7		; Suchbereich fertig
 1352 CBFA  ED A1       	CPI
 1353 CBFC  20 F7       	JR	NZ,MEN2		; nicht 2 * Prologbyte
 1354 CBFE  7E          MEN3:	LD	A,(HL)
 1355 CBFF  FE 20       	CP	20h		; Epilog (0..1Fh)?
 1356 CC01  38 0F       	JR	C,MEN4		; Epilog
 1357 CC03  FE 30       	CP	30H
 1358 CC05  38 DF       	JR	C,MEN1		; < '0'
 1359 CC07  FE 5F       	CP	5FH
 1360 CC09  30 DB       	JR	NC,MEN1		; > 'Z'
 1361 CC0B  CD CE9E     	CALL	CHR
 1362 CC0E  23          	INC	HL
 1363 CC0F  0B          	DEC	BC
 1364 CC10  18 EC       	JR	MEN3
 1365                   	;
 1366 CC12  CD CE99     MEN4:	CALL	LFCR
 1367 CC15  18 CF       	JR	MEN1		; weitersuchen
 1368                   ;
 1369 CC17  E1          NLP1:	POP	HL		; Startadresse vom Stack
 1370 CC18  E1          	POP	HL		; RET-Adresse vom Stack
 1371 CC19  CD DEFE     NLP2:	CALL	DERR		; Error
 1372 CC1C  18 06       	JR	LOOP1
 1373                   	;
 1374 CC1E  3E 0B       LOOP0:	LD	A,0BH		; Zeile hoch
 1375 CC20  CD F003     	CALL	PV1
 1376 CC23  00          	DB	CRT
 1377 CC24  3E 02       LOOP1:	LD	A,2		; Zeile loeschen
 1378 CC26  CD F003     	CALL	PV1
 1379 CC29  00          	DB	CRT
 1380 CC2A  CD F003     LOOP2:	CALL	PV1
 1381 CC2D  20          	DB	NOUT		; Normalausgabe
 1382 CC2E  CD CC77     	CALL	TNAME
 1383 CC31  CD CCC2     	CALL	FREE
 1384 CC34  CD CCFC     	CALL	PERI
 1385 CC37  CD F003     MEN6:	CALL	PV1
 1386 CC3A  23          	DB	OSTR
 1387 CC3B  0D 2D 00    	DB	CR,'-',0	; Prompt
 1388 CC3E  CD F003     MEN7:	CALL	PV1
 1389 CC41  17          	DB	INLIN		; Eingabe im Menuebild
 1390 CC42  38 DA       	JR	C,LOOP0		; BRK
 1391 CC44  13          	INC	DE
 1392 CC45  1A          	LD	A,(DE)
 1393 CC46  FE 20       	CP	' '
 1394 CC48  28 ED       	JR	Z,MEN6		; Beginn mit Space
 1395 CC4A  A7          	AND	A
 1396 CC4B  28 EA       	JR	Z,MEN6
 1397 CC4D  3E DD       	LD	A,0DDH		; Edas-Prolog
 1398 CC4F  21 BA00     	LD	HL,0BA00H
 1399 CC52  01 4700     	LD	BC,4700H	; bis 0100H
 1400 CC55  CD F003     	CALL	PV1
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  38
EDITOR  Z80

 1401 CC58  1D          	DB	ZSUCH		; Menuewort suchen
 1402 CC59  30 BE       	JR	NC,NLP2		; nicht gefunden
 1403                   ;	LD	A,(HL)		; Epilog - ist bei CAOS 4.8 automatisch in A
 1404 CC5B  01 CC2A     	LD	BC,LOOP2
 1405 CC5E  C5          	PUSH	BC		; RET-Adresse auf Stack
 1406 CC5F  23          	INC	HL
 1407 CC60  E5          	PUSH	HL		; Startadresse auf Stack
 1408 CC61  FE 1F       	CP	1FH
 1409 CC63  C8          	RET	Z		; bei Epilog 1Fh ohne Argumente
 1410 CC64  0E 10       	LD	C,16		; Zahlenbasis hexadezimal
 1411 CC66  E6 10       	AND	10h		; Dezimal-Argumente?
 1412 CC68  28 02       	JR	Z,MEN8
 1413 CC6A  0E 0A       	LD	C,10		; Zahlenbasis dezimal
 1414 CC6C  CD F003     MEN8:	CALL	PV1
 1415 CC6F  4C          	DB	GARGC		; bis zu 10 Argumente erfassen
 1416 CC70  38 A5       	JR	C,NLP1		; Fehler in Arg's
 1417 CC72  CD F003     	CALL	PV1
 1418 CC75  15          	DB	LARG
 1419 CC76  C9          	RET			; Ansprung Kommando
 1420                   ;-------
 1421                   ; Anzeige Dateiname in Titelzeile
 1422 CC77  2A B7A0     TNAME:	LD	HL,(CURSO)
 1423 CC7A  E5          	PUSH	HL		; aktuelle Cursorposition merken
 1424 CC7B  CD CAB8     	CALL	WIN40
 1425 CC7E  21 0101     	LD	HL,0101H	; Position Titel oder Dateiname
 1426 CC81  22 B7A0     	LD	(CURSO),HL
 1427 CC84  21 B7F5     	LD	HL,NAMP		; aktueller Dateiname
 1428 CC87  7E          	LD	A,(HL)
 1429 CC88  FE 21       	CP	21h		; Dateiname vorhanden?
 1430 CC8A  38 1C       	JR	C,NONAM		; nein
 1431 CC8C  CD F003     	CALL	PV1
 1432 CC8F  23          	DB	OSTR
 1433 CC90  45 44 49 54 	DB	'EDIT:',0
 1434 CC96  06 08       	LD	B,8
 1435 CC98  CD D630     	CALL	NAME1		; 8 Zeichen Dateiname
 1436 CC9B  3E 2E       	LD	A,'.'
 1437 CC9D  CD F003     	CALL	PV1
 1438 CCA0  00          	DB	CRT
 1439 CCA1  06 03       	LD	B,3
 1440 CCA3  CD D630     	CALL	NAME1		; 3 Zeichen Dateityp
 1441 CCA6  18 43       	JR	FRE2
 1442                   	;
 1443 CCA8  CD F003     NONAM:	CALL	PV1
 1444 CCAB  23          	DB	OSTR
 1445 CCAC  3E 3E 20 4B 	DB	'>> KC-EDIT 0.5 <<',CR,LF,0
 1446 CCC0  18 29       	JR	FRE2		; Fenster regenerieren
 1447                   ;-------
 1448                   ; Anzeige des freien Speicherplatzes:
 1449                   ;
 1450 CCC2  2A B7A0     FREE:	LD	HL,(CURSO)
 1451 CCC5  E5          	PUSH	HL		; aktuelle Cursorposition merken
 1452 CCC6  CD CAB8     	CALL	WIN40		; volles Fenster
 1453 CCC9  21 011D     	LD	HL,011DH	; Pos. fuer Anzeige des freien Speichers
 1454 CCCC  22 B7A0     	LD	(CURSO),HL
 1455 CCCF  CD F003     	CALL	PV1
 1456 CCD2  23          	DB	OSTR
 1457 CCD3  46 72 65 69 	DB	'Frei:',1Fh,1Fh,1Fh,1Fh,0
 1458 CCDD  2A 001E     	LD	HL,(T2A)	; Beginn Teiltext 2
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  39
EDITOR  Z80

 1459 CCE0  ED 5B 001C  	LD	DE,(T1E)	; Ende Teiltext 1
 1460 CCE4  AF          	XOR	A
 1461 CCE5  ED 52       	SBC	HL,DE		; das was dazwischen liegt, ist frei
 1462 CCE7  CD F003     	CALL	PV1
 1463 CCEA  4A          	DB	HLDEZ		; dezimal anzeigen
 1464 CCEB  E1          FRE2:	POP	HL		; aktuelle Cursorposition
 1465 CCEC  22 B7A0     	LD	(CURSO),HL	; regenerieren
 1466                   
 1467                   ; verkuerztes Fenster fuer Menu (unterhalb Titelzeilen):
 1468                   
 1469 CCEF  21 0400     WIN28:	LD	HL,0400h	; ab Zeile 4
 1470 CCF2  22 B79C     	LD	(WINON),HL
 1471 CCF5  21 1C28     	LD	HL,1C28H	; 28 Zeilen
 1472 CCF8  22 B79E     	LD	(WINLG),HL
 1473 CCFB  C9          	RET
 1474                   ;
 1475                   ; Anzeige des aktuellen Devices:
 1476                   ;
 1477 CCFC  2A B7A0     PERI:	LD	HL,(CURSO)
 1478 CCFF  E5          	PUSH	HL		; aktuelle Cursorposition merken
 1479 CD00  CD CAB8     	CALL	WIN40		; volles Fenster
 1480 CD03  21 0113     	LD	HL,0113H
 1481 CD06  22 B7A0     	LD	(CURSO),HL	; Pos. fuer Anzeige des DEVICE
 1482 CD09  3E 28       	LD	A,'('
 1483 CD0B  CD F003     	CALL	PV1
 1484 CD0E  00          	DB	CRT
 1485 CD0F  06 09       	LD	B,9
 1486 CD11  CD F003     PER1:	CALL	PV1
 1487 CD14  2B          	DB	SPACE		; alte Anzeige loeschen
 1488 CD15  10 FA       	DJNZ	PER1
 1489 CD17  3E 14       	LD	A,14H
 1490 CD19  32 B7A0     	LD	(CURSO),A	; Position regenerieren
 1491 CD1C  3E FE       	LD	A,0FEh		; aktuellen Treiber anzeigen
 1492 CD1E  CD F003     	CALL	PV1
 1493 CD21  49          	DB	DEVICE		; 49H - neue Funktion ab CAOS 4.6
 1494                   
 1495                   ; falls Diskette und DEP 2.0 dann DEVICE mit Laufwerk erweitern...
 1496                   
 1497 CD22  11 0114     	LD	DE,0114H	; Cursorposition von DEVICE
 1498 CD25  CD F003     	CALL	PV1		; umrechnen in VRAM-Adresse
 1499 CD28  32          	DB	DABR		; HL = VRAM
 1500 CD29  11 CD69     	LD	DE,DISKN	; Vergleichsname DISK
 1501 CD2C  01 0004     	LD	BC,4		; 4 Zeichen kontrollieren
 1502 CD2F  1A          LWA0:	LD	A,(DE)
 1503 CD30  13          	INC	DE
 1504 CD31  ED A1       	CPI			; Diskette?
 1505 CD33  20 2C       	JR	NZ,LWA3		; nein
 1506 CD35  EA CD2F     	JP	PE,LWA0
 1507 CD38  21 003E     	LD	HL,STAT
 1508 CD3B  CB 4E       	BIT	1,(HL)		; DEP ab Version 2.0?
 1509 CD3D  28 22       	JR	Z,LWA3		; nein
 1510 CD3F  CD F003     	CALL	PV1
 1511 CD42  23          	DB	OSTR
 1512 CD43  3A 00       	DB	':',0
 1513 CD45  3E 01       	LD	A,1		; Lw anfordern
 1514 CD47  01 80F1     	LD	BC,80F1H
 1515 CD4A  ED 79       	OUT	(C),A
 1516 CD4C  ED 78       LWA1:	IN	A,(C)
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  40
EDITOR  Z80

 1517 CD4E  CB 47       	BIT	0,A		; Rueckmeldung?
 1518 CD50  20 FA       	JR	NZ,LWA1		; nein, warten
 1519 CD52  04          	INC	B		; 81F1H
 1520 CD53  ED 78       	IN	A,(C)		; Laufwerk
 1521 CD55  CD CE9E     	CALL	CHR
 1522 CD58  04          	INC	B		; 82F1H
 1523 CD59  ED 68       	IN	L,(C)		; akt. User
 1524 CD5B  26 00       	LD	H,0
 1525 CD5D  CD F003     	CALL	PV1
 1526 CD60  4A          	DB	HLDEZ		; Userbereich dezimal anzeigen
 1527 CD61  3E 29       LWA3:	LD	A,')'
 1528 CD63  CD F003     	CALL	PV1
 1529 CD66  00          	DB	CRT
 1530 CD67  18 82       	JR	FRE2		; Fenster regenerieren
 1531                   	;
 1532 CD69  44 49 53 4B DISKN:	DB	'DISK'
 1533                   
 1534                   ;-------
 1535 CD6D  DDDD        	DEFW	0DDDDH
 1536 CD6F  51 55 49 54 	DB	'QUIT',1
 1537 CD74  CD CAB8     	CALL	WIN40		; grosses Fenster 40-Zeichen-Modus
 1538 CD77  21 B7A1     	LD	HL,CURSO+1
 1539 CD7A  7E          	LD	A,(HL)
 1540 CD7B  C6 04       	ADD	A,4		; Zeile korrigieren
 1541 CD7D  77          	LD	(HL),A
 1542 CD7E  23          	INC	HL		; STBT
 1543 CD7F  CB 8E       	RES	1,(HL)		; Schreiben Farbe ein
 1544                   
 1545 CD81  11 CBB6     	LD	DE,CMENU	; "MENU"
 1546 CD84  21 E000     	LD	HL,0E000H	; Beginn Suchbereich
 1547 CD87  01 2000     	LD	BC,2000h	; Laenge Suchbereich
 1548 CD8A  DD 7E 09    	LD	A,(IX+9)	; Prologbyte
 1549 CD8D  CD F003     	CALL	PV1		; suche CAOS-Kommando MENU
 1550 CD90  1D          	DB	ZSUCH		; Menuewort suchen
 1551 CD91  23          	INC	HL		; Epilogbyte ueberspringen
 1552 CD92  E3          	EX	(SP),HL		; als Return-Adresse auf den Stack legen
 1553 CD93  ED 5B B77F  	LD	DE,(ARGC-1)	; D = urspruenglicher Schaltzustand USER-C
 1554 CD97  3E 02       	LD	A,2		; USER-ROM
 1555 CD99  6F          	LD	L,A		; schalten
 1556 CD9A  1E 26       	LD	E,MODU
 1557 CD9C  C3 F009     	JP	PV3		; zuerst USER-ROM schalten, dann zu CAOS
 1558                   
 1559                   ;-------
 1560 CD9F  DDDD        	DEFW	0DDDDH
 1561 CDA1  43 4C 45 41 	DB	'CLEAR',1Fh
 1562 CDA7  2A 001C     	LD	HL,(T1E)
 1563 CDAA  ED 5B 0018  	LD	DE,(T1A)
 1564 CDAE  A7          	AND	A
 1565 CDAF  ED 52       	SBC	HL,DE
 1566 CDB1  44          	LD	B,H
 1567 CDB2  4D          	LD	C,L
 1568 CDB3  2A 001A     	LD	HL,(T2E)
 1569 CDB6  ED 5B 001E  	LD	DE,(T2A)
 1570 CDBA  ED 52       	SBC	HL,DE
 1571 CDBC  09          	ADD	HL,BC		; Laenge Text 1 + 2
 1572 CDBD  7C          	LD	A,H
 1573 CDBE  B5          	OR	L
 1574 CDBF  28 27       	JR	Z,NACLR		; kein Text, nur Name loeschen
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  41
EDITOR  Z80

 1575 CDC1  CD F003     	CALL	PV1
 1576 CDC4  23          	DB	OSTR
 1577 CDC5  0D 44 65 6C 	DB	CR,'Delete Text',0
 1578 CDD2  CD D55D     	CALL	YESNO
 1579 CDD5  D8          	RET	C		; nein
 1580 CDD6  2A 0018     	LD	HL,(T1A)
 1581 CDD9  22 001C     	LD	(T1E),HL	; Text 1 loeschen
 1582 CDDC  2A 001A     	LD	HL,(T2E)
 1583 CDDF  22 001E     	LD	(T2A),HL	; Text 2 loeschen
 1584 CDE2  CD CCC2     	CALL	FREE		; Free aktualisieren
 1585 CDE5  CD CDF3     	CALL	HOM		; EDIT-Cursor Home
 1586                   ;
 1587                   ; Dateiname loeschen:
 1588                   ;
 1589 CDE8  21 B7F5     NACLR:	LD	HL,NAMP		; Namenpuffer
 1590 CDEB  06 0B       	LD	B,11		; 11 Zeichen lang
 1591 CDED  36 20       NACL1:	LD	(HL),' '	; Leerzeichen eintragen
 1592 CDEF  23          	INC	HL
 1593 CDF0  10 FB       	DJNZ	NACL1
 1594 CDF2  C9          	RET
 1595                   ;-------
 1596 CDF3  11 0000     HOM:	LD	DE,0
 1597 CDF6  ED 53 0020  	LD	(COL),DE	; EDIT-Cursor home
 1598 CDFA  C9          	RET
 1599                   
 1600                   ;-------
 1601 CDFB  DDDD        	DEFW	0DDDDH
 1602 CDFD  53 41 56 45 	DB	'SAVE',1Fh
 1603 CE02  CD D6A1     	CALL	TOP		; Text an Speicherende
 1604 CE05  ED 5B 001E  SAV1:	LD	DE,(T2A)
 1605 CE09  2A 001A     	LD	HL,(T2E)	; Ende Text 2
 1606 CE0C  AF          	XOR	A
 1607 CE0D  ED 52       	SBC	HL,DE		; Text vorhanden?
 1608 CE0F  C8          	RET	Z		; nein
 1609 CE10  CD D5F5     	CALL	NAME		; Dateiname eingeben -> NAME0
 1610 CE13  D8          	RET	C		; BRK
 1611 CE14  CD CE99     	CALL	LFCR
 1612 CE17  CD D63B     	CALL	KPINI		; Kassettenpuffer initialisieren mit Vorblock
 1613 CE1A  ED 5B 001E  	LD	DE,(T2A)	; Beginn Text 2
 1614 CE1E  DD 36 02 01 	LD	(IX+2),1	; Block 1 einstellen
 1615 CE22  DD CB 07 FE 	SET	7,(IX+7)	; Init merken
 1616                   
 1617 CE26  3E FD       	LD	A,0FDH		; Treiber abfragen
 1618 CE28  CD F003     	CALL	PV1
 1619 CE2B  49          	DB	DEVICE		; Kassette?
 1620 CE2C  28 18       	JR	Z,SAV5		; bei Kassette Vorblock ausgeben
 1621 CE2E  21 B780     SAV2:	LD	HL,CASS+80H
 1622 CE31  45          	LD	B,L		; 1 Block
 1623 CE32  3E 1A       	LD	A,1Ah		; Puffer mit 1Ah vorbelegen (Endezeichen CP/M)
 1624 CE34  2D          SAV3:	DEC	L
 1625 CE35  77          	LD	(HL),A		; Kassettenpuffer loeschen (mit 1Ah)
 1626 CE36  20 FC       	JR	NZ,SAV3
 1627 CE38  EB          SAV4:	EX	DE,HL
 1628 CE39  CD 0086     	CALL	GET		; Datenbyte aus Textspeicher
 1629 CE3C  EB          	EX	DE,HL
 1630 CE3D  13          	INC	DE
 1631 CE3E  77          	LD	(HL),A		; in IRM (Kassettenpuffer) ablegen
 1632 CE3F  FE 03       	CP	3
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  42
EDITOR  Z80

 1633 CE41  28 03       	JR	Z,SAV5		; Ende-Kennung erkannt
 1634 CE43  23          	INC	HL
 1635 CE44  10 F2       	DJNZ	SAV4
 1636 CE46  DD 7E 02    SAV5:	LD	A,(IX+2)	; Blocknummer
 1637 CE49  CD F003     	CALL	PV1
 1638 CE4C  1C          	DB	AHEX		; Blocknr. anzeigen
 1639 CE4D  CD F003     	CALL	PV1
 1640 CE50  23          	DB	OSTR
 1641 CE51  08 08 00    	DB	8,8,0		; Cursor zurueck vor Blocknr.
 1642 CE54  CD F003     	CALL	PV1
 1643 CE57  2A          	DB	BRKT
 1644 CE58  01 00A0     	LD	BC,160		; kurzer Vorton
 1645 CE5B  38 23       	JR	C,SAV8		; BRK -> Datei schliessen
 1646 CE5D  2A 001A     	LD	HL,(T2E)	; Textende
 1647 CE60  ED 52       	SBC	HL,DE		; letzter Block?
 1648 CE62  38 1C       	JR	C,SAV8		; -> Datei schliessen
 1649 CE64  D5          	PUSH	DE		; Textpointer
 1650 CE65  DD CB 07 7E 	BIT	7,(IX+7)	; Init?
 1651 CE69  28 0D       	JR	Z,SAV6		; nein
 1652 CE6B  DD CB 07 BE 	RES	7,(IX+7)	; Init ruecksetzen
 1653 CE6F  21 0000     	LD	HL,NAME0	; Dateiname
 1654 CE72  CD F003     	CALL	PV1
 1655 CE75  08          	DB	ISRO		; Vorblock ausgeben
 1656 CE76  18 04       	JR	SAV7
 1657                   	;
 1658 CE78  CD F003     SAV6:	CALL	PV1
 1659 CE7B  01          	DB	MBO		; Daten-Block ausgeben
 1660 CE7C  D1          SAV7:	POP	DE		; Textpointer
 1661 CE7D  D8          	RET	C		; Fehler -> Abbruch
 1662 CE7E  18 AE       	JR	SAV2		; naechster Block
 1663                   	;
 1664 CE80  DD CB 07 7E SAV8:	BIT	7,(IX+7)	; Init?
 1665 CE84  28 0C       	JR	Z,SAV9		; nein
 1666 CE86  DD CB 07 BE 	RES	7,(IX+7)	; Init ruecksetzen
 1667 CE8A  21 0000     	LD	HL,NAME0	; Dateiname
 1668 CE8D  CD F003     	CALL	PV1		; erst noch Datei oeffnen, Vorblock ausgeben
 1669 CE90  08          	DB	ISRO		; (jetzt ist Datei mindestens 2 Bloecke gross)
 1670 CE91  D8          	RET	C
 1671 CE92  CD F003     SAV9:	CALL	PV1
 1672 CE95  09          	DB	CSRO		; Close (Ausgabe letzter Block)
 1673 CE96  D4 CF71     SAV10:	CALL	NC,LOA14	; Dateiname uebernehmen
 1674 CE99  CD F003     LFCR:	CALL	PV1
 1675 CE9C  2C          	DB	CRLF
 1676 CE9D  C9          	RET
 1677                   ;-------
 1678 CE9E  CD F003     CHR:	CALL	PV1
 1679 CEA1  24          	DB	OCHR
 1680 CEA2  C9          	RET
 1681                   
 1682                   ;-------
 1683 CEA3  DDDD        	DEFW	0DDDDH
 1684 CEA5  4C 4F 41 44 	DB	'LOAD',1Fh
 1685 CEAA  3E FD       	LD	A,0FDH		; Treiber abfragen
 1686 CEAC  CD F003     	CALL	PV1
 1687 CEAF  49          	DB	DEVICE		; Kassette?
 1688 CEB0  28 07       	JR	Z,LOA0		; bei Kassette Dateiname nicht abfragen
 1689 CEB2  CD D5F5     	CALL	NAME		; Dateiname eingeben -> NAME0
 1690 CEB5  D8          	RET	C		; BRK
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  43
EDITOR  Z80

 1691 CEB6  CD CE99     	CALL	LFCR
 1692 CEB9  CD CDF3     LOA0:	CALL	HOM		; EDIT-Cursor Home
 1693 CEBC  21 B700     	LD	HL,CASS		; Kassettenpuffer
 1694 CEBF  DD 75 05    	LD	(IX+5),L
 1695 CEC2  DD 74 06    	LD	(IX+6),H
 1696 CEC5  DD CB 07 C6 	SET	0,(IX+7)	; Read, nicht Verify
 1697 CEC9  21 0000     	LD	HL,NAME0	; Name an ISRI uebergeben
 1698 CECC  CD F003     	CALL	PV1
 1699 CECF  0A          	DB	ISRI		; ersten Block einlesen
 1700 CED0  D8          	RET	C		; Fehler
 1701                   
 1702                   ; !!! bei Kassette: BRK abfragen, sonst wiederholen!
 1703                   
 1704 CED1  AF          	XOR	A		; Z=1 (Daten aus Puffer entnehmen!)
 1705 CED2  CD CF7D     	CALL	BLRD		; (Vor-) Block lesen bzw. Blocknummer anzeigen
 1706 CED5  DA CF3B     	JP	C,LOA12		; BRK oder Fehler
 1707 CED8  3E FD       	LD	A,0FDH		; Treiber abfragen
 1708 CEDA  CD F003     	CALL	PV1
 1709 CEDD  49          	DB	DEVICE
 1710 CEDE  20 1C       	JR	NZ,LOA3		; nicht Kassette
 1711                   ; Bei Kassette, Name aus Vorblock anzeigen und speichern:
 1712 CEE0  3E 02       	LD	A,2		; Zeile loeschen
 1713 CEE2  CD CE9E     	CALL	CHR
 1714 CEE5  11 0000     	LD	DE,NAME0	; Name hier zwischenspeichern
 1715 CEE8  21 B700     	LD	HL,CASS
 1716 CEEB  01 000B     	LD	BC,11
 1717 CEEE  7E          LOA2:	LD	A,(HL)		; Zeichen aus Kassettenpuffer
 1718 CEEF  FE 20       	CP	' '
 1719 CEF1  D4 CE9E     	CALL	NC,CHR		; anzeigen
 1720 CEF4  ED A0       	LDI			; und in Puffer kopieren
 1721 CEF6  EA CEEE     	JP	PE,LOA2		; bis alle 11 Zeichen abgearbeitet sind
 1722 CEF9  CD CE99     	CALL	LFCR
 1723 CEFC  DD 36 03 02 LOA3:	LD	(IX+3),2	; Block Nr. 2 erwarten (1. Datenblock)
 1724 CF00  ED 5B 001C  	LD	DE,(T1E)	; Ladebeginn
 1725                   ; LOAD-Hauptschleife
 1726                   ; DE	Adresse, wohin gespeichert wird
 1727                   ; (T2E)	max. Endadresse
 1728 CF04  2A 001E     LOA4:	LD	HL,(T2A)	; max. Endadresse
 1729 CF07  AF          	XOR	A
 1730 CF08  ED 52       	SBC	HL,DE		; verfuegbaren Platz berechnen
 1731 CF0A  28 2B       	JR	Z,LOA11		; kein Byte frei -> no Memory
 1732 CF0C  E5          	PUSH	HL
 1733 CF0D  CD CF7D     	CALL	BLRD		; Block in Puffer einlesen
 1734 CF10  E1          	POP	HL
 1735 CF11  38 28       	JR	C,LOA12		; BRK oder Fehler
 1736 CF13  01 0080     	LD	BC,128		; Blocklaenge
 1737 CF16  ED 42       	SBC	HL,BC		; ist im Speicher noch Platz fuer einen Block?
 1738 CF18  30 02       	JR	NC,LOA5		; ja, voller Block moeglich
 1739 CF1A  09          	ADD	HL,BC
 1740 CF1B  4D          	LD	C,L		; C=restliche Anzahl
 1741 CF1C  41          LOA5:	LD	B,C		; B=Anzahl in dieser Runde
 1742 CF1D  21 B700     	LD	HL,CASS		; Daten aus Kassettenpuffer
 1743 CF20  7E          LOA10:	LD	A,(HL)		; Zeichen entnehmen
 1744 CF21  FE 03       	CP	3		; CAOS-Ende-Zeichen?
 1745 CF23  28 16       	JR	Z,LOA12		; ja
 1746 CF25  FE 1A       	CP	1Ah		; CP/M-Endezeichen?
 1747 CF27  28 12       	JR	Z,LOA12		; ja
 1748 CF29  23          	INC	HL
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  44
EDITOR  Z80

 1749 CF2A  EB          	EX	DE,HL
 1750 CF2B  CD 0092     	CALL	PUT		; Datenbyte in Textspeicher
 1751 CF2E  EB          	EX	DE,HL
 1752 CF2F  13          	INC	DE
 1753 CF30  10 EE       	DJNZ	LOA10
 1754 CF32  DD 34 03    	INC	(IX+3)		; naechste Blocknummer
 1755 CF35  18 CD       	JR	LOA4
 1756                   ;
 1757 CF37  3C          LOA11:	INC	A		; A=1
 1758 CF38  32 0022     	LD	(M4A),A		; Speicher voll setzen
 1759 CF3B  CD F003     LOA12:	CALL	PV1
 1760 CF3E  0B          	DB	CSRI		; Datei schliessen
 1761                   ; Text verschieben
 1762                   ; DE=Ende+1 geladener Text
 1763                   ; (T1E) Anfang geladener Text
 1764 CF3F  62          	LD	H,D
 1765 CF40  6B          	LD	L,E		; HL=Textende neu
 1766 CF41  ED 4B 001C  	LD	BC,(T1E)	; BC=Textende alt
 1767 CF45  A7          	AND	A		; CY=0
 1768 CF46  ED 42       	SBC	HL,BC
 1769 CF48  CA CE99     	JP	Z,LFCR		; Abbruch, kein Inhalt geladen!
 1770 CF4B  44          	LD	B,H
 1771 CF4C  4D          	LD	C,L		; BC=Laenge des zu verschiebenden Textes
 1772 CF4D  2A 001E     	LD	HL,(T2A)	; zu Anfang Teiltext 2 verschieben
 1773 CF50  EB          	EX	DE,HL
 1774 CF51  CD CE99     	CALL	LFCR		; ab CAOS 4.6: Zeilenvorschub nicht mehr in CSRI
 1775 CF54  1B          	DEC	DE
 1776 CF55  2B          	DEC	HL
 1777 CF56  CD 006A     	CALL	TLDDR		; Text verschieben
 1778 CF59  13          	INC	DE
 1779 CF5A  23          	INC	HL
 1780 CF5B  ED 53 001E  	LD	(T2A),DE	; neuer Anfang Teiltext 2
 1781 CF5F  3A 0022     	LD	A,(M4A)
 1782 CF62  B7          	OR	A
 1783 CF63  28 06       	JR	Z,LOA13		; OK
 1784 CF65  CD D539     	CALL	MEM		; Anzeige "no Memory"
 1785 CF68  CD CE99     	CALL	LFCR
 1786                   ; Dateiname jetzt uebernehmen
 1787 CF6B  3A B7F5     LOA13:	LD	A,(NAMP)	; aktueller Dateiname
 1788 CF6E  FE 20       	CP	' '		; noch leer?
 1789 CF70  C0          	RET	NZ		; nein, dann nicht umbenennen
 1790 CF71  21 0000     LOA14:	LD	HL,NAME0	; benutzter Dateiname von LOAD
 1791 CF74  11 B7F5     	LD	DE,NAMP		; aktueller Dateiname
 1792 CF77  01 000B     	LD	BC,11		; im Format 8.3
 1793 CF7A  ED B0       	LDIR			; jetzt uebernehmen
 1794 CF7C  C9          	RET
 1795                   ;-------
 1796                   ; Block einlesen in Kassettenpuffer:
 1797                   ; PE:	(IX+3)	erwarteter Block
 1798                   ;	Z=1	1. Block (nur Puffer entnehmen!)
 1799                   ;	Z=0	folgenden Block lesen
 1800                   ; PA:	CY=1	BRK betaetigt oder Fehler bei Diskette
 1801                   ; VR:	HL,AF
 1802 CF7D  2E 04       BLRD:	LD	L,4		; 4 Versuche
 1803 CF7F  20 06       	JR	NZ,BLRD1
 1804 CF81  DD CB 07 FE 	SET	7,(IX+7)	; Init merken, wenn Vorblock
 1805 CF85  18 35       	JR	BLRD2		; Daten uebernehmen
 1806                   	;
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  45
EDITOR  Z80

 1807 CF87  CD F003     BLRD1:	CALL	PV1
 1808 CF8A  2A          	DB	BRKT
 1809 CF8B  D8          	RET	C		; BRK
 1810 CF8C  DD 7E 03    	LD	A,(IX+3)	; 1. Datenblock erwartet?
 1811 CF8F  FE 02       	CP	2
 1812 CF91  20 24       	JR	NZ,BLRD0	; nein
 1813 CF93  DD CB 07 7E 	BIT	7,(IX+7)	; war vorher Init?
 1814 CF97  28 1E       	JR	Z,BLRD0		; nein
 1815 CF99  DD CB 07 BE 	RES	7,(IX+7)	; Init ruecksetzen
 1816 CF9D  D9          	EXX
 1817 CF9E  ED 4B B711  	 LD	BC,(CASS+11H)	; AADR bei CAOS-Vorblock
 1818 CFA2  2A B713     	 LD	HL,(CASS+13H)	; EADR bei CAOS-Vorblock
 1819 CFA5  ED 42       	 SBC	HL,BC		; CY=0 vom vorangehenden CP 2
 1820 CFA7  22 B786     	 LD	(ARG3),HL	; Anzahl Datenbytes bei Typestar-Dateien
 1821 CFAA  D9          	EXX
 1822 CFAB  3A B710     	LD	A,(CASS+10H)
 1823 CFAE  E6 DF       	AND	0DFH		; echter CAOS-Vorblock?
 1824 CFB0  28 05       	JR	Z,BLRD0		; ja, z.B. EDAS-Quelltext mit Vorblock
 1825 CFB2  DD 35 03    	DEC	(IX+3)		; Blocknummer wie vorher
 1826 CFB5  18 05       	JR	BLRD2		; Inhalt als Daten auswerten!
 1827                   	;
 1828 CFB7  CD F003     BLRD0:	CALL	PV1
 1829 CFBA  05          	DB	MBI		; Block einlesen
 1830 CFBB  D8          	RET	C		; Fehler
 1831 CFBC  3E 01       BLRD2:	LD	A,1
 1832 CFBE  3D          	DEC	A		; Z=1, CY unveraendert!
 1833 CFBF  DD 7E 02    	LD	A,(IX+2)	; Blocknummer
 1834 CFC2  F5          	PUSH	AF
 1835 CFC3  DD BE 03    	CP	(IX+3)		; richtige Blocknummer?
 1836 CFC6  28 08       	JR	Z,BLRD3		; ja
 1837 CFC8  3C          	INC	A		; Z=0
 1838 CFC9  20 21       	JR	NZ,BLRD5	; nicht Block FF
 1839 CFCB  7D          	LD	A,L
 1840 CFCC  FE 04       	CP	4		; Block FF im 1. Versuch?
 1841 CFCE  20 1C       	JR	NZ,BLRD5	; nein
 1842 CFD0  F1          BLRD3:	POP	AF
 1843 CFD1  38 08       	JR	C,BLRD4		; Lesefehler
 1844 CFD3  F5          	PUSH	AF
 1845 CFD4  3E 02       	LD	A,2
 1846 CFD6  CD F003     	CALL	PV1		; Zeile loeschen
 1847 CFD9  00          	DB	CRT
 1848 CFDA  F1          	POP	AF
 1849 CFDB  F5          BLRD4:	PUSH	AF
 1850 CFDC  CD F003     	CALL	PV1
 1851 CFDF  1C          	DB	AHEX		; Blocknr.
 1852 CFE0  F1          	POP	AF
 1853 CFE1  38 0F       	JR	C,BLRD6		; Lesefehler
 1854 CFE3  CD F003     	CALL	PV1
 1855 CFE6  23          	DB	OSTR
 1856 CFE7  3E 20 00    	DB	'> ',0		; ok
 1857 CFEA  A7          	AND	A		; CY=0
 1858 CFEB  C9          	RET
 1859                   	;
 1860 CFEC  F1          BLRD5:	POP	AF
 1861 CFED  37          	SCF			; CY=1, Lesefehler setzen
 1862 CFEE  2C          	INC	L
 1863 CFEF  2D          	DEC	L		; Z=0, falscher Block
 1864 CFF0  18 E9       	JR	BLRD4
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  46
EDITOR  Z80

 1865                   	;
 1866 CFF2  28 0B       BLRD6:	JR	Z,BLRD7		; Blocknr. richtig
 1867 CFF4  CD F003     	CALL	PV1
 1868 CFF7  23          	DB	OSTR
 1869 CFF8  2A 08 08 08 	DB	'*',8,8,8,0	; falsche Blocknr.
 1870 CFFD  18 88       	JR	BLRD1		; weiterversuchen
 1871                   	;
 1872 CFFF  67          BLRD7:	LD	H,A
 1873 D000  2D          	DEC	L		; Leseversuche zaehlen
 1874 D001  28 0B       	JR	Z,BLRD8		; letzter Versuch
 1875 D003  CD F003     	CALL	PV1
 1876 D006  23          	DB	OSTR
 1877 D007  3F 20 07 00 	DB	'? ',7,0	; Lesefehler!
 1878 D00B  C3 CF87     	JP	BLRD1
 1879                   	;
 1880 D00E  CD F003     BLRD8:	CALL	PV1
 1881 D011  23          	DB	OSTR
 1882 D012  21 0A 0D 00 	DB	'!',LF,CR,0	; Block fehlerhaft uebernommen
 1883 D016  A7          	AND	A		; CY=0
 1884 D017  C9          	RET
 1885                   ;-------------------------------------------------------------------------------
 1886                   ; Ausdruck des gesamten Textes auf den in CAOS aktivierten Druckers
 1887                   ; PRINT ohne Parameter druckt Text 1:1 aus
 1888                   ; PRINT mit Parameter fuegt nach n Zeilen einen Seitenwechsel 0ch ein
 1889                   ;
 1890 D018  DDDD        	DEFW	0DDDDH
 1891 D01A  50 52 49 4E 	DB	'PRINT',11H	; Argument als Dezimalzahl!
 1892 D020  CD D101     	CALL	PRINT1		; Druck vorbereiten
 1893 D023  D8          	RET	C		; kein Drucker oder Parameterfehler
 1894 D024  CD D6A1     	CALL	TOP		; gesamten Text an Speicherende
 1895 D027  2A 001E     PRI1:	LD	HL,(T2A)	; Druckbeginn
 1896 D02A  1E 00       	LD	E,0		; mit Zeichenzaehler = 0 starten
 1897 D02C  3A B782     PRI2:	LD	A,(ARG1)	; Zeilen/Seite
 1898 D02F  47          	LD	B,A		; bzw. 0 fuer Endlosdruck
 1899 D030  CD 0086     PRI3:	CALL	GET		; Zeichen aus Textspeicher
 1900 D033  23          	INC	HL
 1901 D034  FE 03       	CP	3		; Ende-Kennung?
 1902 D036  28 7D       	JR	Z,PRI8		; ja, fertig
 1903 D038  FE 0D       	CP	CR		; neue Zeile?
 1904 D03A  20 11       	JR	NZ,PRI4		; nein
 1905 D03C  CD D0C3     	CALL	PRCHR		; CR zum Drucker senden
 1906 D03F  38 7D       	JR	C,PRI9		; BRK
 1907 D041  04          	INC	B
 1908 D042  05          	DEC	B
 1909 D043  28 EB       	JR	Z,PRI3		; keine Seitenwechsel
 1910 D045  10 E9       	DJNZ	PRI3		; bis Seitenende wiederholen
 1911 D047  3A B782     	LD	A,(ARG1)	; Zeilen/Seite
 1912 D04A  47          	LD	B,A		; bzw. 0 fuer Endlosdruck
 1913 D04B  3E 0C       	LD	A,CLS		; Blattwechsel
 1914 D04D  FE 0E       PRI4:	CP	0Eh		; Zeile binden?
 1915 D04F  28 4E       	JR	Z,PRI6		; Rest der Zeile ignorieren, einschl. cr+lf
 1916 D051  FE 0F       	CP	0Fh		; Einleitung HEX-Sequenz?
 1917 D053  20 42       	JR	NZ,PRI5
 1918                   
 1919                   ; HEX-Sequenz
 1920 D055  CD 0086     HEX1:	CALL	GET		; Folgezeichen nach 0Fh
 1921 D058  FE 20       	CP	20H		; Leerzeichen?
 1922 D05A  20 03       	JR	NZ,HEX2
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  47
EDITOR  Z80

 1923 D05C  23          	INC	HL		; falls Leerzeichen -> ignorieren
 1924 D05D  18 F6       	JR	HEX1		; weiter bis das erste Zeichen kommt
 1925                   	;
 1926 D05F  D5          HEX2:	PUSH	DE		; Zeichenzaehler retten
 1927 D060  E5          	PUSH	HL		; Textpointer retten falls keine HEX-Codes
 1928 D061  11 A880     	LD	DE,NERR		; Zeichen in Assemblierpuffer aufbereiten
 1929 D064  CD 0086     HEX3:	CALL	GET		; Zeichen aus Textspeicher
 1930 D067  FE 21       	CP	21H
 1931 D069  38 05       	JR	C,HEX4		; Trennzeichen (Leerzeichen, Tabulator...)
 1932 D06B  12          	LD	(DE),A		; zwischenspeichern
 1933 D06C  13          	INC	DE
 1934 D06D  23          	INC	HL
 1935 D06E  18 F4       	JR	HEX3
 1936                   	;
 1937 D070  AF          HEX4:	XOR	A		; Endekennung
 1938 D071  12          	LD	(DE),A		; anhaengen
 1939 D072  11 A880     	LD	DE,NERR		; Puffer
 1940 D075  E5          	PUSH	HL
 1941 D076  CD F003     	CALL	PV1		; HEX-Code
 1942 D079  18          	DB	RHEX		; umwandeln
 1943 D07A  E1          	POP	HL		; Textpointer nach HEX-Code
 1944 D07B  30 04       	JR	NC,HEX5		; kein Fehler beim Umwandeln
 1945 D07D  E1          	POP	HL		; Textpointer vor HEX-Code
 1946 D07E  D1          	POP	DE		; Zeichenzaehler
 1947 D07F  18 1E       	JR	PRI6		; normal weiter drucken
 1948                   	;
 1949 D081  D1          HEX5:	POP	DE		; Textpointer vor HEX-Code jetzt vergessen
 1950 D082  D1          	POP	DE		; Zeichenzaehler
 1951 D083  3A B797     	LD	A,(NUMVX)
 1952 D086  CD CE9E     	CALL	CHR		; Hexcode direkt zu Drucker schicken
 1953 D089  CD 0086     	CALL	GET		; Trennzeichen nochmals holen
 1954 D08C  23          	INC	HL
 1955 D08D  FE 0D       	CP	CR
 1956 D08F  28 1C       	JR	Z,PRI7		; Zeilenende, normal weiter drucken
 1957 D091  FE 03       	CP	3
 1958 D093  28 20       	JR	Z,PRI8		; Textende erreicht, Druck beenden
 1959 D095  18 C8       	JR	HEX2		; naechsten HEX-Code holen
 1960                   
 1961 D097  1C          PRI5:	INC	E
 1962 D098  1D          	DEC	E
 1963 D099  20 12       	JR	NZ,PRI7		; wir sind nicht am Zeilenanfang
 1964 D09B  FE 2E       	CP	'.'
 1965 D09D  20 0E       	JR	NZ,PRI7		; kein dot-Kommando
 1966                   
 1967                   ; Zeilenrest nicht drucken (z.B. dot-Kommandos)
 1968 D09F  CD 0086     PRI6:	CALL	GET		; Zeichen aus Textspeicher
 1969 D0A2  23          	INC	HL
 1970 D0A3  FE 03       	CP	3
 1971 D0A5  28 0E       	JR	Z,PRI8		; Ende-Kennung erreicht!
 1972 D0A7  FE 0A       	CP	LF
 1973 D0A9  20 F4       	JR	NZ,PRI6		; weiter bis nach CR+LF
 1974 D0AB  18 83       	JR	PRI3		; neue Zeile wieder drucken	
 1975                   
 1976                   ; Zeichen zum Drucker
 1977 D0AD  CD D0C3     PRI7:	CALL	PRCHR		; Druck Zeichen
 1978 D0B0  38 0C       	JR	C,PRI9		; BRK
 1979 D0B2  C3 D030     	JP	PRI3		; naechstes Zeichen
 1980                   
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  48
EDITOR  Z80

 1981                   ; Druck beendet
 1982 D0B5  3A B782     PRI8:	LD	A,(ARG1)	; Zeilen/Seite
 1983 D0B8  B8          	CP	B		; sind wir bereits auf einer neuen Seite?
 1984 D0B9  3E 0C       	LD	A,CLS
 1985 D0BB  C4 D0C3     	CALL	NZ,PRCHR	; nein, dann Blatt wechseln
 1986 D0BE  CD F003     PRI9:	CALL	PV1
 1987 D0C1  20          	DB	NOUT		; zurueck zu Normalausgabe (CRT)
 1988 D0C2  C9          	RET
 1989                   ;-------
 1990                   ; Zeichenausgabe zum Drucker (Ausgabekanal UOUT1):
 1991                   ; - 0Dh sendet CR+LF
 1992                   ; - 0Ch ist Blattwechsel
 1993                   ; - 09h Tabulatoren werden in Leerzeichen gewandelt
 1994                   ; - Druckersteuerzeichen 0-9 nach ESC/P aufloesen
 1995                   ; - alle anderen Steuerzeichen werden ignoriert
 1996                   ; PE:	A	Zeichen
 1997                   ;	E	Zeichenzaehler
 1998                   ; PA:	E	Zeichenzaehler entsprechend um Zeichenzahl
 1999                   ;	CY=1	BRK gedrueckt
 2000                   ; VR:	AF, E
 2001                   ;
 2002 D0C3  C5          PRCHR:	PUSH	BC		; B retten (Zeilenzaehler)
 2003 D0C4  06 01       	LD	B,1		; zunaechst 1 Zeichen annehmen
 2004 D0C6  FE 20       	CP	' '
 2005 D0C8  30 21       	JR	NC,PRC4		; kein Steuerzeichen
 2006 D0CA  FE 0C       	CP	CLS
 2007 D0CC  28 09       	JR	Z,PRC1		; Blattwechsel am Drucker
 2008 D0CE  FE 0D       	CP	CR
 2009 D0D0  20 09       	JR	NZ,PRC2
 2010                   ; CR druckt CR+LF
 2011 D0D2  CD CE9E     	CALL	CHR		; CR zum Drucker
 2012 D0D5  3E 0A       	LD	A,LF
 2013 D0D7  1E FF       PRC1:	LD	E,-1		; Zeilenzaehler ruecksetzen
 2014 D0D9  18 10       	JR	PRC4		; drucken
 2015                   	;
 2016 D0DB  FE 09       PRC2:	CP	9		; Tab ?
 2017 D0DD  20 14       	JR	NZ,PRC5		; alle anderen Steuerzeichen ignorieren!
 2018                   ; TAB in Leerzeichen umwandeln
 2019 D0DF  3E 08       	LD	A,8		; TAB-Schrittweite
 2020 D0E1  93          	SUB	E		; minus Zeichenposition
 2021 D0E2  E6 07       	AND	7		; modulo 8
 2022 D0E4  20 02       	JR	NZ,PRC3
 2023 D0E6  3E 08       	LD	A,8		; kompletter TAB-Schritt
 2024 D0E8  47          PRC3:	LD	B,A		; Anzahl Leerzeichen
 2025 D0E9  3E 20       	LD	A,' '
 2026 D0EB  CD CE9E     PRC4:	CALL	CHR		; ausgeben an Drucker
 2027 D0EE  1C          	INC	E		; Zeichen mit zaehlen
 2028 D0EF  10 FA       	DJNZ	PRC4
 2029 D0F1  18 09       	JR	PRC6
 2030                   	;
 2031 D0F3  D6 10       PRC5:	SUB	10H		; Druckersteuerzeichen?
 2032 D0F5  38 05       	JR	C,PRC6		; < 10H
 2033 D0F7  FE 0A       	CP	10
 2034 D0F9  DC D158     	CALL	C,GETC		; Druckersteuerzeichen ausfuehren
 2035 D0FC  CD D4D2     PRC6:	CALL	BRKS		; BRK/STOP abfragen
 2036 D0FF  C1          	POP	BC
 2037 D100  C9          	RET
 2038                   ;
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  49
EDITOR  Z80

 2039                   ; UP1 fuer PRINT und PPRINT:
 2040                   ; - Kontrolle, ob Drucker aktiviert ist
 2041                   ; - Einstellung Seitenwechsel nach Parameter in ARG1
 2042                   ; - EIN/AUS-Merker fuer Druckersteuerzeichen initialisieren
 2043                   ; PE:	ARG1	Zeilenzahl BCD
 2044                   ; PA:	ARG1	Zeilenzahl Hex
 2045                   ;	CY=1	Fehler: Druckertreiber nicht aktiv oder
 2046                   ;		keine dezimale Angabe des Arguments
 2047                   ;
 2048 D101  2A B7BE     PRINT1:	LD	HL,(UOUT1+1)	; Hier steht die CAOS-Druckerroutine
 2049 D104  7E          	LD	A,(HL)		; ersten Befehlscode holen
 2050 D105  FE C9       	CP	0C9H		; ist das ein RET?
 2051 D107  20 1C       	JR	NZ,DEZ1		; nein, dann ist ein Drucker initialisiert
 2052 D109  CD F003     	CALL	PV1
 2053 D10C  23          	DB	OSTR
 2054 D10D  4B 65 69 6E 	DB	'Kein Drucker aktiv!',CR,LF,0
 2055 D123  37          	SCF
 2056 D124  C9          	RET
 2057                   	;
 2058 D125  3A B781     DEZ1:	LD	A,(ARGN)	; Anzahl Argumente
 2059 D128  B7          	OR	A
 2060 D129  20 03       	JR	NZ,DEZ2
 2061 D12B  32 B782     	LD	(ARG1),A	; ohne Argumente -> wie 0 benutzen
 2062 D12E  21 F008     DEZ2:	LD	HL,ZEI2		; 2=Druckerausgabe
 2063 D131  CD F003     	CALL	PV1		; Ausgabekanal 1
 2064 D134  1E          	DB	SOUT		; einstellen
 2065                   ; Erstbelegung Druckersteuerzeichen
 2066 D135  21 B4E1     	LD	HL,GTCR		; ein/aus-Merker
 2067 D138  AF          	XOR	A		; CY=0
 2068 D139  06 0A       	LD	B,10		; Anzahl Druckersteuerzeichen
 2069 D13B  77          GTC0:	LD	(HL),A
 2070 D13C  23          	INC	HL
 2071 D13D  10 FC       	DJNZ	GTC0
 2072 D13F  C9          	RET
 2073                   	;
 2074 D140  CD F003     DEZ4:	CALL	PV1
 2075 D143  23          	DB	OSTR
 2076 D144  50 61 72 61 	DB	'Parameterfehler',CR,LF,0
 2077 D156  37          	SCF			; Format-Fehler
 2078 D157  C9          	RET
 2079                   ;-------
 2080                   ; Druckersteuerzeichen nach Tabelle abarbeiten:
 2081                   ; PE:	A	Nummer der Funktion 0..9
 2082                   ;	GTCR	Option zur Funktion 0..9
 2083                   ;	GTC	Befehlstabelle
 2084                   ; VR:	BC, AF
 2085                   ;
 2086 D158  E5          GETC:	PUSH	HL
 2087                   ;	CP	10
 2088                   ;	JR	NC,GET4		; groesser als 9
 2089 D159  21 B4E1     	LD	HL,GTCR		; ein/aus Merker, 10 Byte
 2090 D15C  06 00       	LD	B,0
 2091 D15E  4F          	LD	C,A
 2092 D15F  09          	ADD	HL,BC
 2093 D160  7E          	LD	A,(HL)
 2094 D161  EE 01       	XOR	1		; abwechselnd on/off
 2095 D163  77          	LD	(HL),A
 2096 D164  81          	ADD	A,C		; 0/1 plus Funktionsnummer
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  50
EDITOR  Z80

 2097 D165  81          	ADD	A,C		; verdoppeln
 2098 D166  4F          	LD	C,A
 2099 D167  0C          	INC	C		; zu suchende Nummer 1..20
 2100 D168  21 D17E     	LD	HL,GTC		; Druckercode-Tabelle
 2101 D16B  46          GET1:	LD	B,(HL)		; Anzahl Zeichen fuer den Befehl
 2102 D16C  23          	INC	HL
 2103 D16D  0D          	DEC	C
 2104 D16E  28 05       	JR	Z,GET3	 	; gefunden
 2105 D170  23          GET2:	INC	HL
 2106 D171  10 FD       	DJNZ	GET2		; weiter zum naechstem Code
 2107 D173  18 F6       	JR	GET1
 2108                   	;
 2109 D175  7E          GET3:	LD	A,(HL)		; Zeichen aus Tabelle
 2110 D176  CD CE9E     	CALL	CHR		; zum Drucker schicken
 2111 D179  23          	INC	HL
 2112 D17A  10 F9       	DJNZ	GET3
 2113 D17C  E1          GET4:	POP	HL
 2114 D17D  C9          	RET
 2115                   ;-------
 2116                   ; Durckersteuerzeichen fuer Drucker mit ESC/P (z.B. K6313, LX400...)
 2117                   ;		Anzahl,Codes		;Nr.	Funktion
 2118 D17E  03 1B 55 00 GTC:	DB	3,ESC,'U',0		;0	unidirektional aus
 2119 D182  03 1B 55 01 	DB	3,ESC,'U',1		;	unidirektional ein
 2120 D186  02 1B 54    	DB	2,ESC,'T'		;1	Exponentschrift aus
 2121 D189  03 1B 53 00 	DB	3,ESC,'S',0		;	Exponentschrift ein
 2122 D18D  01 12       	DB	1,12H			;2	Schmalschrift aus
 2123 D18F  01 0F       	DB	1,0FH			;	Schmalschrift ein
 2124 D191  03 1B 2D 30 	DB	3,ESC,'-','0'		;3	unterstreichen aus
 2125 D195  03 1B 2D 31 	DB	3,ESC,'-','1'		;	unterstreichen ein
 2126 D199  02 1B 50    	DB	2,ESC,'P'		;4	PICA  (10 cpi)
 2127 D19C  02 1B 4D    	DB	2,ESC,'M'		;	ELITE (12 cpi)
 2128 D19F  03 1B 57 00 	DB	3,ESC,'W',0		;5	Breitschrift aus
 2129 D1A3  03 1B 57 01 	DB	3,ESC,'W',1		;	Breitschrift ein
 2130 D1A7  02 1B 48    	DB	2,ESC,'H'		;6	Doppeldruck aus
 2131 D1AA  02 1B 47    	DB	2,ESC,'G'		;	Doppeldruck ein
 2132 D1AD  02 1B 54    	DB	2,ESC,'T'		;7	Indexschrift aus
 2133 D1B0  03 1B 53 01 	DB	3,ESC,'S',1		;	Indexschrift ein
 2134 D1B4  02 1B 46    	DB	2,ESC,'F'		;8	Fettschrift aus
 2135 D1B7  02 1B 45    	DB	2,ESC,'E'		;	Fettschrift ein
 2136 D1BA  03 1B 78 00 	DB	3,ESC,'x',0		;9	NLQ aus
 2137 D1BE  03 1B 78 01 	DB	3,ESC,'x',1		;	NLQ ein
 2138                   ;-------------------------------------------------------------------------------
 2139                   ; KEY		KEYLIST
 2140                   ; KEY 0		Defaultbelegung fuer KC-Tastatur
 2141                   ; KEY D5	Defaultbelegung fuer D005-Tastatur
 2142                   ; KEY 1-F	F-Taste belegen
 2143                   ;
 2144 D1C2  DDDD        	DEFW	0DDDDH
 2145 D1C4  4B 45 59 01 	DB	'KEY',1
 2146 D1C8  B7          	OR	A
 2147 D1C9  20 05       	JR	NZ,KEYL
 2148 D1CB  CD F003     	CALL	PV1
 2149 D1CE  3A          	DB	KEYLI		; KEYLIST
 2150 D1CF  C9          	RET
 2151                   	;
 2152 D1D0  7D          KEYL:	LD	A,L
 2153 D1D1  B7          	OR	A
 2154 D1D2  28 09       	JR	Z,KEY0		; KEY 0
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  51
EDITOR  Z80

 2155 D1D4  FE D5       	CP	0D5H
 2156 D1D6  28 0C       	JR	Z,KEYD5		; KEY D5
 2157 D1D8  CD F003     	CALL	PV1
 2158 D1DB  39          	DB	KEY		; F-Taste belegen
 2159 D1DC  C9          	RET
 2160                   	;
 2161 D1DD  21 D209     KEY0:	LD	HL,KEB		; KC-Tastatur
 2162 D1E0  06 03       	LD	B,3		; 3 Tasten
 2163 D1E2  18 05       	JR	KEYBEL
 2164                   	;
 2165 D1E4  21 D1FE     KEYD5:	LD	HL,KEA		; D005-Tastatur
 2166 D1E7  06 0B       	LD	B,11		; 11 Tasten
 2167 D1E9  11 B900     KEYBEL:	LD	DE,FTASTE	; 0B900H
 2168 D1EC  AF          	XOR	A
 2169 D1ED  12          KEYNEU:	LD	(DE),A		; Trennung
 2170 D1EE  13          	INC	DE
 2171 D1EF  ED A0       	LDI			; Tastencode
 2172 D1F1  03          	INC	BC		; BC unveraendert
 2173 D1F2  10 F9       	DJNZ	KEYNEU
 2174 D1F4  EB          	EX	DE,HL
 2175 D1F5  36 00       KCL:	LD	(HL),0		; Rest loeschen
 2176 D1F7  23          	INC	HL
 2177 D1F8  7D          	LD	A,L
 2178 D1F9  FE 9C       	CP	9CH
 2179 D1FB  20 F8       	JR	NZ,KCL
 2180 D1FD  C9          	RET
 2181                   ;
 2182                   ; Funktionstastencodes:
 2183                   ;
 2184 D1FE  5B          KEA:	DB	'['	; F1	D005-Tastatur
 2185 D1FF  5C          	DB	'\'	; F2
 2186 D200  5D          	DB	']'	; F3
 2187 D201  7E          	DB	'~'	; F4
 2188 D202  05          	DB	5	; F5	TAB
 2189 D203  06          	DB	6	; F6	weitersuchen
 2190 D204  7B          	DB	'{'	; F7
 2191 D205  7C          	DB	'|'	; F8
 2192 D206  7D          	DB	'}'	; F9
 2193 D207  60          	DB	'`'	; F10
 2194 D208  7F          	DB	''	; F11
 2195                   ;
 2196 D209  1B          KEB:	DB	ESC	; F1	ESC
 2197 D20A  05          	DB	5	; F2	TAB
 2198 D20B  06          	DB	6	; F3	weitersuchen
 2199                   ;-------
 2200                   ; Unterprogramm sucht String ab Cursorzeile und stellt T2A entsprechend
 2201                   ; PE:	STRING	gesuchte Zeichenkette
 2202                   ; PA:	Textgrenzen so eingestellt, dass EDIT dahinzeigt
 2203 D20C  3A 0021     FIND:	LD	A,(LIN)		; Suche ab akt. Cursorzeile
 2204 D20F  16 00       	LD	D,0
 2205 D211  5F          	LD	E,A		; DE=aktuelle Bildschirmzeile
 2206 D212  B7          	OR	A		; steht der Cursor in Zeile 0?
 2207 D213  C4 D64F     	CALL	NZ,TXANF	; ggf. Textzeilen nach Anfang verschieben
 2208 D216  CD CDF3     	CALL	HOM		; Suche ab akt. Seite
 2209 D219  ED 5B 001E  	LD	DE,(T2A)
 2210 D21D  2A 001A     	LD	HL,(T2E)
 2211 D220  AF          	XOR	A
 2212 D221  ED 52       	SBC	HL,DE
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  52
EDITOR  Z80

 2213 D223  CA D2B0     	JP	Z,BOTO		; kein Text 2 vorhanden
 2214 D226  44          	LD	B,H
 2215 D227  4D          	LD	C,L		; BC = Laenge
 2216 D228  EB          	EX	DE,HL		; HL = Anfang
 2217 D229  11 0023     FIN1:	LD	DE,STRING	; Stringspeicher
 2218 D22C  1A          	LD	A,(DE)		; 1. Zeichen
 2219 D22D  B7          	OR	A
 2220 D22E  C8          	RET	Z		; 0 = Ende
 2221 D22F  CD 0071     	CALL	TCPIR		; suchen 1. Zeichen
 2222 D232  20 7C       	JR	NZ,BOTO		; nicht gefunden
 2223 D234  E5          	PUSH	HL
 2224 D235  C5          	PUSH	BC
 2225 D236  13          FIN2:	INC	DE
 2226 D237  1A          	LD	A,(DE)		; naechstes Zeichen
 2227 D238  B7          	OR	A
 2228 D239  28 09       	JR	Z,FIN3		; gefunden
 2229 D23B  CD 007F     	CALL	TCPI		; suchen weiteres Zeichen
 2230 D23E  28 F6       	JR	Z,FIN2
 2231 D240  C1          	POP	BC
 2232 D241  E1          	POP	HL
 2233 D242  18 E5       	JR	FIN1		; weitersuchen
 2234                   	;
 2235 D244  C1          FIN3:	POP	BC
 2236 D245  D1          	POP	DE
 2237 D246  ED 5B 001E  	LD	DE,(T2A)
 2238 D24A  2B          	DEC	HL
 2239 D24B  ED 52       	SBC	HL,DE
 2240 D24D  C8          	RET	Z		; an Textende
 2241 D24E  44          	LD	B,H
 2242 D24F  4D          	LD	C,L
 2243 D250  ED 5B 001C  	LD	DE,(T1E)
 2244 D254  2A 001E     	LD	HL,(T2A)
 2245 D257  CD 0063     	CALL	TLDIR		; Text teilen
 2246 D25A  ED 53 001C  	LD	(T1E),DE
 2247 D25E  22 001E     	LD	(T2A),HL
 2248 D261  11 0001     	LD	DE,1
 2249 D264  E5          	PUSH	HL
 2250 D265  CD D6A4     	CALL	TXEND		; einen Zeilenanfang zurueck
 2251 D268  E1          	POP	HL		; Pos. vor Verschiebung auf Zeilenanfang
 2252 D269  ED 5B 001E  	LD	DE,(T2A)	; Pos. nach Verschiebung
 2253 D26D  AF          	XOR	A
 2254 D26E  ED 52       	SBC	HL,DE
 2255 D270  45          	LD	B,L
 2256 D271  4F          	LD	C,A		; BC=Position in der Zeile
 2257 D272  28 1E       	JR	Z,FIN7		; String steht an Zeilenanfang
 2258 D274  21 0024     	LD	HL,STRING+1	; 2. Zeichen des Suchstring
 2259 D277  BE          FIN4:	CP	(HL)		; 0 ?
 2260 D278  23          	INC	HL
 2261 D279  28 04       	JR	Z,FIN5		; Stringende
 2262 D27B  10 FA       	DJNZ	FIN4
 2263 D27D  18 13       	JR	FIN7
 2264                   	;
 2265 D27F  EB          FIN5:	EX	DE,HL
 2266 D280  CD 0086     	CALL	GET		; Zeichen aus Textspeicher
 2267 D283  EB          	EX	DE,HL
 2268 D284  13          	INC	DE
 2269 D285  0C          	INC	C
 2270 D286  FE 09       	CP	TAB		; Tabulator?
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  53
EDITOR  Z80

 2271 D288  20 06       	JR	NZ,FIN6
 2272 D28A  79          	LD	A,C
 2273 D28B  C6 07       	ADD	A,7
 2274 D28D  E6 78       	AND	78H
 2275 D28F  4F          	LD	C,A
 2276 D290  10 ED       FIN6:	DJNZ	FIN5
 2277 D292  79          FIN7:	LD	A,C
 2278 D293  FE 50       	CP	80		; letzte Spalte?
 2279 D295  38 02       	JR	C,FIN8
 2280 D297  3E 4F       	LD	A,79
 2281 D299  6F          FIN8:	LD	L,A		; Spalte
 2282 D29A  26 00       	LD	H,0		; Zeile 0
 2283 D29C  22 0020     FIN9:	LD	(COL),HL
 2284 D29F  3E 03       	LD	A,3
 2285 D2A1  BC          	CP	H		; sind wir schon in Zeile 3?
 2286 D2A2  C8          	RET	Z		; ja, fertig
 2287 D2A3  11 0001     	LD	DE,1
 2288 D2A6  CD D6A4     	CALL	TXEND		; Versuch, eine Zeile zurueck zu gehen
 2289 D2A9  C8          	RET	Z		; wir waren schon am Textanfang
 2290 D2AA  2A 0020     	LD	HL,(COL)
 2291 D2AD  24          	INC	H		; Zeile+1 eintragen
 2292 D2AE  18 EC       	JR	FIN9
 2293                   ;
 2294                   ; Zum Textende gehen (Seite beginnt 22 Zeilen vor Ende)
 2295                   ;
 2296 D2B0  11 0000     BOTO:	LD	DE,0		; komplett an Textende gehen
 2297 D2B3  CD D64F     	CALL	TXANF
 2298 D2B6  21 1500     BOT:	LD	HL,1500H	; EDIT-Cursor in Zeile 21
 2299 D2B9  22 0020     	LD	(COL),HL
 2300 D2BC  55          	LD	D,L		; 0
 2301 D2BD  5C          	LD	E,H		; 21
 2302 D2BE  CD D6A4     	CALL	TXEND		; 21 Zeilen zurueck
 2303 D2C1  C9          	RET
 2304                   ;
 2305                   ; EDITOR-Hauptschleife:
 2306                   ;
 2307 D2C2  DDDD        	DEFW	0DDDDH
 2308 D2C4  45 44 49 54 	DB	'EDIT',1Fh
 2309 D2C9  CD DEAF     EDIT:	CALL	BILD0		; Editor immer in Bild 0 (Bild 1 = Hilfe)
 2310 D2CC  21 CBAF     	LD	HL,MAIN
 2311 D2CF  E3          	EX	(SP),HL		; zurueck zum kurzen Menu
 2312 D2D0  2A BFE7     	LD	HL,(0BFE7H)	; Hier steht Menuewort QUIT zu ASM
 2313 D2D3  11 DDDD     	LD	DE,0DDDDH
 2314 D2D6  A7          	AND	A
 2315 D2D7  ED 52       	SBC	HL,DE
 2316 D2D9  28 04       	JR	Z,EDI0		; aus ASM gestartet
 2317 D2DB  DD CB 08 BE 	res	7,(IX+8)	; ansonsten CAPS einschalten
 2318 D2DF  CD CA38     EDI0:	CALL	SET80		; 80-Zeichen-Modus einstellen
 2319 D2E2  CD C884     	CALL	CLS80		; Bild loeschen
 2320 D2E5  CD D3E4     	CALL	LCOUNT		; Zeilennummer ermitteln
 2321 D2E8  CD D7F2     EDI1:	CALL	WRPG		; Seite schreiben
 2322 D2EB  CD D938     EDI2:	CALL	PCOL		; Cursorposition anzeigen
 2323 D2EE  CD D50F     	CALL	KEYB		; Eingabe
 2324 D2F1  2A 001C     	ld	hl,(t1e)
 2325 D2F4  22 B4D8     	ld	(T1MERK),hl	; Textgrenzen merken fuer den Fall
 2326 D2F7  2A 001E     	ld	hl,(t2a)	; dass beim Speichern kein Platz ist
 2327 D2FA  22 B4DA     	ld	(T2MERK),hl
 2328 D2FD  30 55       	JR	NC,EDI3		; nicht BRK
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  54
EDITOR  Z80

 2329 D2FF  CD D70A     	CALL	MPAGE		; Seite speichern
 2330 D302  38 6C       	JR	C,EDI6		; No Memory
 2331                   ; zusaetzliche CR+LF am Ende von Text 2 abschneiden:
 2332 D304  2A 001A     	ld	hl,(t2e)
 2333 D307  ED 5B 001E  ts1:	ld	de,(t2a)
 2334 D30B  ED 52       	sbc	hl,de
 2335 D30D  44          	ld	b,h
 2336 D30E  4D          	ld	c,l		; BC = Textlaenge
 2337 D30F  19          	add	hl,de		; veraendert Z-Flag nicht!
 2338 D310  ED 5B 001A  	ld	de,(t2e)
 2339 D314  28 25       	jr	z,ts3		; kein Teiltext 2 mehr vorhanden
 2340 D316  2B          	dec	hl
 2341 D317  CD 0086     	call	GET		; letztes Zeichen holen
 2342 D31A  FE 0A       	cp	lf
 2343 D31C  20 08       	jr	nz,ts2		; Textende gefunden
 2344 D31E  2B          	dec	hl
 2345 D31F  CD 0086     	call	GET		; vorletztes Zeichen holen
 2346 D322  FE 0D       	cp	cr
 2347 D324  28 E1       	jr	z,ts1		; Suchen, ob noch ein CR+LF davor kommt?
 2348 D326  23          ts2:	inc	hl		; hier steht das letzte CR
 2349 D327  23          	inc	hl		; hier steht das letzte LF
 2350 D328  ED 5B 001A  	ld	de,(t2e)	; hier steht 03h
 2351 D32C  1B          	dec	de		; hier soll letztes LF stehen
 2352 D32D  B7          	or	a		; CY=0
 2353 D32E  ED 52       	sbc	hl,de
 2354 D330  30 0D       	jr	nc,ts4		; kein CR+LF am Textende
 2355 D332  28 0B       	jr	z,ts4		; keine CR+LF zu viel am Textende
 2356 D334  19          	add	hl,de
 2357 D335  03          	inc	bc
 2358 D336  03          	inc	bc
 2359 D337  CD 006A     	CALL	TLDDR		; Text nach hinten verschieben
 2360 D33A  13          	inc	de
 2361 D33B  ED 53 001E  ts3:	ld	(t2a),de	; neuer Anfang von Teiltext 2
 2362 D33F  CD CA97     ts4:	CALL	SET40		; zurueck zum 40-Zeichen-Modus
 2363 D342  21 AD00     	ld	hl,vram1
 2364 D345  11 AD01     	ld	de,vram1+1
 2365 D348  01 09FF     	ld	bc,09FFh
 2366 D34B  36 00       	ld	(hl),0
 2367 D34D  ED B0       	ldir			; gesamten VRAM von Bild 0+1 loeschen
 2368 D34F  DD CB 08 FE 	set	7,(ix+8)	; CAPS aus
 2369 D353  C9          	ret
 2370                   	;
 2371 D354  FE 0D       EDI3:	CP	CR		; Enter?
 2372 D356  20 02       	JR	NZ,EDI4
 2373 D358  3E 0E       	LD	A,0Eh		; 0Dh als 0Eh ausfuehren
 2374 D35A  FE 7F       EDI4:	CP	7FH		; ge-CAPS-ter Unterstrich?
 2375 D35C  20 02       	JR	NZ,EDI5
 2376 D35E  3E 5F       	LD	A,5FH		; wieder als Unterstrich
 2377 D360  CD D385     EDI5:	CALL	CRT_I		; Zeichen auf Bildschirm anzeigen
 2378 D363  2A B7A0     	LD	HL,(CURSO)
 2379 D366  22 0020     	LD	(COL),HL	; EDIT-Cursor
 2380 D369  3A 0022     	LD	A,(M4A)
 2381 D36C  B7          	OR	A		; Ueberlauf?
 2382 D36D  CA D2EB     	JP	Z,EDI2
 2383 D370  CD D4F6     EDI6:	CALL	MEMW		; Anzeige "No Memory" und Tastaturabfrage
 2384 D373  CD D845     	CALL	STATUS		; Staturzeile aktualisieren
 2385 D376  2A B4D8     	ld	hl,(T1MERK)
 2386 D379  22 001C     	ld	(t1e),hl	; urspruengliche Textgrenzen
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  55
EDITOR  Z80

 2387 D37C  2A B4DA     	ld	hl,(T2MERK)	; wieder regenerieren
 2388 D37F  22 001E     	ld	(t2a),hl
 2389 D382  C3 D2EB     	JP	EDI2		; zurueck zum Editieren
 2390                   ;
 2391                   ; Zeichenausgabe mit Einfuegemodus
 2392                   ; PE:	A	Zeichencode
 2393                   ;
 2394 D385  FE 20       CRT_I:	CP	20h		; Steuerzeichen?
 2395 D387  38 33       	JR	C,INS3		; direkt ausfuehren ohne anzuzeigen!
 2396 D389  21 003E     CRT_X:	LD	HL,STAT
 2397 D38C  CB 66       	BIT	4,(HL)		; Einfuegemodus?
 2398 D38E  20 2C       	JR	NZ,INS3		; nein, einfach anzeigen
 2399 D390  08          	EX	AF,AF'		; Zeichencode in A'
 2400 D391  CD D3BF     	CALL	CFR1		; ist noch ein Zeichen frei?
 2401 D394  D8          	RET	C		; nein
 2402 D395  08          	EX	AF,AF'		; Zeichencode
 2403 D396  ED 5B B7A0  INS0:	LD	DE,(CURSO)	; aktuelle Cursorposition
 2404 D39A  CD C561     	CALL	DABR80		; VRAM-Adresse holen
 2405 D39D  46          INS1:	LD	B,(HL)		; Zeichen von akt. Position holen
 2406 D39E  77          	LD	(HL),A		; neues Zeichen eintragen
 2407 D39F  CD C5B5     	CALL	WPIX		; auf Bildschirm zeichnen
 2408 D3A2  78          	LD	A,B
 2409 D3A3  A7          	AND	A		; war das ein Dummy?
 2410 D3A4  28 0E       	JR	Z,INS2		; ja, fertig
 2411 D3A6  1C          	INC	E		; CUR
 2412 D3A7  CD C561     	CALL	DABR80		; raus?
 2413 D3AA  30 F1       	JR	NC,INS1
 2414 D3AC  1E 00       	LD	E,0		; Spalte 0 in
 2415 D3AE  14          	INC	D		; naechster Zeile
 2416 D3AF  CD C561     	CALL	DABR80		; raus?
 2417 D3B2  30 E9       	JR	NC,INS1		; nein, weiter einfuegen
 2418 D3B4  ED 5B B7A0  INS2:	LD	DE,(CURSO)	; aktuelle Cursorposition
 2419 D3B8  CD C561     	CALL	DABR80		; VRAM-Adresse holen
 2420 D3BB  7E          	LD	A,(HL)		; Zeichen aus VRAM zuruecklesen
 2421 D3BC  C3 C637     INS3:	JP	CRT80
 2422                   ;
 2423                   ; Kontrolle, ob noch genug Zeichen zum Einfuegen frei sind
 2424                   ; PE:	B	Anzahl der Zeichen
 2425                   ; PA:	CY=1	kein Platz
 2426                   ; VR:	HL,BC,DE,AF
 2427                   ;
 2428 D3BF  0E 01       CFR1:	LD	C,1
 2429 D3C1  C5          CFREE:	PUSH	BC		; Anzahl C auf Stack
 2430 D3C2  ED 5B B7A0  	LD	DE,(CURSO)	; aktuelle Cursorposition
 2431 D3C6  CD C561     	CALL	DABR80		; aktuelle VRAM-Adresse
 2432 D3C9  EB          	EX	DE,HL		; DE = VRAM-Adresse		
 2433 D3CA  21 B4D0     	LD	HL,0B4D0H	; VRAM-Ende
 2434 D3CD  AF          	XOR	A	; CY=0
 2435 D3CE  ED 52       	SBC	HL,DE		; Anzahl Zeichen bis Bildschirmende
 2436 D3D0  44          	LD	B,H
 2437 D3D1  4D          	LD	C,L		; BC = Suchlaenge
 2438 D3D2  EB          	EX	DE,HL		; HL = Adresse
 2439 D3D3  D1          	POP	DE		; Anzahl jetzt in E
 2440 D3D4  ED B1       CFR2:	CPIR			; ist da noch mindestens 1 Zeichen frei?
 2441 D3D6  37          	SCF
 2442 D3D7  C0          	RET	NZ		; nicht gefunden (Fehler)
 2443 D3D8  3F          	CCF
 2444 D3D9  E2 D3E0     	JP	PO,CFR3		; ausgesucht
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  56
EDITOR  Z80

 2445 D3DC  1D          	DEC	E
 2446 D3DD  20 F5       	JR	NZ,CFR2		; weitere freie Zeichen suchen
 2447 D3DF  C9          	RET
 2448                   	;
 2449 D3E0  1D          CFR3:	DEC	E
 2450 D3E1  C8          	RET	Z		; ausgesucht und E=0: OK
 2451 D3E2  37          	SCF			; ansonsten Fehler
 2452 D3E3  C9          	RET
 2453                   ;
 2454                   ; Zaehle die Zeilenumbrueche im Teiltext1, also vor dem Bildbeginn
 2455                   ; PE:	T1A, T1E
 2456                   ; PA:	MEML, DE=(MEML)
 2457                   ;
 2458 D3E4  ED 5B 0018  LCOUNT:	ld	de,(t1a)	; Beginn Text 1 = 0201h
 2459 D3E8  1B          	dec	de		; 0200h
 2460 D3E9  2A 001C     	ld	hl,(t1e)
 2461 D3EC  A7          	and	a
 2462 D3ED  ED 52       	sbc	hl,de
 2463 D3EF  44          	ld	b,h
 2464 D3F0  4D          	ld	c,l		; BC = Laenge Text 1
 2465 D3F1  EB          	ex	de,hl		; HL = Beginn Text 1
 2466 D3F2  11 0000     	ld	de,0		; DE = Zeilenzaehler
 2467 D3F5  3E 0D       	ld	a,CR		; Trennzeichen 
 2468 D3F7  CD 0071     LCNT1:	CALL	TCPIR		; CR suchen
 2469 D3FA  20 04       	JR	NZ,LCNT2	; nicht gefunden
 2470 D3FC  13          	INC	DE		; CR zaehlen
 2471 D3FD  EA D3F7     	JP	PE,LCNT1		; noch nicht ausgesucht
 2472 D400  ED 53 0012  LCNT2:	ld	(meml),de	; Zeilennummern vor dargestellter Seite
 2473 D404  C9          	ret
 2474                   ;-------
 2475                   ; 02h->1Dh = Shift-DEL - aktuelle Zeile loeschen, Rest nach oben scrollen
 2476                   ;
 2477 D405  3E 16       EDEL:	LD	A,22		; letzte Zeile
 2478 D407  92          	SUB	D		; - aktuelle Zeile
 2479 D408  47          	LD	B,A		; = Anzahl zu scrollender Zeilen
 2480 D409  C4 C7A7     	CALL	NZ,UROLL	; B Zeilen scrollen
 2481 D40C  ED 5B B79E  	LD	DE,(WINLG)
 2482 D410  15          	DEC	D		; letzte Zeile
 2483 D411  1E 00       	LD	E,0		; Spalte 0
 2484 D413  CD C561     	CALL	DABR80		; HL=VRAM-Adresse
 2485 D416  ED 4B 001E  	LD	BC,(T2A)	; unterste Zeile aus Teiltext 2 neu anzeigen
 2486 D41A  CD D78D     	CALL	WRZLE		; Letzte Zeile anzeigen
 2487 D41D  ED 5B B7A0  	LD	DE,(CURSO)
 2488 D421  C3 C6E5     	JP	CUD1		; Cursor auf/hinter Zeichen setzen
 2489                   ;-------
 2490                   ; F1 (5) - Tabulatorschritt erzeugen:
 2491 D424  3A 003E     EDTAB:	LD	A,(STAT)
 2492 D427  E6 10       	AND	10h		; Einfuegemodus?
 2493 D429  20 1C       	JR	NZ,TAB2		; nein, einfach zur naechsten TAB-Position gehen
 2494 D42B  7B          	LD	A,E		; Spalte
 2495 D42C  2F          	CPL
 2496 D42D  E6 07       	AND	7		; bis zur naechsten TAB-Position
 2497 D42F  3C          	INC	A
 2498 D430  47          	LD	B,A		; Anzahl
 2499 D431  4F          	LD	C,A
 2500 D432  C5          	PUSH	BC
 2501 D433  CD D3C1     	CALL	CFREE		; Kontrolle, ob genug Zeichen frei sind
 2502 D436  C1          	POP	BC
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  57
EDITOR  Z80

 2503 D437  ED 5B B7A0  	LD	DE,(CURSO)
 2504 D43B  D8          	RET	C		; nicht genug frei!
 2505 D43C  C5          TAB1:	PUSH	BC
 2506 D43D  3E 20       	LD	A,' '		; Leerzeichen
 2507 D43F  CD D396     	CALL	INS0		; im Einfuegemodus ausgeben
 2508 D442  36 00       	LD	(HL),0		; Dummy in VRAM eintragen
 2509 D444  C1          	POP	BC
 2510 D445  10 F5       	DJNZ	TAB1
 2511                   ;zur naechsten TAB-Position gehen
 2512 D447  CD C696     TAB2:	CALL	CUR80		; Cursor nach rechts
 2513 D44A  7B          	LD	A,E
 2514 D44B  E6 07       	AND	7		; TAB-Position erreicht?
 2515 D44D  20 F8       	JR	NZ,TAB2
 2516 D44F  C9          	RET
 2517                   ;-------
 2518                   ; 0Dh -> 0Eh Enter (und Shift-Enter):
 2519                   ;
 2520 D450  3A 003E     EENT:	LD	A,(STAT)
 2521 D453  E6 10       	AND	10h		; Einfuegemodus?
 2522 D455  20 60       	JR	NZ,ENT4		; nein, einfach zur naechsten Zeile gehen
 2523 D457  3A B79F     	LD	A,(WINLG+1)	; Anzahl Zeilen
 2524 D45A  3D          	DEC	A		; letzte Zeile
 2525 D45B  BA          	CP	D		; unterste Bildschirmzeile?
 2526 D45C  20 08       	JR	NZ,ENT1		; nein
 2527 D45E  CD C705     	CALL	CUD4		; ja, dann erst einmal hoch scrollen
 2528                   ;	JR	C,...		; Fehler / No Memory?
 2529 D461  15          	DEC	D		; und Cursor auf die vorherige Zeile mitnehmen
 2530 D462  ED 53 B7A0  	LD	(CURSO),DE	; Cursorposition eintragen
 2531                   ;letzte Bildschirmzeile abspeichern vor Text 2
 2532 D466  2A 001C     ENT1:	LD	HL,(T1E)	; Ende Text 1 merken
 2533 D469  E5          	PUSH	HL
 2534 D46A  21 B480     	LD	HL,0B480h	; VRAM-Adresse, Beginn letzte Zeile
 2535 D46D  CD D730     	CALL	MLINE		; letzte Zeile abspeichern, ab T1E
 2536 D470  D1          	POP	DE		; alter Wert von T1E
 2537 D471  D4 D6ED     	CALL	NC,TXE4		; zum Anfang von Text 2 verschieben
 2538                   ;Text unterhalb der aktuellen Zeile nach unten scrollen
 2539 D474  ED 5B B7A0  	LD	DE,(CURSO)
 2540 D478  3A B79F     	LD	A,(WINLG+1)	; Anzahl Zeilen
 2541 D47B  3D          	DEC	A		; letzte Zeile
 2542 D47C  92          	SUB	D		; - aktuelle Zeile
 2543 D47D  3D          	DEC	A		; Zeile darunter
 2544 D47E  47          	LD	B,A		; = Anzahl zu scrollender Zeilen
 2545 D47F  CD C801     	CALL	DROLL		; B Zeilen nach unten scrollen
 2546                   ;Zeile unterhalb der aktuellen Zeile ist jetzt leer
 2547                   ;Text ab alter Cursorposition in die neue Zeile uebernehmen
 2548 D482  ED 5B B7A0  	LD	DE,(CURSO)	; Position aktuelle Zeile
 2549 D486  2A 0010     	LD	HL,(RANDL)	; L=linker Rand
 2550 D489  62          	LD	H,D
 2551 D48A  24          	INC	H		; H=eine Zeile tiefer
 2552 D48B  7B          	LD	A,E
 2553 D48C  BD          	CP	L		; Cursor links vom linken Rand?
 2554 D48D  30 02       	JR	NC,ENT2		; nein, auf linkem Rand bleiben
 2555 D48F  2E 00       	LD	L,0		; ja, dann ganz links neu beginnen
 2556 D491  22 B7A0     ENT2:	LD	(CURSO),HL	; neue Position
 2557 D494  45          	LD	B,L		; neue Spalte
 2558 D495  CD C561     ENT3:	CALL	DABR80		; VRAM-Adresse holen
 2559 D498  4E          	ld	c,(hl)		; Zeichen entnehmen
 2560 D499  AF          	xor	a
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  58
EDITOR  Z80

 2561 D49A  77          	ld	(hl),a		; leer machen
 2562 D49B  CD C5B5     	call	wpix		; anzeigen, also loeschen
 2563 D49E  D5          	PUSH	DE
 2564 D49F  14          	INC	D		; Zeile darunter
 2565 D4A0  58          	LD	E,B		; Spalte
 2566 D4A1  CD C561     	CALL	DABR80		; VRAM-Adresse berechnen
 2567 D4A4  79          	LD	A,C		; Zeichen
 2568 D4A5  77          	LD	(HL),A		; auf neuer Zeile eintragen
 2569 D4A6  CD C5B5     	CALL	WPIX		; und anzeigen
 2570 D4A9  1C          	INC	E		; naechste Spalte in neuer Zeile
 2571 D4AA  43          	LD	B,E		; wieder in B merken
 2572 D4AB  D1          	POP	DE
 2573 D4AC  1C          	INC	E		; naechste Spalte in aktueller Zeile
 2574 D4AD  7B          	LD	A,E
 2575 D4AE  FE 51       	CP	81		; fertig?
 2576 D4B0  20 E3       	JR	NZ,ENT3		; nein, weiter bis zum Zeilenende
 2577 D4B2  ED 5B B7A0  	LD	DE,(CURSO)	; neue Position
 2578 D4B6  C9          	RET
 2579                   	;
 2580 D4B7  CD C6D8     ENT4:	CALL	CUD80		; Cursor eine Zeile nach unten
 2581 D4BA  3A 0010     	LD	A,(RANDL)
 2582 D4BD  5F          	LD	E,A		; und auf den linken Rand setzen
 2583 D4BE  C9          	RET
 2584                   ;
 2585                   ; 1. Quelltextzeile abspeichern:
 2586                   ;
 2587 D4BF  11 0000     SCROL:	LD	DE,0		; Position links oben
 2588 D4C2  CD C561     	CALL	DABR80		; VRAM-Adresse berechnen
 2589 D4C5  CD D730     	CALL	MLINE		; 1. Zeile speichern
 2590 D4C8  3A B7A1     SCROL1:	LD	A,(CURSO+1)	; Zeile
 2591 D4CB  3C          	INC	A
 2592 D4CC  32 B79F     	LD	(WINLG+1),A	; Fenster begrenzen
 2593 D4CF  C3 CE99     	JP	LFCR
 2594                   ;-------
 2595                   ; Abfrage BRK und STOP (bei STOP auf naechste Taste warten):
 2596                   ; PA:	CY=1	BRK betaetigt
 2597 D4D2  CD F003     BRKS:	CALL	PV1
 2598 D4D5  0C          	DB	KBDS
 2599 D4D6  D0          	RET	NC		; keine Taste gedrueckt
 2600 D4D7  FE 03       	CP	3		; BRK?
 2601 D4D9  37          	SCF
 2602 D4DA  C8          	RET	Z
 2603 D4DB  FE 13       STOP:	CP	13H		; STOP?
 2604 D4DD  37          	SCF
 2605 D4DE  3F          	CCF
 2606 D4DF  C0          	RET	NZ		; nicht STOP
 2607 D4E0  CD D50F     	CALL	KEYB		; auf Taste warten
 2608 D4E3  D8          	RET	C		; BRK
 2609 D4E4  18 F5       	JR	STOP
 2610                   ;-------
 2611                   ; Anzeige "Blockmarken?" und warten:
 2612 D4E6  2A B7A0     BLMW:	LD	HL,(CURSO)
 2613 D4E9  E5          	PUSH	HL
 2614 D4EA  CD CA8A     	CALL	WIN80		; volles Fenster zum Schreiben in Statuszeile
 2615 D4ED  AF          	XOR	A		; Zeile 0
 2616 D4EE  32 B7A1     	LD	(CURSO+1),A
 2617 D4F1  CD D519     	CALL	BLER1		; Anzeige "Blockmarken?" statt Zeile/Spalte
 2618 D4F4  18 0E       	JR	MEMW1		; Tastatureingabe abwarten
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  59
EDITOR  Z80

 2619                   ;-------
 2620                   ; Anzeige "no Memory" und warten:
 2621 D4F6  2A B7A0     MEMW:	LD	HL,(CURSO)
 2622 D4F9  E5          	PUSH	HL
 2623 D4FA  CD CA8A     	CALL	WIN80		; volles Fenster zum Schreiben in Statuszeile
 2624 D4FD  AF          	XOR	A		; Zeile 0
 2625 D4FE  32 B7A1     	LD	(CURSO+1),A
 2626 D501  CD D539     	CALL	MEM		; Anzeige "No Memory" statt Zeile/Spalte
 2627 D504  CD D50F     MEMW1:	CALL	KEYB		; Tastatureingabe abwarten
 2628 D507  CD D982     	CALL	WIN82
 2629 D50A  E1          	POP	HL
 2630 D50B  22 B7A0     	LD	(CURSO),HL
 2631 D50E  C9          	RET
 2632                   
 2633 D50F  CD F003     KEYB:	CALL	PV1
 2634 D512  04          	DB	KBD		; Eingabe abwarten
 2635 D513  FE 03       	CP	3
 2636 D515  37          	SCF			; BRK -> CY=1
 2637 D516  C8          	RET	Z
 2638 D517  3F          	CCF
 2639 D518  C9          	RET
 2640                   ;-------
 2641                   ; Anzeige "Blockmarken?"
 2642 D519  CD F003     BLER1:	CALL	PV1
 2643 D51C  23          	DB	OSTR
 2644 D51D  0D 09 3E 3E 	DB	CR,9,'>>>> Block-Marken? <<<<',8,0
 2645 D538  C9          	RET
 2646                   ;-------
 2647                   ; Anzeige "no Memory":
 2648 D539  CD F003     MEM:	CALL	PV1
 2649 D53C  23          	DB	OSTR
 2650 D53D  0D 09 3E 3E 	DB	CR,9,'>>>> Speicher voll <<<<',8,0
 2651 D558  AF          	XOR	A
 2652 D559  32 0022     	LD	(M4A),A		; Fehler loeschen
 2653 D55C  C9          	RET
 2654                   ;-------
 2655                   ; Abfrage ja/nein:
 2656                   ; PA:	CY=1	BRK oder 'N' gedrueckt
 2657                   ;	CY=0	'Y' gedrueckt
 2658 D55D  CD F003     YESNO:	CALL	PV1
 2659 D560  23          	DB	OSTR
 2660 D561  20 28 59 2F 	DB	' (Y/N) ? ',0	; Entscheidung
 2661 D56B  CD D50F     YES1:	CALL	KEYB
 2662 D56E  38 0C       	JR	C,YES2		; BRK
 2663 D570  CD DB60     	CALL	LETTR
 2664 D573  FE 59       	CP	'Y'
 2665 D575  28 05       	JR	Z,YES2
 2666 D577  FE 4E       	CP	'N'
 2667 D579  20 F0       	JR	NZ,YES1
 2668 D57B  37          	SCF			; nein -> CY=1
 2669 D57C  F5          YES2:	PUSH	AF
 2670 D57D  CD CE9E     	CALL	CHR
 2671 D580  CD CE99     	CALL	LFCR
 2672 D583  F1          	POP	AF
 2673 D584  C9          	RET
 2674                   ;
 2675                   ; Tastatureingabe in einer Zeile:	(fuer FIND, RPLACE, NAME, ZEILE)
 2676                   ; (bei CR wird kein Zeilenvorschub ausgegeben)
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  60
EDITOR  Z80

 2677                   ; PE:	BC=min./max. Cursorspalte!
 2678                   ;	BC=0610h	Eingabe Dateiname
 2679                   ;	BC=0627h	Eingabe REPLACE
 2680                   ;	BC=080Ch	Eingabe ESC-Z (Zeilennummer)
 2681                   ;	BC=0819h	Eingabe ESC-F (Find)
 2682                   ; PA:	CY=1	BRK gedrueckt (und LF,CR ausgegeben)
 2683                   ;	CY=0	Enter, HL=Adresse des Zeilenanfangs im VRAM
 2684                   ; VR:	AF,DE,HL
 2685                   ;
 2686 D585  3A B7DF     INPUT:	ld	a,(l3siz)	; Laenge der ESC-Tabelle
 2687 D588  F5          	push	af
 2688 D589  AF          	xor	a		; temporaer deaktivieren
 2689 D58A  32 B7DF     	ld	(l3siz),a
 2690 D58D  78          	LD	A,B
 2691 D58E  32 B7A0     	LD	(CURSO),A
 2692 D591  CD D50F     INP1:	CALL	KEYB		; Tasteneingabe
 2693 D594  30 09       	JR	NC,INP0		; nicht BRK
 2694 D596  CD CE99     	CALL	LFCR		; Bei BRK Zeilenvorschub
 2695 D599  F1          	pop	af
 2696 D59A  32 B7DF     	ld	(l3siz),a	; ESC-Funktionen wieder aktivieren
 2697 D59D  37          	SCF
 2698 D59E  C9          	RET
 2699                   	;
 2700 D59F  FE 2E       INP0:	cp	'.'
 2701 D5A1  28 23       	jr	z,inp9		; Punkt trennt Dateiname + Typ
 2702 D5A3  FE 05       	cp	5		; TAB
 2703 D5A5  28 24       	jr	z,inpp		; geht zu Dateityp
 2704 D5A7  FE 20       	CP	' '
 2705 D5A9  30 2A       	JR	NC,INP2		; darstellbares Zeichen
 2706 D5AB  FE 08       	CP	8		; CUL
 2707 D5AD  28 26       	JR	Z,INP2
 2708 D5AF  FE 09       	CP	9		; CUR
 2709 D5B1  28 22       	JR	Z,INP2
 2710 D5B3  FE 0D       	CP	CR
 2711 D5B5  20 DA       	JR	NZ,INP1
 2712                   
 2713                   ; Eingabe beenden
 2714 D5B7  3A B7A1     INP7:	LD	A,(CURSO+1)	; aktuelle Zeile
 2715 D5BA  57          	LD	D,A
 2716 D5BB  58          	LD	E,B		; Eingabeposition
 2717 D5BC  CD F003     	CALL	PV1
 2718 D5BF  32          	DB	DABR		; Berechnen VRAM-Adresse
 2719 D5C0  F1          	pop	af
 2720 D5C1  32 B7DF     	ld	(l3siz),a	; ESC-Funktionen wieder aktivieren
 2721 D5C4  A7          	AND	A		; CY=0
 2722 D5C5  C9          	RET
 2723                   
 2724 D5C6  79          INP9:	LD	A,C		; max. Spalte
 2725 D5C7  FE 10       	CP	10h		; sind wir bei der Eingabe Dateiname?
 2726 D5C9  20 08       	JR	NZ,INP10	; nein, dann als normales Zeichen zulassen
 2727                   ; gehe zu Spalte von Dateityp
 2728 D5CB  78          inpp:	ld	a,b
 2729 D5CC  C6 08       	add	a,8
 2730 D5CE  32 B7A0     	ld	(curso),a
 2731 D5D1  18 06       	jr	INP3
 2732                   
 2733                   ; Zeichen anzeigen
 2734 D5D3  3E 2E       INP10:	LD	A,'.'
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  61
EDITOR  Z80

 2735 D5D5  CD F003     INP2:	CALL	PV1
 2736 D5D8  00          	DB	CRT		; Zeichen anzeigen
 2737 D5D9  21 B7A0     INP3:	LD	HL,CURSO
 2738 D5DC  7E          	LD	A,(HL)
 2739 D5DD  B8          	CP	B		; zu klein?
 2740 D5DE  30 01       	JR	NC,INP4
 2741 D5E0  78          	LD	A,B
 2742 D5E1  B9          INP4:	CP	C		; zu gross?
 2743 D5E2  38 01       	JR	C,INP5
 2744 D5E4  79          	LD	A,C
 2745 D5E5  77          INP5:	LD	(HL),A
 2746 D5E6  18 A9       	JR	INP1
 2747                   
 2748                   ;-------
 2749 D5E8  DDDD        	DEFW	0DDDDH
 2750 D5EA  4E 41 4D 45 	DB	'NAME',1
 2751 D5EF  CD D5F5     	CALL	NAME		; Dateiname eingeben -> NAME0
 2752 D5F2  C3 CE96     	JP	SAV10		; aktuellen Dateiname aendern
 2753                   ;
 2754                   ; Name (mit Typ) eingeben und zur Benutzung ablegen:
 2755                   ; PE:	NAMP	gespeicherter Dateiname (zur Vorgabe)
 2756                   ; PA:	HL=NAME0 (eingegebener Dateiname dort abgelegt)
 2757                   ;	CY=1	BRK
 2758                   ;
 2759 D5F5  CD F003     NAME:	CALL	PV1
 2760 D5F8  23          	DB	OSTR
 2761 D5F9  0A 0B 4E 61 	DB	LF,0BH,'Name :',0
 2762 D602  21 B7F5     	LD	HL,NAMP		; aktueller Dateiname
 2763 D605  06 08       	LD	B,8		; 8 Zeichen Dateiname
 2764 D607  CD D630     	CALL	NAME1		; anzeigen
 2765 D60A  7E          	LD	A,(HL)		; Dateityp
 2766 D60B  FE 21       	CP	' '+1		; leer?
 2767 D60D  38 07       	JR	C,NAME2		; TXT vorschlagen
 2768 D60F  06 03       	LD	B,3		; 3 Zeichen Dateityp
 2769 D611  CD D630     	CALL	NAME1		; anzeigen
 2770 D614  18 08       	JR	NAME3
 2771                   	;
 2772 D616  CD F003     NAME2:	CALL	PV1
 2773 D619  23          	DB	OSTR
 2774 D61A  54 58 54 00 	DB	'TXT',0		; Dateityp vorschlagen
 2775 D61E  01 0610     NAME3:	LD	BC,0610H	; Eingabeposition von-bis
 2776 D621  CD D585     	CALL	INPUT		; Eingabe
 2777 D624  D8          	RET	C		; BRK
 2778 D625  11 0000     	LD	DE,NAME0	; Dateiname hier ablegen
 2779 D628  D5          	PUSH	DE
 2780 D629  01 000B     	LD	BC,11		; 8.3
 2781 D62C  ED B0       	LDIR			; Zur Verwendung kopieren
 2782 D62E  E1          	POP	HL
 2783 D62F  C9          	RET
 2784                   	;
 2785 D630  7E          NAME1:	LD	A,(HL)		; gemerkter Name
 2786 D631  E6 7F       	AND	7FH		; wegen BASIC UUU
 2787 D633  23          	INC	HL
 2788 D634  CD F003     	CALL	PV1
 2789 D637  42          	DB	CSTBT		; zur Sicherheit!
 2790 D638  10 F6       	DJNZ	NAME1
 2791 D63A  C9          	RET
 2792                   ;
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  62
EDITOR  Z80

 2793                   ; Kassettenpuffer initialisieren, Dateiname eintragen:
 2794                   ; PE:	HL=Dateiname
 2795                   ;
 2796 D63B  11 B780     KPINI:	LD	DE,CASS+80h	; Ende Kassettenpuffer+1
 2797 D63E  AF          	XOR	A
 2798 D63F  1D          KPIN2:	DEC	E
 2799 D640  12          	LD	(DE),A		; Kassettenpuffer loeschen
 2800 D641  20 FC       	JR	NZ,KPIN2
 2801 D643  DD 73 05    	LD	(IX+5),E	; DE=0B700h
 2802 D646  DD 72 06    	LD	(IX+6),D
 2803 D649  01 000B     	LD	BC,11
 2804 D64C  ED B0       	LDIR			; Name eintragen
 2805 D64E  C9          	RET
 2806                   ;
 2807                   ; Text an Speicheranfang verschieben:
 2808                   ; PE:	DE=Zeilenzahl, 0=gesamter Text
 2809                   ;
 2810 D64F  2A 001A     TXANF:	LD	HL,(T2E)	; Ende Teiltext 2
 2811 D652  ED 4B 001E  	LD	BC,(T2A)	; Anfang Teiltext 2
 2812 D656  AF          	XOR	A		; CY=0
 2813 D657  ED 42       	SBC	HL,BC
 2814 D659  44          	LD	B,H
 2815 D65A  4D          	LD	C,L		; Laenge Text 2
 2816 D65B  C8          	RET	Z		; kein Text 2
 2817 D65C  2A 0012     	LD	HL,(MEML)	; Zeilennummer
 2818 D65F  E5          	PUSH	HL
 2819 D660  2A 001E     	LD	HL,(T2A)	; von hier verschieben
 2820 D663  3E 0D       TXA1:	LD	A,CR
 2821 D665  CD 0071     	CALL	TCPIR		; Zeilenende suchen
 2822 D668  20 13       	JR	NZ,TXA2		; ausgesucht, aber CR nicht gefunden
 2823 D66A  1B          	DEC	DE		; rueckwaerts zaehlen
 2824 D66B  E3          	EX	(SP),HL
 2825 D66C  23          	INC	HL		; Zeilennummer +1
 2826 D66D  E3          	EX	(SP),HL
 2827 D66E  E2 D67D     	JP	PO,TXA2		; ausgesucht und CR gefunden
 2828 D671  7A          	LD	A,D
 2829 D672  B3          	OR	E		; gewuenschte Anzahl erreicht?
 2830 D673  20 EE       	JR	NZ,TXA1
 2831 D675  CD 0086     	CALL	GET
 2832 D678  FE 0A       	CP	LF		; folgt LF?
 2833 D67A  20 01       	JR	NZ,TXA2		; nein
 2834 D67C  23          	INC	HL		; LF noch mitnehmen
 2835 D67D  CD D685     TXA2:	CALL	TXA		; Text verschieben
 2836 D680  E1          TXA4:	POP	HL
 2837 D681  22 0012     	LD	(MEML),HL	; neue Zeilennummer
 2838 D684  C9          	RET
 2839                   	;
 2840 D685  ED 5B 001E  TXA:	LD	DE,(T2A)	; Anfang Text 2
 2841 D689  D5          	PUSH	DE
 2842 D68A  AF          	XOR	A
 2843 D68B  ED 52       	SBC	HL,DE
 2844 D68D  44          	LD	B,H
 2845 D68E  4D          	LD	C,L		; BC=Laenge des zu verschiebenden Textes
 2846 D68F  E1          	POP	HL		; HL=Quelle
 2847 D690  ED 5B 001C  	LD	DE,(T1E)	; DE=Ziel
 2848 D694  28 03       	JR	Z,TXA3		; nichts zu verschieben
 2849 D696  CD 0063     	CALL	TLDIR		; an Text 1 anhaengen
 2850 D699  ED 53 001C  TXA3:	LD	(T1E),DE
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  63
EDITOR  Z80

 2851 D69D  22 001E     	LD	(T2A),HL
 2852 D6A0  C9          	RET
 2853                   ;
 2854                   ; Text an Speicherende verschieben:
 2855                   ; PE:	DE=Zeilenzahl, 0=gesamter Text
 2856                   ; PA:	Z=1 es wurde kein Text verschoben (Position ist bereits Textanfang)
 2857                   ;
 2858 D6A1  CD CDF3     TOP:	CALL	HOM
 2859 D6A4  2A 001C     TXEND:	LD	HL,(T1E)	; Ende Teiltext 1
 2860 D6A7  ED 4B 0018  	LD	BC,(T1A)	; Anfang Teiltext 1
 2861 D6AB  AF          	XOR	A		; CY=0
 2862 D6AC  ED 42       	SBC	HL,BC
 2863 D6AE  44          	LD	B,H
 2864 D6AF  4D          	LD	C,L		; Laenge Text 1
 2865 D6B0  C8          	RET	Z		; kein Text 1
 2866 D6B1  03          	INC	BC		; bis zum CR am Textanfang suchen
 2867 D6B2  2A 0012     	LD	HL,(MEML)	; Zeilennummer
 2868 D6B5  E5          	PUSH	HL
 2869 D6B6  2A 001C     	LD	HL,(T1E)	; von hier verschieben
 2870 D6B9  2B          	DEC	HL		; letztes Zeichen
 2871 D6BA  CD 0086     	CALL	GET		; Zeichen aus Textspeicher
 2872 D6BD  FE 0A       	CP	LF		; LF am Zeilenende?
 2873 D6BF  20 02       	JR	NZ,TXE0
 2874 D6C1  2B          	DEC	HL		; vor das LF gehen fuer Suchen
 2875 D6C2  0B          	DEC	BC		; und Suchanzahl verringern
 2876 D6C3  CD 0086     TXE0:	CALL	GET		; Zeichen aus Textspeicher
 2877 D6C6  FE 0D       	CP	CR		; davor noch ein CR?
 2878 D6C8  20 02       	JR	NZ,TXE1
 2879 D6CA  2B          	DEC	HL		; das auch uebergehen
 2880 D6CB  0B          	DEC	BC
 2881 D6CC  3E 0D       TXE1:	LD	A,CR
 2882 D6CE  CD 0078     	CALL	TCPDR		; Zeilenende suchen
 2883 D6D1  1B          	DEC	DE		; rueckwaerts zaehlen
 2884 D6D2  E3          	EX	(SP),HL
 2885 D6D3  2B          	DEC	HL		; Textzeile -1
 2886 D6D4  E3          	EX	(SP),HL
 2887 D6D5  20 08       	JR	NZ,TXE2		; ausgesucht, aber CR nicht gefunden
 2888 D6D7  E2 D6DE     	JP	PO,TXE2a	; ausgesucht und CR gefunden
 2889 D6DA  7A          	LD	A,D
 2890 D6DB  B3          	OR	E		; gewuenschte Anzahl erreicht?
 2891 D6DC  20 EE       	JR	NZ,TXE1
 2892 D6DE  23          TXE2a:	INC	HL		; auf CR gehen
 2893 D6DF  23          TXE2:	INC	HL		; auf LF gehen
 2894 D6E0  CD 0086     	CALL	GET		; Zeichen aus Textspeicher
 2895 D6E3  FE 0A       	CP	LF		; folgt LF?
 2896 D6E5  20 01       	JR	NZ,TXE3
 2897 D6E7  23          	INC	HL		; das LF auch noch ubergehen
 2898 D6E8  EB          TXE3:	EX	DE,HL		; DE=Beginn Verschiebebereich
 2899 D6E9  E1          	POP	HL
 2900 D6EA  22 0012     	LD	(MEML),HL	; neue Zeilennummer
 2901 D6ED  2A 001C     TXE4:	LD	HL,(T1E)	; HL=Ende Verschiebebereich
 2902 D6F0  E5          TXE5:	PUSH	HL
 2903 D6F1  AF          	XOR	A		; CY=0
 2904 D6F2  ED 52       	SBC	HL,DE
 2905 D6F4  44          	LD	B,H
 2906 D6F5  4D          	LD	C,L		; BC=Laenge des zu verschiebenden Textes
 2907 D6F6  E1          	POP	HL
 2908 D6F7  ED 5B 001E  	LD	DE,(T2A)
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  64
EDITOR  Z80

 2909 D6FB  1B          	DEC	DE		; DE=Quelle
 2910 D6FC  2B          	DEC	HL		; HL=Ziel
 2911 D6FD  C4 006A     	CALL	NZ,TLDDR	; Text verschieben
 2912 D700  13          	INC	DE
 2913 D701  ED 53 001E  	LD	(T2A),DE
 2914 D705  23          	INC	HL
 2915 D706  22 001C     	LD	(T1E),HL
 2916 D709  C9          	RET
 2917                   ;
 2918                   ; Abspeichern der Bildschirmseite in den Textspeicher:
 2919                   ; PA:	CY=1	No Memory
 2920                   ;
 2921 D70A  2A 001E     MPAGE:	ld	hl,(t2a)
 2922 D70D  22 B4DA     	ld	(T2merk),hl	; Textgrenzen merken fuer den Fall
 2923 D710  2A 001C     	ld	hl,(t1e)	; dass beim Speichern kein Platz ist
 2924 D713  22 B4D8     	ld	(T1merk),hl
 2925 D716  2A 001C     	LD	HL,(T1E)
 2926 D719  E5          	PUSH	HL		; Ende Text 1 merken
 2927 D71A  11 0000     	LD	DE,0		; links oben
 2928 D71D  CD C561     	CALL	DABR80		; VRAM-Adresse berechnen
 2929 D720  06 17       	LD	B,23		; Zeilen
 2930 D722  C5          MPG1:	PUSH	BC
 2931 D723  CD D730     	CALL	MLINE		; Zeile abspeichern, an Text 1 anhaengen
 2932 D726  C1          	POP	BC
 2933 D727  38 05       	JR	C,MPG3		; No Memory!
 2934 D729  10 F7       	DJNZ	MPG1		; bis alle Bildschirmzeilen abgearbeitet sind
 2935 D72B  D1          	POP	DE		; T1E alter Wert
 2936 D72C  18 BF       	JR	TXE4		; zum Anfang von Text 2 verschieben!
 2937                   	;
 2938 D72E  D1          MPG3:	POP	DE
 2939 D72F  C9          	RET
 2940                   ;
 2941                   ; Bildschirmzeile (an Ende von Text 1) abspeichern:
 2942                   ; PE:	HL	VRAM-Adresse der Zeile
 2943                   ; PA:	HL	VRAM-Adresse + 80 (naechste Zeile)
 2944                   ;	T1E	neues Textende
 2945                   ;	CY=1	und (M4A)=A	Speicher voll!
 2946                   ;
 2947 D730  ED 5B 001C  MLINE:	LD	DE,(T1E)	; Text hier abspeichern
 2948 D734  06 50       	LD	B,80		; Zeilenlaenge
 2949 D736  0E 00       MLN1:	LD	C,0		; Zaehler fuer Nullen
 2950 D738  7E          	LD	A,(HL)
 2951 D739  23          	INC	HL
 2952 D73A  A7          	AND	A		; Zeichen vorhanden?
 2953 D73B  28 0D       	JR	Z,MLN4		; kein Zeichen
 2954 D73D  CD D778     MLN2:	CALL	MLN9		; Zeichen in Textspeicher
 2955 D740  D8          	RET	C		; No Memory
 2956 D741  10 F3       	DJNZ	MLN1		; naechstes Zeichen
 2957 D743  18 08       	JR	MLN5		; CR+LF anhaengen
 2958                   	;
 2959 D745  7E          MLN3:	LD	A,(HL)		; naechstes Zeichen testen
 2960 D746  23          	INC	HL
 2961 D747  A7          	AND	A		; jetzt ein Zeichen vorhanden
 2962 D748  20 14       	JR	NZ,MLN6		; ja, Tabs eintragen
 2963 D74A  0C          MLN4:	INC	C		; Nullen zaehlen
 2964 D74B  10 F8       	DJNZ	MLN3
 2965 D74D  3E 0D       MLN5:	LD	A,CR
 2966 D74F  CD D778     	CALL	MLN9		; in Textspeicher
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  65
EDITOR  Z80

 2967 D752  D8          	RET	C
 2968 D753  3E 0A       	LD	A,LF
 2969 D755  CD D778     	CALL	MLN9		; in Textspeicher
 2970 D758  D8          	RET	C
 2971 D759  ED 53 001C  	LD	(T1E),DE	; Text bis hierher eingetragen
 2972 D75D  C9          	RET
 2973                   	;
 2974 D75E  F5          MLN6:	PUSH	AF		; Zeichen merken
 2975 D75F  79          	LD	A,C		; gezaehlte Nullen
 2976 D760  C6 07       	ADD	7		; aufrunden
 2977 D762  CB 3F       	SRL	A
 2978 D764  CB 3F       	SRL	A
 2979 D766  CB 3F       	SRL	A		; und durch 8 teilen
 2980 D768  4F          	LD	C,A		; Anzahl Tabulatoren
 2981 D769  3E 09       	LD	A,TAB
 2982 D76B  CD D778     MLN7:	CALL	MLN9		; in Textspeicher eintragen
 2983 D76E  38 06       	JR	C,MLN8		; Speicher voll
 2984 D770  0D          	DEC	C
 2985 D771  20 F8       	JR	NZ,MLN7
 2986 D773  F1          	POP	AF		; Zeichen
 2987 D774  18 C7       	JR	MLN2		; nach dem TAB eintragen
 2988                   	;
 2989 D776  C1          MLN8:	POP	BC		; Zeichen vergessen
 2990 D777  C9          	RET
 2991                   ;
 2992                   ; Zeichen in Textspeicher eintragen
 2993                   ; PE:	A	Zeichen
 2994                   ;	DE	Zeiger auf Textspeicher
 2995                   ; PA:	CY=1	und (M4A)=A	Speicher voll!
 2996                   ;
 2997 D778  E5          MLN9:	PUSH	HL
 2998 D779  2A 001E     	LD	HL,(T2A)
 2999 D77C  37          	SCF
 3000 D77D  ED 52       	SBC	HL,DE		; 1 Zeichen Platz frei?
 3001 D77F  E1          	POP	HL
 3002 D780  38 07       	JR	C,MLN10
 3003 D782  EB          	EX	DE,HL
 3004 D783  CD 0092     	CALL	PUT		; Zeichen in Textspeicher
 3005 D786  EB          	EX	DE,HL
 3006 D787  13          	INC	DE
 3007 D788  C9          	RET
 3008                   	;
 3009 D789  32 0022     MLN10:	LD	(M4A),A		; no Memory
 3010 D78C  C9          	RET
 3011                   ;
 3012                   ; Ausgabe Zeile auf Bildschirm:
 3013                   ; PE:	BC	Zeiger auf Textspeicher
 3014                   ;	DE	Cursorposition (E = Spalte)
 3015                   ;	HL	VRAM-Adresse
 3016                   ;
 3017 D78D  7B          WRZLE:	LD	A,E		; Spalte
 3018 D78E  FE 50       	CP	80		; Zeilenende?
 3019 D790  30 33       	JR	NC,WRZL05	; Bildschirmzeile voll
 3020 D792  CD 008C     	CALL	GETBC		; Zeichen aus Textspeicher holen und
 3021 D795  FE 03       	CP	3		; Textende?
 3022 D797  28 4A       	JR	Z,WRZL10	; T2A setzen und Rest der Zeile loeschen
 3023 D799  03          	INC	BC		; Zeiger auf naechstes Zeichen setzen
 3024 D79A  FE 20       	CP	' '
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  66
EDITOR  Z80

 3025 D79C  38 07       	JR	C,WRZL02	; Steuerzeichen
 3026 D79E  CD C5B2     WRZL01:	CALL	WRZCH		; Zeichen anzeigen (wenn anders)
 3027 D7A1  23          	INC	HL		; naechste VRAM-Adresse
 3028 D7A2  1C          	INC	E		; naechste Spaltenposition
 3029 D7A3  18 E8       	JR	WRZLE		; naechstes Zeichen aus Textspeicher holen
 3030                   	;
 3031 D7A5  FE 09       WRZL02:	CP	TAB		; Tabulator
 3032 D7A7  20 10       	JR	NZ,WRZL04
 3033 D7A9  CD C5B1     WRZL03:	CALL	WRZCH0		; Leerzeichen anzeigen
 3034 D7AC  23          	INC	HL		; VRAM
 3035 D7AD  1C          	INC	E		; Spalte
 3036 D7AE  7B          	LD	A,E
 3037 D7AF  FE 50       	CP	80		; Zeilenende?
 3038 D7B1  30 12       	JR	NC,WRZL05	; Bildschirmzeile voll
 3039 D7B3  E6 07       	AND	7
 3040 D7B5  20 F2       	JR	NZ,WRZL03	; bis Tabulatorschritt fertig
 3041 D7B7  18 D4       	JR	WRZLE		; naechstes Zeichen aus Textspeicher holen
 3042                   	;
 3043 D7B9  FE 0D       WRZL04:	CP	CR		; Zeilenende?
 3044 D7BB  28 1E       	JR	Z,WRZL08	; ja
 3045 D7BD  FE 0A       	CP	LF
 3046 D7BF  28 10       	JR	Z,WRZL06	; LF
 3047 D7C1  FE 03       	CP	3		; Textende?
 3048 D7C3  18 D9       	JR	WRZL01		; alles andere darstellen
 3049                   
 3050                   ; Bildschirmzeile voll
 3051 D7C5  CD 008C     WRZL05:	CALL	GETBC		; 81. Zeichen lesen
 3052 D7C8  FE 0D       	CP	CR		; ist das vielleicht noch ein CR?
 3053 D7CA  28 0E       	JR	Z,WRZL07
 3054 D7CC  FE 0A       	CP	LF		; oder ein LF?
 3055 D7CE  20 13       	JR	NZ,WRZL10
 3056                   ; LF erkannt
 3057 D7D0  03          	INC	BC		; LF uebergehen
 3058 D7D1  CD 008C     WRZL06:	CALL	GETBC
 3059 D7D4  FE 0D       	CP	CR		; LF+CR?
 3060 D7D6  20 0B       	JR	NZ,WRZL10	; nur LF
 3061 D7D8  18 08       	JR	WRZL09
 3062                   
 3063                   ; CR erkannt
 3064 D7DA  03          WRZL07:	INC	BC		; CR uebergehen
 3065 D7DB  CD 008C     WRZL08:	CALL	GETBC
 3066 D7DE  FE 0A       	CP	LF		; CR+LF?
 3067 D7E0  20 01       	JR	NZ,WRZL10
 3068 D7E2  03          WRZL09:	INC	BC		; 2. Zeichen von CR+LF uebergehen
 3069 D7E3  ED 43 001E  WRZL10:	LD	(T2A),BC	; neuer Textanfang
 3070                   
 3071                   ; Zeilenrest mit Leerzeichen beschreiben
 3072 D7E7  7B          WRZL11:	LD	A,E
 3073 D7E8  FE 50       	CP	80		; letzte Spalte?
 3074 D7EA  D0          	RET	NC		; fertig mit der Zeile
 3075 D7EB  CD C5B1     	CALL	WRZCH0		; Zeilenrest mit Leerzeichen fuellen
 3076 D7EE  23          	INC	HL
 3077 D7EF  1C          	INC	E
 3078 D7F0  18 F5       	JR	WRZL11
 3079                   ;
 3080                   ; Ausgabe einer Text-Seite auf Bildschirm:
 3081                   ;
 3082 D7F2  CD D845     WRPG:	CALL	STATUS		; Statuszeile anzeigen
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  67
EDITOR  Z80

 3083 D7F5  ED 4B 001E  WRPG0:	LD	BC,(T2A)	; Anfang Teiltext 2
 3084 D7F9  11 0000     	LD	DE,0		; Zeile 0, Spalte 0
 3085 D7FC  CD C561     	CALL	DABR80		; HL=VRAM-Adresse
 3086 D7FF  1E 00       WRPG1:	LD	E,0
 3087 D801  CD D78D     	CALL	WRZLE		; Zeile schreiben
 3088 D804  14          	INC	D		; naechste Zeile
 3089 D805  7A          	LD	A,D
 3090 D806  FE 17       	CP	23		; letzte Zeile?
 3091 D808  20 F5       	JR	NZ,WRPG1
 3092 D80A  C3 C986     	JP	CLI2		; gemerkte Cursorposition aktivieren
 3093                   ;
 3094                   ; Anzeige der Statuszeile im Editiermodus (aehnlich WordPro)
 3095                   ;
 3096 D80D  0000  00FF  LINES:	DW	0,255,319,255	; Linie oberer Bildschirmrand
 3097 D815  0000  00ED  	DW	0,237,319,237	; Linie unter Statuszeile
 3098 D81D  0000  00ED  	DW	0,237,0,255	; Rahmen linke Seite
 3099 D825  013F  00EE  	DW	319,238,319,254	; Rahmen rechte Seite
 3100 D82D  006A  00EE  	DW	106,238,106,254	; erste Trennung
 3101 D835  00AA  00EE  	DW	170,238,170,254	; zweite Trennung
 3102 D83D  00F2  00EE  	DW	242,238,242,254	; dritte Trennung
 3103                   
 3104 D845  CD CA8A     STATUS:	CALL	WIN80		; volles Fenster
 3105                   
 3106                   ; Rahmen zeichnen
 3107 D848  3E 3C       	LD	A,00111100b
 3108 D84A  32 B7D6     	LD	(FARB),A	; Linienfarbe weiss
 3109 D84D  21 D80D     	LD	HL,LINES
 3110 D850  06 07       	LD	B,7		; 7 Linien zeichnen
 3111 D852  C5          STA0:	PUSH	BC
 3112 D853  11 B782     	LD	DE,ARG1
 3113 D856  01 0008     	LD	BC,8
 3114 D859  ED B0       	LDIR			; Linienparameter in ARG's laden
 3115 D85B  E5          	PUSH	HL
 3116 D85C  CD F003     	CALL	PV1
 3117 D85F  3E          	DB	LINE
 3118 D860  E1          	POP	HL
 3119 D861  C1          	POP	BC
 3120 D862  10 EE       	DJNZ	STA0
 3121                   
 3122 D864  21 0001     	LD	HL,1		; Zeile 0, Spalte 1
 3123 D867  22 B7A0     	LD	(CURSO),HL
 3124 D86A  CD F003     	CALL	PV1
 3125 D86D  23          	DB	OSTR
 3126 D86E  5A 65 69 6C 	DB	'Zeile:       Spalte: ',0
 3127 D884  CD D999     	CALL	CAPS0		; CAPS-Symbol anzeigen Spalte 28
 3128                   
 3129                   ; Bit 4 (STAT) testen: Einfuegen ein/aus?
 3130 D887  3E 1E       	LD	A,30		; Spalte 30
 3131 D889  32 B7A0     	LD	(CURSO),A
 3132 D88C  21 003E     	LD	HL,STAT
 3133 D88F  CB 66       	BIT	4,(HL)
 3134 D891  20 10       	JR	NZ,STA1
 3135 D893  CD F003     	CALL	PV1
 3136 D896  23          	DB	OSTR
 3137 D897  45 69 6E 66 	DB	'Einf'81h,'gen ',0
 3138 D8A1  18 0E       	JR	STA2
 3139                   	;
 3140 D8A3  CD F003     STA1:	CALL	PV1
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  68
EDITOR  Z80

 3141 D8A6  23          	DB	OSTR
 3142 D8A7  9A 62 65 72 	DB	9Ah,'berschr.',0
 3143                   
 3144                   ; Bit 5+6 (STAT) testen: Zeichensatz
 3145 D8B1  3E 2D       STA2:	LD	A,45		; Spalte 44
 3146 D8B3  32 B7A0     	LD	(CURSO),A
 3147 D8B6  CD F003     	CALL	PV1
 3148 D8B9  23          	DB	OSTR
 3149 D8BA  5A 53 3A 00 	DB	'ZS:',0
 3150 D8BE  7E          	LD	A,(HL)
 3151 D8BF  E6 60       	AND	60H		; Bit 5+6
 3152 D8C1  20 0E       	JR	NZ,STA3
 3153 D8C3  CD F003     	CALL	PV1
 3154 D8C6  23          	DB	OSTR
 3155 D8C7  41 53 43 49 	DB	'ASCII  ',0	; 00 = IBM-Zeichensatz
 3156 D8CF  18 1E       	JR	STA4
 3157                   
 3158 D8D1  D6 20       STA3:	SUB	20H
 3159 D8D3  20 0E       	JR	NZ,STA31
 3160 D8D5  CD F003     	CALL	PV1
 3161 D8D8  23          	DB	OSTR
 3162 D8D9  64 65 75 74 	DB	'deutsch',0	; 01 = ASCII deutsch
 3163 D8E1  18 0C       	JR	STA4
 3164                   	;
 3165 D8E3  CD F003     STA31:	CALL	PV1
 3166 D8E6  23          	DB	OSTR
 3167 D8E7  43 41 4F 53 	DB	'CAOS   ',0	; 10 = CAOS-Zeichensatz
 3168                   
 3169                   ; aktuellen Dateiname anzeigen
 3170 D8EF  3E 40       STA4:	LD	A,64		; Spalte 64
 3171 D8F1  32 B7A0     	LD	(CURSO),A
 3172 D8F4  21 B7F5     	LD	HL,NAMP
 3173 D8F7  06 08       	LD	B,8
 3174 D8F9  CD D630     	CALL	NAME1
 3175 D8FC  3E 2E       	LD	A,'.'
 3176 D8FE  CD F003     	CALL	PV1
 3177 D901  00          	DB	CRT
 3178 D902  06 03       	LD	B,3
 3179 D904  CD D630     	CALL	NAME1
 3180                   
 3181                   ; Spaltengloeckchen falls Tastenclick ein ist
 3182 D907  11 0028     	LD	DE,0028h	; Position Spaltengloeckchen in Zeile 0
 3183 D90A  DD CB 08 6E 	BIT	5,(IX+8)	; Tastenclick?
 3184 D90E  3E 05       	LD	A,5		; Code fuer Gloeckchen
 3185 D910  20 02       	JR	NZ,STA5
 3186 D912  3E 20       	LD	A,' '		; ansonsten leer
 3187 D914  CD C5B5     STA5:	CALL	WPIX		; direkt anzeigen
 3188                   
 3189                   ; Tabulatorleiste mit Randmarken
 3190 D917  11 0100     	LD	DE,0100h	; Zeile 1, Spalte 0
 3191 D91A  2A 0010     	LD	HL,(RANDL)	; L=Pos. linker Rand
 3192                   				; H=Pos. rechter Rand
 3193 D91D  06 0A       	LD	B,10		; 10 Tabulatoren
 3194 D91F  0E 07       	LD	C,7		; Code fuer waagerechte Linie ohne TAB
 3195 D921  7B          STA6:	LD	A,E		; Spalte
 3196 D922  BD          	CP	L		; linke Randmarke?
 3197 D923  20 02       	JR	NZ,STA7
 3198 D925  0E 02       	LD	C,2		; Code fuer linke Randmarke
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  69
EDITOR  Z80

 3199 D927  BC          STA7:	CP	H		; rechte Randmarke?
 3200 D928  20 02       	JR	NZ,STA8
 3201 D92A  0E 03       	LD	C,3		; Code fuer rechte Randmarke		
 3202 D92C  79          STA8:	LD	A,C		; Zeichencode
 3203 D92D  CD C5B5     	CALL	WPIX		; direkt anzeigen
 3204 D930  3E 08       	LD	A,8
 3205 D932  83          	ADD	A,E		; naechste Spalte
 3206 D933  5F          	LD	E,A
 3207 D934  0E 06       	LD	C,6		; Code fuer waagerechte Linie mit TAB
 3208 D936  10 E9       	DJNZ	STA6
 3209                   
 3210                   ; Anzeige der Cursorposition in der Statuszeile
 3211                   
 3212 D938  CD CA8A     PCOL:	CALL	WIN80		; volle Fenstergroesse (falls Einsprung hier)
 3213 D93B  21 0008     	LD	HL,8		; Position Zeile
 3214 D93E  22 B7A0     	LD	(CURSO),HL
 3215 D941  2A 0021     	LD	HL,(COL+1)	; aktuelle Zeile
 3216 D944  26 00       	LD	H,0
 3217 D946  ED 5B 0012  	LD	DE,(MEML)	; Zeilennummer von Textanfang
 3218 D94A  19          	ADD	HL,DE
 3219 D94B  CD F003     	CALL	PV1
 3220 D94E  4A          	DB	HLDEZ		; dezimal anzeigen
 3221 D94F  CD F003     	CALL	PV1
 3222 D952  2B          	DB	SPACE
 3223 D953  21 0016     	LD	HL,22		; Position Spalte
 3224 D956  22 B7A0     	LD	(CURSO),HL
 3225 D959  2A 0020     	LD	HL,(COL)	; aktuelle Spalte
 3226 D95C  26 00       	LD	H,0
 3227 D95E  23          	INC	HL		; ab 1 beginnend
 3228 D95F  CD F003     	CALL	PV1
 3229 D962  4A          	DB	HLDEZ		; dezimal anzeigen
 3230 D963  CD F003     	CALL	PV1
 3231 D966  2B          	DB	SPACE
 3232                   
 3233 D967  3E 38       	LD	A,56		; Position HEX-Wert
 3234 D969  32 B7A0     	LD	(CURSO),A
 3235 D96C  ED 5B 0020  	LD	DE,(COL)	; aktuelle Cursorposition
 3236 D970  14          	INC	D
 3237 D971  14          	INC	D		; +2 weil wir in WIN80 stehen
 3238 D972  CD C561     	CALL	DABR80
 3239 D975  7E          	LD	A,(HL)
 3240 D976  CD F003     	CALL	PV1
 3241 D979  1C          	DB	AHEX
 3242                   
 3243 D97A  ED 5B 0020  	LD	DE,(COL)	; aktuelle Cursorposition
 3244 D97E  ED 53 B7A0  	LD	(CURSO),DE	; wieder eintragen
 3245                   ;	JP	WIN82		; Editor-Fenster ab Zeile 2
 3246                   
 3247                   ; Fenster ab Zeile 2 mit 23 Zeilen
 3248                   
 3249 D982  21 0200     WIN82:	LD	HL,0200h
 3250 D985  22 B79C     	LD	(WINON),HL
 3251 D988  21 1750     	LD	HL,1750h
 3252 D98B  22 B79E     	LD	(WINLG),HL
 3253 D98E  C9          	RET
 3254                   
 3255                   ; CAPS-Zustand anzeigen
 3256                   
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  70
EDITOR  Z80

 3257 D98F  D5          CAPS80:	PUSH	DE
 3258 D990  CD CA8A     	CALL	WIN80		; Fenster mit Statuszeile
 3259 D993  CD D999     	CALL	CAPS0
 3260 D996  D1          	POP	DE
 3261 D997  18 E9       	JR	WIN82		; Fenster ohne Statuszeile
 3262                   	;
 3263 D999  DD CB 08 7E CAPS0:	BIT	7,(IX+8)	; CAPS ein oder aus?
 3264 D99D  3E 1D       	LD	A,1DH		; Pfeil nach oben
 3265 D99F  20 02       	JR	NZ,CA1		; CAPS ist aus
 3266 D9A1  3E 1F       	LD	A,1FH		; Pfeil nach unten
 3267 D9A3  11 001C     CA1:	LD	DE,001Ch	; Position CAPS-Symbol (Spalte 28)
 3268 D9A6  C3 C5B5     	JP	WPIX		; direkt anzeigen
 3269                   
 3270                   ;======================
 3271                   ; Editor-Erweiterungen:
 3272                   ;======================
 3273                   
 3274                   ;
 3275                   ; Import-Funktion nachladen
 3276                   ;
 3277 D9A9  49 4D 50 4F I_NAME:	DB	'IMPORT  KCC',0	; Dateiname
 3278 D9B5  DDDD        	DEFW	0DDDDH
 3279 D9B7  49 4D 50 4F 	DB	'IMPORT',1
 3280 D9BE  21 D9A9     	LD	HL,I_NAME	; Dateiname
 3281 D9C1  CD F003     OVERLD:	CALL	PV1
 3282 D9C4  23          	DB	OSTR
 3283 D9C5  4C 6F 61 64 	DB	'Loading ',0
 3284 D9CE  E5          	PUSH	HL
 3285 D9CF  CD F003     	CALL	PV1
 3286 D9D2  45          	DB	ZKOUT		; Dateiname anzeigen
 3287 D9D3  CD CE99     	CALL	LFCR
 3288 D9D6  E1          	POP	HL		; Dateiname aus dem EDITOR-ROM
 3289 D9D7  11 0000     	LD	DE,NAME0	; nach Adresse 0 kopieren
 3290 D9DA  01 000B     	LD	BC,11		; 8.3
 3291 D9DD  ED B0       	LDIR
 3292 D9DF  21 0000     	LD	HL,NAME0	; Dateiname fuer LOAD
 3293 D9E2  CD F003     	CALL	PV1		; (ARGN)=0 wenn ohne Parameter aufgerufen wird
 3294 D9E5  10          	DB	LOAD
 3295 D9E6  D8          	RET	C		; Fehler
 3296 D9E7  C3 BA00     	JP	0BA00H
 3297                   ;
 3298                   ; Hilfe-Funktion nachladen:
 3299                   ;
 3300 D9EA  48 49 4C 46 H_NAME:	DB	'HILFE   KCC',0	; Dateiname
 3301 D9F6  DDDD        	DEFW	0DDDDH
 3302 D9F8  48 45 4C 50 	DB	'HELP',1
 3303 D9FD  21 D9EA     	LD	HL,H_NAME	; Dateiname
 3304 DA00  18 BF       	JR	OVERLD		; nachladen & starten
 3305                   ;-------
 3306                   ; Blockmarken (1CH=Anfang, 1EH=Ende) suchen:
 3307                   ; PE:	HL	Beginn Suchbereich
 3308                   ;	DE	Ende Suchbereich
 3309                   ; PA:	Z=1	beide Blockmarken gefunden
 3310                   ;	HL	Adresse nach Blockanfangszeichen
 3311                   ;	DE	Adresse des Blockendezeichens oder Ende Suchbereich
 3312                   ;
 3313 DA02  EB          SRCH40:	EX	DE,HL
 3314 DA03  B7          	OR	A		; CY=0
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  71
EDITOR  Z80

 3315 DA04  ED 52       	SBC	HL,DE
 3316 DA06  4D          	LD	C,L
 3317 DA07  44          	LD	B,H		; Textlaenge
 3318 DA08  03          	INC	BC
 3319 DA09  EB          	EX	DE,HL
 3320 DA0A  3E 1C       	LD	A,1CH		; Blockanfangsmarke
 3321 DA0C  CD 0071     	CALL	TCPIR		; Suchen 1. Trennzeichen
 3322 DA0F  C0          	RET	NZ
 3323 DA10  54          	LD	D,H
 3324 DA11  5D          	LD	E,L
 3325 DA12  3E 1E       	LD	A,1EH		; Blockendemarke
 3326 DA14  CD 0071     	CALL	TCPIR		; Suchen 2. Trennzeichen
 3327 DA17  2B          	DEC	HL
 3328                   ;	XOR	A		; Z=1
 3329 DA18  EB          	EX	DE,HL
 3330 DA19  C9          	RET
 3331                   
 3332                   ;-------
 3333 DA1A  DDDD        	DEFW	0DDDDH
 3334 DA1C  50 53 41 56 	DB	'PSAVE',1Fh
 3335 DA22  CD D6A1     	CALL	TOP		; gesamten Text an Speicherende
 3336 DA25  2A 001E     	LD	HL,(T2A)
 3337 DA28  E5          	PUSH	HL
 3338 DA29  ED 5B 001A  	LD	DE,(T2E)
 3339 DA2D  D5          	PUSH	DE
 3340 DA2E  CD DA02     	CALL	SRCH40		; Blockmarken suchen
 3341 DA31  28 0C       	JR	Z,PSA1		; gefunden
 3342 DA33  D1          BLERR:	POP	DE
 3343 DA34  E1          	POP	HL
 3344 DA35  CD F003     	CALL	PV1
 3345 DA38  20          	DB	NOUT
 3346 DA39  CD D519     	CALL	BLER1		; Anzeige "Blockmarken?"
 3347 DA3C  C3 CE99     	JP	LFCR
 3348                   	;
 3349 DA3F  22 001E     PSA1:	LD	(T2A),HL	; modifizieren
 3350 DA42  ED 53 001A  	LD	(T2E),DE	; modifizieren
 3351 DA46  2A 001A     	LD	HL,(T2E)
 3352 DA49  CD 0086     	CALL	GET		; Zeichen aus Textspeicher
 3353 DA4C  E5          	PUSH	HL		; Adresse und
 3354 DA4D  F5          	PUSH	AF		; Inhalt merken
 3355 DA4E  3E 03       	LD	A,3
 3356 DA50  CD 0092     	CALL	PUT		; Textende vortaeuschen!
 3357 DA53  CD CE05     	CALL	SAV1		; abspeichern
 3358 DA56  F1          PSA2:	POP	AF
 3359 DA57  E1          	POP	HL
 3360 DA58  CD 0092     	CALL	PUT		; regenerieren
 3361 DA5B  E1          	POP	HL
 3362 DA5C  22 001A     	LD	(T2E),HL	; gesamter Text
 3363 DA5F  E1          	POP	HL
 3364 DA60  22 001E     	LD	(T2A),HL	; gesamter Text
 3365 DA63  C9          	RET
 3366                   ;-------------------------------------------------------------------------------
 3367                   ; Ausdruck eines Teil-Textes auf den in CAOS aktivierten Druckers
 3368                   ; PPRINT ohne Parameter druckt Text 1:1 aus
 3369                   ; PPRINT mit Parameter fuegt nach n Zeilen einen Seitenwechsel 0ch ein
 3370                   ;
 3371 DA64  DDDD        	DEFW	0DDDDH
 3372 DA66  50 50 52 49 	DB	'PPRINT',11H	; Argument als Dezimalzahl
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  72
EDITOR  Z80

 3373 DA6D  CD D101     	CALL	PRINT1		; Druck vorbereiten
 3374 DA70  D8          	RET	C		; kein Drucker oder Parameterfehler
 3375 DA71  CD D6A1     	CALL	TOP		; gesamten Text an Speicherende
 3376 DA74  2A 001E     	LD	HL,(T2A)
 3377 DA77  E5          	PUSH	HL
 3378 DA78  ED 5B 001A  	LD	DE,(T2E)
 3379 DA7C  D5          	PUSH	DE
 3380 DA7D  CD DA02     	CALL	SRCH40		; Blockmarken suchen
 3381 DA80  20 B1       	JR	NZ,BLERR	; nicht gefunden
 3382 DA82  22 001E     	LD	(T2A),HL	; modifizieren
 3383 DA85  ED 53 001A  	LD	(T2E),DE	; modifizieren
 3384 DA89  2A 001A     	LD	HL,(T2E)
 3385 DA8C  CD 0086     	CALL	GET		; Zeichen aus Textspeicher
 3386 DA8F  E5          	PUSH	HL		; Adresse und
 3387 DA90  F5          	PUSH	AF		; Inhalt merken
 3388 DA91  3E 03       	LD	A,3
 3389 DA93  CD 0092     	CALL	PUT		; Textende vortaeuschen!
 3390 DA96  CD D027     	CALL	PRI1		; Drucken
 3391 DA99  18 BB       	JR	PSA2		; alter Zustand
 3392                   
 3393                   ;-------
 3394                   ; Eingabe Zeile, danach CR,LF:
 3395 DA9B  01 0627     REPL8:	LD	BC,627H
 3396 DA9E  CD D585     	CALL	INPUT
 3397 DAA1  D8          	RET	C		; BRK
 3398 DAA2  F5          	PUSH	AF
 3399 DAA3  CD CE99     	CALL	LFCR
 3400 DAA6  F1          	POP	AF
 3401 DAA7  C9          	RET
 3402                   
 3403                   ;-------
 3404 DAA8  DDDD        	DEFW	0DDDDH
 3405 DAAA  52 45 50 4C 	DB	'REPLACE'
 3406 DAB1  01          	DB	1
 3407 DAB2  B7          	OR	A
 3408 DAB3  CC D6A1     	CALL	Z,TOP		; an Speicherende verschieben
 3409 DAB6  CD F003     	CALL	PV1
 3410 DAB9  23          	DB	OSTR
 3411 DABA  0A 0A 0B 0B 	DB	LF,LF,0BH,0BH,'Find :',0
 3412 DAC5  CD DA9B     	CALL	REPL8		; Eingabe
 3413 DAC8  D8          	RET	C		; BRK
 3414 DAC9  7E          	LD	A,(HL)
 3415 DACA  B7          	OR	A
 3416 DACB  C8          	RET	Z		; nichts eingegeben!
 3417 DACC  22 0014     	LD	(FTXT),HL	; VRAM-Adresse1 merken
 3418 DACF  CD F003     	CALL	PV1
 3419 DAD2  23          	DB	OSTR
 3420 DAD3  52 65 70 6C 	DB	'Repl.:',0
 3421 DADA  CD DA9B     	CALL	REPL8		; Eingabe
 3422 DADD  D8          	RET	C		; BRK
 3423 DADE  22 0016     	LD	(RTXT),HL	; VRAM-Adresse2 merken
 3424 DAE1  FD          	DB	0FDH
 3425 DAE2  26 00       	LD	H,0		; Zaehler HY
 3426 DAE4  2A 001A     	LD	HL,(T2E)
 3427 DAE7  ED 5B 001E  	LD	DE,(T2A)
 3428 DAEB  B7          	OR	A
 3429 DAEC  ED 52       	SBC	HL,DE
 3430 DAEE  C8          	RET	Z		; kein Text im Speicher
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  73
EDITOR  Z80

 3431 DAEF  44          	LD	B,H
 3432 DAF0  4D          	LD	C,L		; Textlaenge
 3433 DAF1  EB          	EX	DE,HL
 3434 DAF2  ED 5B 0014  REPL1:	LD	DE,(FTXT)	; Suchtext
 3435 DAF6  1A          	LD	A,(DE)		; 1. Zeichen aus VRAM
 3436 DAF7  CD 0071     	CALL	TCPIR		; im Teiltext 2 suchen
 3437 DAFA  E2 DB12     	JP	PO,REPL4	; nicht gefunden
 3438 DAFD  C5          	PUSH	BC		; restl. Laenge
 3439 DAFE  E5          	PUSH	HL		; Adresse
 3440 DAFF  13          REPL2:	INC	DE
 3441 DB00  1A          	LD	A,(DE)		; naechstes Zeichen aus VRAM
 3442 DB01  B7          	OR	A		; Suchstring zu Ende?
 3443 DB02  28 2D       	JR	Z,REPL5		; ja, gefunden
 3444 DB04  CD 007F     	CALL	TCPI
 3445 DB07  E2 DB10     	JP	PO,REPL3	; Ende Quelltext
 3446 DB0A  28 F3       	JR	Z,REPL2		; stimmt ueberein
 3447 DB0C  E1          	POP	HL
 3448 DB0D  C1          	POP	BC
 3449 DB0E  18 E2       	JR	REPL1		; weitersuchen
 3450                   ;
 3451 DB10  E1          REPL3:	POP	HL
 3452 DB11  C1          	POP	BC
 3453 DB12  11 0001     REPL4:	LD	DE,1
 3454 DB15  CD D6A4     	CALL	TXEND		; 1 Zeile zurueckgehen
 3455 DB18  FD          	DB	0FDH
 3456 DB19  7C          	LD	A,H		; Anzahl der Ersetzungen HY
 3457 DB1A  CD F003     	CALL	PV1
 3458 DB1D  1C          	DB	AHEX
 3459 DB1E  CD F003     	CALL	PV1
 3460 DB21  23          	DB	OSTR
 3461 DB22  20 52 65 70 	DB	' Replaces'
 3462 DB2B  0D 0B 0B 0B 	DB	CR,0BH,0BH,0BH,0
 3463 DB30  C9          	RET
 3464                   
 3465                   ; Zeichenketten ersetzen:
 3466 DB31  E3          REPL5:	EX	(SP),HL
 3467 DB32  2B          	DEC	HL		; Beginn der Zeichenkette im Text
 3468 DB33  C5          	PUSH	BC		; restl. Laenge
 3469 DB34  CD D685     	CALL	TXA		; Teiltext zum Anfang verschieben
 3470 DB37  ED 5B 001C  	LD	DE,(T1E)
 3471 DB3B  C1          	POP	BC		; restl. Laenge
 3472 DB3C  E1          	POP	HL		; Nach der Zeichenkette
 3473 DB3D  E5          	PUSH	HL
 3474 DB3E  22 001E     	LD	(T2A),HL
 3475 DB41  2A 0016     	LD	HL,(RTXT)	; neuer String
 3476 DB44  7E          REPL6:	LD	A,(HL)
 3477 DB45  A7          	AND	A		; Null?
 3478 DB46  28 09       	JR	Z,REPL7		; ja, fertig
 3479 DB48  23          	INC	HL
 3480 DB49  EB          	EX	DE,HL
 3481 DB4A  CD 0092     	CALL	PUT		; an Text 1 anfuegen
 3482 DB4D  EB          	EX	DE,HL
 3483 DB4E  13          	INC	DE
 3484 DB4F  18 F3       	JR	REPL6
 3485                   ;
 3486 DB51  ED 53 001C  REPL7:	LD	(T1E),DE	; Ende Text 1 neu setzen
 3487 DB55  FD          	DB	0FDH
 3488 DB56  7C          	LD	A,H		; Zaehler HY
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  74
EDITOR  Z80

 3489 DB57  C6 01       	ADD	A,1		; +1
 3490 DB59  27          	DAA
 3491 DB5A  FD          	DB	0FDH
 3492 DB5B  67          	LD	H,A		; Zaehler HY
 3493 DB5C  E1          	POP	HL		; Pos. zum weitersuchen
 3494 DB5D  D1          	POP	DE		; Stack reinigen
 3495 DB5E  18 92       	JR	REPL1
 3496                   ;-------
 3497                   ; Test auf gueltiges Zeichen (Buchstabe):
 3498                   ; PE:	A	Zeichen
 3499                   ; PA:	A	Zeichen (Kleinbuchstaben -> gross)
 3500                   ;	CY=1	kein Buchstabe
 3501 DB60  FE 41       LETTR:	CP	'A'
 3502 DB62  D8          	RET	C		; 00...40H
 3503 DB63  FE 5B       	CP	'Z'+1
 3504 DB65  3F          	CCF
 3505 DB66  D0          	RET	NC		; A...Z
 3506 DB67  FE 61       	CP	'a'
 3507 DB69  D8          	RET	C		; 5BH...60H
 3508 DB6A  FE 7B       	CP	'z'+1
 3509 DB6C  3F          	CCF
 3510 DB6D  D8          	RET	C		; 7BH...
 3511 DB6E  E6 DF       	AND	0DFH		; klein -> gross
 3512 DB70  C9          	RET
 3513                   
 3514                   ; ESC-Funktionen (Eingabe von Druckersteuerzeichen)
 3515                   
 3516 DB71  79          ESC0:	LD	A,C		; Nr. in 2er-Schritten	also 00h..12h
 3517 DB72  CB 3F       	SRL	A		; /2			also 00h..09h
 3518 DB74  F6 10       	OR	10h		; Druckercodes ab 10h	also 10h..19h
 3519 DB76  21 B7A2     ESC1:	LD	HL,STBT
 3520 DB79  CB DE       	SET	3,(HL)		; Steuercodes nicht ausfuehren
 3521 DB7B  E5          	PUSH	HL
 3522 DB7C  CD D389     	CALL	CRT_X		; Druckersteuerzeichen darstellen
 3523 DB7F  E1          	POP	HL
 3524 DB80  CB 9E       	RES	3,(HL)
 3525 DB82  ED 5B B7A0  	LD	DE,(CURSO)	; neue Cursorposition
 3526 DB86  ED 53 0020  	LD	(COL),DE	; als EDIT-Cursor eintragen
 3527 DB8A  C3 D938     	JP	PCOL		; Cursorposition anzeigen
 3528                   				; Cursorpos. in DE mitgeben an KBD
 3529                   
 3530                   ; ESC-Steuer-Funktionen
 3531                   
 3532 DB8D  3E 0C       ESCJ:	LD	A,0CH		; Seitenwechsel (CLS/Eject)
 3533 DB8F  21          	DB	21h
 3534 DB90  3E 0E       ESCN:	LD	A,0EH		; Zeile binden
 3535 DB92  21          	DB	21h
 3536 DB93  3E 0F       ESCX:	LD	A,0FH		; HEX-Sequenz wir in WP9
 3537 DB95  21          	DB	21h
 3538 DB96  3E 1C       ESCA:	LD	A,1CH		; Blockanfangsmarke
 3539 DB98  21          	DB	21h
 3540 DB99  3E 1D       ESCU:	LD	A,1DH		; Pfeil nach oben (UP)
 3541 DB9B  21          	DB	21h
 3542 DB9C  3E 1E       ESCE:	LD	A,1EH		; Blockendemarke
 3543 DB9E  21          	DB	21h
 3544 DB9F  3E 1F       ESCD:	LD	A,1FH		; Pfeil nach unten (DOWN)
 3545 DBA1  18 D3       	JR	ESC1
 3546                   
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  75
EDITOR  Z80

 3547                   ; ESC-G (Eingabe Grafikzeichen mit Auswahl in Statuszeile)
 3548                   
 3549 DBA3  21 0000     ESCG:	LD	HL,0		; Fenster ab links/oben
 3550 DBA6  22 B79C     	LD	(WINON),HL
 3551 DBA9  22 B7A0     	LD	(CURSO),HL	; Cursor home
 3552 DBAC  CD F003     	CALL	PV1
 3553 DBAF  23          	DB	OSTR
 3554 DBB0  5A 65 69 63 	DB	'Zeichen ausw',84h,'hlen und BRK/Ender:',0
 3555 DBD1  3E B0       	LD	A,0B0h
 3556 DBD3  06 30       	ld	b,30h
 3557 DBD5  CD F003     gra1:	call	pv1
 3558 DBD8  00          	db	crt		; B0h-AFh
 3559 DBD9  3C          	inc	a
 3560 DBDA  10 F9       	djnz	gra1
 3561 DBDC  3E 80       	LD	A,80h
 3562 DBDE  06 30       	ld	b,30h
 3563 DBE0  CD F003     gra2:	call	pv1
 3564 DBE3  00          	db	crt		; 80h-AFh
 3565 DBE4  3C          	inc	a
 3566 DBE5  10 F9       	djnz	gra2
 3567 DBE7  3E E0       	LD	A,0E0h
 3568 DBE9  06 20       	ld	b,20h
 3569 DBEB  CD F003     gra3:	call	pv1
 3570 DBEE  00          	db	crt		; E0-FFh
 3571 DBEF  3C          	inc	a
 3572 DBF0  10 F9       	djnz	gra3
 3573 DBF2  2A B4DE     	LD	HL,(GCURS)	; gemerkte Cursor-Position
 3574 DBF5  22 B7A0     gra4:	LD	(CURSO),HL	; Cursor home
 3575 DBF8  CD D50F     gra5:	CALL	KEYB		; Eingabe
 3576 DBFB  38 60       	JR	C,GRA99		; BRK
 3577 DBFD  2A B7A0     	LD	HL,(CURSO)
 3578 DC00  FE 08       	cp	8		; CUL?
 3579 DC02  20 14       	JR	NZ,gra8
 3580 DC04  7C          	ld	a,h		; Zeile
 3581 DC05  A7          	and	a		; Zeile 0?
 3582 DC06  7D          	ld	a,l		; Spalte
 3583 DC07  20 07       	jr	nz,gra7
 3584 DC09  FE 20       	cp	20h		; ganz links in Zeile 0?
 3585 DC0B  28 EB       	jr	z,gra5		; nichts tun
 3586 DC0D  2D          gra6:	dec	l		; eine Pos. nach links
 3587 DC0E  18 E5       	jr	gra4
 3588                   	;
 3589 DC10  A7          gra7:	and	a		; ganz links?
 3590 DC11  20 FA       	jr	nz,gra6
 3591 DC13  21 004F     	ld	hl,79		; letzte Spalte in Zeile 0
 3592 DC16  18 DD       	jr	gra4
 3593                   	;
 3594 DC18  FE 09       gra8:	CP	9		; CUR?
 3595 DC1A  20 15       	jr	nz,gra11
 3596 DC1C  7C          	ld	a,h		; Zeile
 3597 DC1D  A7          	and	a		; Zeile 0?
 3598 DC1E  7D          	ld	a,l		; Spalte
 3599 DC1F  28 07       	jr	z,gra10
 3600 DC21  FE 4F       	cp	79		; ganz rechts?
 3601 DC23  28 D3       	jr	z,gra5		; nichts tun
 3602 DC25  2C          gra9:	inc	l		; eine Pos. nach rechts
 3603 DC26  18 CD       	jr	gra4
 3604                   	;
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  76
EDITOR  Z80

 3605 DC28  FE 4F       gra10:	cp	79		; ganz rechts?
 3606 DC2A  20 F9       	jr	nz,gra9
 3607 DC2C  21 0100     	ld	hl,100h		; erste Spalte in Zeile 1
 3608 DC2F  18 C4       	jr	gra4
 3609                   	;
 3610 DC31  FE 0A       gra11:	CP	0Ah		; CUD?
 3611 DC33  20 07       	jr	nz,gra17
 3612 DC35  7C          	ld	a,h		; Zeile
 3613 DC36  3D          	dec	a		; Zeile 1?
 3614 DC37  28 BF       	jr	z,gra5		; nichts tun
 3615 DC39  24          	inc	h		; Zeile runter
 3616 DC3A  18 B9       	jr	gra4
 3617                   	;
 3618 DC3C  FE 0B       gra17:	CP	0Bh		; CUU?
 3619 DC3E  20 0C       	jr	nz,gra12
 3620 DC40  7C          	ld	a,h		; Zeile
 3621 DC41  A7          	and	a		; Zeile 0?
 3622 DC42  28 B4       	jr	z,gra5		; nichts tun
 3623 DC44  7D          	ld	a,l
 3624 DC45  FE 20       	cp	20h		; Spalte <20h
 3625 DC47  38 AF       	jr	c,gra5		; nichts tun
 3626 DC49  25          	dec	h		; Zeile hoch
 3627 DC4A  18 A9       	jr	gra4
 3628                   	;
 3629 DC4C  FE 0D       gra12:	CP	0Dh		; Enter?
 3630 DC4E  20 A8       	jr	nz,gra5
 3631 DC50  EB          	ex	de,hl		; Cursorpos. in DE
 3632 DC51  CD C561     	call	dabr80		; VRAM-Adresse berechnen
 3633 DC54  7E          	ld	a,(hl)		; Code aus VRAM lesen
 3634 DC55  F5          	push	af
 3635 DC56  CD DC5D     	call	gra99		; Statuszeile regenerieren
 3636 DC59  F1          	pop	af
 3637 DC5A  C3 DB76     	JP	ESC1		; Grafikzeichen in Text schreiben
 3638                   
 3639 DC5D              GRA99:	; Statuszeile + Cursorposition regenerieren
 3640 DC5D  2A B7A0     	LD	HL,(CURSO)	; Cursorposition
 3641 DC60  22 B4DE     	LD	(GCURS),HL	; merken fuer naechstes ESC-G
 3642 DC63  3E 02       	LD	A,2		; Fenster begrenzen auf
 3643 DC65  32 B79F     	LD	(WINLG+1),A	; 2 Zeilen
 3644 DC68  CD C884     	CALL	CLS80		; Fenster der Statuszeile loeschen
 3645 DC6B  C3 C983     GRA100:	JP	CLI1		; Statuszeile neu anzeigen
 3646                   				; und Cursorposition regenerieren
 3647                   
 3648                   ; ESC-L (setze linke Randmarke)
 3649                   ; ESC-R (setze rechte Randmarke)
 3650                   
 3651 DC6E  21 0010     ESCL:	LD	HL,RANDL
 3652 DC71  18 03       	JR	ESCLR
 3653                   	;
 3654 DC73  21 0011     ESCR:	LD	HL,RANDR
 3655 DC76  7B          ESCLR:	LD	A,E		; aktuelle Spalte = (CURSO)
 3656 DC77  E6 F8       	AND	0F8h		; zurueck auf naechsten TAB-Stop
 3657 DC79  77          	LD	(HL),A
 3658 DC7A  18 EF       	JR	GRA100
 3659                   
 3660                   ; ESC-C (Block kopieren direkt zu aktueller Cursorposition)
 3661                   ; PE:	DE	aktuelle Cursorposition
 3662                   
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  77
EDITOR  Z80

 3663 DC7C  CD DC98     ESCC:	CALL	COPY		; Block kopieren
 3664 DC7F  CD D3E4     ESCC0:	CALL	LCOUNT		; tatsaechliche Zeilennummer ermitteln
 3665 DC82  C3 D7F2     	JP	WRPG		; Seite neu anzeigen (mit Statuszeile)
 3666                   
 3667                   ; ESC-K (Block loeschen)
 3668                   ; PE:	DE	aktuelle Cursorposition
 3669                   
 3670 DC85  CD DD62     ESCK:	CALL	KILL		; Block loeschen
 3671 DC88  18 F5       	JR	ESCC0
 3672                   
 3673                   ; ESC-V (Block verschieben)
 3674                   ; PE:	DE	aktuelle Cursorposition
 3675                   
 3676 DC8A  2A 0012     ESCV:	ld	hl,(MEML)	; merken, wo Bildschirm beginnt
 3677 DC8D  22 B4DC     	ld	(Mmerk),hl
 3678 DC90  CD DC98     	CALL	COPY		; Block kopieren
 3679 DC93  D4 DD6E     	CALL	NC,KILL1	; Block loeschen, wenn COPY erfolgreich war
 3680 DC96  18 E7       	JR	ESCC0
 3681                   ;
 3682                   ; Block kopieren
 3683                   ; PE:	DE	aktuelle Cursorposition
 3684                   ; PA:	CY=1	Fehler (Speicherplatz oder Blockmarken)
 3685                   ;
 3686 DC98  CD C561     COPY:	CALL	DABR80		; VRAM-Adresse akt. Cursorpos. berechnen
 3687 DC9B  7E          	LD	A,(HL)		; Code aus VRAM lesen
 3688 DC9C  32 B4E0     	LD	(Cmerk),A	; Zeichencode auf Cursorposition merken
 3689 DC9F  3E 1A       	LD	A,1AH		; Kennung
 3690 DCA1  77          	LD	(HL),A		; an Cursor-Position eintragen
 3691                   
 3692 DCA2  CD D70A     	CALL	MPAGE		; Seite speichern
 3693 DCA5  30 10       	JR	NC,COPY1	; OK
 3694                   ; No Memory
 3695 DCA7  ED 5B 0020  	LD	DE,(COL)	; EDIT-Cursor
 3696 DCAB  CD C561     	CALL	DABR80		; VRAM-Adresse berechnen
 3697 DCAE  3A B4E0     	LD	A,(Cmerk)	; gespeicherter Code auf dieser Stalle
 3698 DCB1  77          	LD	(HL),A		; wieder im VRAM eintragen
 3699 DCB2  CD D4F6     	CALL	MEMW		; Anzeige "No Memory" und Tastaturabfrage
 3700                   ;	CALL	STATUS		; Statuszeile neu anzeigen
 3701                   ;	LD	DE,(COL)	; EDIT-Cursor
 3702 DCB5  37          	SCF
 3703 DCB6  C9          	RET
 3704                   
 3705                   ; Text genau an Cursorposition trennen
 3706 DCB7              COPY1:	; Text ist gespeichert (Bildschirminhalt liegt ab T2A)
 3707 DCB7  ED 5B 001E  	LD	DE,(T2A)
 3708 DCBB  2A 001A     	LD	HL,(T2E)
 3709                   	;AND	A		; CY ist noch 0
 3710 DCBE  ED 52       	SBC	HL,DE		; Laenge Text 2 berechnen
 3711 DCC0  44          	LD	B,H
 3712 DCC1  4D          	LD	C,L		; Laenge Suchbereich
 3713 DCC2  EB          	EX	DE,HL		; HL=(T2A) Beginn Suchbereich
 3714 DCC3  3E 1A       	LD	A,1AH		; Kennung
 3715 DCC5  CD 0071     	CALL	TCPIR		; Kennung suchen in Text 2
 3716                   	; HL zeigt jetzt direkt nach Kennung
 3717 DCC8  ED 5B 001E  	LD	DE,(T2A)
 3718 DCCC  ED 52       	SBC	HL,DE
 3719 DCCE  44          	LD	B,H
 3720 DCCF  4D          	LD	C,L		; Laenge des zu verschiebenden Textes
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  78
EDITOR  Z80

 3721 DCD0  0B          	DEC	BC		; ohne Kennung
 3722 DCD1  EB          	EX	DE,HL		; Quelle = Anfang von Text 2
 3723 DCD2  ED 5B 001C  	LD	DE,(T1E)	; Ziel = Ende von Text 1
 3724 DCD6  78          	LD	A,B
 3725 DCD7  B1          	OR	C
 3726 DCD8  C4 0063     	CALL	NZ,TLDIR	; von T2A bis vor Kennung zu T1E verschieben
 3727 DCDB  ED 53 001C  	LD	(T1E),DE	; neues Ende Text 1
 3728 DCDF  3A B4E0     	LD	A,(Cmerk)
 3729 DCE2  CD 0092     	CALL	PUT		; jetzt regenerieren
 3730 DCE5  A7          	AND	A		; war ein Zeichen unter Cursor?
 3731 DCE6  20 01       	JR	NZ,COPY2	; ja
 3732 DCE8  23          	INC	HL
 3733 DCE9  22 001E     COPY2:	LD	(T2A),HL	; neuer Anfang Text 2
 3734                   
 3735                   ; Blockmarken suchen in Text 1 oder Text 2
 3736 DCEC  2A 0018     	LD	HL,(T1A)
 3737 DCEF  CD DA02     	CALL	SRCH40		; Blockmarken suchen
 3738 DCF2  28 14       	JR	Z,COPY3		; in Text 1 enthalten
 3739 DCF4  2A 001E     	LD	HL,(T2A)
 3740 DCF7  ED 5B 001A  	LD	DE,(T2E)
 3741 DCFB  CD DA02     	CALL	SRCH40		; Blockmarken suchen
 3742 DCFE  28 08       	JR	Z,COPY3		; in Text 2 enthalten
 3743                   
 3744                   ; Blockmarken nicht gefunden
 3745 DD00  CD D4E6     	CALL	BLMW		; Anzeige "Blockmarken?" und Tastaturabfrage
 3746 DD03  CD DD2F     	CALL	ESC98		; zurueck zur aktuellen EDIT-Position
 3747 DD06  37          	SCF
 3748 DD07  C9          	RET
 3749                   
 3750                   ; Kontrolle, ob Blockgroesse noch zwischen T1E und T2A passt
 3751                   ;	HL zeigt auf Blockanfang (nach Marke)
 3752                   ;	DE zeigt auf die Blockendemarke
 3753 DD08  D5          COPY3:	PUSH	DE		; DE = Blockanende
 3754 DD09  EB          	EX	DE,HL
 3755 DD0A  ED 52       	SBC	HL,DE
 3756 DD0C  44          	LD	B,H
 3757 DD0D  4D          	LD	C,L		; BC = Groesse des zu kopierenden Blocks
 3758 DD0E  2A 001E     	LD	HL,(T2A)
 3759 DD11  ED 5B 001C  	LD	DE,(T1E)
 3760 DD15  ED 52       	SBC	HL,DE		; HL = Groesse des freien Bereichs
 3761 DD17  ED 42       	SBC	HL,BC		; passt Block noch dazwischen?
 3762 DD19  E1          	POP	HL		; HL = Blockendemarke
 3763 DD1A  30 05       	JR	NC,COPY4	; OK, Block passt noch dazwischen
 3764                   
 3765                   ; Block passt nicht zwischen T1E und T2A
 3766 DD1C  CD DD2F     	CALL	ESC98		; zurueck zur aktuellen EDIT-Poition
 3767 DD1F  37          	SCF
 3768 DD20  C9          	RET
 3769                   
 3770                   ; Block vor Anfang von Text 2 kopieren
 3771 DD21  2B          COPY4:	DEC	HL		; vor Blockendemarke gehen
 3772 DD22  ED 5B 001E  	LD	DE,(T2A)	; Anfang Text 2
 3773 DD26  1B          	DEC	DE
 3774 DD27  CD 006A     	CALL	TLDDR		; Block kopieren
 3775 DD2A  13          	INC	DE
 3776 DD2B  ED 53 001E  	LD	(T2A),DE	; neuer Anfang von Text 2 jetzt hier
 3777                   
 3778                   ; So viele Zeilen zurueck gehen wie die Cursorposition angibt
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  79
EDITOR  Z80

 3779 DD2F  ED 5B 0021  ESC98:	LD	DE,(LIN)	; E=aktuelle Bildschirmzeile
 3780 DD33  16 00       	LD	D,0		; Spalte uninteressant
 3781 DD35  3A 0020     	LD	A,(COL)		; aktuelle Cursorspalte
 3782 DD38  A7          	AND	A		; ganz links?
 3783 DD39  28 01       	JR	Z,ESCC5		; ja
 3784 DD3B  1C          	INC	E		; sonst die angefangene Zeile dazu zaehlen
 3785 DD3C  C3 D6A4     ESCC5:	JP	TXEND		; Text an Speicherende verschieben
 3786                   
 3787                   ; ESC-B (gehe zu Textende)
 3788                   
 3789 DD3F  CD D70A     ESCB:	CALL	MPAGE		; Seite speichern
 3790 DD42  30 0B       	JR	NC,ESCB1
 3791 DD44  CD D4F6     NOMEM:	CALL	MEMW		; Anzeige "No Memory" und Tastaturabfrage
 3792 DD47  CD D845     	CALL	STATUS		; Statuszeile neu anzeigen
 3793 DD4A  ED 5B 0020  	LD	DE,(COL)	; EDIT-Cursor
 3794 DD4E  C9          	RET
 3795                   	;
 3796 DD4F  CD D2B0     ESCB1:	CALL	BOTO		; zu Textende gehen
 3797                   
 3798                   ; Bildschirm neu anzeigen
 3799 DD52  CD D3E4     ESC97:	CALL	LCOUNT		; tatsaechliche Zeilennummer ermitteln
 3800 DD55  C3 D7F2     	JP	WRPG		; Seite neu anzeigen (mit Statuszeile)
 3801                   
 3802                   ; ESC-T (gehe zu Textanfang)
 3803                   
 3804 DD58  CD D70A     ESCT:	CALL	MPAGE		; Seite speichern
 3805 DD5B  38 E7       	JR	C,NOMEM		; Anzeige "No Memory" in Titelzeile
 3806 DD5D  CD D6A1     	CALL	TOP
 3807 DD60  18 F0       	JR	ESC97		; Seite neu anzeigen (mit Statuszeile)
 3808                   ;
 3809                   ; Block loeschen
 3810                   ; PA:	CY=1	Fehler (Speicherplatz oder Blockmarken)
 3811                   ;
 3812 DD62  2A 0012     KILL:	ld	hl,(MEML)	; merken, wo Bildschirm beginnt
 3813 DD65  22 B4DC     	ld	(Mmerk),hl
 3814 DD68  CD D70A     	CALL	MPAGE		; Seite speichern
 3815                   ;	JR	NC,KILL1	; OK
 3816                   ; No Memory
 3817 DD6B  DA D4F6     	JP	C,MEMW		; Anzeige "No Memory" und Tastaturabfrage
 3818                   
 3819                   ; Text komplett an Speicherende verschieben
 3820 DD6E  11 0000     KILL1:	LD	DE,0		; gesamter Text
 3821 DD71  CD D6A4     	CALL	TXEND		; Text an Speicherende verschieben
 3822 DD74  2A 001E     	LD	HL,(T2A)
 3823 DD77  ED 5B 001A  	LD	DE,(T2E)
 3824 DD7B  CD DA02     	CALL	SRCH40		; Blockmarken suchen in Text 2
 3825 DD7E  28 05       	JR	Z,KILL2
 3826                   
 3827                   ; Blockmarken nicht gefunden
 3828 DD80  CD D4E6     	CALL	BLMW		; Anzeige "Blockmarken?" und Tastaturabfrage
 3829 DD83  18 23       	JR	GOTO		; zurueck zur aktuellen EDIT-Position
 3830                   ;	SCF
 3831                   ;	RET
 3832                   
 3833                   ; Text an Blockanfang trennen
 3834                   ;	HL zeigt auf Blockanfang (nach Marke)
 3835                   ;	DE zeigt auf die Blockendemarke
 3836 DD85  D5          KILL2:	PUSH	DE
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  80
EDITOR  Z80

 3837 DD86  ED 5B 001E  	LD	DE,(T2A)
 3838 DD8A  ED 52       	SBC	HL,DE
 3839 DD8C  44          	LD	B,H
 3840 DD8D  4D          	LD	C,L		; Laenge von Textanfang bis Blockanfang
 3841 DD8E  EB          	EX	DE,HL		; HL=(T2A)
 3842 DD8F  ED 5B 0018  	LD	DE,(T1A)
 3843 DD93  78          	LD	A,B
 3844 DD94  B1          	OR	C
 3845 DD95  C4 0063     	CALL	NZ,TLDIR	; alles vor Blockanfang zu Text 1 verschieben
 3846 DD98  1B          	DEC	DE		; vor Blockanfangsmarke gehen
 3847 DD99  ED 53 001C  	LD	(T1E),DE	; Ende Text 1 jetzt hier
 3848                   
 3849                   ; Text 2 nach Blockende beginnen lassen
 3850 DD9D  E1          	POP	HL
 3851 DD9E  23          	INC	HL		; nach Blockanfangsmarke gehen
 3852 DD9F  22 001E     	LD	(T2A),HL	; Anfang Text 2 jetzt hier
 3853 DDA2  11 0001     	LD	DE,1
 3854 DDA5  CD D6A4     	CALL	TXEND		; getrennte Zeile zu Textende ergaenzen
 3855                   
 3856                   ; zu urspruenglicher Zeile gehen
 3857 DDA8  CD D3E4     GOTO:	CALL	LCOUNT		; aktuelle Zeilennummer ermitteln
 3858 DDAB  2A B4DC     	LD	HL,(Mmerk)	; urspruengliche Zeilennummer BS-Anfang
 3859 DDAE  B7          	OR	A		; CY=0
 3860 DDAF  ED 52       	SBC	HL,DE
 3861 DDB1  C8          	RET	Z		; stimmt
 3862 DDB2  38 04       	JR	C,ESK81
 3863 DDB4  EB          	EX	DE,HL
 3864 DDB5  C3 D64F     	JP	TXANF		; noch nn Zeilen zum Textanfang verschieben
 3865                   	;
 3866 DDB8  19          ESK81:	ADD	HL,DE
 3867 DDB9  EB          	EX	DE,HL
 3868 DDBA  B7          	OR	A
 3869 DDBB  ED 52       	SBC	HL,DE
 3870 DDBD  EB          	EX	DE,HL
 3871 DDBE  C3 D6A4     	JP	TXEND		; noch nn Zeilen zum Textende verschieben
 3872                   
 3873                   ; ESC-Z (Gehe zu Zeile Nr.)
 3874                   
 3875 DDC1  CD CA8A     ESCZ:	CALL	WIN80		; volles Fenster zum Schreiben in Statuszeile
 3876 DDC4  AF          ESCZ1:	XOR	A
 3877 DDC5  32 B7A1     	LD	(CURSO+1),A	; Zeile 0
 3878 DDC8  32 AD0D     	LD	(0AD0DH),A	; Trennung Zeile/Spalte wegen DEL-Taste
 3879 DDCB  01 080C     	LD	BC,080Ch	; Spalte von 8 bis 12 zulaessig
 3880 DDCE  CD D585     	CALL	INPUT		; Eingabe
 3881 DDD1  38 41       	JR	C,ESCZ4		; BRK -> nur Statuszeile regenerieren
 3882                   
 3883                   ; eingegebene Dezimalzahl erfassen
 3884 DDD3  11 AD08     	LD	DE,0AD08h	; VRAM-Adresse der Zeilennummer
 3885 DDD6  01 0000     	LD	BC,0		; Zeilenzaehler
 3886 DDD9  1A          ESCZ2:	LD	A,(DE)
 3887 DDDA  E6 DF       	AND	0DFH
 3888 DDDC  28 1B       	JR	Z,ESCZ3		; 0 oder Leerzeichen beendet die Zahlenfolge
 3889 DDDE  1A          	LD	A,(DE)
 3890 DDDF  FE 30       	CP	'0'
 3891 DDE1  38 E1       	JR	C,ESCZ1		; Zeichen kleiner als '0'
 3892 DDE3  FE 3A       	CP	'9'+1
 3893 DDE5  30 DD       	JR	NC,ESCZ1	; Zeichen groesser als '9'
 3894 DDE7  E6 0F       	AND	0Fh
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  81
EDITOR  Z80

 3895 DDE9  60          	LD	H,B
 3896 DDEA  69          	LD	L,C
 3897 DDEB  29          	ADD	HL,HL	; *2
 3898 DDEC  29          	ADD	HL,HL	; *4
 3899 DDED  29          	ADD	HL,HL	; *8
 3900 DDEE  09          	ADD	HL,BC	; *9
 3901 DDEF  09          	ADD	HL,BC	; *10
 3902 DDF0  06 00       	LD	B,0
 3903 DDF2  4F          	LD	C,A
 3904 DDF3  09          	ADD	HL,BC		; + neue Ziffer
 3905 DDF4  44          	LD	B,H
 3906 DDF5  4D          	LD	C,L
 3907 DDF6  13          	INC	DE		; naechste Stelle
 3908 DDF7  18 E0       	JR	ESCZ2
 3909                   
 3910                   ; gehe zu eingegebener Zeile
 3911                   ;	BC = Zeilennummer
 3912 DDF9  2A 0012     ESCZ3:	LD	HL,(MEML)	; Zeilennummer, Bildschirmanfang
 3913 DDFC  11 0016     	LD	DE,22
 3914 DDFF  19          	ADD	HL,DE		; Zeilennummer der letzten BS-Zeile
 3915 DE00  ED 42       	SBC	HL,BC
 3916 DE02  38 13       	JR	C,ESCZ5		; gewuenschte Zeile liegt hinter BS-Ende
 3917 DE04  60          	LD	H,B
 3918 DE05  69          	LD	L,C
 3919 DE06  ED 5B 0012  	LD	DE,(MEML)	; Zeilennummer, Bildschirmanfang
 3920 DE0A  ED 52       	SBC	HL,DE
 3921 DE0C  38 09       	JR	C,ESCZ5		; gewuenschte Zeile liegt vor BS-Anfang
 3922                   
 3923                   ; die gewuenschte Zeile ist auf dem Bildschirm, dann Cursor auf diese Zeile setzen
 3924 DE0E  65          	LD	H,L		; neue Zeile
 3925 DE0F  2E 00       	LD	L,0		; Spalte 0
 3926 DE11  22 0020     	LD	(COL),HL	; zur Cursorposition machen
 3927 DE14  C3 D845     ESCZ4:	JP	STATUS		; Staturzeile aktualisieren
 3928                   
 3929                   ; die gewuenschte Zeile liegt ausserhalb des Bildschirms
 3930 DE17  ED 43 B4DC  ESCZ5:	LD	(Mmerk),BC	; Soll-Zeilennummer merken fuer GOTO
 3931 DE1B  CD D982     	CALL	WIN82
 3932 DE1E  CD D70A     	CALL	MPAGE		; Seite speichern
 3933 DE21  30 11       	JR	NC,ESCZ6
 3934 DE23  CD D4F6     ESCF2:	CALL	MEMW		; Anzeige "No Memory" und Tastaturabfrage
 3935 DE26  2A B4D8     	ld	hl,(T1MERK)
 3936 DE29  22 001C     	ld	(t1e),hl	; urspruengliche Textgrenzen
 3937 DE2C  2A B4DA     	ld	hl,(T2MERK)	; wieder regenerieren
 3938 DE2F  22 001E     	ld	(t2a),hl
 3939 DE32  18 E0       	JR	ESCZ4
 3940                   
 3941                   ; Bildschirminhalt ist gespeichert, jetzt zu gewuenschter Stelle gehen
 3942 DE34  CD DDA8     ESCZ6:	CALL	GOTO		; Text entsprechend verschieben
 3943 DE37  21 0000     	LD	HL,0
 3944 DE3A  22 0020     	LD	(COL),HL	; neue Cursorposition
 3945 DE3D  C3 D7F2     	JP	WRPG		; Seite neu anzeigen (mit Statuszeile)
 3946                   
 3947                   ; ESC-F (Suchen einer Zeichenkette)
 3948                   
 3949 DE40  CD CA8A     ESCF:	CALL	WIN80		; volles Fenster zum Schreiben in Statuszeile
 3950 DE43  21 0001     	LD	HL,1		; Zeile 0, Spalte 1
 3951 DE46  22 B7A0     	LD	(CURSO),HL
 3952 DE49  CD F003     	CALL	PV1
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  82
EDITOR  Z80

 3953 DE4C  23          	DB	OSTR
 3954 DE4D  53 75 63 68 	DB	'Suche:',0
 3955 DE54  11 0008     	LD	DE,8		; Zeile 0, Spalte 8
 3956 DE57  06 11       	LD	B,17
 3957 DE59  CD C561     ESCF1:	CALL	DABR80		; VRAM-Adresse berechnen
 3958 DE5C  CD C5B1     	CALL	WRZCH0		; Nullcode eintragen
 3959 DE5F  1C          	INC	E		; naechste Spalte
 3960 DE60  10 F7       	DJNZ	ESCF1
 3961 DE62  01 0819     	LD	BC,0819h	; Spalte von 8 bis 25 zulaessig
 3962 DE65  CD D585     	CALL	INPUT		; Eingabe der Zeichenkette
 3963 DE68  38 AA       	JR	C,ESCZ4		; BRK -> nur Statuszeile regenerieren
 3964                   
 3965                   ; Zeichenkette ist eingegeben
 3966 DE6A  21 AD08     	LD	HL,0AD08h	; VRAM-Adresse der eingegebenen Zeichenkette
 3967 DE6D  11 0023     	LD	DE,STRING	; Stringspeicher
 3968 DE70  01 001B     	LD	BC,LSTR		; max. Laenge
 3969 DE73  ED B0       	LDIR			; eintragen und merken
 3970 DE75  CD D845     	CALL	STATUS		; Statuszeile regenerieren
 3971 DE78  ED 5B 0020  	LD	DE,(COL)	; EDIT-Cursor mitgeben
 3972                   ;
 3973                   ; F2 (F6) - weitersuchen:
 3974                   ;
 3975 DE7C  3A 0023     EFIND:	LD	A,(STRING)
 3976 DE7F  B7          	OR	A
 3977 DE80  C8          	RET	Z		; kein Text
 3978 DE81  CD D70A     	CALL	MPAGE		; Seite speichern
 3979 DE84  38 9D       	JR	C,ESCF2		; "No Memory" und Abbruch
 3980 DE86  11 0001     	LD	DE,1
 3981 DE89  CD D64F     	CALL	TXANF		; 1 Zeile vorwaerts
 3982 DE8C  CD D20C     	CALL	FIND		; String suchen ab 2. BS-Zeile
 3983 DE8F  CD D3E4     	CALL	LCOUNT		; Zeilennummer neu ermitteln
 3984 DE92  CD D7F2     	CALL	WRPG		; Seite neu anzeigen
 3985 DE95  C3 C986     	JP	CLI2		; Cursorposition regenerieren
 3986                   
 3987                   ; ESC-H (Hilfe) - Anzeige von Bild 1 und Warten auf Tastatureingabe
 3988                   ; Hilfe-Texte muessen vorher dort angezeigt sein!
 3989                   ;
 3990 DE98  ED 5B B7A0  ESCH:	LD	DE,(CURSO)
 3991 DE9C  21 1548     	LD	HL,1548H
 3992 DE9F  22 B7A0     	LD	(CURSO),HL
 3993 DEA2  DD 7E 01    	LD	A,(IX+1)	; Merkzelle von Port 84h
 3994 DEA5  F6 05       	OR	0101b		; Anzeige+Zugriff Bild 1
 3995 DEA7  DD 77 01    	LD	(IX+1),A
 3996 DEAA  D3 84       	OUT	(PORT1),A
 3997 DEAC  CD D50F     	CALL	KEYB		; Tastatureingabe abwarten
 3998 DEAF  DD 7E 01    BILD0:	LD	A,(IX+1)	; Merkzelle von Port 84h
 3999 DEB2  E6 FA       	AND	11111010b	; Anzeige+Zugriff Bild 0
 4000 DEB4  DD 77 01    	LD	(IX+1),A
 4001 DEB7  D3 84       	OUT	(PORT1),A
 4002 DEB9  ED 53 B7A0  	LD	(CURSO),DE
 4003 DEBD  C9          	RET
 4004                   
 4005                   ;=======	DEVICE-Kommandos	=======
 4006                   
 4007 DEBE  DDDD        	DEFW	0DDDDH
 4008 DEC0  44 49 52    	DEFM	'DIR'
 4009 DEC3  1F          	DB	1Fh		; In Register DE Maske uebergeben
 4010 DEC4  CD F021     	CALL	PV7		; neue Funktion ab CAOS 4.7
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  83
EDITOR  Z80

 4011 DEC7  08          	DB	8		; Verzeichnis anzeigen
 4012 DEC8  C9          	RET
 4013                   
 4014 DEC9  DDDD        	DEFW	0DDDDH
 4015 DECB  43 44       	DEFM	'CD'
 4016 DECD  1F          	DB	1Fh		; neues Laufwerk in Register DE uebergeben
 4017 DECE  CD F021     	CALL	PV7		; neue Funktion ab CAOS 4.7
 4018 DED1  09          	DB	9		; Laufwerk wechseln
 4019 DED2  C9          	RET
 4020                   
 4021 DED3  DDDD        	DEFW	0DDDDH
 4022 DED5  52 45 4E    	DEFM	'REN'
 4023 DED8  1F          	DB	1Fh		; Textargument zulaessig (2 Dateinamen)
 4024 DED9  CD F021     	CALL	PV7
 4025 DEDC  0B          	DB	11		; Datei umbenennen
 4026 DEDD  C9          	RET
 4027                   
 4028 DEDE  DDDD        	DEFW	0DDDDH
 4029 DEE0  45 52 41    	DB	'ERA'
 4030 DEE3  1F          	DB	1Fh		; Textargument zulaessig (Dateiname)
 4031 DEE4  CD F021     	CALL	PV7
 4032 DEE7  0A          	DB	10		; Datei loeschen
 4033 DEE8  C9          	RET
 4034                   
 4035                   ;-------
 4036                   ; Geraeteumschaltung und Anzeige
 4037                   ; DEVICE	Auflisten der installierten Treiber
 4038                   ; DEVICE n	Umschaltung Geraet n (0..7)
 4039                   ;
 4040 DEE9  DDDD        	DW	0DDDDH
 4041 DEEB  44 45 56 49 	DB	'DEVICE',1
 4042 DEF2  A7          	AND	A		; Parameter angegeben?
 4043 DEF3  28 0E       	JR	Z,DRLIST	; nein, Treiber auflisten
 4044 DEF5  7D          	LD	A,L
 4045 DEF6  FE 08       	CP	8
 4046 DEF8  30 04       	JR	NC,DERR		; n > 8
 4047 DEFA  CD DF05     	CALL	SETDRV		; Treiber einstellen
 4048 DEFD  D0          	RET	NC		; kein Fehler
 4049 DEFE  CD F003     DERR:	CALL	PV1
 4050 DF01  19          	DB	ERRM		; Treiber nicht aktiv
 4051 DF02  C9          	RET
 4052                   	;
 4053 DF03  3E FF       DRLIST:	LD	A,0FFh		; Treiber auflisten
 4054 DF05  CD F003     SETDRV:	CALL	PV1
 4055 DF08  49          	DB	DEVICE		; 49H - neue Funktion seit CAOS 4.6
 4056 DF09  C9          	RET
 4057                   ;
 4058                   ; Steuercodetabelle fuer 80-Zeichen-Mode:
 4059                   ;			; 	CRT	EDIT
 4060                   ;
 4061 DF0A  C671        CTAB80:	DW	NOOP	; 00
 4062 DF0C  C98F        	DW	CLR80	; 01	CLR	Zeichen links loeschen	OK
 4063 DF0E  D405        	DW	EDEL	; 02	Sh-DEL	Zeile loeschen		OK
 4064 DF10  C671        	DW	NOOP	; 03	BRK	Editor beenden		OK
 4065 DF12  C671        	DW	NOOP	; 04	Sh-BRK
 4066 DF14  D424        	DW	EDTAB	; 05	-	F1 (Tabulator)		OK INS und NoINS
 4067 DF16  DE7C        	DW	EFIND	; 06	-	F2 (weitersuchen)	OK
 4068 DF18  C671        	DW	NOOP	; 07	BEEP
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  84
EDITOR  Z80

 4069 DF1A  C8D2        	DW	CUL80	; 08	CUL	Cursor nach links	OK mit Scrolling
 4070 DF1C  C696        	DW	CUR80	; 09	CUR	Cursor nach rechts	OK mit Scrolling
 4071 DF1E  C6D8        	DW	CUD80	; 0A	CUD	Cursor runter		OK mit Scrolling
 4072 DF20  C737        	DW	CUU80	; 0B	CUU	Cursor hoch		OK mit Scrolling
 4073 DF22  C8CB        	DW	ECLS	; 0C	Sh-HOME	Cursor rechts/unten	OK
 4074 DF24  C8C8        	DW	CBL80	; 0D	CR
 4075 DF26  D450        	DW	EENT	; 0E/0D	Sh-Enter neue Zeile		OK INS und NoINS
 4076 DF28  C920        	DW	HCOPY	; 0F	Sh-CLR	Hardcopy, CALC		OK
 4077 DF2A  C8C6        	DW	HOME80	; 10	HOME	Cursor links oben	OK
 4078 DF2C  C869        	DW	EVPG	; 11	Sh-CUU	Seite zurueck		OK
 4079 DF2E  C846        	DW	ENPG	; 12	Sh-CUD	Seite vor		OK
 4080 DF30  C932        	DW	ASCII	; 13	STOP	Wechsel Zeichensatz	OK
 4081 DF32  C97B        	DW	CLICK	; 14	Sh-INS	Tastenclick EIN/AUS	OK
 4082 DF34  C671        	DW	NOOP	; 15	-
 4083 DF36  D98F        	DW	CAPS80	; 16	CAPS	(Anzeige aktualisieren)
 4084 DF38  C671        	DW	NOOP	; 17	-
 4085 DF3A  C6C3        	DW	WRIGH	; 18	Sh-CUR	Wort nach rechts	OK mit Scrolling
 4086 DF3C  C8FC        	DW	WLEFT	; 19	Sh-CUL	Wort nach links		OK mit Scrolling
 4087 DF3E  C971        	DW	INS80	; 1A	INS	Einfuegen ein/aus	OK
 4088 DF40  C671        	DW	NOOP	; 1B	ESC	(wird innerhalb KBD in CAOS ausgewertet)
 4089 DF42  C671        	DW	NOOP	; 1C	LIST	-
 4090 DF44  C671        	DW	NOOP	; 1D	RUN	-
 4091 DF46  C671        	DW	NOOP	; 1E	CONT	-
 4092 DF48  C9C5        	DW	DEL80	; 1F	DEL	akt. Zeichen loeschen	OK
 4093                   
 4094                   ; ESC-Tabelle fuer die Funktionen ESC-A bis ESC-Z
 4095                   ;
 4096 DF4A  DB96        ESCTAB:	DW	ESCA	; ESC-A	ANFANG	Eingabe Blockanfangsmarke 1Ch
 4097 DF4C  DD3F        	DW	ESCB	; ESC-B	BOTTOM	gehe zu Textende (ehemals Menuewort BOTTOM)
 4098 DF4E  DC7C        	DW	ESCC	; ESC-C COPY	Block kopieren (ehemals Menuewort PCOPY)
 4099 DF50  DB9F        	DW	ESCD	; ESC-D	DOWN	Eingabe Pfeil runter 1Fh
 4100 DF52  DB9C        	DW	ESCE	; ESC-E	ENDE	Eingabe Blockendemarke 1Eh
 4101 DF54  DE40        	DW	ESCF	; ESC-F FIND	Suchen (ehemals Menuewort FIND)
 4102 DF56  DBA3        	DW	ESCG	; ESC-G	GRAFIK	Eingabe Grafikzeichen
 4103 DF58  DE98        	DW	ESCH	; ESC-H	HELP	Online-Hilfe (Anzeige IRM-Seite 2)
 4104 DF5A  C671        	DW	NOOP	; ESC-I
 4105 DF5C  DB8D        	DW	ESCJ	; ESC-J	eJect	Eingabe Seitenwechsel (Eject) 0Ch
 4106 DF5E  DC85        	DW	ESCK	; ESC-K KILL	Block loeschen (ehemals Menuewort PDEL)
 4107 DF60  DC6E        	DW	ESCL	; ESC-L	LINKS	setze linke Randmarke
 4108 DF62  C671        	DW	NOOP	; ESC-M
 4109 DF64  DB90        	DW	ESCN	; ESC-N NEWLINE	Zeile binden 0Eh 
 4110 DF66  C671        	DW	NOOP	; ESC-O
 4111 DF68  C671        	DW	NOOP	; ESC-P
 4112 DF6A  C671        	DW	NOOP	; ESC-Q
 4113 DF6C  DC73        	DW	ESCR	; ESC-R	RECHTS	setze rechte Randmarke
 4114 DF6E  C671        	DW	NOOP	; ESC-S
 4115 DF70  DD58        	DW	ESCT	; ESC-T	TOP	gehe zu Textanfang (ehemals Menuewort TOP)
 4116 DF72  DB99        	DW	ESCU	; ESC-U	UP	Eingabe Pfeil hoch 1Dh
 4117 DF74  DC8A        	DW	ESCV	; ESC-V moVe	Block verschieben (COPY + KILL)
 4118 DF76  C671        	DW	NOOP	; ESC-W
 4119 DF78  DB93        	DW	ESCX	; ESC-X	HEX	Eingabe HEX-Sequenz 0Fh (wie WP9)
 4120 DF7A  C671        	DW	NOOP	; ESC-Y
 4121 DF7C  DDC1        	DW	ESCZ	; ESC-Z	ZEILE	Gehe zu Zeile Nr.?
 4122                   
 4123                   	ABSFILL	0E000h,<USER-ROM-Ende (Editor)>
    7 DF7E  FF FF FF FF 	  DS	0E000h - $,0FFh
 4124                   
 4125 E000              ROMEND:
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  85
EDITOR  Z80

 4126                   	.DEPHASE
 4127                   
 4128                   	END
 0 Error(s) Detected.
 8320 Absolute Bytes. 704 Symbols Detected.
 DC73        	DW	ESCR	; ESC-R	RECHTS	setze rechte Randmarke
 4114 DF6E